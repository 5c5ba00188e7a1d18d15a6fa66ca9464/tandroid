package org.telegram.ui.Cells;

import android.animation.Animator;
import android.animation.AnimatorListenerAdapter;
import android.animation.AnimatorSet;
import android.animation.Keyframe;
import android.animation.ObjectAnimator;
import android.animation.PropertyValuesHolder;
import android.animation.ValueAnimator;
import android.app.Activity;
import android.content.Context;
import android.content.res.ColorStateList;
import android.graphics.Bitmap;
import android.graphics.Canvas;
import android.graphics.Color;
import android.graphics.ColorFilter;
import android.graphics.LinearGradient;
import android.graphics.Paint;
import android.graphics.Path;
import android.graphics.PorterDuff;
import android.graphics.PorterDuffColorFilter;
import android.graphics.Rect;
import android.graphics.RectF;
import android.graphics.Shader;
import android.graphics.Typeface;
import android.graphics.drawable.BitmapDrawable;
import android.graphics.drawable.Drawable;
import android.graphics.drawable.RippleDrawable;
import android.net.Uri;
import android.os.Build;
import android.os.Bundle;
import android.os.SystemClock;
import android.text.Layout;
import android.text.Spannable;
import android.text.SpannableString;
import android.text.SpannableStringBuilder;
import android.text.StaticLayout;
import android.text.TextPaint;
import android.text.TextUtils;
import android.text.style.CharacterStyle;
import android.text.style.ClickableSpan;
import android.text.style.URLSpan;
import android.util.Property;
import android.util.SparseArray;
import android.util.StateSet;
import android.view.MotionEvent;
import android.view.View;
import android.view.ViewConfiguration;
import android.view.ViewGroup;
import android.view.ViewStructure;
import android.view.accessibility.AccessibilityEvent;
import android.view.accessibility.AccessibilityManager;
import android.view.accessibility.AccessibilityNodeInfo;
import android.view.accessibility.AccessibilityNodeProvider;
import android.view.animation.Interpolator;
import android.widget.Toast;
import androidx.core.graphics.ColorUtils;
import androidx.core.view.ViewCompat;
import androidx.recyclerview.widget.ItemTouchHelper;
import com.google.android.exoplayer2.DefaultRenderersFactory;
import com.google.android.exoplayer2.upstream.DefaultLoadErrorHandlingPolicy;
import com.google.android.exoplayer2.util.MimeTypes;
import com.google.android.gms.common.Scopes;
import com.google.android.gms.common.internal.ImagesContract;
import com.google.firebase.remoteconfig.FirebaseRemoteConfig;
import java.io.File;
import java.lang.ref.WeakReference;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collections;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Locale;
import java.util.Stack;
import java.util.concurrent.atomic.AtomicReference;
import org.telegram.PhoneFormat.PhoneFormat;
import org.telegram.messenger.AccountInstance;
import org.telegram.messenger.AndroidUtilities;
import org.telegram.messenger.ChatObject;
import org.telegram.messenger.ContactsController;
import org.telegram.messenger.DialogObject;
import org.telegram.messenger.DocumentObject;
import org.telegram.messenger.DownloadController;
import org.telegram.messenger.Emoji;
import org.telegram.messenger.FileLoader;
import org.telegram.messenger.FileLog;
import org.telegram.messenger.ImageLoader;
import org.telegram.messenger.ImageLocation;
import org.telegram.messenger.ImageReceiver;
import org.telegram.messenger.LocaleController;
import org.telegram.messenger.MediaController;
import org.telegram.messenger.MediaDataController;
import org.telegram.messenger.MessageObject;
import org.telegram.messenger.MessagesController;
import org.telegram.messenger.NotificationCenter;
import org.telegram.messenger.SendMessagesHelper;
import org.telegram.messenger.SharedConfig;
import org.telegram.messenger.UserConfig;
import org.telegram.messenger.UserObject;
import org.telegram.messenger.Utilities;
import org.telegram.messenger.WebFile;
import org.telegram.messenger.beta.R;
import org.telegram.messenger.browser.Browser;
import org.telegram.messenger.video.VideoPlayerRewinder;
import org.telegram.tgnet.ConnectionsManager;
import org.telegram.tgnet.TLObject;
import org.telegram.tgnet.TLRPC;
import org.telegram.ui.ActionBar.Theme;
import org.telegram.ui.Cells.TextSelectionHelper;
import org.telegram.ui.ChatActivity;
import org.telegram.ui.Components.AnimatedFileDrawable;
import org.telegram.ui.Components.AnimatedNumberLayout;
import org.telegram.ui.Components.AnimationProperties;
import org.telegram.ui.Components.AudioVisualizerDrawable;
import org.telegram.ui.Components.AvatarDrawable;
import org.telegram.ui.Components.BackgroundGradientDrawable;
import org.telegram.ui.Components.CheckBoxBase;
import org.telegram.ui.Components.CubicBezierInterpolator;
import org.telegram.ui.Components.EmptyStubSpan;
import org.telegram.ui.Components.FloatSeekBarAccessibilityDelegate;
import org.telegram.ui.Components.InfiniteProgress;
import org.telegram.ui.Components.LinkPath;
import org.telegram.ui.Components.LinkSpanDrawable;
import org.telegram.ui.Components.MessageBackgroundDrawable;
import org.telegram.ui.Components.MotionBackgroundDrawable;
import org.telegram.ui.Components.MsgClockDrawable;
import org.telegram.ui.Components.Point;
import org.telegram.ui.Components.RLottieDrawable;
import org.telegram.ui.Components.RadialProgress2;
import org.telegram.ui.Components.Reactions.ReactionsLayoutInBubble;
import org.telegram.ui.Components.RecyclerListView;
import org.telegram.ui.Components.RoundVideoPlayingDrawable;
import org.telegram.ui.Components.SearchViewPager;
import org.telegram.ui.Components.SeekBar;
import org.telegram.ui.Components.SeekBarAccessibilityDelegate;
import org.telegram.ui.Components.SeekBarWaveform;
import org.telegram.ui.Components.SlotsDrawable;
import org.telegram.ui.Components.StaticLayoutEx;
import org.telegram.ui.Components.TextStyleSpan;
import org.telegram.ui.Components.TimerParticles;
import org.telegram.ui.Components.TranscribeButton;
import org.telegram.ui.Components.TypefaceSpan;
import org.telegram.ui.Components.URLSpanBotCommand;
import org.telegram.ui.Components.URLSpanBrowser;
import org.telegram.ui.Components.URLSpanMono;
import org.telegram.ui.Components.URLSpanNoUnderline;
import org.telegram.ui.Components.VideoForwardDrawable;
import org.telegram.ui.Components.spoilers.SpoilerEffect;
import org.telegram.ui.GroupCallActivity;
import org.telegram.ui.PhotoViewer;
import org.telegram.ui.PinchToZoomHelper;
import org.telegram.ui.SecretMediaViewer;
/* loaded from: classes4.dex */
public class ChatMessageCell extends BaseCell implements SeekBar.SeekBarDelegate, ImageReceiver.ImageReceiverDelegate, DownloadController.FileDownloadProgressListener, TextSelectionHelper.SelectableView, NotificationCenter.NotificationCenterDelegate {
    private static final int DOCUMENT_ATTACH_TYPE_AUDIO = 3;
    private static final int DOCUMENT_ATTACH_TYPE_DOCUMENT = 1;
    private static final int DOCUMENT_ATTACH_TYPE_GIF = 2;
    private static final int DOCUMENT_ATTACH_TYPE_MUSIC = 5;
    private static final int DOCUMENT_ATTACH_TYPE_NONE = 0;
    private static final int DOCUMENT_ATTACH_TYPE_ROUND = 7;
    private static final int DOCUMENT_ATTACH_TYPE_STICKER = 6;
    private static final int DOCUMENT_ATTACH_TYPE_THEME = 9;
    private static final int DOCUMENT_ATTACH_TYPE_VIDEO = 4;
    private static final int DOCUMENT_ATTACH_TYPE_WALLPAPER = 8;
    private static float[] radii = new float[8];
    private final boolean ALPHA_PROPERTY_WORKAROUND;
    public Property<ChatMessageCell, Float> ANIMATION_OFFSET_X;
    private int TAG;
    CharSequence accessibilityText;
    private SparseArray<Rect> accessibilityVirtualViewBounds;
    private int addedCaptionHeight;
    private boolean addedForTest;
    private int additionalTimeOffsetY;
    private StaticLayout adminLayout;
    private boolean allowAssistant;
    private float alphaInternal;
    private int animateFromStatusDrawableParams;
    private boolean animatePollAnswer;
    private boolean animatePollAnswerAlpha;
    private boolean animatePollAvatars;
    private int animateToStatusDrawableParams;
    private int animatingDrawVideoImageButton;
    private float animatingDrawVideoImageButtonProgress;
    private float animatingLoadingProgressProgress;
    private int animatingNoSound;
    private boolean animatingNoSoundPlaying;
    private float animatingNoSoundProgress;
    private float animationOffsetX;
    private boolean animationRunning;
    private boolean attachedToWindow;
    private StaticLayout authorLayout;
    private int authorX;
    private boolean autoPlayingMedia;
    private int availableTimeWidth;
    private AvatarDrawable avatarDrawable;
    private ImageReceiver avatarImage;
    private boolean avatarPressed;
    private Theme.MessageDrawable.PathDrawParams backgroundCacheParams;
    private MessageBackgroundDrawable backgroundDrawable;
    private int backgroundDrawableBottom;
    private int backgroundDrawableLeft;
    private int backgroundDrawableRight;
    private int backgroundDrawableTop;
    private int backgroundHeight;
    private int backgroundWidth;
    private int blurredViewBottomOffset;
    private int blurredViewTopOffset;
    private ArrayList<BotButton> botButtons;
    private HashMap<String, BotButton> botButtonsByData;
    private HashMap<String, BotButton> botButtonsByPosition;
    private String botButtonsLayout;
    private boolean bottomNearToSet;
    private int buttonPressed;
    private int buttonState;
    private int buttonX;
    private int buttonY;
    private final boolean canDrawBackgroundInParent;
    private boolean canStreamVideo;
    private int captionHeight;
    private StaticLayout captionLayout;
    private int captionOffsetX;
    private AtomicReference<Layout> captionPatchedSpoilersLayout;
    private List<SpoilerEffect> captionSpoilers;
    private Stack<SpoilerEffect> captionSpoilersPool;
    private int captionWidth;
    private float captionX;
    private float captionY;
    private CheckBoxBase checkBox;
    private boolean checkBoxAnimationInProgress;
    private float checkBoxAnimationProgress;
    private int checkBoxTranslation;
    private boolean checkBoxVisible;
    private boolean checkOnlyButtonPressed;
    public boolean clipToGroupBounds;
    private String closeTimeText;
    private int closeTimeWidth;
    private int commentArrowX;
    private AvatarDrawable[] commentAvatarDrawables;
    private ImageReceiver[] commentAvatarImages;
    private boolean[] commentAvatarImagesVisible;
    private boolean commentButtonPressed;
    private Rect commentButtonRect;
    private boolean commentDrawUnread;
    private StaticLayout commentLayout;
    private AnimatedNumberLayout commentNumberLayout;
    private int commentNumberWidth;
    private InfiniteProgress commentProgress;
    private float commentProgressAlpha;
    private long commentProgressLastUpadteTime;
    private int commentUnreadX;
    private int commentWidth;
    private int commentX;
    private AvatarDrawable contactAvatarDrawable;
    private float controlsAlpha;
    private int currentAccount;
    private Theme.MessageDrawable currentBackgroundDrawable;
    private Theme.MessageDrawable currentBackgroundSelectedDrawable;
    private CharSequence currentCaption;
    private TLRPC.Chat currentChat;
    private int currentFocusedVirtualView;
    private TLRPC.Chat currentForwardChannel;
    private String currentForwardName;
    private String currentForwardNameString;
    private TLRPC.User currentForwardUser;
    private int currentMapProvider;
    private MessageObject currentMessageObject;
    private MessageObject.GroupedMessages currentMessagesGroup;
    private String currentNameString;
    private TLRPC.FileLocation currentPhoto;
    private String currentPhotoFilter;
    private String currentPhotoFilterThumb;
    private TLRPC.PhotoSize currentPhotoObject;
    private TLRPC.PhotoSize currentPhotoObjectThumb;
    private BitmapDrawable currentPhotoObjectThumbStripped;
    private MessageObject.GroupedMessagePosition currentPosition;
    private String currentRepliesString;
    private TLRPC.PhotoSize currentReplyPhoto;
    private float currentSelectedBackgroundAlpha;
    private String currentTimeString;
    private String currentUrl;
    private TLRPC.User currentUser;
    private TLRPC.User currentViaBotUser;
    private String currentViewsString;
    private WebFile currentWebFile;
    private ChatMessageCellDelegate delegate;
    private RectF deleteProgressRect;
    private StaticLayout descriptionLayout;
    private int descriptionX;
    private int descriptionY;
    private Runnable diceFinishCallback;
    private boolean disallowLongPress;
    private StaticLayout docTitleLayout;
    private int docTitleOffsetX;
    private int docTitleWidth;
    private TLRPC.Document documentAttach;
    private int documentAttachType;
    private boolean drawBackground;
    private boolean drawCommentButton;
    private boolean drawCommentNumber;
    private boolean drawForwardedName;
    public boolean drawFromPinchToZoom;
    private boolean drawImageButton;
    private boolean drawInstantView;
    private int drawInstantViewType;
    private boolean drawJoinChannelView;
    private boolean drawJoinGroupView;
    private boolean drawMediaCheckBox;
    private boolean drawName;
    private boolean drawNameLayout;
    private boolean drawPhotoImage;
    public boolean drawPinnedBottom;
    private boolean drawPinnedTop;
    private boolean drawRadialCheckBackground;
    private boolean drawSelectionBackground;
    private int drawSideButton;
    private boolean drawTime;
    private float drawTimeX;
    private float drawTimeY;
    private boolean drawVideoImageButton;
    private boolean drawVideoSize;
    private StaticLayout durationLayout;
    private int durationWidth;
    private boolean edited;
    boolean enterTransitionInProgress;
    private boolean firstCircleLength;
    private int firstVisibleBlockNum;
    private boolean flipImage;
    private boolean forceNotDrawTime;
    private boolean forwardBotPressed;
    private boolean forwardName;
    private int forwardNameCenterX;
    private float[] forwardNameOffsetX;
    private boolean forwardNamePressed;
    private float forwardNameX;
    private int forwardNameY;
    private StaticLayout[] forwardedNameLayout;
    private int forwardedNameWidth;
    private boolean fullyDraw;
    private boolean gamePreviewPressed;
    private LinearGradient gradientShader;
    private boolean groupPhotoInvisible;
    private MessageObject.GroupedMessages groupedMessagesToSet;
    private boolean hadLongPress;
    public boolean hasDiscussion;
    private boolean hasEmbed;
    private boolean hasGamePreview;
    private boolean hasInvoicePreview;
    private boolean hasLinkPreview;
    private int hasMiniProgress;
    private boolean hasNewLineForTime;
    private boolean hasOldCaptionPreview;
    private boolean hasPsaHint;
    private int highlightProgress;
    private float hintButtonProgress;
    private boolean hintButtonVisible;
    private int imageBackgroundColor;
    private int imageBackgroundGradientColor1;
    private int imageBackgroundGradientColor2;
    private int imageBackgroundGradientColor3;
    private int imageBackgroundGradientRotation;
    private float imageBackgroundIntensity;
    private int imageBackgroundSideColor;
    private int imageBackgroundSideWidth;
    private boolean imageDrawn;
    private boolean imagePressed;
    private boolean inLayout;
    private StaticLayout infoLayout;
    private int infoWidth;
    private int infoX;
    private boolean instantButtonPressed;
    private RectF instantButtonRect;
    private boolean instantPressed;
    private int instantTextLeftX;
    private boolean instantTextNewLine;
    private int instantTextX;
    private StaticLayout instantViewLayout;
    private int instantWidth;
    private Runnable invalidateRunnable;
    private boolean invalidateSpoilersParent;
    private boolean invalidatesParent;
    private boolean isAvatarVisible;
    public boolean isBlurred;
    public boolean isBot;
    private boolean isCaptionSpoilerPressed;
    public boolean isChat;
    private boolean isCheckPressed;
    private boolean isHighlighted;
    private boolean isHighlightedAnimated;
    private boolean isMedia;
    public boolean isMegagroup;
    public boolean isPinned;
    public boolean isPinnedChat;
    private boolean isPlayingRound;
    private boolean isPressed;
    public boolean isRepliesChat;
    private boolean isRoundVideo;
    private boolean isSmallImage;
    private boolean isSpoilerRevealing;
    public boolean isThreadChat;
    private boolean isThreadPost;
    private boolean isUpdating;
    private int keyboardHeight;
    private long lastAnimationTime;
    private long lastCheckBoxAnimationTime;
    private long lastControlsAlphaChangeTime;
    private int lastDeleteDate;
    private float lastDrawingAudioProgress;
    float lastDrawingPlayPauseAlpha;
    private int lastHeight;
    private long lastHighlightProgressTime;
    private long lastLoadingSizeTotal;
    private long lastNamesAnimationTime;
    private TLRPC.Poll lastPoll;
    private long lastPollCloseTime;
    private ArrayList<TLRPC.TL_pollAnswerVoters> lastPollResults;
    private int lastPollResultsVoters;
    private String lastPostAuthor;
    private TLRPC.TL_messageReactions lastReactions;
    private int lastRepliesCount;
    private TLRPC.Message lastReplyMessage;
    private long lastSeekUpdateTime;
    private int lastSendState;
    int lastSize;
    private int lastTime;
    private float lastTouchX;
    private float lastTouchY;
    private int lastViewsCount;
    private int lastVisibleBlockNum;
    private WebFile lastWebFile;
    private int lastWidth;
    private int layoutHeight;
    private int layoutWidth;
    private int linkBlockNum;
    private int linkPreviewHeight;
    private boolean linkPreviewPressed;
    private int linkSelectionBlockNum;
    public long linkedChatId;
    private LinkSpanDrawable.LinkCollector links;
    private StaticLayout loadingProgressLayout;
    private boolean locationExpired;
    private ImageReceiver locationImageReceiver;
    private boolean mediaBackground;
    private CheckBoxBase mediaCheckBox;
    private int mediaOffsetY;
    private boolean mediaWasInvisible;
    private MessageObject messageObjectToSet;
    private int miniButtonPressed;
    private int miniButtonState;
    private MotionBackgroundDrawable motionBackgroundDrawable;
    private StaticLayout nameLayout;
    private float nameOffsetX;
    private int nameWidth;
    private float nameX;
    private float nameY;
    private int namesOffset;
    private boolean needNewVisiblePart;
    public boolean needReplyImage;
    private int noSoundCenterX;
    private boolean otherPressed;
    private int otherX;
    private int otherY;
    private int overideShouldDrawTimeOnMedia;
    private int parentHeight;
    public float parentViewTopOffset;
    private int parentWidth;
    private StaticLayout performerLayout;
    private int performerX;
    private ImageReceiver photoImage;
    private boolean photoNotSet;
    private TLObject photoParentObject;
    private StaticLayout photosCountLayout;
    private int photosCountWidth;
    public boolean pinnedBottom;
    public boolean pinnedTop;
    private float pollAnimationProgress;
    private float pollAnimationProgressTime;
    private AvatarDrawable[] pollAvatarDrawables;
    private ImageReceiver[] pollAvatarImages;
    private boolean[] pollAvatarImagesVisible;
    private ArrayList<PollButton> pollButtons;
    private CheckBoxBase[] pollCheckBox;
    private boolean pollClosed;
    private boolean pollHintPressed;
    private int pollHintX;
    private int pollHintY;
    private boolean pollUnvoteInProgress;
    private boolean pollVoteInProgress;
    private int pollVoteInProgressNum;
    private boolean pollVoted;
    private int pressedBotButton;
    private LinkSpanDrawable pressedLink;
    private int pressedLinkType;
    private int[] pressedState;
    private int pressedVoteButton;
    private float psaButtonProgress;
    private boolean psaButtonVisible;
    private int psaHelpX;
    private int psaHelpY;
    private boolean psaHintPressed;
    private RadialProgress2 radialProgress;
    public final ReactionsLayoutInBubble reactionsLayoutInBubble;
    private RectF rect;
    private Path rectPath;
    private StaticLayout repliesLayout;
    private int repliesTextWidth;
    public ImageReceiver replyImageReceiver;
    public StaticLayout replyNameLayout;
    private int replyNameOffset;
    private int replyNameWidth;
    private boolean replyPanelIsForward;
    private boolean replyPressed;
    public List<SpoilerEffect> replySpoilers;
    private Stack<SpoilerEffect> replySpoilersPool;
    public int replyStartX;
    public int replyStartY;
    public StaticLayout replyTextLayout;
    private int replyTextOffset;
    private int replyTextWidth;
    private final Theme.ResourcesProvider resourcesProvider;
    private float roundPlayingDrawableProgress;
    private float roundProgressAlpha;
    float roundSeekbarOutAlpha;
    float roundSeekbarOutProgress;
    int roundSeekbarTouched;
    private float roundToPauseProgress;
    private float roundToPauseProgress2;
    private RoundVideoPlayingDrawable roundVideoPlayingDrawable;
    private Path sPath;
    private boolean scheduledInvalidate;
    private Rect scrollRect;
    private SeekBar seekBar;
    private SeekBarAccessibilityDelegate seekBarAccessibilityDelegate;
    private SeekBarWaveform seekBarWaveform;
    private int seekBarX;
    private int seekBarY;
    float seekbarRoundX;
    float seekbarRoundY;
    private float selectedBackgroundProgress;
    private Paint selectionOverlayPaint;
    private Drawable[] selectorDrawable;
    private int[] selectorDrawableMaskType;
    private AnimatorSet shakeAnimation;
    private boolean sideButtonPressed;
    private float sideStartX;
    private float sideStartY;
    private StaticLayout siteNameLayout;
    private boolean siteNameRtl;
    private int siteNameWidth;
    private float slidingOffsetX;
    private StaticLayout songLayout;
    private int songX;
    private SpoilerEffect spoilerPressed;
    private AtomicReference<Layout> spoilersPatchedReplyTextLayout;
    private boolean statusDrawableAnimationInProgress;
    private ValueAnimator statusDrawableAnimator;
    private float statusDrawableProgress;
    private int substractBackgroundHeight;
    private int textX;
    private int textY;
    private float timeAlpha;
    private int timeAudioX;
    private StaticLayout timeLayout;
    private boolean timePressed;
    private int timeTextWidth;
    private boolean timeWasInvisible;
    private int timeWidth;
    private int timeWidthAudio;
    private int timeX;
    private TimerParticles timerParticles;
    private float timerTransitionProgress;
    private StaticLayout titleLayout;
    private int titleX;
    private float toSeekBarProgress;
    private boolean topNearToSet;
    private long totalChangeTime;
    private int totalCommentWidth;
    private int totalHeight;
    private int totalVisibleBlocksCount;
    private TranscribeButton transcribeButton;
    private float transcribeX;
    private float transcribeY;
    private final TransitionParams transitionParams;
    float transitionYOffsetForDrawables;
    private int unmovedTextX;
    private Runnable unregisterFlagSecure;
    private ArrayList<LinkPath> urlPathCache;
    private ArrayList<LinkPath> urlPathSelection;
    private boolean useSeekBarWaveform;
    private boolean useTranscribeButton;
    private int viaNameWidth;
    private TypefaceSpan viaSpan1;
    private TypefaceSpan viaSpan2;
    private int viaWidth;
    private boolean vibrateOnPollVote;
    private int videoButtonPressed;
    private int videoButtonX;
    private int videoButtonY;
    VideoForwardDrawable videoForwardDrawable;
    private StaticLayout videoInfoLayout;
    VideoPlayerRewinder videoPlayerRewinder;
    private RadialProgress2 videoRadialProgress;
    private float viewTop;
    private StaticLayout viewsLayout;
    private int viewsTextWidth;
    private float voteCurrentCircleLength;
    private float voteCurrentProgressTime;
    private long voteLastUpdateTime;
    private float voteRadOffset;
    private boolean voteRisingCircleLength;
    private boolean wasLayout;
    private boolean wasPinned;
    private boolean wasSending;
    private int widthBeforeNewTimeLine;
    private int widthForButtons;
    private boolean willRemoved;

    public RadialProgress2 getRadialProgress() {
        return this.radialProgress;
    }

    public void setEnterTransitionInProgress(boolean b) {
        this.enterTransitionInProgress = b;
        invalidate();
    }

    public ReactionsLayoutInBubble.ReactionButton getReactionButton(String reaction) {
        return this.reactionsLayoutInBubble.getReactionButton(reaction);
    }

    public MessageObject getPrimaryMessageObject() {
        MessageObject messageObject = null;
        MessageObject messageObject2 = this.currentMessageObject;
        if (messageObject2 != null && this.currentMessagesGroup != null && messageObject2.hasValidGroupId()) {
            messageObject = this.currentMessagesGroup.findPrimaryMessageObject();
        }
        if (messageObject != null) {
            return messageObject;
        }
        return this.currentMessageObject;
    }

    @Override // org.telegram.messenger.NotificationCenter.NotificationCenterDelegate
    public void didReceivedNotification(int id, int account, Object... args) {
        TLRPC.User user;
        if (id == NotificationCenter.startSpoilers) {
            setSpoilersSuppressed(false);
        } else if (id == NotificationCenter.stopSpoilers) {
            setSpoilersSuppressed(true);
        } else if (id == NotificationCenter.userInfoDidLoad && (user = this.currentUser) != null) {
            Long uid = (Long) args[0];
            if (user.id == uid.longValue()) {
                setAvatar(this.currentMessageObject);
            }
        }
    }

    private void setAvatar(MessageObject messageObject) {
        if (messageObject == null) {
            return;
        }
        if (this.isAvatarVisible) {
            if (messageObject.customAvatarDrawable != null) {
                this.avatarImage.setImageBitmap(messageObject.customAvatarDrawable);
                return;
            }
            TLRPC.User user = this.currentUser;
            if (user != null) {
                if (user.photo != null) {
                    this.currentPhoto = this.currentUser.photo.photo_small;
                } else {
                    this.currentPhoto = null;
                }
                this.avatarDrawable.setInfo(this.currentUser);
                this.avatarImage.setForUserOrChat(this.currentUser, this.avatarDrawable, null, true);
                return;
            }
            TLRPC.Chat chat = this.currentChat;
            if (chat != null) {
                if (chat.photo != null) {
                    this.currentPhoto = this.currentChat.photo.photo_small;
                } else {
                    this.currentPhoto = null;
                }
                this.avatarDrawable.setInfo(this.currentChat);
                this.avatarImage.setForUserOrChat(this.currentChat, this.avatarDrawable);
                return;
            } else if (messageObject != null && messageObject.isSponsored()) {
                if (messageObject.sponsoredChatInvite != null && messageObject.sponsoredChatInvite.chat != null) {
                    this.avatarDrawable.setInfo(messageObject.sponsoredChatInvite.chat);
                    this.avatarImage.setForUserOrChat(messageObject.sponsoredChatInvite.chat, this.avatarDrawable);
                    return;
                }
                this.avatarDrawable.setInfo(messageObject.sponsoredChatInvite);
                TLRPC.Photo photo = messageObject.sponsoredChatInvite.photo;
                if (photo != null) {
                    this.avatarImage.setImage(ImageLocation.getForPhoto(photo.sizes.get(0), photo), "50_50", this.avatarDrawable, null, null, 0);
                    return;
                }
                return;
            } else {
                this.currentPhoto = null;
                this.avatarDrawable.setInfo(messageObject.getFromChatId(), null, null);
                this.avatarImage.setImage(null, null, this.avatarDrawable, null, null, 0);
                return;
            }
        }
        this.currentPhoto = null;
    }

    public void setSpoilersSuppressed(boolean s) {
        for (SpoilerEffect eff : this.captionSpoilers) {
            eff.setSuppressUpdates(s);
        }
        for (SpoilerEffect eff2 : this.replySpoilers) {
            eff2.setSuppressUpdates(s);
        }
        if (getMessageObject() != null && getMessageObject().textLayoutBlocks != null) {
            Iterator<MessageObject.TextLayoutBlock> it = getMessageObject().textLayoutBlocks.iterator();
            while (it.hasNext()) {
                MessageObject.TextLayoutBlock bl = it.next();
                for (SpoilerEffect eff3 : bl.spoilers) {
                    eff3.setSuppressUpdates(s);
                }
            }
        }
    }

    public boolean hasSpoilers() {
        if ((!hasCaptionLayout() || this.captionSpoilers.isEmpty()) && (this.replyTextLayout == null || this.replySpoilers.isEmpty())) {
            if (getMessageObject() != null && getMessageObject().textLayoutBlocks != null) {
                Iterator<MessageObject.TextLayoutBlock> it = getMessageObject().textLayoutBlocks.iterator();
                while (it.hasNext()) {
                    MessageObject.TextLayoutBlock bl = it.next();
                    if (!bl.spoilers.isEmpty()) {
                        return true;
                    }
                }
                return false;
            }
            return false;
        }
        return true;
    }

    private void updateSpoilersVisiblePart(int top, int bottom) {
        if (hasCaptionLayout()) {
            float off = -this.captionY;
            for (SpoilerEffect eff : this.captionSpoilers) {
                eff.setVisibleBounds(0.0f, top + off, getWidth(), bottom + off);
            }
        }
        StaticLayout staticLayout = this.replyTextLayout;
        if (staticLayout != null) {
            float off2 = (-this.replyStartY) - staticLayout.getHeight();
            for (SpoilerEffect eff2 : this.replySpoilers) {
                eff2.setVisibleBounds(0.0f, top + off2, getWidth(), bottom + off2);
            }
        }
        if (getMessageObject() != null && getMessageObject().textLayoutBlocks != null) {
            Iterator<MessageObject.TextLayoutBlock> it = getMessageObject().textLayoutBlocks.iterator();
            while (it.hasNext()) {
                MessageObject.TextLayoutBlock bl = it.next();
                for (SpoilerEffect eff3 : bl.spoilers) {
                    eff3.setVisibleBounds(0.0f, (top - bl.textYOffset) - this.textY, getWidth(), (bottom - bl.textYOffset) - this.textY);
                }
            }
        }
    }

    public void setScrimReaction(String scrimViewReaction) {
        this.reactionsLayoutInBubble.setScrimReaction(scrimViewReaction);
    }

    public void drawScrimReaction(Canvas canvas, String scrimViewReaction) {
        MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
        if ((groupedMessagePosition == null || ((groupedMessagePosition.flags & 8) != 0 && (this.currentPosition.flags & 1) != 0)) && !this.reactionsLayoutInBubble.isSmall) {
            this.reactionsLayoutInBubble.draw(canvas, this.transitionParams.animateChangeProgress, scrimViewReaction);
        }
    }

    public boolean checkUnreadReactions(float clipTop, int clipBottom) {
        if (!this.reactionsLayoutInBubble.hasUnreadReactions) {
            return false;
        }
        float y = getY() + this.reactionsLayoutInBubble.y;
        return y > clipTop && (((float) this.reactionsLayoutInBubble.height) + y) - ((float) AndroidUtilities.dp(16.0f)) < ((float) clipBottom);
    }

    public void markReactionsAsRead() {
        this.reactionsLayoutInBubble.hasUnreadReactions = false;
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject == null) {
            return;
        }
        messageObject.markReactionsAsRead();
    }

    /* loaded from: classes4.dex */
    public interface ChatMessageCellDelegate {
        boolean canDrawOutboundsContent();

        boolean canPerformActions();

        void didLongPress(ChatMessageCell chatMessageCell, float f, float f2);

        void didLongPressBotButton(ChatMessageCell chatMessageCell, TLRPC.KeyboardButton keyboardButton);

        boolean didLongPressChannelAvatar(ChatMessageCell chatMessageCell, TLRPC.Chat chat, int i, float f, float f2);

        boolean didLongPressUserAvatar(ChatMessageCell chatMessageCell, TLRPC.User user, float f, float f2);

        void didPressBotButton(ChatMessageCell chatMessageCell, TLRPC.KeyboardButton keyboardButton);

        void didPressCancelSendButton(ChatMessageCell chatMessageCell);

        void didPressChannelAvatar(ChatMessageCell chatMessageCell, TLRPC.Chat chat, int i, float f, float f2);

        void didPressCommentButton(ChatMessageCell chatMessageCell);

        void didPressHiddenForward(ChatMessageCell chatMessageCell);

        void didPressHint(ChatMessageCell chatMessageCell, int i);

        void didPressImage(ChatMessageCell chatMessageCell, float f, float f2);

        void didPressInstantButton(ChatMessageCell chatMessageCell, int i);

        void didPressOther(ChatMessageCell chatMessageCell, float f, float f2);

        void didPressReaction(ChatMessageCell chatMessageCell, TLRPC.TL_reactionCount tL_reactionCount, boolean z);

        void didPressReplyMessage(ChatMessageCell chatMessageCell, int i);

        void didPressSideButton(ChatMessageCell chatMessageCell);

        void didPressTime(ChatMessageCell chatMessageCell);

        void didPressUrl(ChatMessageCell chatMessageCell, CharacterStyle characterStyle, boolean z);

        void didPressUserAvatar(ChatMessageCell chatMessageCell, TLRPC.User user, float f, float f2);

        void didPressViaBot(ChatMessageCell chatMessageCell, String str);

        void didPressViaBotNotInline(ChatMessageCell chatMessageCell, long j);

        void didPressVoteButtons(ChatMessageCell chatMessageCell, ArrayList<TLRPC.TL_pollAnswer> arrayList, int i, int i2, int i3);

        void didStartVideoStream(MessageObject messageObject);

        String getAdminRank(long j);

        PinchToZoomHelper getPinchToZoomHelper();

        TextSelectionHelper.ChatListTextSelectionHelper getTextSelectionHelper();

        boolean hasSelectedMessages();

        void invalidateBlur();

        boolean isLandscape();

        boolean keyboardIsOpened();

        void needOpenWebView(MessageObject messageObject, String str, String str2, String str3, String str4, int i, int i2);

        boolean needPlayMessage(MessageObject messageObject);

        void needReloadPolls();

        void needShowPremiumFeatures(String str);

        boolean onAccessibilityAction(int i, Bundle bundle);

        void onDiceFinished();

        void setShouldNotRepeatSticker(MessageObject messageObject);

        boolean shouldDrawThreadProgress(ChatMessageCell chatMessageCell);

        boolean shouldRepeatSticker(MessageObject messageObject);

        void videoTimerReached();

        /* renamed from: org.telegram.ui.Cells.ChatMessageCell$ChatMessageCellDelegate$-CC */
        /* loaded from: classes4.dex */
        public final /* synthetic */ class CC {
            public static void $default$didPressUserAvatar(ChatMessageCellDelegate _this, ChatMessageCell cell, TLRPC.User user, float touchX, float touchY) {
            }

            public static boolean $default$didLongPressUserAvatar(ChatMessageCellDelegate _this, ChatMessageCell cell, TLRPC.User user, float touchX, float touchY) {
                return false;
            }

            public static void $default$didPressHiddenForward(ChatMessageCellDelegate _this, ChatMessageCell cell) {
            }

            public static void $default$didPressViaBotNotInline(ChatMessageCellDelegate _this, ChatMessageCell cell, long botId) {
            }

            public static void $default$didPressViaBot(ChatMessageCellDelegate _this, ChatMessageCell cell, String username) {
            }

            public static void $default$didPressChannelAvatar(ChatMessageCellDelegate _this, ChatMessageCell cell, TLRPC.Chat chat, int postId, float touchX, float touchY) {
            }

            public static boolean $default$didLongPressChannelAvatar(ChatMessageCellDelegate _this, ChatMessageCell cell, TLRPC.Chat chat, int postId, float touchX, float touchY) {
                return false;
            }

            public static void $default$didPressCancelSendButton(ChatMessageCellDelegate _this, ChatMessageCell cell) {
            }

            public static void $default$didLongPress(ChatMessageCellDelegate _this, ChatMessageCell cell, float x, float y) {
            }

            public static void $default$didPressReplyMessage(ChatMessageCellDelegate _this, ChatMessageCell cell, int id) {
            }

            public static void $default$didPressUrl(ChatMessageCellDelegate _this, ChatMessageCell cell, CharacterStyle url, boolean longPress) {
            }

            public static void $default$needOpenWebView(ChatMessageCellDelegate _this, MessageObject message, String url, String title, String description, String originalUrl, int w, int h) {
            }

            public static void $default$didPressImage(ChatMessageCellDelegate _this, ChatMessageCell cell, float x, float y) {
            }

            public static void $default$didPressSideButton(ChatMessageCellDelegate _this, ChatMessageCell cell) {
            }

            public static void $default$didPressOther(ChatMessageCellDelegate _this, ChatMessageCell cell, float otherX, float otherY) {
            }

            public static void $default$didPressTime(ChatMessageCellDelegate _this, ChatMessageCell cell) {
            }

            public static void $default$didPressBotButton(ChatMessageCellDelegate _this, ChatMessageCell cell, TLRPC.KeyboardButton button) {
            }

            public static void $default$didLongPressBotButton(ChatMessageCellDelegate _this, ChatMessageCell cell, TLRPC.KeyboardButton button) {
            }

            public static void $default$didPressReaction(ChatMessageCellDelegate _this, ChatMessageCell cell, TLRPC.TL_reactionCount reaction, boolean longpress) {
            }

            public static void $default$didPressVoteButtons(ChatMessageCellDelegate _this, ChatMessageCell cell, ArrayList arrayList, int showCount, int x, int y) {
            }

            public static void $default$didPressInstantButton(ChatMessageCellDelegate _this, ChatMessageCell cell, int type) {
            }

            public static void $default$didPressCommentButton(ChatMessageCellDelegate _this, ChatMessageCell cell) {
            }

            public static void $default$didPressHint(ChatMessageCellDelegate _this, ChatMessageCell cell, int type) {
            }

            public static void $default$needShowPremiumFeatures(ChatMessageCellDelegate _this, String source) {
            }

            public static String $default$getAdminRank(ChatMessageCellDelegate _this, long uid) {
                return null;
            }

            public static boolean $default$needPlayMessage(ChatMessageCellDelegate _this, MessageObject messageObject) {
                return false;
            }

            public static boolean $default$canPerformActions(ChatMessageCellDelegate _this) {
                return false;
            }

            public static boolean $default$onAccessibilityAction(ChatMessageCellDelegate _this, int action, Bundle arguments) {
                return false;
            }

            public static void $default$videoTimerReached(ChatMessageCellDelegate _this) {
            }

            public static void $default$didStartVideoStream(ChatMessageCellDelegate _this, MessageObject message) {
            }

            public static boolean $default$shouldRepeatSticker(ChatMessageCellDelegate _this, MessageObject message) {
                return true;
            }

            public static void $default$setShouldNotRepeatSticker(ChatMessageCellDelegate _this, MessageObject message) {
            }

            public static TextSelectionHelper.ChatListTextSelectionHelper $default$getTextSelectionHelper(ChatMessageCellDelegate _this) {
                return null;
            }

            public static boolean $default$hasSelectedMessages(ChatMessageCellDelegate _this) {
                return false;
            }

            public static void $default$needReloadPolls(ChatMessageCellDelegate _this) {
            }

            public static void $default$onDiceFinished(ChatMessageCellDelegate _this) {
            }

            public static boolean $default$shouldDrawThreadProgress(ChatMessageCellDelegate _this, ChatMessageCell cell) {
                return false;
            }

            public static PinchToZoomHelper $default$getPinchToZoomHelper(ChatMessageCellDelegate _this) {
                return null;
            }

            public static boolean $default$keyboardIsOpened(ChatMessageCellDelegate _this) {
                return false;
            }

            public static boolean $default$isLandscape(ChatMessageCellDelegate _this) {
                return false;
            }

            public static void $default$invalidateBlur(ChatMessageCellDelegate _this) {
            }

            public static boolean $default$canDrawOutboundsContent(ChatMessageCellDelegate _this) {
                return true;
            }
        }
    }

    /* loaded from: classes4.dex */
    public static class BotButton {
        private int angle;
        private TLRPC.KeyboardButton button;
        private int height;
        private boolean isInviteButton;
        private long lastUpdateTime;
        private float progressAlpha;
        private TLRPC.TL_reactionCount reaction;
        private StaticLayout title;
        private int width;
        private int x;
        private int y;

        private BotButton() {
        }

        static /* synthetic */ float access$2716(BotButton x0, float x1) {
            float f = x0.progressAlpha + x1;
            x0.progressAlpha = f;
            return f;
        }

        static /* synthetic */ float access$2724(BotButton x0, float x1) {
            float f = x0.progressAlpha - x1;
            x0.progressAlpha = f;
            return f;
        }

        static /* synthetic */ int access$2816(BotButton x0, float x1) {
            int i = (int) (x0.angle + x1);
            x0.angle = i;
            return i;
        }

        static /* synthetic */ int access$2820(BotButton x0, int x1) {
            int i = x0.angle - x1;
            x0.angle = i;
            return i;
        }
    }

    /* loaded from: classes4.dex */
    public static class PollButton {
        private TLRPC.TL_pollAnswer answer;
        private boolean chosen;
        private boolean correct;
        private int count;
        private float decimal;
        public int height;
        private int percent;
        private float percentProgress;
        private boolean prevChosen;
        private int prevPercent;
        private float prevPercentProgress;
        private StaticLayout title;
        public int x;
        public int y;

        static /* synthetic */ int access$1712(PollButton x0, int x1) {
            int i = x0.percent + x1;
            x0.percent = i;
            return i;
        }

        static /* synthetic */ float access$2424(PollButton x0, float x1) {
            float f = x0.decimal - x1;
            x0.decimal = f;
            return f;
        }
    }

    public ChatMessageCell(Context context) {
        this(context, false, null);
    }

    public ChatMessageCell(Context context, boolean canDrawBackgroundInParent, Theme.ResourcesProvider resourcesProvider) {
        super(context);
        this.reactionsLayoutInBubble = new ReactionsLayoutInBubble(this);
        this.scrollRect = new Rect();
        this.imageBackgroundGradientRotation = 45;
        this.selectorDrawable = new Drawable[2];
        this.selectorDrawableMaskType = new int[2];
        this.instantButtonRect = new RectF();
        this.pressedState = new int[]{16842910, 16842919};
        this.deleteProgressRect = new RectF();
        this.rect = new RectF();
        this.timeAlpha = 1.0f;
        this.controlsAlpha = 1.0f;
        this.links = new LinkSpanDrawable.LinkCollector(this);
        this.urlPathCache = new ArrayList<>();
        this.urlPathSelection = new ArrayList<>();
        this.rectPath = new Path();
        this.pollButtons = new ArrayList<>();
        this.botButtons = new ArrayList<>();
        this.botButtonsByData = new HashMap<>();
        this.botButtonsByPosition = new HashMap<>();
        this.currentAccount = UserConfig.selectedAccount;
        this.isCheckPressed = true;
        this.drawBackground = true;
        this.backgroundWidth = 100;
        this.commentButtonRect = new Rect();
        this.spoilersPatchedReplyTextLayout = new AtomicReference<>();
        this.forwardedNameLayout = new StaticLayout[2];
        this.forwardNameOffsetX = new float[2];
        this.drawTime = true;
        this.ALPHA_PROPERTY_WORKAROUND = Build.VERSION.SDK_INT == 28;
        this.alphaInternal = 1.0f;
        this.transitionParams = new TransitionParams();
        this.diceFinishCallback = new Runnable() { // from class: org.telegram.ui.Cells.ChatMessageCell.1
            @Override // java.lang.Runnable
            public void run() {
                if (ChatMessageCell.this.delegate != null) {
                    ChatMessageCell.this.delegate.onDiceFinished();
                }
            }
        };
        this.invalidateRunnable = new Runnable() { // from class: org.telegram.ui.Cells.ChatMessageCell.2
            @Override // java.lang.Runnable
            public void run() {
                ChatMessageCell.this.checkLocationExpired();
                if (ChatMessageCell.this.locationExpired) {
                    ChatMessageCell.this.invalidate();
                    ChatMessageCell.this.scheduledInvalidate = false;
                    return;
                }
                ChatMessageCell chatMessageCell = ChatMessageCell.this;
                chatMessageCell.invalidate(((int) chatMessageCell.rect.left) - 5, ((int) ChatMessageCell.this.rect.top) - 5, ((int) ChatMessageCell.this.rect.right) + 5, ((int) ChatMessageCell.this.rect.bottom) + 5);
                if (ChatMessageCell.this.scheduledInvalidate) {
                    AndroidUtilities.runOnUIThread(ChatMessageCell.this.invalidateRunnable, 1000L);
                }
            }
        };
        this.accessibilityVirtualViewBounds = new SparseArray<>();
        this.currentFocusedVirtualView = -1;
        this.backgroundCacheParams = new Theme.MessageDrawable.PathDrawParams();
        this.replySpoilers = new ArrayList();
        this.replySpoilersPool = new Stack<>();
        this.captionSpoilers = new ArrayList();
        this.captionSpoilersPool = new Stack<>();
        this.captionPatchedSpoilersLayout = new AtomicReference<>();
        this.sPath = new Path();
        this.hadLongPress = false;
        this.ANIMATION_OFFSET_X = new Property<ChatMessageCell, Float>(Float.class, "animationOffsetX") { // from class: org.telegram.ui.Cells.ChatMessageCell.7
            public Float get(ChatMessageCell object) {
                return Float.valueOf(object.animationOffsetX);
            }

            public void set(ChatMessageCell object, Float value) {
                object.setAnimationOffsetX(value.floatValue());
            }
        };
        this.resourcesProvider = resourcesProvider;
        this.canDrawBackgroundInParent = canDrawBackgroundInParent;
        this.backgroundDrawable = new MessageBackgroundDrawable(this);
        ImageReceiver imageReceiver = new ImageReceiver();
        this.avatarImage = imageReceiver;
        imageReceiver.setRoundRadius(AndroidUtilities.dp(21.0f));
        this.avatarDrawable = new AvatarDrawable();
        ImageReceiver imageReceiver2 = new ImageReceiver(this);
        this.replyImageReceiver = imageReceiver2;
        imageReceiver2.setRoundRadius(AndroidUtilities.dp(2.0f));
        ImageReceiver imageReceiver3 = new ImageReceiver(this);
        this.locationImageReceiver = imageReceiver3;
        imageReceiver3.setRoundRadius(AndroidUtilities.dp(26.1f));
        this.TAG = DownloadController.getInstance(this.currentAccount).generateObserverTag();
        this.contactAvatarDrawable = new AvatarDrawable();
        ImageReceiver imageReceiver4 = new ImageReceiver(this);
        this.photoImage = imageReceiver4;
        imageReceiver4.setUseRoundForThumbDrawable(true);
        this.photoImage.setDelegate(this);
        this.radialProgress = new RadialProgress2(this, resourcesProvider);
        RadialProgress2 radialProgress2 = new RadialProgress2(this, resourcesProvider);
        this.videoRadialProgress = radialProgress2;
        radialProgress2.setDrawBackground(false);
        this.videoRadialProgress.setCircleRadius(AndroidUtilities.dp(15.0f));
        SeekBar seekBar = new SeekBar(this);
        this.seekBar = seekBar;
        seekBar.setDelegate(this);
        SeekBarWaveform seekBarWaveform = new SeekBarWaveform(context);
        this.seekBarWaveform = seekBarWaveform;
        seekBarWaveform.setDelegate(this);
        this.seekBarWaveform.setParentView(this);
        this.seekBarAccessibilityDelegate = new FloatSeekBarAccessibilityDelegate() { // from class: org.telegram.ui.Cells.ChatMessageCell.3
            @Override // org.telegram.ui.Components.FloatSeekBarAccessibilityDelegate
            public float getProgress() {
                if (ChatMessageCell.this.currentMessageObject.isMusic()) {
                    return ChatMessageCell.this.seekBar.getProgress();
                }
                if (ChatMessageCell.this.currentMessageObject.isVoice()) {
                    return ChatMessageCell.this.useSeekBarWaveform ? ChatMessageCell.this.seekBarWaveform.getProgress() : ChatMessageCell.this.seekBar.getProgress();
                } else if (ChatMessageCell.this.currentMessageObject.isRoundVideo()) {
                    return ChatMessageCell.this.currentMessageObject.audioProgress;
                } else {
                    return 0.0f;
                }
            }

            @Override // org.telegram.ui.Components.FloatSeekBarAccessibilityDelegate
            public void setProgress(float progress) {
                if (ChatMessageCell.this.currentMessageObject.isMusic()) {
                    ChatMessageCell.this.seekBar.setProgress(progress);
                } else if (ChatMessageCell.this.currentMessageObject.isVoice()) {
                    if (ChatMessageCell.this.useSeekBarWaveform) {
                        ChatMessageCell.this.seekBarWaveform.setProgress(progress);
                    } else {
                        ChatMessageCell.this.seekBar.setProgress(progress);
                    }
                } else if (ChatMessageCell.this.currentMessageObject.isRoundVideo()) {
                    ChatMessageCell.this.currentMessageObject.audioProgress = progress;
                } else {
                    return;
                }
                ChatMessageCell.this.onSeekBarDrag(progress);
                ChatMessageCell.this.invalidate();
            }
        };
        this.roundVideoPlayingDrawable = new RoundVideoPlayingDrawable(this, resourcesProvider);
        setImportantForAccessibility(1);
    }

    private void createPollUI() {
        if (this.pollAvatarImages != null) {
            return;
        }
        this.pollAvatarImages = new ImageReceiver[3];
        this.pollAvatarDrawables = new AvatarDrawable[3];
        this.pollAvatarImagesVisible = new boolean[3];
        int a = 0;
        while (true) {
            ImageReceiver[] imageReceiverArr = this.pollAvatarImages;
            if (a >= imageReceiverArr.length) {
                break;
            }
            imageReceiverArr[a] = new ImageReceiver(this);
            this.pollAvatarImages[a].setRoundRadius(AndroidUtilities.dp(8.0f));
            this.pollAvatarDrawables[a] = new AvatarDrawable();
            this.pollAvatarDrawables[a].setTextSize(AndroidUtilities.dp(6.0f));
            a++;
        }
        this.pollCheckBox = new CheckBoxBase[10];
        int a2 = 0;
        while (true) {
            CheckBoxBase[] checkBoxBaseArr = this.pollCheckBox;
            if (a2 < checkBoxBaseArr.length) {
                checkBoxBaseArr[a2] = new CheckBoxBase(this, 20, this.resourcesProvider);
                this.pollCheckBox[a2].setDrawUnchecked(false);
                this.pollCheckBox[a2].setBackgroundType(9);
                a2++;
            } else {
                return;
            }
        }
    }

    private void createCommentUI() {
        if (this.commentAvatarImages != null) {
            return;
        }
        this.commentAvatarImages = new ImageReceiver[3];
        this.commentAvatarDrawables = new AvatarDrawable[3];
        this.commentAvatarImagesVisible = new boolean[3];
        int a = 0;
        while (true) {
            ImageReceiver[] imageReceiverArr = this.commentAvatarImages;
            if (a < imageReceiverArr.length) {
                imageReceiverArr[a] = new ImageReceiver(this);
                this.commentAvatarImages[a].setRoundRadius(AndroidUtilities.dp(12.0f));
                this.commentAvatarDrawables[a] = new AvatarDrawable();
                this.commentAvatarDrawables[a].setTextSize(AndroidUtilities.dp(8.0f));
                a++;
            } else {
                return;
            }
        }
    }

    public void resetPressedLink(int type) {
        if (type != -1) {
            this.links.removeLinks(Integer.valueOf(type));
        } else {
            this.links.clear();
        }
        if (this.pressedLink != null) {
            if (this.pressedLinkType != type && type != -1) {
                return;
            }
            this.pressedLink = null;
            this.pressedLinkType = -1;
            invalidate();
        }
    }

    private void resetUrlPaths() {
        if (this.urlPathSelection.isEmpty()) {
            return;
        }
        this.urlPathCache.addAll(this.urlPathSelection);
        this.urlPathSelection.clear();
    }

    private LinkPath obtainNewUrlPath() {
        LinkPath linkPath;
        if (!this.urlPathCache.isEmpty()) {
            linkPath = this.urlPathCache.get(0);
            this.urlPathCache.remove(0);
        } else {
            linkPath = new LinkPath(true);
        }
        linkPath.reset();
        this.urlPathSelection.add(linkPath);
        return linkPath;
    }

    public int[] getRealSpanStartAndEnd(Spannable buffer, CharacterStyle link) {
        int start = 0;
        int end = 0;
        boolean ok = false;
        if (link instanceof URLSpanBrowser) {
            URLSpanBrowser span = (URLSpanBrowser) link;
            TextStyleSpan.TextStyleRun style = span.getStyle();
            if (style != null && style.urlEntity != null) {
                start = style.urlEntity.offset;
                end = style.urlEntity.offset + style.urlEntity.length;
                ok = true;
            }
        }
        if (!ok) {
            start = buffer.getSpanStart(link);
            end = buffer.getSpanEnd(link);
        }
        return new int[]{start, end};
    }

    /*  JADX ERROR: JadxRuntimeException in pass: BlockProcessor
        jadx.core.utils.exceptions.JadxRuntimeException: Unreachable block: B:73:0x015e
        	at jadx.core.dex.visitors.blocks.BlockProcessor.checkForUnreachableBlocks(BlockProcessor.java:92)
        	at jadx.core.dex.visitors.blocks.BlockProcessor.processBlocksTree(BlockProcessor.java:52)
        	at jadx.core.dex.visitors.blocks.BlockProcessor.visit(BlockProcessor.java:44)
        */
    private boolean checkTextBlockMotionEvent(android.view.MotionEvent r26) {
        /*
            Method dump skipped, instructions count: 886
            To view this dump add '--comments-level debug' option
        */
        throw new UnsupportedOperationException("Method not decompiled: org.telegram.ui.Cells.ChatMessageCell.checkTextBlockMotionEvent(android.view.MotionEvent):boolean");
    }

    /* JADX WARN: Removed duplicated region for block: B:46:0x00b9 A[Catch: Exception -> 0x0139, TryCatch #0 {Exception -> 0x0139, blocks: (B:25:0x0056, B:27:0x007a, B:29:0x0086, B:31:0x0095, B:35:0x009b, B:36:0x00a4, B:38:0x00a8, B:40:0x00ae, B:46:0x00b9, B:48:0x00bf, B:50:0x00c3, B:52:0x00cb, B:56:0x00f9, B:59:0x0126, B:60:0x0129, B:61:0x0134, B:57:0x0102), top: B:72:0x0056, inners: #1 }] */
    /* JADX WARN: Removed duplicated region for block: B:82:? A[ADDED_TO_REGION, RETURN, SYNTHETIC] */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    private boolean checkCaptionMotionEvent(MotionEvent event) {
        CharacterStyle[] link;
        boolean ignore;
        if (!(this.currentCaption instanceof Spannable) || this.captionLayout == null) {
            return false;
        }
        if (event.getAction() == 0 || ((this.linkPreviewPressed || this.pressedLink != null) && event.getAction() == 1)) {
            int x = (int) event.getX();
            int y = (int) event.getY();
            float f = this.captionX;
            if (x >= f && x <= f + this.captionWidth) {
                float f2 = this.captionY;
                if (y >= f2 && y <= f2 + this.captionHeight) {
                    if (event.getAction() == 0) {
                        try {
                            int x2 = (int) (x - this.captionX);
                            int y2 = (int) (y - this.captionY);
                            int line = this.captionLayout.getLineForVertical(y2);
                            int off = this.captionLayout.getOffsetForHorizontal(line, x2);
                            float left = this.captionLayout.getLineLeft(line);
                            if (left <= x2 && this.captionLayout.getLineWidth(line) + left >= x2) {
                                Spannable buffer = (Spannable) this.currentCaption;
                                CharacterStyle[] link2 = (CharacterStyle[]) buffer.getSpans(off, off, ClickableSpan.class);
                                if (link2 != null && link2.length != 0) {
                                    link = link2;
                                    if (link.length != 0 && (!(link[0] instanceof URLSpanBotCommand) || URLSpanBotCommand.enabled)) {
                                        ignore = false;
                                        if (ignore && !AndroidUtilities.isAccessibilityScreenReaderEnabled()) {
                                            LinkSpanDrawable linkSpanDrawable = this.pressedLink;
                                            if (linkSpanDrawable == null || linkSpanDrawable.getSpan() != link[0]) {
                                                this.links.removeLink(this.pressedLink);
                                                LinkSpanDrawable linkSpanDrawable2 = new LinkSpanDrawable(link[0], this.resourcesProvider, x2, y2, spanSupportsLongPress(link[0]));
                                                this.pressedLink = linkSpanDrawable2;
                                                linkSpanDrawable2.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outLinkSelectBackground : Theme.key_chat_linkSelectBackground));
                                                this.pressedLinkType = 3;
                                                try {
                                                    LinkPath path = this.pressedLink.obtainNewPath();
                                                    int[] pos = getRealSpanStartAndEnd(buffer, this.pressedLink.getSpan());
                                                    path.setCurrentLayout(this.captionLayout, pos[0], 0.0f);
                                                    this.captionLayout.getSelectionPath(pos[0], pos[1], path);
                                                } catch (Exception e) {
                                                    FileLog.e(e);
                                                }
                                                this.links.addLink(this.pressedLink, 3);
                                            }
                                            invalidateWithParent();
                                            return true;
                                        }
                                    }
                                    ignore = true;
                                    return ignore ? false : false;
                                }
                                link = (CharacterStyle[]) buffer.getSpans(off, off, URLSpanMono.class);
                                if (link.length != 0) {
                                    ignore = false;
                                    if (ignore) {
                                    }
                                }
                                ignore = true;
                                if (ignore) {
                                }
                            } else {
                                return false;
                            }
                        } catch (Exception e2) {
                            FileLog.e(e2);
                            return false;
                        }
                    } else if (this.pressedLinkType == 3) {
                        this.delegate.didPressUrl(this, this.pressedLink.getSpan(), false);
                        resetPressedLink(3);
                        return true;
                    } else {
                        return false;
                    }
                }
            }
            resetPressedLink(3);
            return false;
        }
        return false;
    }

    private boolean checkGameMotionEvent(MotionEvent event) {
        boolean ignore;
        int i;
        int i2;
        if (!this.hasGamePreview) {
            return false;
        }
        int x = (int) event.getX();
        int y = (int) event.getY();
        if (event.getAction() == 0) {
            if (this.drawPhotoImage && this.drawImageButton && this.buttonState != -1 && x >= (i = this.buttonX) && x <= i + AndroidUtilities.dp(48.0f) && y >= (i2 = this.buttonY) && y <= i2 + AndroidUtilities.dp(48.0f) && this.radialProgress.getIcon() != 4) {
                this.buttonPressed = 1;
                invalidate();
                return true;
            } else if (this.drawPhotoImage && this.photoImage.isInsideImage(x, y)) {
                this.gamePreviewPressed = true;
                return true;
            } else if (this.descriptionLayout != null && y >= this.descriptionY) {
                try {
                    int x2 = x - ((this.unmovedTextX + AndroidUtilities.dp(10.0f)) + this.descriptionX);
                    int y2 = y - this.descriptionY;
                    int line = this.descriptionLayout.getLineForVertical(y2);
                    int off = this.descriptionLayout.getOffsetForHorizontal(line, x2);
                    float left = this.descriptionLayout.getLineLeft(line);
                    if (left <= x2 && this.descriptionLayout.getLineWidth(line) + left >= x2) {
                        Spannable buffer = (Spannable) this.currentMessageObject.linkDescription;
                        ClickableSpan[] link = (ClickableSpan[]) buffer.getSpans(off, off, ClickableSpan.class);
                        if (link.length != 0 && (!(link[0] instanceof URLSpanBotCommand) || URLSpanBotCommand.enabled)) {
                            ignore = false;
                            if (ignore && !AndroidUtilities.isAccessibilityScreenReaderEnabled()) {
                                LinkSpanDrawable linkSpanDrawable = this.pressedLink;
                                if (linkSpanDrawable == null || linkSpanDrawable.getSpan() != link[0]) {
                                    this.links.removeLink(this.pressedLink);
                                    LinkSpanDrawable linkSpanDrawable2 = new LinkSpanDrawable(link[0], this.resourcesProvider, x2, y2, spanSupportsLongPress(link[0]));
                                    this.pressedLink = linkSpanDrawable2;
                                    linkSpanDrawable2.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outLinkSelectBackground : Theme.key_chat_linkSelectBackground));
                                    this.linkBlockNum = -10;
                                    this.pressedLinkType = 2;
                                    try {
                                        LinkPath path = this.pressedLink.obtainNewPath();
                                        int[] pos = getRealSpanStartAndEnd(buffer, this.pressedLink.getSpan());
                                        path.setCurrentLayout(this.descriptionLayout, pos[0], 0.0f);
                                        this.descriptionLayout.getSelectionPath(pos[0], pos[1], path);
                                    } catch (Exception e) {
                                        FileLog.e(e);
                                    }
                                    this.links.addLink(this.pressedLink, 2);
                                }
                                invalidate();
                                return true;
                            }
                        }
                        ignore = true;
                        return ignore ? false : false;
                    }
                    return false;
                } catch (Exception e2) {
                    FileLog.e(e2);
                    return false;
                }
            } else {
                return false;
            }
        } else if (event.getAction() == 1) {
            if (this.pressedLinkType == 2 || this.gamePreviewPressed || this.buttonPressed != 0) {
                if (this.buttonPressed != 0) {
                    this.buttonPressed = 0;
                    playSoundEffect(0);
                    didPressButton(true, false);
                    invalidate();
                    return false;
                }
                LinkSpanDrawable linkSpanDrawable3 = this.pressedLink;
                if (linkSpanDrawable3 == null) {
                    this.gamePreviewPressed = false;
                    int a = 0;
                    while (true) {
                        if (a >= this.botButtons.size()) {
                            break;
                        }
                        BotButton button = this.botButtons.get(a);
                        if (button.button instanceof TLRPC.TL_keyboardButtonGame) {
                            playSoundEffect(0);
                            this.delegate.didPressBotButton(this, button.button);
                            invalidate();
                            break;
                        }
                        a++;
                    }
                    resetPressedLink(2);
                    return true;
                }
                if (linkSpanDrawable3.getSpan() instanceof URLSpan) {
                    Browser.openUrl(getContext(), ((URLSpan) this.pressedLink.getSpan()).getURL());
                } else if (this.pressedLink.getSpan() instanceof ClickableSpan) {
                    ((ClickableSpan) this.pressedLink.getSpan()).onClick(this);
                }
                resetPressedLink(2);
                return false;
            }
            resetPressedLink(2);
            return false;
        } else {
            return false;
        }
    }

    private boolean checkTranscribeButtonMotionEvent(MotionEvent event) {
        TranscribeButton transcribeButton;
        return this.useTranscribeButton && (transcribeButton = this.transcribeButton) != null && transcribeButton.onTouch(event.getAction(), event.getX() - this.transcribeX, event.getY() - this.transcribeY);
    }

    /* JADX WARN: Can't wrap try/catch for region: R(13:42|(3:47|61|62)|48|(1:50)(1:51)|52|247|53|54|249|55|60|61|62) */
    /* JADX WARN: Code restructure failed: missing block: B:56:0x0138, code lost:
        r0 = e;
     */
    /* JADX WARN: Code restructure failed: missing block: B:57:0x013a, code lost:
        r0 = e;
     */
    /* JADX WARN: Code restructure failed: missing block: B:59:0x013d, code lost:
        org.telegram.messenger.FileLog.e(r0);
     */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    private boolean checkLinkPreviewMotionEvent(MotionEvent event) {
        boolean z;
        int i;
        int i2;
        int i3;
        int i4;
        boolean z2;
        boolean ignore;
        if (this.currentMessageObject.type != 0 || !this.hasLinkPreview) {
            return false;
        }
        int x = (int) event.getX();
        int y = (int) event.getY();
        int i5 = this.unmovedTextX;
        if (x < i5 || x > i5 + this.backgroundWidth || y < this.textY + this.currentMessageObject.textHeight) {
            return false;
        }
        if (y <= this.textY + this.currentMessageObject.textHeight + this.linkPreviewHeight + AndroidUtilities.dp((this.drawInstantView ? 46 : 0) + 8)) {
            if (event.getAction() == 0) {
                if (this.descriptionLayout != null && y >= this.descriptionY) {
                    try {
                        int checkX = x - ((this.unmovedTextX + AndroidUtilities.dp(10.0f)) + this.descriptionX);
                        int checkY = y - this.descriptionY;
                        if (checkY <= this.descriptionLayout.getHeight()) {
                            int line = this.descriptionLayout.getLineForVertical(checkY);
                            int off = this.descriptionLayout.getOffsetForHorizontal(line, checkX);
                            float left = this.descriptionLayout.getLineLeft(line);
                            if (left <= checkX && this.descriptionLayout.getLineWidth(line) + left >= checkX) {
                                Spannable buffer = (Spannable) this.currentMessageObject.linkDescription;
                                ClickableSpan[] link = (ClickableSpan[]) buffer.getSpans(off, off, ClickableSpan.class);
                                if (link.length != 0 && (!(link[0] instanceof URLSpanBotCommand) || URLSpanBotCommand.enabled)) {
                                    ignore = false;
                                    if (ignore && !AndroidUtilities.isAccessibilityScreenReaderEnabled()) {
                                        LinkSpanDrawable linkSpanDrawable = this.pressedLink;
                                        if (linkSpanDrawable != null && linkSpanDrawable.getSpan() == link[0]) {
                                            invalidate();
                                            return true;
                                        }
                                        this.links.removeLink(this.pressedLink);
                                        LinkSpanDrawable linkSpanDrawable2 = new LinkSpanDrawable(link[0], this.resourcesProvider, x, y, spanSupportsLongPress(link[0]));
                                        this.pressedLink = linkSpanDrawable2;
                                        linkSpanDrawable2.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outLinkSelectBackground : Theme.key_chat_linkSelectBackground));
                                        this.linkBlockNum = -10;
                                        this.pressedLinkType = 2;
                                        startCheckLongPress();
                                        LinkPath path = this.pressedLink.obtainNewPath();
                                        int[] pos = getRealSpanStartAndEnd(buffer, this.pressedLink.getSpan());
                                        path.setCurrentLayout(this.descriptionLayout, pos[0], 0.0f);
                                        this.descriptionLayout.getSelectionPath(pos[0], pos[1], path);
                                        this.links.addLink(this.pressedLink, 2);
                                        invalidate();
                                        return true;
                                    }
                                }
                                ignore = true;
                                if (ignore) {
                                }
                            }
                        }
                    } catch (Exception e) {
                        FileLog.e(e);
                    }
                }
                if (this.pressedLink == null) {
                    int side = AndroidUtilities.dp(48.0f);
                    boolean area2 = false;
                    if (this.miniButtonState >= 0) {
                        int offset = AndroidUtilities.dp(27.0f);
                        int i6 = this.buttonX;
                        if (x >= i6 + offset && x <= i6 + offset + side) {
                            int i7 = this.buttonY;
                            if (y >= i7 + offset && y <= i7 + offset + side) {
                                z2 = true;
                                area2 = z2;
                            }
                        }
                        z2 = false;
                        area2 = z2;
                    }
                    if (area2) {
                        this.miniButtonPressed = 1;
                        invalidate();
                        return true;
                    } else if (this.drawVideoImageButton && this.buttonState != -1 && x >= (i3 = this.videoButtonX) && x <= i3 + AndroidUtilities.dp(34.0f) + Math.max(this.infoWidth, this.docTitleWidth) && y >= (i4 = this.videoButtonY) && y <= i4 + AndroidUtilities.dp(30.0f)) {
                        this.videoButtonPressed = 1;
                        invalidate();
                        return true;
                    } else if (this.drawPhotoImage && this.drawImageButton && this.buttonState != -1 && ((!this.checkOnlyButtonPressed && this.photoImage.isInsideImage(x, y)) || (x >= (i = this.buttonX) && x <= i + AndroidUtilities.dp(48.0f) && y >= (i2 = this.buttonY) && y <= i2 + AndroidUtilities.dp(48.0f) && this.radialProgress.getIcon() != 4))) {
                        this.buttonPressed = 1;
                        invalidate();
                        return true;
                    } else if (this.drawInstantView) {
                        this.instantPressed = true;
                        this.selectorDrawableMaskType[0] = 0;
                        if (Build.VERSION.SDK_INT >= 21) {
                            Drawable[] drawableArr = this.selectorDrawable;
                            if (drawableArr[0] != null) {
                                if (!drawableArr[0].getBounds().contains(x, y)) {
                                    z = true;
                                } else {
                                    this.selectorDrawable[0].setHotspot(x, y);
                                    this.selectorDrawable[0].setState(this.pressedState);
                                    z = true;
                                    this.instantButtonPressed = true;
                                }
                                invalidate();
                                return z;
                            }
                        }
                        z = true;
                        invalidate();
                        return z;
                    } else if (this.documentAttachType != 1 && this.drawPhotoImage && this.photoImage.isInsideImage(x, y)) {
                        this.linkPreviewPressed = true;
                        TLRPC.WebPage webPage = this.currentMessageObject.messageOwner.media.webpage;
                        if (this.documentAttachType == 2 && this.buttonState == -1 && SharedConfig.autoplayGifs) {
                            if (this.photoImage.getAnimation() == null || !TextUtils.isEmpty(webPage.embed_url)) {
                                this.linkPreviewPressed = false;
                                return false;
                            }
                            return true;
                        }
                        return true;
                    } else {
                        return false;
                    }
                }
                return false;
            } else if (event.getAction() == 1) {
                if (this.instantPressed) {
                    ChatMessageCellDelegate chatMessageCellDelegate = this.delegate;
                    if (chatMessageCellDelegate != null) {
                        chatMessageCellDelegate.didPressInstantButton(this, this.drawInstantViewType);
                    }
                    playSoundEffect(0);
                    if (Build.VERSION.SDK_INT >= 21) {
                        Drawable[] drawableArr2 = this.selectorDrawable;
                        if (drawableArr2[0] != null) {
                            drawableArr2[0].setState(StateSet.NOTHING);
                        }
                    }
                    this.instantButtonPressed = false;
                    this.instantPressed = false;
                    invalidate();
                    return false;
                } else if (this.pressedLinkType == 2 || this.buttonPressed != 0 || this.miniButtonPressed != 0 || this.videoButtonPressed != 0 || this.linkPreviewPressed) {
                    if (this.videoButtonPressed == 1) {
                        this.videoButtonPressed = 0;
                        playSoundEffect(0);
                        didPressButton(true, true);
                        invalidate();
                        return false;
                    } else if (this.buttonPressed != 0) {
                        this.buttonPressed = 0;
                        playSoundEffect(0);
                        if (!this.drawVideoImageButton) {
                            didPressButton(true, false);
                        } else {
                            didClickedImage();
                        }
                        invalidate();
                        return false;
                    } else if (this.miniButtonPressed != 0) {
                        this.miniButtonPressed = 0;
                        playSoundEffect(0);
                        didPressMiniButton(true);
                        invalidate();
                        return false;
                    } else {
                        LinkSpanDrawable linkSpanDrawable3 = this.pressedLink;
                        if (linkSpanDrawable3 != null) {
                            if (linkSpanDrawable3.getSpan() instanceof URLSpan) {
                                this.delegate.didPressUrl(this, this.pressedLink.getSpan(), false);
                            } else if (this.pressedLink.getSpan() instanceof ClickableSpan) {
                                ((ClickableSpan) this.pressedLink.getSpan()).onClick(this);
                            }
                            resetPressedLink(2);
                            return false;
                        }
                        int i8 = this.documentAttachType;
                        if (i8 == 7) {
                            if (!MediaController.getInstance().isPlayingMessage(this.currentMessageObject) || MediaController.getInstance().isMessagePaused()) {
                                this.delegate.needPlayMessage(this.currentMessageObject);
                            } else {
                                MediaController.getInstance().m383lambda$startAudioAgain$7$orgtelegrammessengerMediaController(this.currentMessageObject);
                            }
                        } else if (i8 == 2 && this.drawImageButton) {
                            int i9 = this.buttonState;
                            if (i9 == -1) {
                                if (SharedConfig.autoplayGifs) {
                                    this.delegate.didPressImage(this, this.lastTouchX, this.lastTouchY);
                                } else {
                                    this.buttonState = 2;
                                    this.currentMessageObject.gifState = 1.0f;
                                    this.photoImage.setAllowStartAnimation(false);
                                    this.photoImage.stopAnimation();
                                    this.radialProgress.setIcon(getIconForCurrentState(), false, true);
                                    invalidate();
                                    playSoundEffect(0);
                                }
                            } else if (i9 == 2 || i9 == 0) {
                                didPressButton(true, false);
                                playSoundEffect(0);
                            }
                        } else {
                            TLRPC.WebPage webPage2 = this.currentMessageObject.messageOwner.media.webpage;
                            if (webPage2 != null && !TextUtils.isEmpty(webPage2.embed_url)) {
                                this.delegate.needOpenWebView(this.currentMessageObject, webPage2.embed_url, webPage2.site_name, webPage2.title, webPage2.url, webPage2.embed_width, webPage2.embed_height);
                            } else {
                                int i10 = this.buttonState;
                                if (i10 == -1 || i10 == 3) {
                                    this.delegate.didPressImage(this, this.lastTouchX, this.lastTouchY);
                                    playSoundEffect(0);
                                } else if (webPage2 != null) {
                                    Browser.openUrl(getContext(), webPage2.url);
                                }
                            }
                        }
                        resetPressedLink(2);
                        return true;
                    }
                } else if (!this.hadLongPress) {
                    this.hadLongPress = false;
                    resetPressedLink(2);
                    return false;
                } else {
                    return false;
                }
            } else if (event.getAction() == 2 && this.instantButtonPressed && Build.VERSION.SDK_INT >= 21) {
                Drawable[] drawableArr3 = this.selectorDrawable;
                if (drawableArr3[0] != null) {
                    drawableArr3[0].setHotspot(x, y);
                    return false;
                }
                return false;
            } else {
                return false;
            }
        }
        return false;
    }

    private boolean checkPollButtonMotionEvent(MotionEvent event) {
        int i;
        int i2;
        if (this.currentMessageObject.eventId != 0 || this.pollVoteInProgress || this.pollUnvoteInProgress || this.pollButtons.isEmpty() || this.currentMessageObject.type != 17 || !this.currentMessageObject.isSent()) {
            return false;
        }
        int x = (int) event.getX();
        int y = (int) event.getY();
        if (event.getAction() == 0) {
            this.pressedVoteButton = -1;
            this.pollHintPressed = false;
            if (this.hintButtonVisible && (i = this.pollHintX) != -1 && x >= i && x <= i + AndroidUtilities.dp(40.0f) && y >= (i2 = this.pollHintY) && y <= i2 + AndroidUtilities.dp(40.0f)) {
                this.pollHintPressed = true;
                this.selectorDrawableMaskType[0] = 3;
                if (Build.VERSION.SDK_INT >= 21) {
                    Drawable[] drawableArr = this.selectorDrawable;
                    if (drawableArr[0] != null) {
                        drawableArr[0].setBounds(this.pollHintX - AndroidUtilities.dp(8.0f), this.pollHintY - AndroidUtilities.dp(8.0f), this.pollHintX + AndroidUtilities.dp(32.0f), this.pollHintY + AndroidUtilities.dp(32.0f));
                        this.selectorDrawable[0].setHotspot(x, y);
                        this.selectorDrawable[0].setState(this.pressedState);
                    }
                }
                invalidate();
                return true;
            }
            for (int a = 0; a < this.pollButtons.size(); a++) {
                PollButton button = this.pollButtons.get(a);
                int y2 = (button.y + this.namesOffset) - AndroidUtilities.dp(13.0f);
                if (x >= button.x && x <= (button.x + this.backgroundWidth) - AndroidUtilities.dp(31.0f) && y >= y2 && y <= button.height + y2 + AndroidUtilities.dp(26.0f)) {
                    this.pressedVoteButton = a;
                    if (!this.pollVoted && !this.pollClosed) {
                        this.selectorDrawableMaskType[0] = 1;
                        if (Build.VERSION.SDK_INT >= 21) {
                            Drawable[] drawableArr2 = this.selectorDrawable;
                            if (drawableArr2[0] != null) {
                                drawableArr2[0].setBounds(button.x - AndroidUtilities.dp(9.0f), y2, (button.x + this.backgroundWidth) - AndroidUtilities.dp(22.0f), button.height + y2 + AndroidUtilities.dp(26.0f));
                                this.selectorDrawable[0].setHotspot(x, y);
                                this.selectorDrawable[0].setState(this.pressedState);
                            }
                        }
                        invalidate();
                    }
                    return true;
                }
            }
            return false;
        } else if (event.getAction() == 1) {
            if (this.pollHintPressed) {
                playSoundEffect(0);
                this.delegate.didPressHint(this, 0);
                this.pollHintPressed = false;
                if (Build.VERSION.SDK_INT < 21) {
                    return false;
                }
                Drawable[] drawableArr3 = this.selectorDrawable;
                if (drawableArr3[0] == null) {
                    return false;
                }
                drawableArr3[0].setState(StateSet.NOTHING);
                return false;
            } else if (this.pressedVoteButton == -1) {
                return false;
            } else {
                playSoundEffect(0);
                if (Build.VERSION.SDK_INT >= 21) {
                    Drawable[] drawableArr4 = this.selectorDrawable;
                    if (drawableArr4[0] != null) {
                        drawableArr4[0].setState(StateSet.NOTHING);
                    }
                }
                if (this.currentMessageObject.scheduled) {
                    Toast.makeText(getContext(), LocaleController.getString("MessageScheduledVote", R.string.MessageScheduledVote), 1).show();
                } else {
                    PollButton button2 = this.pollButtons.get(this.pressedVoteButton);
                    TLRPC.TL_pollAnswer answer = button2.answer;
                    if (this.pollVoted || this.pollClosed) {
                        ArrayList<TLRPC.TL_pollAnswer> answers = new ArrayList<>();
                        answers.add(answer);
                        this.delegate.didPressVoteButtons(this, answers, button2.count, button2.x + AndroidUtilities.dp(50.0f), button2.y + this.namesOffset);
                    } else if (this.lastPoll.multiple_choice) {
                        if (this.currentMessageObject.checkedVotes.contains(answer)) {
                            this.currentMessageObject.checkedVotes.remove(answer);
                            this.pollCheckBox[this.pressedVoteButton].setChecked(false, true);
                        } else {
                            this.currentMessageObject.checkedVotes.add(answer);
                            this.pollCheckBox[this.pressedVoteButton].setChecked(true, true);
                        }
                    } else {
                        this.pollVoteInProgressNum = this.pressedVoteButton;
                        this.pollVoteInProgress = true;
                        this.vibrateOnPollVote = true;
                        this.voteCurrentProgressTime = 0.0f;
                        this.firstCircleLength = true;
                        this.voteCurrentCircleLength = 360.0f;
                        this.voteRisingCircleLength = false;
                        ArrayList<TLRPC.TL_pollAnswer> answers2 = new ArrayList<>();
                        answers2.add(answer);
                        this.delegate.didPressVoteButtons(this, answers2, -1, 0, 0);
                    }
                }
                this.pressedVoteButton = -1;
                invalidate();
                return false;
            }
        } else if (event.getAction() != 2) {
            return false;
        } else {
            if ((this.pressedVoteButton == -1 && !this.pollHintPressed) || Build.VERSION.SDK_INT < 21) {
                return false;
            }
            Drawable[] drawableArr5 = this.selectorDrawable;
            if (drawableArr5[0] == null) {
                return false;
            }
            drawableArr5[0].setHotspot(x, y);
            return false;
        }
    }

    private boolean checkInstantButtonMotionEvent(MotionEvent event) {
        if (this.currentMessageObject.isSponsored() || (this.drawInstantView && this.currentMessageObject.type != 0)) {
            int x = (int) event.getX();
            int y = (int) event.getY();
            int i = 2;
            if (event.getAction() == 0) {
                if (this.drawInstantView && this.instantButtonRect.contains(x, y)) {
                    int[] iArr = this.selectorDrawableMaskType;
                    if (this.lastPoll == null) {
                        i = 0;
                    }
                    iArr[0] = i;
                    this.instantPressed = true;
                    if (Build.VERSION.SDK_INT >= 21 && this.selectorDrawable[0] != null && this.instantButtonRect.contains(x, y)) {
                        this.selectorDrawable[0].setHotspot(x, y);
                        this.selectorDrawable[0].setState(this.pressedState);
                        this.instantButtonPressed = true;
                    }
                    invalidate();
                    return true;
                }
            } else if (event.getAction() == 1) {
                if (this.instantPressed) {
                    ChatMessageCellDelegate chatMessageCellDelegate = this.delegate;
                    if (chatMessageCellDelegate != null) {
                        if (this.lastPoll != null) {
                            if (this.currentMessageObject.scheduled) {
                                Toast.makeText(getContext(), LocaleController.getString("MessageScheduledVoteResults", R.string.MessageScheduledVoteResults), 1).show();
                            } else if (this.pollVoted || this.pollClosed) {
                                this.delegate.didPressInstantButton(this, this.drawInstantViewType);
                            } else {
                                if (!this.currentMessageObject.checkedVotes.isEmpty()) {
                                    this.pollVoteInProgressNum = -1;
                                    this.pollVoteInProgress = true;
                                    this.vibrateOnPollVote = true;
                                    this.voteCurrentProgressTime = 0.0f;
                                    this.firstCircleLength = true;
                                    this.voteCurrentCircleLength = 360.0f;
                                    this.voteRisingCircleLength = false;
                                }
                                this.delegate.didPressVoteButtons(this, this.currentMessageObject.checkedVotes, -1, 0, this.namesOffset);
                            }
                        } else {
                            chatMessageCellDelegate.didPressInstantButton(this, this.drawInstantViewType);
                        }
                    }
                    playSoundEffect(0);
                    if (Build.VERSION.SDK_INT >= 21) {
                        Drawable[] drawableArr = this.selectorDrawable;
                        if (drawableArr[0] != null) {
                            drawableArr[0].setState(StateSet.NOTHING);
                        }
                    }
                    this.instantButtonPressed = false;
                    this.instantPressed = false;
                    invalidate();
                }
            } else if (event.getAction() == 2 && this.instantButtonPressed && Build.VERSION.SDK_INT >= 21) {
                Drawable[] drawableArr2 = this.selectorDrawable;
                if (drawableArr2[0] != null) {
                    drawableArr2[0].setHotspot(x, y);
                }
            }
            return false;
        }
        return false;
    }

    private void invalidateWithParent() {
        if (this.currentMessagesGroup != null && getParent() != null) {
            ((ViewGroup) getParent()).invalidate();
        }
        invalidate();
    }

    private boolean checkCommentButtonMotionEvent(MotionEvent event) {
        if (!this.drawCommentButton) {
            return false;
        }
        int x = (int) event.getX();
        int y = (int) event.getY();
        MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
        int i = 1;
        if (groupedMessagePosition != null && (groupedMessagePosition.flags & 1) == 0 && this.commentButtonRect.contains(x, y)) {
            ViewGroup parent = (ViewGroup) getParent();
            int a = 0;
            int N = parent.getChildCount();
            while (a < N) {
                View view = parent.getChildAt(a);
                if (view != this && (view instanceof ChatMessageCell)) {
                    ChatMessageCell cell = (ChatMessageCell) view;
                    if (cell.drawCommentButton && cell.currentMessagesGroup == this.currentMessagesGroup && (cell.currentPosition.flags & i) != 0) {
                        MotionEvent childEvent = MotionEvent.obtain(0L, 0L, event.getActionMasked(), (event.getX() + getLeft()) - cell.getLeft(), (event.getY() + getTop()) - cell.getTop(), 0);
                        cell.checkCommentButtonMotionEvent(childEvent);
                        childEvent.recycle();
                        return true;
                    }
                }
                a++;
                i = 1;
            }
            return true;
        }
        if (event.getAction() == 0) {
            if (this.commentButtonRect.contains(x, y)) {
                if (this.currentMessageObject.isSent()) {
                    this.selectorDrawableMaskType[1] = 2;
                    this.commentButtonPressed = true;
                    if (Build.VERSION.SDK_INT >= 21) {
                        Drawable[] drawableArr = this.selectorDrawable;
                        if (drawableArr[1] != null) {
                            drawableArr[1].setHotspot(x, y);
                            this.selectorDrawable[1].setState(this.pressedState);
                        }
                    }
                    invalidateWithParent();
                    return true;
                }
                return true;
            }
        } else if (event.getAction() == 1) {
            if (this.commentButtonPressed) {
                ChatMessageCellDelegate chatMessageCellDelegate = this.delegate;
                if (chatMessageCellDelegate != null) {
                    if (this.isRepliesChat) {
                        chatMessageCellDelegate.didPressSideButton(this);
                    } else {
                        chatMessageCellDelegate.didPressCommentButton(this);
                    }
                }
                playSoundEffect(0);
                if (Build.VERSION.SDK_INT >= 21) {
                    Drawable[] drawableArr2 = this.selectorDrawable;
                    if (drawableArr2[1] != null) {
                        drawableArr2[1].setState(StateSet.NOTHING);
                    }
                }
                this.commentButtonPressed = false;
                invalidateWithParent();
            }
        } else if (event.getAction() == 2 && this.commentButtonPressed && Build.VERSION.SDK_INT >= 21) {
            Drawable[] drawableArr3 = this.selectorDrawable;
            if (drawableArr3[1] != null) {
                drawableArr3[1].setHotspot(x, y);
            }
        }
        return false;
    }

    /* JADX WARN: Type inference failed for: r5v2, types: [boolean] */
    private boolean checkOtherButtonMotionEvent(MotionEvent event) {
        int i;
        MessageObject.GroupedMessagePosition groupedMessagePosition;
        int i2 = this.documentAttachType;
        if ((i2 == 5 || i2 == 1) && (groupedMessagePosition = this.currentPosition) != null && (groupedMessagePosition.flags & 4) == 0) {
            return false;
        }
        boolean allow = this.currentMessageObject.type == 16;
        if (!allow) {
            allow = (this.documentAttachType == 1 || this.currentMessageObject.type == 12 || (i = this.documentAttachType) == 5 || i == 4 || i == 2 || this.currentMessageObject.type == 8) && !this.hasGamePreview && !this.hasInvoicePreview;
        }
        if (!allow) {
            return false;
        }
        int x = (int) event.getX();
        int y = (int) event.getY();
        if (event.getAction() == 0) {
            if (this.currentMessageObject.type == 16) {
                ?? isVideoCall = this.currentMessageObject.isVideoCall();
                int i3 = this.otherX;
                if (x < i3) {
                    return false;
                }
                if (x > i3 + AndroidUtilities.dp((isVideoCall == 0 ? SearchViewPager.deleteItemId : 200) + 30) || y < this.otherY - AndroidUtilities.dp(14.0f) || y > this.otherY + AndroidUtilities.dp(50.0f)) {
                    return false;
                }
                this.otherPressed = true;
                this.selectorDrawableMaskType[0] = 4;
                if (Build.VERSION.SDK_INT >= 21 && this.selectorDrawable[0] != null) {
                    int dp = this.otherX + AndroidUtilities.dp(isVideoCall == 0 ? 202.0f : 200.0f);
                    Drawable[] drawableArr = Theme.chat_msgInCallDrawable;
                    int idx = isVideoCall == true ? 1 : 0;
                    int cx = dp + (drawableArr[idx].getIntrinsicWidth() / 2);
                    int cy = this.otherY + (Theme.chat_msgInCallDrawable[isVideoCall].getIntrinsicHeight() / 2);
                    this.selectorDrawable[0].setBounds(cx - AndroidUtilities.dp(20.0f), cy - AndroidUtilities.dp(20.0f), AndroidUtilities.dp(20.0f) + cx, AndroidUtilities.dp(20.0f) + cy);
                    this.selectorDrawable[0].setHotspot(x, y);
                    this.selectorDrawable[0].setState(this.pressedState);
                }
                invalidate();
                return true;
            } else if (x < this.otherX - AndroidUtilities.dp(20.0f) || x > this.otherX + AndroidUtilities.dp(20.0f) || y < this.otherY - AndroidUtilities.dp(4.0f) || y > this.otherY + AndroidUtilities.dp(30.0f)) {
                return false;
            } else {
                this.otherPressed = true;
                invalidate();
                return true;
            }
        } else if (event.getAction() != 1) {
            if (event.getAction() != 2 || this.currentMessageObject.type != 16 || !this.otherPressed || Build.VERSION.SDK_INT < 21) {
                return false;
            }
            Drawable[] drawableArr2 = this.selectorDrawable;
            if (drawableArr2[0] == null) {
                return false;
            }
            drawableArr2[0].setHotspot(x, y);
            return false;
        } else if (!this.otherPressed) {
            return false;
        } else {
            if (this.currentMessageObject.type == 16 && Build.VERSION.SDK_INT >= 21) {
                Drawable[] drawableArr3 = this.selectorDrawable;
                if (drawableArr3[0] != null) {
                    drawableArr3[0].setState(StateSet.NOTHING);
                }
            }
            this.otherPressed = false;
            playSoundEffect(0);
            this.delegate.didPressOther(this, this.otherX, this.otherY);
            invalidate();
            return true;
        }
    }

    private boolean checkDateMotionEvent(MotionEvent event) {
        if (!this.currentMessageObject.isImportedForward()) {
            return false;
        }
        int x = (int) event.getX();
        int y = (int) event.getY();
        if (event.getAction() == 0) {
            float f = this.drawTimeX;
            if (x < f || x > f + this.timeWidth) {
                return false;
            }
            float f2 = this.drawTimeY;
            if (y < f2 || y > f2 + AndroidUtilities.dp(20.0f)) {
                return false;
            }
            this.timePressed = true;
            invalidate();
            return true;
        } else if (event.getAction() != 1 || !this.timePressed) {
            return false;
        } else {
            this.timePressed = false;
            playSoundEffect(0);
            this.delegate.didPressTime(this);
            invalidate();
            return true;
        }
    }

    private boolean checkRoundSeekbar(MotionEvent event) {
        float f;
        if (!MediaController.getInstance().isPlayingMessage(this.currentMessageObject) || !MediaController.getInstance().isMessagePaused()) {
            return false;
        }
        int x = (int) event.getX();
        int y = (int) event.getY();
        if (event.getAction() == 0) {
            if (x < this.seekbarRoundX - AndroidUtilities.dp(20.0f) || x > this.seekbarRoundX + AndroidUtilities.dp(20.0f) || y < this.seekbarRoundY - AndroidUtilities.dp(20.0f) || y > this.seekbarRoundY + AndroidUtilities.dp(20.0f)) {
                float localX = x - this.photoImage.getCenterX();
                float localY = y - this.photoImage.getCenterY();
                float r2 = (this.photoImage.getImageWidth() - AndroidUtilities.dp(64.0f)) / 2.0f;
                if ((localX * localX) + (localY * localY) < ((this.photoImage.getImageWidth() / 2.0f) * this.photoImage.getImageWidth()) / 2.0f && (localX * localX) + (localY * localY) > r2 * r2) {
                    getParent().requestDisallowInterceptTouchEvent(true);
                    cancelCheckLongPress();
                    this.roundSeekbarTouched = 1;
                    invalidate();
                }
            } else {
                getParent().requestDisallowInterceptTouchEvent(true);
                cancelCheckLongPress();
                this.roundSeekbarTouched = 1;
                invalidate();
            }
        } else if (this.roundSeekbarTouched == 1 && event.getAction() == 2) {
            float localX2 = x - this.photoImage.getCenterX();
            float localY2 = y - this.photoImage.getCenterY();
            float a = ((float) Math.toDegrees(Math.atan2(localY2, localX2))) + 90.0f;
            if (a < 0.0f) {
                a += 360.0f;
            }
            float p = a / 360.0f;
            if (Math.abs(this.currentMessageObject.audioProgress - p) > 0.9f) {
                if (this.roundSeekbarOutAlpha == 0.0f) {
                    performHapticFeedback(3);
                }
                this.roundSeekbarOutAlpha = 1.0f;
                this.roundSeekbarOutProgress = this.currentMessageObject.audioProgress;
            }
            long currentTime = System.currentTimeMillis();
            if (currentTime - this.lastSeekUpdateTime > 100) {
                MediaController.getInstance().seekToProgress(this.currentMessageObject, p);
                this.lastSeekUpdateTime = currentTime;
            }
            this.currentMessageObject.audioProgress = p;
            updatePlayingMessageProgress();
        }
        if ((event.getAction() == 1 || event.getAction() == 3) && this.roundSeekbarTouched != 0) {
            if (event.getAction() == 1) {
                float localX3 = x - this.photoImage.getCenterX();
                float localY3 = y - this.photoImage.getCenterY();
                float a2 = ((float) Math.toDegrees(Math.atan2(localY3, localX3))) + 90.0f;
                if (a2 >= 0.0f) {
                    f = 360.0f;
                } else {
                    f = 360.0f;
                    a2 += 360.0f;
                }
                float p2 = a2 / f;
                this.currentMessageObject.audioProgress = p2;
                MediaController.getInstance().seekToProgress(this.currentMessageObject, p2);
                updatePlayingMessageProgress();
            }
            MediaController.getInstance().playMessage(this.currentMessageObject);
            this.roundSeekbarTouched = 0;
            getParent().requestDisallowInterceptTouchEvent(false);
        }
        return this.roundSeekbarTouched != 0;
    }

    private boolean checkPhotoImageMotionEvent(MotionEvent event) {
        int i;
        int i2;
        int i3;
        int i4;
        boolean z;
        if ((this.drawPhotoImage || this.documentAttachType == 1) && (!this.currentMessageObject.isSending() || this.buttonState == 1)) {
            int x = (int) event.getX();
            int y = (int) event.getY();
            boolean result = false;
            if (event.getAction() == 0) {
                boolean area2 = false;
                int side = AndroidUtilities.dp(48.0f);
                if (this.miniButtonState >= 0) {
                    int offset = AndroidUtilities.dp(27.0f);
                    int i5 = this.buttonX;
                    if (x >= i5 + offset && x <= i5 + offset + side) {
                        int i6 = this.buttonY;
                        if (y >= i6 + offset && y <= i6 + offset + side) {
                            z = true;
                            area2 = z;
                        }
                    }
                    z = false;
                    area2 = z;
                }
                if (area2) {
                    this.miniButtonPressed = 1;
                    invalidate();
                    result = true;
                } else if (this.buttonState != -1 && this.radialProgress.getIcon() != 4 && x >= (i3 = this.buttonX) && x <= i3 + side && y >= (i4 = this.buttonY) && y <= i4 + side) {
                    this.buttonPressed = 1;
                    invalidate();
                    result = true;
                } else if (this.drawVideoImageButton && this.buttonState != -1 && x >= (i = this.videoButtonX) && x <= i + AndroidUtilities.dp(34.0f) + Math.max(this.infoWidth, this.docTitleWidth) && y >= (i2 = this.videoButtonY) && y <= i2 + AndroidUtilities.dp(30.0f)) {
                    this.videoButtonPressed = 1;
                    invalidate();
                    result = true;
                } else if (this.documentAttachType == 1) {
                    if (x >= this.photoImage.getImageX() && x <= (this.photoImage.getImageX() + this.backgroundWidth) - AndroidUtilities.dp(50.0f) && y >= this.photoImage.getImageY() && y <= this.photoImage.getImageY() + this.photoImage.getImageHeight()) {
                        this.imagePressed = true;
                        result = true;
                    }
                } else if (!this.currentMessageObject.isAnyKindOfSticker() || this.currentMessageObject.getInputStickerSet() != null || this.currentMessageObject.isAnimatedEmoji() || this.currentMessageObject.isDice()) {
                    if (x >= this.photoImage.getImageX() && x <= this.photoImage.getImageX() + this.photoImage.getImageWidth() && y >= this.photoImage.getImageY() && y <= this.photoImage.getImageY() + this.photoImage.getImageHeight()) {
                        if (this.isRoundVideo) {
                            if (((x - this.photoImage.getCenterX()) * (x - this.photoImage.getCenterX())) + ((y - this.photoImage.getCenterY()) * (y - this.photoImage.getCenterY())) < (this.photoImage.getImageWidth() / 2.0f) * (this.photoImage.getImageWidth() / 2.0f)) {
                                this.imagePressed = true;
                                result = true;
                            }
                        } else {
                            this.imagePressed = true;
                            result = true;
                        }
                    }
                    if (this.currentMessageObject.type == 12) {
                        long uid = this.currentMessageObject.messageOwner.media.user_id;
                        TLRPC.User user = null;
                        if (uid != 0) {
                            user = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(uid));
                        }
                        if (user == null) {
                            this.imagePressed = false;
                            result = false;
                        }
                    }
                }
                if (this.imagePressed) {
                    if (this.currentMessageObject.isSendError()) {
                        this.imagePressed = false;
                        return false;
                    } else if (this.currentMessageObject.type == 8 && this.buttonState == -1 && SharedConfig.autoplayGifs && this.photoImage.getAnimation() == null) {
                        this.imagePressed = false;
                        return false;
                    } else {
                        return result;
                    }
                }
                return result;
            } else if (event.getAction() != 1) {
                return false;
            } else {
                if (this.videoButtonPressed == 1) {
                    this.videoButtonPressed = 0;
                    playSoundEffect(0);
                    didPressButton(true, true);
                    invalidate();
                    return false;
                } else if (this.buttonPressed == 1) {
                    this.buttonPressed = 0;
                    playSoundEffect(0);
                    if (this.drawVideoImageButton) {
                        didClickedImage();
                    } else {
                        didPressButton(true, false);
                    }
                    invalidate();
                    return false;
                } else if (this.miniButtonPressed == 1) {
                    this.miniButtonPressed = 0;
                    playSoundEffect(0);
                    didPressMiniButton(true);
                    invalidate();
                    return false;
                } else if (!this.imagePressed) {
                    return false;
                } else {
                    this.imagePressed = false;
                    int i7 = this.buttonState;
                    if (i7 == -1 || i7 == 2 || i7 == 3 || this.drawVideoImageButton) {
                        playSoundEffect(0);
                        didClickedImage();
                    } else if (i7 == 0) {
                        playSoundEffect(0);
                        didPressButton(true, false);
                    }
                    invalidate();
                    return false;
                }
            }
        }
        return false;
    }

    private boolean checkAudioMotionEvent(MotionEvent event) {
        boolean result;
        boolean z;
        int i;
        boolean z2;
        int i2 = this.documentAttachType;
        if ((i2 == 3 || i2 == 5) && !AndroidUtilities.isAccessibilityScreenReaderEnabled()) {
            int x = (int) event.getX();
            int y = (int) event.getY();
            if (this.useSeekBarWaveform) {
                result = this.seekBarWaveform.onTouch(event.getAction(), (event.getX() - this.seekBarX) - AndroidUtilities.dp(13.0f), event.getY() - this.seekBarY);
            } else if (MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
                result = this.seekBar.onTouch(event.getAction(), event.getX() - this.seekBarX, event.getY() - this.seekBarY);
            } else {
                result = false;
            }
            if (result) {
                if (!this.useSeekBarWaveform && event.getAction() == 0) {
                    getParent().requestDisallowInterceptTouchEvent(true);
                } else if (this.useSeekBarWaveform && !this.seekBarWaveform.isStartDraging() && event.getAction() == 1) {
                    didPressButton(true, false);
                }
                this.disallowLongPress = true;
                invalidate();
                return result;
            }
            int side = AndroidUtilities.dp(36.0f);
            boolean area = false;
            boolean area2 = false;
            if (this.miniButtonState >= 0) {
                int offset = AndroidUtilities.dp(27.0f);
                int i3 = this.buttonX;
                if (x >= i3 + offset && x <= i3 + offset + side) {
                    int i4 = this.buttonY;
                    if (y >= i4 + offset && y <= i4 + offset + side) {
                        z2 = true;
                        area2 = z2;
                    }
                }
                z2 = false;
                area2 = z2;
            }
            if (!area2) {
                int i5 = this.buttonState;
                if (i5 == 0 || i5 == 1 || i5 == 2) {
                    if (x >= this.buttonX - AndroidUtilities.dp(12.0f) && x <= (this.buttonX - AndroidUtilities.dp(12.0f)) + this.backgroundWidth) {
                        boolean z3 = this.drawInstantView;
                        if (y >= (z3 ? this.buttonY : this.namesOffset + this.mediaOffsetY)) {
                            if (y <= (z3 ? this.buttonY + side : this.namesOffset + this.mediaOffsetY + AndroidUtilities.dp(82.0f))) {
                                z = true;
                                area = z;
                            }
                        }
                    }
                    z = false;
                    area = z;
                } else {
                    int i6 = this.buttonX;
                    area = x >= i6 && x <= i6 + side && y >= (i = this.buttonY) && y <= i + side;
                }
            }
            if (event.getAction() == 0) {
                if (area || area2) {
                    if (area) {
                        this.buttonPressed = 1;
                    } else {
                        this.miniButtonPressed = 1;
                    }
                    invalidate();
                    return true;
                }
                return result;
            } else if (this.buttonPressed != 0) {
                if (event.getAction() == 1) {
                    this.buttonPressed = 0;
                    playSoundEffect(0);
                    didPressButton(true, false);
                    invalidate();
                    return result;
                } else if (event.getAction() != 3) {
                    if (event.getAction() == 2 && !area) {
                        this.buttonPressed = 0;
                        invalidate();
                        return result;
                    }
                    return result;
                } else {
                    this.buttonPressed = 0;
                    invalidate();
                    return result;
                }
            } else if (this.miniButtonPressed != 0) {
                if (event.getAction() == 1) {
                    this.miniButtonPressed = 0;
                    playSoundEffect(0);
                    didPressMiniButton(true);
                    invalidate();
                    return result;
                } else if (event.getAction() != 3) {
                    if (event.getAction() == 2 && !area2) {
                        this.miniButtonPressed = 0;
                        invalidate();
                        return result;
                    }
                    return result;
                } else {
                    this.miniButtonPressed = 0;
                    invalidate();
                    return result;
                }
            } else {
                return result;
            }
        }
        return false;
    }

    public boolean checkSpoilersMotionEvent(MotionEvent event) {
        MessageObject.GroupedMessages groupedMessages;
        if (this.currentMessageObject.hasValidGroupId() && (groupedMessages = this.currentMessagesGroup) != null && !groupedMessages.isDocuments) {
            ViewGroup parent = (ViewGroup) getParent();
            for (int i = 0; i < parent.getChildCount(); i++) {
                View v = parent.getChildAt(i);
                if (v instanceof ChatMessageCell) {
                    ChatMessageCell cell = (ChatMessageCell) v;
                    MessageObject.GroupedMessages group = cell.getCurrentMessagesGroup();
                    MessageObject.GroupedMessagePosition position = cell.getCurrentPosition();
                    if (group != null && group.groupId == this.currentMessagesGroup.groupId && (position.flags & 8) != 0 && (position.flags & 1) != 0 && cell != this) {
                        event.offsetLocation(getLeft() - cell.getLeft(), getTop() - cell.getTop());
                        boolean result = cell.checkSpoilersMotionEvent(event);
                        event.offsetLocation(-(getLeft() - cell.getLeft()), -(getTop() - cell.getTop()));
                        return result;
                    }
                }
            }
        }
        if (this.isSpoilerRevealing) {
            return false;
        }
        int x = (int) event.getX();
        int y = (int) event.getY();
        int act = event.getActionMasked();
        if (act == 0) {
            int i2 = this.textX;
            if (x >= i2 && y >= this.textY && x <= i2 + this.currentMessageObject.textWidth && y <= this.textY + this.currentMessageObject.textHeight) {
                List<MessageObject.TextLayoutBlock> blocks = this.currentMessageObject.textLayoutBlocks;
                for (int i3 = 0; i3 < blocks.size() && blocks.get(i3).textYOffset <= y; i3++) {
                    MessageObject.TextLayoutBlock block = blocks.get(i3);
                    int offX = block.isRtl() ? (int) this.currentMessageObject.textXOffset : 0;
                    for (SpoilerEffect eff : block.spoilers) {
                        if (eff.getBounds().contains((x - this.textX) + offX, (int) ((y - this.textY) - block.textYOffset))) {
                            this.spoilerPressed = eff;
                            this.isCaptionSpoilerPressed = false;
                            return true;
                        }
                    }
                }
            }
            if (hasCaptionLayout()) {
                float f = this.captionX;
                if (x >= f && y >= this.captionY && x <= f + this.captionLayout.getWidth() && y <= this.captionY + this.captionLayout.getHeight()) {
                    for (SpoilerEffect eff2 : this.captionSpoilers) {
                        if (eff2.getBounds().contains((int) (x - this.captionX), (int) (y - this.captionY))) {
                            this.spoilerPressed = eff2;
                            this.isCaptionSpoilerPressed = true;
                            return true;
                        }
                    }
                    return false;
                }
                return false;
            }
            return false;
        } else if (act == 1 && this.spoilerPressed != null) {
            playSoundEffect(0);
            this.sPath.rewind();
            if (this.isCaptionSpoilerPressed) {
                for (SpoilerEffect eff3 : this.captionSpoilers) {
                    Rect b = eff3.getBounds();
                    this.sPath.addRect(b.left, b.top, b.right, b.bottom, Path.Direction.CW);
                }
            } else {
                Iterator<MessageObject.TextLayoutBlock> it = this.currentMessageObject.textLayoutBlocks.iterator();
                while (it.hasNext()) {
                    MessageObject.TextLayoutBlock block2 = it.next();
                    for (SpoilerEffect eff4 : block2.spoilers) {
                        Rect b2 = eff4.getBounds();
                        this.sPath.addRect(b2.left, b2.top + block2.textYOffset, b2.right, b2.bottom + block2.textYOffset, Path.Direction.CW);
                    }
                }
            }
            this.sPath.computeBounds(this.rect, false);
            float width = this.rect.width();
            float height = this.rect.height();
            float rad = (float) Math.sqrt(Math.pow(width, 2.0d) + Math.pow(height, 2.0d));
            this.isSpoilerRevealing = true;
            this.spoilerPressed.setOnRippleEndCallback(new Runnable() { // from class: org.telegram.ui.Cells.ChatMessageCell$$ExternalSyntheticLambda2
                @Override // java.lang.Runnable
                public final void run() {
                    ChatMessageCell.this.m1637x3d58ab10();
                }
            });
            if (this.isCaptionSpoilerPressed) {
                for (SpoilerEffect eff5 : this.captionSpoilers) {
                    eff5.startRipple(x - this.captionX, y - this.captionY, rad);
                }
            } else if (this.currentMessageObject.textLayoutBlocks != null) {
                Iterator<MessageObject.TextLayoutBlock> it2 = this.currentMessageObject.textLayoutBlocks.iterator();
                while (it2.hasNext()) {
                    MessageObject.TextLayoutBlock block3 = it2.next();
                    int offX2 = block3.isRtl() ? (int) this.currentMessageObject.textXOffset : 0;
                    for (SpoilerEffect eff6 : block3.spoilers) {
                        eff6.startRipple((x - this.textX) + offX2, (y - block3.textYOffset) - this.textY, rad);
                    }
                }
            }
            if (getParent() instanceof RecyclerListView) {
                ViewGroup vg = (ViewGroup) getParent();
                for (int i4 = 0; i4 < vg.getChildCount(); i4++) {
                    View ch = vg.getChildAt(i4);
                    if (ch instanceof ChatMessageCell) {
                        final ChatMessageCell cell2 = (ChatMessageCell) ch;
                        if (cell2.getMessageObject() != null && cell2.getMessageObject().getReplyMsgId() == getMessageObject().getId() && !cell2.replySpoilers.isEmpty()) {
                            cell2.replySpoilers.get(0).setOnRippleEndCallback(new Runnable() { // from class: org.telegram.ui.Cells.ChatMessageCell$$ExternalSyntheticLambda5
                                @Override // java.lang.Runnable
                                public final void run() {
                                    ChatMessageCell.this.m1638xcf5a9992(cell2);
                                }
                            });
                            for (SpoilerEffect eff7 : cell2.replySpoilers) {
                                eff7.startRipple(eff7.getBounds().centerX(), eff7.getBounds().centerY(), rad);
                            }
                        }
                    }
                }
            }
            this.spoilerPressed = null;
            return true;
        } else {
            return false;
        }
    }

    /* renamed from: lambda$checkSpoilersMotionEvent$1$org-telegram-ui-Cells-ChatMessageCell */
    public /* synthetic */ void m1637x3d58ab10() {
        post(new Runnable() { // from class: org.telegram.ui.Cells.ChatMessageCell$$ExternalSyntheticLambda1
            @Override // java.lang.Runnable
            public final void run() {
                ChatMessageCell.this.m1636x7457b3cf();
            }
        });
    }

    /* renamed from: lambda$checkSpoilersMotionEvent$0$org-telegram-ui-Cells-ChatMessageCell */
    public /* synthetic */ void m1636x7457b3cf() {
        this.isSpoilerRevealing = false;
        getMessageObject().isSpoilersRevealed = true;
        if (this.isCaptionSpoilerPressed) {
            this.captionSpoilers.clear();
        } else if (this.currentMessageObject.textLayoutBlocks != null) {
            Iterator<MessageObject.TextLayoutBlock> it = this.currentMessageObject.textLayoutBlocks.iterator();
            while (it.hasNext()) {
                MessageObject.TextLayoutBlock block = it.next();
                block.spoilers.clear();
            }
        }
        invalidate();
    }

    /* renamed from: lambda$checkSpoilersMotionEvent$3$org-telegram-ui-Cells-ChatMessageCell */
    public /* synthetic */ void m1638xcf5a9992(ChatMessageCell cell) {
        post(new Runnable() { // from class: org.telegram.ui.Cells.ChatMessageCell$$ExternalSyntheticLambda3
            @Override // java.lang.Runnable
            public final void run() {
                ChatMessageCell.lambda$checkSpoilersMotionEvent$2(ChatMessageCell.this);
            }
        });
    }

    public static /* synthetic */ void lambda$checkSpoilersMotionEvent$2(ChatMessageCell cell) {
        cell.getMessageObject().replyMessageObject.isSpoilersRevealed = true;
        cell.replySpoilers.clear();
        cell.invalidate();
    }

    private boolean checkBotButtonMotionEvent(MotionEvent event) {
        int addX;
        if (this.botButtons.isEmpty() || this.currentMessageObject.eventId != 0) {
            return false;
        }
        int x = (int) event.getX();
        int y = (int) event.getY();
        if (event.getAction() == 0) {
            if (this.currentMessageObject.isOutOwner()) {
                addX = (getMeasuredWidth() - this.widthForButtons) - AndroidUtilities.dp(10.0f);
            } else {
                addX = this.backgroundDrawableLeft + AndroidUtilities.dp(this.mediaBackground ? 1.0f : 7.0f);
            }
            for (int a = 0; a < this.botButtons.size(); a++) {
                BotButton button = this.botButtons.get(a);
                int y2 = (button.y + this.layoutHeight) - AndroidUtilities.dp(2.0f);
                if (x >= button.x + addX && x <= button.x + addX + button.width && y >= y2 && y <= button.height + y2) {
                    this.pressedBotButton = a;
                    invalidate();
                    final int longPressedBotButton = this.pressedBotButton;
                    postDelayed(new Runnable() { // from class: org.telegram.ui.Cells.ChatMessageCell$$ExternalSyntheticLambda4
                        @Override // java.lang.Runnable
                        public final void run() {
                            ChatMessageCell.this.m1635xa5a14b61(longPressedBotButton);
                        }
                    }, ViewConfiguration.getLongPressTimeout() - 1);
                    return true;
                }
            }
            return false;
        } else if (event.getAction() != 1 || this.pressedBotButton == -1) {
            return false;
        } else {
            playSoundEffect(0);
            if (this.currentMessageObject.scheduled) {
                Toast.makeText(getContext(), LocaleController.getString("MessageScheduledBotAction", R.string.MessageScheduledBotAction), 1).show();
            } else {
                BotButton button2 = this.botButtons.get(this.pressedBotButton);
                if (button2.button != null) {
                    this.delegate.didPressBotButton(this, button2.button);
                }
            }
            this.pressedBotButton = -1;
            invalidate();
            return false;
        }
    }

    /* renamed from: lambda$checkBotButtonMotionEvent$4$org-telegram-ui-Cells-ChatMessageCell */
    public /* synthetic */ void m1635xa5a14b61(int longPressedBotButton) {
        if (longPressedBotButton == this.pressedBotButton) {
            if (!this.currentMessageObject.scheduled) {
                BotButton button2 = this.botButtons.get(this.pressedBotButton);
                if (button2.button != null) {
                    cancelCheckLongPress();
                    this.delegate.didLongPressBotButton(this, button2.button);
                }
            }
            this.pressedBotButton = -1;
            invalidate();
        }
    }

    /* JADX WARN: Code restructure failed: missing block: B:271:0x0449, code lost:
        if (r10 <= (r0 + org.telegram.messenger.AndroidUtilities.dp(32.0f))) goto L389;
     */
    /* JADX WARN: Code restructure failed: missing block: B:307:0x04c3, code lost:
        if (r10 <= (r0 + org.telegram.messenger.AndroidUtilities.dp(32.0f))) goto L389;
     */
    /* JADX WARN: Code restructure failed: missing block: B:356:0x059a, code lost:
        if (r10 <= (r1 + org.telegram.messenger.AndroidUtilities.dp(35.0f))) goto L389;
     */
    /* JADX WARN: Code restructure failed: missing block: B:386:0x05f9, code lost:
        if (r10 > (r0 + org.telegram.messenger.AndroidUtilities.dp(32 + ((r19.drawSideButton != 3 || r19.commentLayout == null) ? 0 : 18)))) goto L387;
     */
    @Override // android.view.View
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    public boolean onTouchEvent(MotionEvent event) {
        boolean result;
        int replyEnd;
        int id;
        TLRPC.Chat chat;
        int replyEnd2;
        int i;
        int i2;
        int i3;
        int i4;
        int i5;
        if (this.currentMessageObject == null || !this.delegate.canPerformActions() || this.animationRunning) {
            checkTextSelection(event);
            return super.onTouchEvent(event);
        } else if (checkTextSelection(event) || checkRoundSeekbar(event) || checkReactionsTouchEvent(event)) {
            return true;
        } else {
            VideoPlayerRewinder videoPlayerRewinder = this.videoPlayerRewinder;
            int i6 = 0;
            if (videoPlayerRewinder != null && videoPlayerRewinder.rewindCount > 0) {
                if (event.getAction() != 1 && event.getAction() != 3) {
                    return true;
                }
                getParent().requestDisallowInterceptTouchEvent(false);
                this.videoPlayerRewinder.cancelRewind();
                return false;
            }
            this.disallowLongPress = false;
            this.lastTouchX = event.getX();
            float y = event.getY();
            this.lastTouchY = y;
            this.backgroundDrawable.setTouchCoords(this.lastTouchX, y);
            boolean result2 = checkSpoilersMotionEvent(event);
            if (!result2) {
                result2 = checkTextBlockMotionEvent(event);
            }
            if (!result2) {
                result2 = checkPinchToZoom(event);
            }
            if (!result2) {
                result2 = checkDateMotionEvent(event);
            }
            if (!result2) {
                result2 = checkTextSelection(event);
            }
            if (!result2) {
                result2 = checkOtherButtonMotionEvent(event);
            }
            if (!result2) {
                result2 = checkCaptionMotionEvent(event);
            }
            if (!result2) {
                result2 = checkTranscribeButtonMotionEvent(event);
            }
            if (!result2) {
                result2 = checkAudioMotionEvent(event);
            }
            if (!result2) {
                result2 = checkLinkPreviewMotionEvent(event);
            }
            if (!result2) {
                result2 = checkInstantButtonMotionEvent(event);
            }
            if (!result2) {
                result2 = checkCommentButtonMotionEvent(event);
            }
            if (!result2) {
                result2 = checkGameMotionEvent(event);
            }
            if (!result2) {
                result2 = checkPhotoImageMotionEvent(event);
            }
            if (!result2) {
                result2 = checkBotButtonMotionEvent(event);
            }
            if (!result2) {
                result2 = checkPollButtonMotionEvent(event);
            }
            if (event.getAction() == 3) {
                this.spoilerPressed = null;
                this.isCaptionSpoilerPressed = false;
                this.buttonPressed = 0;
                this.miniButtonPressed = 0;
                this.pressedBotButton = -1;
                this.pressedVoteButton = -1;
                this.pollHintPressed = false;
                this.psaHintPressed = false;
                this.linkPreviewPressed = false;
                this.otherPressed = false;
                this.sideButtonPressed = false;
                this.imagePressed = false;
                this.timePressed = false;
                this.gamePreviewPressed = false;
                this.commentButtonPressed = false;
                this.instantButtonPressed = false;
                this.instantPressed = false;
                if (Build.VERSION.SDK_INT >= 21) {
                    int a = 0;
                    while (true) {
                        Drawable[] drawableArr = this.selectorDrawable;
                        if (a >= drawableArr.length) {
                            break;
                        }
                        if (drawableArr[a] != null) {
                            drawableArr[a].setState(StateSet.NOTHING);
                        }
                        a++;
                    }
                }
                if (this.hadLongPress) {
                    if (this.pressedLinkType != 2) {
                        this.hadLongPress = false;
                    }
                    this.pressedLink = null;
                    this.pressedLinkType = -1;
                } else {
                    resetPressedLink(-1);
                }
                result = false;
            } else {
                result = result2;
            }
            updateRadialProgressBackground();
            if (!this.disallowLongPress && result && event.getAction() == 0) {
                startCheckLongPress();
            }
            if (event.getAction() != 0 && event.getAction() != 2) {
                cancelCheckLongPress();
            }
            if (!result) {
                float x = event.getX();
                float y2 = event.getY();
                if (event.getAction() == 0) {
                    ChatMessageCellDelegate chatMessageCellDelegate = this.delegate;
                    if (chatMessageCellDelegate == null || chatMessageCellDelegate.canPerformActions()) {
                        if (this.isAvatarVisible && this.avatarImage.isInsideImage(x, getTop() + y2)) {
                            this.avatarPressed = true;
                            result = true;
                        } else {
                            if (this.psaButtonVisible && this.hasPsaHint) {
                                if (x >= this.psaHelpX && x <= i4 + AndroidUtilities.dp(40.0f)) {
                                    if (y2 >= this.psaHelpY && y2 <= i5 + AndroidUtilities.dp(40.0f)) {
                                        this.psaHintPressed = true;
                                        createSelectorDrawable(0);
                                        this.selectorDrawableMaskType[0] = 3;
                                        if (Build.VERSION.SDK_INT >= 21) {
                                            Drawable[] drawableArr2 = this.selectorDrawable;
                                            if (drawableArr2[0] != null) {
                                                drawableArr2[0].setBounds(this.psaHelpX - AndroidUtilities.dp(8.0f), this.psaHelpY - AndroidUtilities.dp(8.0f), this.psaHelpX + AndroidUtilities.dp(32.0f), this.psaHelpY + AndroidUtilities.dp(32.0f));
                                                this.selectorDrawable[0].setHotspot(x, y2);
                                                this.selectorDrawable[0].setState(this.pressedState);
                                            }
                                        }
                                        result = true;
                                        invalidate();
                                    }
                                }
                            }
                            if (this.drawForwardedName && this.forwardedNameLayout[0] != null) {
                                float f = this.forwardNameX;
                                if (x >= f && x <= f + this.forwardedNameWidth) {
                                    if (y2 >= this.forwardNameY && y2 <= i3 + AndroidUtilities.dp(32.0f)) {
                                        if (this.viaWidth != 0 && x >= this.forwardNameX + this.viaNameWidth + AndroidUtilities.dp(4.0f)) {
                                            this.forwardBotPressed = true;
                                        } else {
                                            this.forwardNamePressed = true;
                                        }
                                        result = true;
                                    }
                                }
                            }
                            if (this.drawNameLayout && this.nameLayout != null && (i2 = this.viaWidth) != 0) {
                                float f2 = this.nameX;
                                int i7 = this.viaNameWidth;
                                if (x >= i7 + f2 && x <= f2 + i7 + i2 && y2 >= this.nameY - AndroidUtilities.dp(4.0f) && y2 <= this.nameY + AndroidUtilities.dp(20.0f)) {
                                    this.forwardBotPressed = true;
                                    result = true;
                                }
                            }
                            if (this.drawSideButton != 0) {
                                float f3 = this.sideStartX;
                                if (x >= f3 && x <= f3 + AndroidUtilities.dp(40.0f)) {
                                    float f4 = this.sideStartY;
                                    if (y2 >= f4) {
                                        if (this.drawSideButton == 3 && this.commentLayout != null) {
                                            i6 = 18;
                                        }
                                        if (y2 <= f4 + AndroidUtilities.dp(32 + i6)) {
                                            if (this.currentMessageObject.isSent()) {
                                                this.sideButtonPressed = true;
                                            }
                                            result = true;
                                            invalidate();
                                        }
                                    }
                                }
                            }
                            if (this.replyNameLayout != null) {
                                if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                                    replyEnd2 = this.replyStartX + Math.max(this.replyNameWidth, this.replyTextWidth);
                                } else {
                                    int replyEnd3 = this.replyStartX;
                                    replyEnd2 = replyEnd3 + this.backgroundDrawableRight;
                                }
                                if (x >= this.replyStartX && x <= replyEnd2) {
                                    if (y2 >= this.replyStartY && y2 <= i + AndroidUtilities.dp(35.0f)) {
                                        this.replyPressed = true;
                                        result = true;
                                    }
                                }
                            }
                        }
                        if (result) {
                            startCheckLongPress();
                        }
                    }
                } else {
                    if (event.getAction() != 2) {
                        cancelCheckLongPress();
                    }
                    if (this.avatarPressed) {
                        if (event.getAction() == 1) {
                            this.avatarPressed = false;
                            playSoundEffect(0);
                            if (this.delegate != null) {
                                TLRPC.User user = this.currentUser;
                                if (user != null) {
                                    if (user.id == 0) {
                                        this.delegate.didPressHiddenForward(this);
                                    } else {
                                        this.delegate.didPressUserAvatar(this, this.currentUser, this.lastTouchX, this.lastTouchY);
                                    }
                                } else if (this.currentChat != null) {
                                    TLRPC.Chat chat2 = this.currentChat;
                                    if (this.currentMessageObject.messageOwner.fwd_from != null) {
                                        if ((this.currentMessageObject.messageOwner.fwd_from.flags & 16) != 0) {
                                            chat = chat2;
                                            id = this.currentMessageObject.messageOwner.fwd_from.saved_from_msg_id;
                                        } else {
                                            int id2 = this.currentMessageObject.messageOwner.fwd_from.channel_post;
                                            chat = this.currentForwardChannel;
                                            id = id2;
                                        }
                                    } else {
                                        chat = chat2;
                                        id = 0;
                                    }
                                    this.delegate.didPressChannelAvatar(this, chat != null ? chat : this.currentChat, id, this.lastTouchX, this.lastTouchY);
                                } else {
                                    MessageObject messageObject = this.currentMessageObject;
                                    if (messageObject != null && messageObject.sponsoredChatInvite != null) {
                                        this.delegate.didPressInstantButton(this, this.drawInstantViewType);
                                    }
                                }
                            }
                        } else if (event.getAction() == 3) {
                            this.avatarPressed = false;
                        } else if (event.getAction() == 2 && this.isAvatarVisible && !this.avatarImage.isInsideImage(x, getTop() + y2)) {
                            this.avatarPressed = false;
                        }
                    } else if (this.psaHintPressed) {
                        if (event.getAction() == 1) {
                            playSoundEffect(0);
                            this.delegate.didPressHint(this, 1);
                            this.psaHintPressed = false;
                            if (Build.VERSION.SDK_INT >= 21) {
                                Drawable[] drawableArr3 = this.selectorDrawable;
                                if (drawableArr3[0] != null) {
                                    drawableArr3[0].setState(StateSet.NOTHING);
                                }
                            }
                            invalidate();
                        }
                    } else if (this.forwardNamePressed) {
                        if (event.getAction() == 1) {
                            this.forwardNamePressed = false;
                            playSoundEffect(0);
                            ChatMessageCellDelegate chatMessageCellDelegate2 = this.delegate;
                            if (chatMessageCellDelegate2 != null) {
                                TLRPC.Chat chat3 = this.currentForwardChannel;
                                if (chat3 != null) {
                                    chatMessageCellDelegate2.didPressChannelAvatar(this, chat3, this.currentMessageObject.messageOwner.fwd_from.channel_post, this.lastTouchX, this.lastTouchY);
                                } else {
                                    TLRPC.User user2 = this.currentForwardUser;
                                    if (user2 != null) {
                                        chatMessageCellDelegate2.didPressUserAvatar(this, user2, this.lastTouchX, this.lastTouchY);
                                    } else if (this.currentForwardName != null) {
                                        chatMessageCellDelegate2.didPressHiddenForward(this);
                                    }
                                }
                            }
                        } else if (event.getAction() == 3) {
                            this.forwardNamePressed = false;
                        } else if (event.getAction() == 2) {
                            float f5 = this.forwardNameX;
                            if (x >= f5 && x <= f5 + this.forwardedNameWidth) {
                                if (y2 >= this.forwardNameY) {
                                }
                            }
                            this.forwardNamePressed = false;
                        }
                    } else if (this.forwardBotPressed) {
                        if (event.getAction() == 1) {
                            this.forwardBotPressed = false;
                            playSoundEffect(0);
                            if (this.delegate != null) {
                                if (this.currentViaBotUser.bot_inline_placeholder == null) {
                                    ChatMessageCellDelegate chatMessageCellDelegate3 = this.delegate;
                                    TLRPC.User user3 = this.currentViaBotUser;
                                    chatMessageCellDelegate3.didPressViaBotNotInline(this, user3 != null ? user3.id : 0L);
                                } else {
                                    ChatMessageCellDelegate chatMessageCellDelegate4 = this.delegate;
                                    TLRPC.User user4 = this.currentViaBotUser;
                                    chatMessageCellDelegate4.didPressViaBot(this, user4 != null ? user4.username : this.currentMessageObject.messageOwner.via_bot_name);
                                }
                            }
                        } else if (event.getAction() == 3) {
                            this.forwardBotPressed = false;
                        } else if (event.getAction() == 2) {
                            if (this.drawForwardedName && this.forwardedNameLayout[0] != null) {
                                float f6 = this.forwardNameX;
                                if (x >= f6 && x <= f6 + this.forwardedNameWidth) {
                                    if (y2 >= this.forwardNameY) {
                                    }
                                }
                                this.forwardBotPressed = false;
                            } else {
                                float f7 = this.nameX;
                                int i8 = this.viaNameWidth;
                                if (x < i8 + f7 || x > f7 + i8 + this.viaWidth || y2 < this.nameY - AndroidUtilities.dp(4.0f) || y2 > this.nameY + AndroidUtilities.dp(20.0f)) {
                                    this.forwardBotPressed = false;
                                }
                            }
                        }
                    } else if (this.replyPressed) {
                        if (event.getAction() == 1) {
                            this.replyPressed = false;
                            playSoundEffect(0);
                            if (this.replyPanelIsForward) {
                                ChatMessageCellDelegate chatMessageCellDelegate5 = this.delegate;
                                if (chatMessageCellDelegate5 != null) {
                                    TLRPC.Chat chat4 = this.currentForwardChannel;
                                    if (chat4 != null) {
                                        chatMessageCellDelegate5.didPressChannelAvatar(this, chat4, this.currentMessageObject.messageOwner.fwd_from.channel_post, this.lastTouchX, this.lastTouchY);
                                    } else {
                                        TLRPC.User user5 = this.currentForwardUser;
                                        if (user5 != null) {
                                            chatMessageCellDelegate5.didPressUserAvatar(this, user5, this.lastTouchX, this.lastTouchY);
                                        } else if (this.currentForwardName != null) {
                                            chatMessageCellDelegate5.didPressHiddenForward(this);
                                        }
                                    }
                                }
                            } else if (this.delegate != null && this.currentMessageObject.hasValidReplyMessageObject()) {
                                this.delegate.didPressReplyMessage(this, this.currentMessageObject.getReplyMsgId());
                            }
                        } else if (event.getAction() == 3) {
                            this.replyPressed = false;
                        } else if (event.getAction() == 2) {
                            if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                                replyEnd = this.replyStartX + Math.max(this.replyNameWidth, this.replyTextWidth);
                            } else {
                                int replyEnd4 = this.replyStartX;
                                replyEnd = replyEnd4 + this.backgroundDrawableRight;
                            }
                            if (x >= this.replyStartX && x <= replyEnd) {
                                if (y2 >= this.replyStartY) {
                                }
                            }
                            this.replyPressed = false;
                        }
                    } else if (this.sideButtonPressed) {
                        if (event.getAction() == 1) {
                            this.sideButtonPressed = false;
                            playSoundEffect(0);
                            ChatMessageCellDelegate chatMessageCellDelegate6 = this.delegate;
                            if (chatMessageCellDelegate6 != null) {
                                if (this.drawSideButton == 3) {
                                    chatMessageCellDelegate6.didPressCommentButton(this);
                                } else {
                                    chatMessageCellDelegate6.didPressSideButton(this);
                                }
                            }
                        } else if (event.getAction() == 3) {
                            this.sideButtonPressed = false;
                        } else if (event.getAction() == 2) {
                            float f8 = this.sideStartX;
                            if (x >= f8 && x <= f8 + AndroidUtilities.dp(40.0f)) {
                                float f9 = this.sideStartY;
                                if (y2 >= f9) {
                                }
                            }
                            this.sideButtonPressed = false;
                        }
                        invalidate();
                    }
                }
            }
            return result;
        }
    }

    private boolean checkReactionsTouchEvent(MotionEvent event) {
        MessageObject.GroupedMessages groupedMessages;
        if (this.currentMessageObject.hasValidGroupId() && (groupedMessages = this.currentMessagesGroup) != null && !groupedMessages.isDocuments) {
            ViewGroup parent = (ViewGroup) getParent();
            if (parent == null) {
                return false;
            }
            for (int i = 0; i < parent.getChildCount(); i++) {
                View v = parent.getChildAt(i);
                if (v instanceof ChatMessageCell) {
                    ChatMessageCell cell = (ChatMessageCell) v;
                    MessageObject.GroupedMessages group = cell.getCurrentMessagesGroup();
                    MessageObject.GroupedMessagePosition position = cell.getCurrentPosition();
                    if (group != null && group.groupId == this.currentMessagesGroup.groupId && (position.flags & 8) != 0 && (position.flags & 1) != 0) {
                        if (cell == this) {
                            return this.reactionsLayoutInBubble.chekTouchEvent(event);
                        }
                        event.offsetLocation(getLeft() - cell.getLeft(), getTop() - cell.getTop());
                        boolean result = cell.reactionsLayoutInBubble.chekTouchEvent(event);
                        event.offsetLocation(-(getLeft() - cell.getLeft()), -(getTop() - cell.getTop()));
                        return result;
                    }
                }
            }
            return false;
        }
        return this.reactionsLayoutInBubble.chekTouchEvent(event);
    }

    private boolean checkPinchToZoom(MotionEvent ev) {
        ChatMessageCellDelegate chatMessageCellDelegate = this.delegate;
        PinchToZoomHelper pinchToZoomHelper = chatMessageCellDelegate == null ? null : chatMessageCellDelegate.getPinchToZoomHelper();
        if (this.currentMessageObject != null && this.photoImage.hasNotThumb() && pinchToZoomHelper != null && !this.currentMessageObject.isSticker() && !this.currentMessageObject.isAnimatedEmoji()) {
            if ((this.currentMessageObject.isVideo() && !this.autoPlayingMedia) || this.isRoundVideo || this.currentMessageObject.isAnimatedSticker()) {
                return false;
            }
            if ((this.currentMessageObject.isDocument() && !this.currentMessageObject.isGif()) || this.currentMessageObject.needDrawBluredPreview()) {
                return false;
            }
            return pinchToZoomHelper.checkPinchToZoom(ev, this, this.photoImage, this.currentMessageObject);
        }
        return false;
    }

    private boolean checkTextSelection(MotionEvent event) {
        int linkX;
        MessageObject.GroupedMessages groupedMessages;
        TextSelectionHelper.ChatListTextSelectionHelper textSelectionHelper = this.delegate.getTextSelectionHelper();
        if (textSelectionHelper == null || MessagesController.getInstance(this.currentAccount).isChatNoForwards(this.currentMessageObject.getChatId()) || (this.currentMessageObject.messageOwner != null && this.currentMessageObject.messageOwner.noforwards)) {
            return false;
        }
        boolean hasTextBlocks = this.currentMessageObject.textLayoutBlocks != null && !this.currentMessageObject.textLayoutBlocks.isEmpty();
        if (!hasTextBlocks && !hasCaptionLayout()) {
            return false;
        }
        if ((!this.drawSelectionBackground && this.currentMessagesGroup == null) || (this.currentMessagesGroup != null && !this.delegate.hasSelectedMessages())) {
            return false;
        }
        if (this.currentMessageObject.hasValidGroupId() && (groupedMessages = this.currentMessagesGroup) != null && !groupedMessages.isDocuments) {
            ViewGroup parent = (ViewGroup) getParent();
            for (int i = 0; i < parent.getChildCount(); i++) {
                View v = parent.getChildAt(i);
                if (v instanceof ChatMessageCell) {
                    ChatMessageCell cell = (ChatMessageCell) v;
                    MessageObject.GroupedMessages group = cell.getCurrentMessagesGroup();
                    MessageObject.GroupedMessagePosition position = cell.getCurrentPosition();
                    if (group != null && group.groupId == this.currentMessagesGroup.groupId && (position.flags & 8) != 0 && (position.flags & 1) != 0) {
                        textSelectionHelper.setMaybeTextCord((int) cell.captionX, (int) cell.captionY);
                        textSelectionHelper.setMessageObject(cell);
                        if (cell == this) {
                            return textSelectionHelper.onTouchEvent(event);
                        }
                        event.offsetLocation(getLeft() - cell.getLeft(), getTop() - cell.getTop());
                        boolean result = textSelectionHelper.onTouchEvent(event);
                        event.offsetLocation(-(getLeft() - cell.getLeft()), -(getTop() - cell.getTop()));
                        return result;
                    }
                }
            }
            return false;
        }
        if (hasCaptionLayout()) {
            textSelectionHelper.setIsDescription(false);
            textSelectionHelper.setMaybeTextCord((int) this.captionX, (int) this.captionY);
        } else if (this.descriptionLayout != null && event.getY() > this.descriptionY) {
            textSelectionHelper.setIsDescription(true);
            if (this.hasGamePreview) {
                linkX = this.unmovedTextX - AndroidUtilities.dp(10.0f);
            } else if (this.hasInvoicePreview) {
                linkX = this.unmovedTextX + AndroidUtilities.dp(1.0f);
            } else {
                int linkX2 = this.unmovedTextX;
                linkX = linkX2 + AndroidUtilities.dp(1.0f);
            }
            textSelectionHelper.setMaybeTextCord(AndroidUtilities.dp(10.0f) + linkX + this.descriptionX, this.descriptionY);
        } else {
            textSelectionHelper.setIsDescription(false);
            textSelectionHelper.setMaybeTextCord(this.textX, this.textY);
        }
        textSelectionHelper.setMessageObject(this);
        return textSelectionHelper.onTouchEvent(event);
    }

    private void updateSelectionTextPosition() {
        int linkX;
        if (getDelegate() != null && getDelegate().getTextSelectionHelper() != null && getDelegate().getTextSelectionHelper().isSelected(this.currentMessageObject)) {
            int textSelectionType = getDelegate().getTextSelectionHelper().getTextSelectionType(this);
            if (textSelectionType != TextSelectionHelper.ChatListTextSelectionHelper.TYPE_DESCRIPTION) {
                if (textSelectionType == TextSelectionHelper.ChatListTextSelectionHelper.TYPE_CAPTION) {
                    getDelegate().getTextSelectionHelper().updateTextPosition((int) this.captionX, (int) this.captionY);
                    return;
                } else {
                    getDelegate().getTextSelectionHelper().updateTextPosition(this.textX, this.textY);
                    return;
                }
            }
            if (this.hasGamePreview) {
                linkX = this.unmovedTextX - AndroidUtilities.dp(10.0f);
            } else if (this.hasInvoicePreview) {
                linkX = this.unmovedTextX + AndroidUtilities.dp(1.0f);
            } else {
                int linkX2 = this.unmovedTextX;
                linkX = linkX2 + AndroidUtilities.dp(1.0f);
            }
            getDelegate().getTextSelectionHelper().updateTextPosition(AndroidUtilities.dp(10.0f) + linkX + this.descriptionX, this.descriptionY);
        }
    }

    public ArrayList<PollButton> getPollButtons() {
        return this.pollButtons;
    }

    public void updatePlayingMessageProgress() {
        if (this.currentMessageObject == null) {
            return;
        }
        VideoPlayerRewinder videoPlayerRewinder = this.videoPlayerRewinder;
        if (videoPlayerRewinder != null && videoPlayerRewinder.rewindCount != 0 && this.videoPlayerRewinder.rewindByBackSeek) {
            this.currentMessageObject.audioProgress = this.videoPlayerRewinder.getVideoProgress();
        }
        if (this.documentAttachType == 4) {
            if (this.infoLayout != null && (PhotoViewer.isPlayingMessage(this.currentMessageObject) || MediaController.getInstance().isGoingToShowMessageObject(this.currentMessageObject))) {
                return;
            }
            int duration = 0;
            AnimatedFileDrawable animation = this.photoImage.getAnimation();
            if (animation != null) {
                MessageObject messageObject = this.currentMessageObject;
                int durationMs = animation.getDurationMs() / 1000;
                messageObject.audioPlayerDuration = durationMs;
                duration = durationMs;
                if (this.currentMessageObject.messageOwner.ttl > 0 && this.currentMessageObject.messageOwner.destroyTime == 0 && !this.currentMessageObject.needDrawBluredPreview() && this.currentMessageObject.isVideo() && animation.hasBitmap()) {
                    this.delegate.didStartVideoStream(this.currentMessageObject);
                }
            }
            if (duration == 0) {
                duration = this.currentMessageObject.getDuration();
            }
            if (MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
                duration = (int) (duration - (duration * this.currentMessageObject.audioProgress));
            } else if (animation != null) {
                if (duration != 0) {
                    duration -= animation.getCurrentProgressMs() / 1000;
                }
                if (this.delegate != null && animation.getCurrentProgressMs() >= 3000) {
                    this.delegate.videoTimerReached();
                }
            }
            if (this.lastTime != duration) {
                String str = AndroidUtilities.formatShortDuration(duration);
                this.infoWidth = (int) Math.ceil(Theme.chat_infoPaint.measureText(str));
                this.infoLayout = new StaticLayout(str, Theme.chat_infoPaint, this.infoWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                this.lastTime = duration;
            }
        } else if (this.isRoundVideo) {
            int duration2 = 0;
            TLRPC.Document document = this.currentMessageObject.getDocument();
            int a = 0;
            while (true) {
                if (a >= document.attributes.size()) {
                    break;
                }
                TLRPC.DocumentAttribute attribute = document.attributes.get(a);
                if (!(attribute instanceof TLRPC.TL_documentAttributeVideo)) {
                    a++;
                } else {
                    duration2 = attribute.duration;
                    break;
                }
            }
            if (MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
                duration2 = Math.max(0, duration2 - this.currentMessageObject.audioProgressSec);
            }
            if (this.lastTime != duration2) {
                this.lastTime = duration2;
                String timeString = AndroidUtilities.formatLongDuration(duration2);
                this.timeWidthAudio = (int) Math.ceil(Theme.chat_timePaint.measureText(timeString));
                this.durationLayout = new StaticLayout(timeString, Theme.chat_timePaint, this.timeWidthAudio, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
            }
            if (this.currentMessageObject.audioProgress != 0.0f) {
                float f = this.currentMessageObject.audioProgress;
                this.lastDrawingAudioProgress = f;
                if (f > 0.9f) {
                    this.lastDrawingAudioProgress = 1.0f;
                }
            }
            invalidate();
        } else if (this.documentAttach != null) {
            if (this.useSeekBarWaveform) {
                if (!this.seekBarWaveform.isDragging()) {
                    this.seekBarWaveform.setProgress(this.currentMessageObject.audioProgress, true);
                }
            } else if (!this.seekBar.isDragging()) {
                this.seekBar.setProgress(this.currentMessageObject.audioProgress);
                this.seekBar.setBufferedProgress(this.currentMessageObject.bufferedProgress);
            }
            int duration3 = 0;
            if (this.documentAttachType == 3) {
                if (!MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
                    int a2 = 0;
                    while (true) {
                        if (a2 >= this.documentAttach.attributes.size()) {
                            break;
                        }
                        TLRPC.DocumentAttribute attribute2 = this.documentAttach.attributes.get(a2);
                        if (!(attribute2 instanceof TLRPC.TL_documentAttributeAudio)) {
                            a2++;
                        } else {
                            duration3 = attribute2.duration;
                            break;
                        }
                    }
                } else {
                    duration3 = this.currentMessageObject.audioProgressSec;
                }
                if (this.lastTime != duration3) {
                    this.lastTime = duration3;
                    String timeString2 = AndroidUtilities.formatLongDuration(duration3);
                    this.timeWidthAudio = (int) Math.ceil(Theme.chat_audioTimePaint.measureText(timeString2));
                    this.durationLayout = new StaticLayout(timeString2, Theme.chat_audioTimePaint, this.timeWidthAudio, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                }
            } else {
                int currentProgress = 0;
                int duration4 = this.currentMessageObject.getDuration();
                if (MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
                    currentProgress = this.currentMessageObject.audioProgressSec;
                }
                if (this.lastTime != currentProgress) {
                    this.lastTime = currentProgress;
                    String timeString3 = AndroidUtilities.formatShortDuration(currentProgress, duration4);
                    int timeWidth = (int) Math.ceil(Theme.chat_audioTimePaint.measureText(timeString3));
                    this.durationLayout = new StaticLayout(timeString3, Theme.chat_audioTimePaint, timeWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                }
            }
            invalidate();
        }
    }

    public void setFullyDraw(boolean draw) {
        this.fullyDraw = draw;
    }

    public void setParentViewSize(int parentW, int parentH) {
        Theme.MessageDrawable messageDrawable;
        this.parentWidth = parentW;
        this.parentHeight = parentH;
        this.backgroundHeight = parentH;
        if ((this.currentMessageObject != null && hasGradientService() && this.currentMessageObject.shouldDrawWithoutBackground()) || ((messageDrawable = this.currentBackgroundDrawable) != null && messageDrawable.getGradientShader() != null)) {
            invalidate();
        }
    }

    public void setVisiblePart(int position, int height, int parent, float parentOffset, float visibleTop, int parentW, int parentH, int blurredViewTopOffset, int blurredViewBottomOffset) {
        this.parentWidth = parentW;
        this.parentHeight = parentH;
        this.backgroundHeight = parentH;
        this.blurredViewTopOffset = blurredViewTopOffset;
        this.blurredViewBottomOffset = blurredViewBottomOffset;
        this.viewTop = visibleTop;
        if (parent != parentH || parentOffset != this.parentViewTopOffset) {
            this.parentViewTopOffset = parentOffset;
            this.parentHeight = parent;
        }
        if (this.currentMessageObject != null && hasGradientService() && this.currentMessageObject.shouldDrawWithoutBackground()) {
            invalidate();
        }
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject == null || messageObject.textLayoutBlocks == null) {
            return;
        }
        int position2 = position - this.textY;
        int newFirst = -1;
        int newLast = -1;
        int newCount = 0;
        int startBlock = 0;
        for (int a = 0; a < this.currentMessageObject.textLayoutBlocks.size() && this.currentMessageObject.textLayoutBlocks.get(a).textYOffset <= position2; a++) {
            startBlock = a;
        }
        for (int a2 = startBlock; a2 < this.currentMessageObject.textLayoutBlocks.size(); a2++) {
            MessageObject.TextLayoutBlock block = this.currentMessageObject.textLayoutBlocks.get(a2);
            float y = block.textYOffset;
            if (intersect(y, block.height + y, position2, position2 + height)) {
                if (newFirst == -1) {
                    newFirst = a2;
                }
                int newLast2 = a2;
                newCount++;
                newLast = newLast2;
            } else if (y > position2) {
                break;
            }
        }
        if (this.lastVisibleBlockNum != newLast || this.firstVisibleBlockNum != newFirst || this.totalVisibleBlocksCount != newCount) {
            this.lastVisibleBlockNum = newLast;
            this.firstVisibleBlockNum = newFirst;
            this.totalVisibleBlocksCount = newCount;
            invalidate();
        }
    }

    private boolean intersect(float left1, float right1, float left2, float right2) {
        return left1 <= left2 ? right1 >= left2 : left1 <= right2;
    }

    public static StaticLayout generateStaticLayout(CharSequence text, TextPaint paint, int maxWidth, int smallWidth, int linesCount, int maxLines) {
        SpannableStringBuilder stringBuilder = new SpannableStringBuilder(text);
        int addedChars = 0;
        StaticLayout layout = new StaticLayout(text, paint, smallWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
        int maxWidth2 = maxWidth;
        for (int a = 0; a < linesCount; a++) {
            layout.getLineDirections(a);
            if (layout.getLineLeft(a) != 0.0f || layout.isRtlCharAt(layout.getLineStart(a)) || layout.isRtlCharAt(layout.getLineEnd(a))) {
                maxWidth2 = smallWidth;
            }
            int pos = layout.getLineEnd(a);
            if (pos == text.length()) {
                break;
            }
            int pos2 = pos - 1;
            if (stringBuilder.charAt(pos2 + addedChars) == ' ') {
                stringBuilder.replace(pos2 + addedChars, pos2 + addedChars + 1, (CharSequence) "\n");
            } else if (stringBuilder.charAt(pos2 + addedChars) != '\n') {
                stringBuilder.insert(pos2 + addedChars, (CharSequence) "\n");
                addedChars++;
            }
            if (a == layout.getLineCount() - 1 || a == maxLines - 1) {
                break;
            }
        }
        return StaticLayoutEx.createStaticLayout(stringBuilder, paint, maxWidth2, Layout.Alignment.ALIGN_NORMAL, 1.0f, AndroidUtilities.dp(1.0f), false, TextUtils.TruncateAt.END, maxWidth2, maxLines, true);
    }

    private void didClickedImage() {
        TLRPC.WebPage webPage;
        if (this.currentMessageObject.type == 1 || this.currentMessageObject.isAnyKindOfSticker()) {
            int i = this.buttonState;
            if (i == -1) {
                this.delegate.didPressImage(this, this.lastTouchX, this.lastTouchY);
            } else if (i == 0) {
                didPressButton(true, false);
            }
        } else if (this.currentMessageObject.type == 12) {
            long uid = this.currentMessageObject.messageOwner.media.user_id;
            TLRPC.User user = null;
            if (uid != 0) {
                user = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(uid));
            }
            this.delegate.didPressUserAvatar(this, user, this.lastTouchX, this.lastTouchY);
        } else if (this.currentMessageObject.type == 5) {
            if (this.buttonState != -1) {
                didPressButton(true, false);
            } else if (!MediaController.getInstance().isPlayingMessage(this.currentMessageObject) || MediaController.getInstance().isMessagePaused()) {
                this.delegate.needPlayMessage(this.currentMessageObject);
            } else {
                MediaController.getInstance().m383lambda$startAudioAgain$7$orgtelegrammessengerMediaController(this.currentMessageObject);
            }
        } else if (this.currentMessageObject.type == 8) {
            int i2 = this.buttonState;
            if (i2 == -1 || (i2 == 1 && this.canStreamVideo && this.autoPlayingMedia)) {
                this.delegate.didPressImage(this, this.lastTouchX, this.lastTouchY);
            } else if (i2 == 2 || i2 == 0) {
                didPressButton(true, false);
            }
        } else if (this.documentAttachType == 4) {
            if (this.buttonState == -1 || (this.drawVideoImageButton && (this.autoPlayingMedia || (SharedConfig.streamMedia && this.canStreamVideo)))) {
                this.delegate.didPressImage(this, this.lastTouchX, this.lastTouchY);
            } else if (this.drawVideoImageButton) {
                didPressButton(true, true);
            } else {
                int i3 = this.buttonState;
                if (i3 == 0 || i3 == 3) {
                    didPressButton(true, false);
                }
            }
        } else if (this.currentMessageObject.type == 4) {
            this.delegate.didPressImage(this, this.lastTouchX, this.lastTouchY);
        } else {
            int i4 = this.documentAttachType;
            if (i4 == 1) {
                if (this.buttonState == -1) {
                    this.delegate.didPressImage(this, this.lastTouchX, this.lastTouchY);
                }
            } else if (i4 == 2) {
                if (this.buttonState == -1 && (webPage = this.currentMessageObject.messageOwner.media.webpage) != null) {
                    if (webPage.embed_url != null && webPage.embed_url.length() != 0) {
                        this.delegate.needOpenWebView(this.currentMessageObject, webPage.embed_url, webPage.site_name, webPage.description, webPage.url, webPage.embed_width, webPage.embed_height);
                    } else {
                        Browser.openUrl(getContext(), webPage.url);
                    }
                }
            } else if (this.hasInvoicePreview) {
                if (this.buttonState == -1) {
                    this.delegate.didPressImage(this, this.lastTouchX, this.lastTouchY);
                }
            } else if (Build.VERSION.SDK_INT >= 26 && this.delegate != null) {
                if (this.currentMessageObject.type == 16) {
                    this.delegate.didLongPress(this, 0.0f, 0.0f);
                } else {
                    this.delegate.didPressOther(this, this.otherX, this.otherY);
                }
            }
        }
    }

    private void updateSecretTimeText(MessageObject messageObject) {
        String str;
        if (messageObject == null || !messageObject.needDrawBluredPreview() || (str = messageObject.getSecretTimeString()) == null) {
            return;
        }
        this.infoWidth = (int) Math.ceil(Theme.chat_infoPaint.measureText(str));
        CharSequence str2 = TextUtils.ellipsize(str, Theme.chat_infoPaint, this.infoWidth, TextUtils.TruncateAt.END);
        this.infoLayout = new StaticLayout(str2, Theme.chat_infoPaint, this.infoWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
        invalidate();
    }

    private boolean isPhotoDataChanged(MessageObject object) {
        int provider;
        String url;
        if (object.type == 0 || object.type == 14) {
            return false;
        }
        if (object.type == 4) {
            if (this.currentUrl == null) {
                return true;
            }
            double lat = object.messageOwner.media.geo.lat;
            double lon = object.messageOwner.media.geo._long;
            if (((int) object.getDialogId()) == 0) {
                if (SharedConfig.mapPreviewType == 0) {
                    provider = -1;
                } else if (SharedConfig.mapPreviewType == 1) {
                    provider = 4;
                } else if (SharedConfig.mapPreviewType == 3) {
                    provider = 1;
                } else {
                    provider = -1;
                }
            } else {
                provider = -1;
            }
            if (object.messageOwner.media instanceof TLRPC.TL_messageMediaGeoLive) {
                int photoWidth = this.backgroundWidth - AndroidUtilities.dp(21.0f);
                int photoHeight = AndroidUtilities.dp(195.0f);
                double d = 268435456;
                Double.isNaN(d);
                double rad = d / 3.141592653589793d;
                double d2 = 268435456;
                Double.isNaN(d2);
                double y = Math.round(d2 - ((Math.log((Math.sin((lat * 3.141592653589793d) / 180.0d) + 1.0d) / (1.0d - Math.sin((lat * 3.141592653589793d) / 180.0d))) * rad) / 2.0d)) - (AndroidUtilities.dp(10.3f) << 6);
                double d3 = 268435456;
                Double.isNaN(y);
                Double.isNaN(d3);
                double lat2 = ((1.5707963267948966d - (Math.atan(Math.exp((y - d3) / rad)) * 2.0d)) * 180.0d) / 3.141592653589793d;
                int i = this.currentAccount;
                int photoHeight2 = (int) (photoWidth / AndroidUtilities.density);
                url = AndroidUtilities.formapMapUrl(i, lat2, lon, photoHeight2, (int) (photoHeight / AndroidUtilities.density), false, 15, provider);
            } else if (!TextUtils.isEmpty(object.messageOwner.media.title)) {
                int photoWidth2 = this.backgroundWidth - AndroidUtilities.dp(21.0f);
                int photoHeight3 = AndroidUtilities.dp(195.0f);
                url = AndroidUtilities.formapMapUrl(this.currentAccount, lat, lon, (int) (photoWidth2 / AndroidUtilities.density), (int) (photoHeight3 / AndroidUtilities.density), true, 15, provider);
            } else {
                int photoWidth3 = this.backgroundWidth - AndroidUtilities.dp(12.0f);
                int photoHeight4 = AndroidUtilities.dp(195.0f);
                url = AndroidUtilities.formapMapUrl(this.currentAccount, lat, lon, (int) (photoWidth3 / AndroidUtilities.density), (int) (photoHeight4 / AndroidUtilities.density), true, 15, provider);
            }
            return !url.equals(this.currentUrl);
        }
        TLRPC.PhotoSize photoSize = this.currentPhotoObject;
        if (photoSize == null || (photoSize.location instanceof TLRPC.TL_fileLocationUnavailable)) {
            return object.type == 1 || object.type == 5 || object.type == 3 || object.type == 8 || object.isAnyKindOfSticker();
        } else if (this.currentMessageObject == null || !this.photoNotSet) {
            return false;
        } else {
            File cacheFile = FileLoader.getInstance(this.currentAccount).getPathToMessage(this.currentMessageObject.messageOwner);
            return cacheFile.exists();
        }
    }

    public int getRepliesCount() {
        MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
        if (groupedMessages != null && !groupedMessages.messages.isEmpty()) {
            MessageObject messageObject = this.currentMessagesGroup.messages.get(0);
            return messageObject.getRepliesCount();
        }
        MessageObject messageObject2 = this.currentMessageObject;
        return messageObject2.getRepliesCount();
    }

    private ArrayList<TLRPC.Peer> getRecentRepliers() {
        MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
        if (groupedMessages != null && !groupedMessages.messages.isEmpty()) {
            MessageObject messageObject = this.currentMessagesGroup.messages.get(0);
            if (messageObject.messageOwner.replies != null) {
                return messageObject.messageOwner.replies.recent_repliers;
            }
        }
        if (this.currentMessageObject.messageOwner.replies != null) {
            return this.currentMessageObject.messageOwner.replies.recent_repliers;
        }
        return null;
    }

    private void updateCaptionSpoilers() {
        this.captionSpoilersPool.addAll(this.captionSpoilers);
        this.captionSpoilers.clear();
        if (this.captionLayout != null && !getMessageObject().isSpoilersRevealed) {
            SpoilerEffect.addSpoilers(this, this.captionLayout, this.captionSpoilersPool, this.captionSpoilers);
        }
    }

    private boolean isUserDataChanged() {
        TLRPC.PhotoSize photoSize;
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject == null || this.hasLinkPreview || messageObject.messageOwner.media == null || !(this.currentMessageObject.messageOwner.media.webpage instanceof TLRPC.TL_webPage)) {
            MessageObject messageObject2 = this.currentMessageObject;
            if (messageObject2 == null || (this.currentUser == null && this.currentChat == null)) {
                return false;
            }
            if (this.lastSendState != messageObject2.messageOwner.send_state || this.lastDeleteDate != this.currentMessageObject.messageOwner.destroyTime || this.lastViewsCount != this.currentMessageObject.messageOwner.views || this.lastRepliesCount != getRepliesCount() || this.lastReactions != this.currentMessageObject.messageOwner.reactions) {
                return true;
            }
            updateCurrentUserAndChat();
            TLRPC.FileLocation newPhoto = null;
            if (this.isAvatarVisible) {
                TLRPC.User user = this.currentUser;
                if (user != null && user.photo != null) {
                    newPhoto = this.currentUser.photo.photo_small;
                } else {
                    TLRPC.Chat chat = this.currentChat;
                    if (chat != null && chat.photo != null) {
                        newPhoto = this.currentChat.photo.photo_small;
                    }
                }
            }
            if (this.replyTextLayout == null && this.currentMessageObject.replyMessageObject != null && (!this.isThreadChat || this.currentMessageObject.replyMessageObject.messageOwner.fwd_from == null || this.currentMessageObject.replyMessageObject.messageOwner.fwd_from.channel_post == 0)) {
                return true;
            }
            TLRPC.FileLocation fileLocation = this.currentPhoto;
            if ((fileLocation == null && newPhoto != null) || ((fileLocation != null && newPhoto == null) || (fileLocation != null && (fileLocation.local_id != newPhoto.local_id || this.currentPhoto.volume_id != newPhoto.volume_id)))) {
                return true;
            }
            TLRPC.PhotoSize newReplyPhoto = null;
            if (this.replyNameLayout != null && this.currentMessageObject.replyMessageObject != null && (photoSize = FileLoader.getClosestPhotoSizeWithSize(this.currentMessageObject.replyMessageObject.photoThumbs, 40)) != null && !this.currentMessageObject.replyMessageObject.isAnyKindOfSticker()) {
                newReplyPhoto = photoSize;
            }
            if (this.currentReplyPhoto == null && newReplyPhoto != null) {
                return true;
            }
            String newNameString = isNeedAuthorName() ? getAuthorName() : null;
            String str = this.currentNameString;
            if ((str == null && newNameString != null) || ((str != null && newNameString == null) || (str != null && !str.equals(newNameString)))) {
                return true;
            }
            if (!this.drawForwardedName || !this.currentMessageObject.needDrawForwarded()) {
                return false;
            }
            String newNameString2 = this.currentMessageObject.getForwardedName();
            String str2 = this.currentForwardNameString;
            if (str2 == null && newNameString2 != null) {
                return true;
            }
            if (str2 != null && newNameString2 == null) {
                return true;
            }
            return str2 != null && !str2.equals(newNameString2);
        }
        return true;
    }

    public ImageReceiver getPhotoImage() {
        return this.photoImage;
    }

    public int getNoSoundIconCenterX() {
        return this.noSoundCenterX;
    }

    public int getForwardNameCenterX() {
        TLRPC.User user = this.currentUser;
        if (user != null && user.id == 0) {
            return (int) this.avatarImage.getCenterX();
        }
        return (int) (this.forwardNameX + this.forwardNameCenterX);
    }

    public int getChecksX() {
        return this.layoutWidth - AndroidUtilities.dp(SharedConfig.bubbleRadius >= 10 ? 27.3f : 25.3f);
    }

    public int getChecksY() {
        if (this.currentMessageObject.shouldDrawWithoutBackground()) {
            return (int) (this.drawTimeY - getThemedDrawable(Theme.key_drawable_msgStickerCheck).getIntrinsicHeight());
        }
        return (int) (this.drawTimeY - Theme.chat_msgMediaCheckDrawable.getIntrinsicHeight());
    }

    public TLRPC.User getCurrentUser() {
        return this.currentUser;
    }

    @Override // android.view.ViewGroup, android.view.View
    protected void onDetachedFromWindow() {
        super.onDetachedFromWindow();
        NotificationCenter.getGlobalInstance().removeObserver(this, NotificationCenter.startSpoilers);
        NotificationCenter.getGlobalInstance().removeObserver(this, NotificationCenter.stopSpoilers);
        NotificationCenter.getInstance(this.currentAccount).removeObserver(this, NotificationCenter.userInfoDidLoad);
        cancelShakeAnimation();
        if (this.animationRunning) {
            return;
        }
        CheckBoxBase checkBoxBase = this.checkBox;
        if (checkBoxBase != null) {
            checkBoxBase.onDetachedFromWindow();
        }
        CheckBoxBase checkBoxBase2 = this.mediaCheckBox;
        if (checkBoxBase2 != null) {
            checkBoxBase2.onDetachedFromWindow();
        }
        if (this.pollCheckBox != null) {
            int a = 0;
            while (true) {
                CheckBoxBase[] checkBoxBaseArr = this.pollCheckBox;
                if (a >= checkBoxBaseArr.length) {
                    break;
                }
                checkBoxBaseArr[a].onDetachedFromWindow();
                a++;
            }
        }
        this.attachedToWindow = false;
        this.radialProgress.onDetachedFromWindow();
        this.videoRadialProgress.onDetachedFromWindow();
        this.avatarImage.onDetachedFromWindow();
        if (this.pollAvatarImages != null) {
            int a2 = 0;
            while (true) {
                ImageReceiver[] imageReceiverArr = this.pollAvatarImages;
                if (a2 >= imageReceiverArr.length) {
                    break;
                }
                imageReceiverArr[a2].onDetachedFromWindow();
                a2++;
            }
        }
        if (this.commentAvatarImages != null) {
            int a3 = 0;
            while (true) {
                ImageReceiver[] imageReceiverArr2 = this.commentAvatarImages;
                if (a3 >= imageReceiverArr2.length) {
                    break;
                }
                imageReceiverArr2[a3].onDetachedFromWindow();
                a3++;
            }
        }
        this.replyImageReceiver.onDetachedFromWindow();
        this.locationImageReceiver.onDetachedFromWindow();
        this.photoImage.onDetachedFromWindow();
        if (this.addedForTest && this.currentUrl != null && this.currentWebFile != null) {
            ImageLoader.getInstance().removeTestWebFile(this.currentUrl);
            this.addedForTest = false;
        }
        DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
        if (getDelegate() != null && getDelegate().getTextSelectionHelper() != null) {
            getDelegate().getTextSelectionHelper().onChatMessageCellDetached(this);
        }
        this.transitionParams.onDetach();
        if (MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
            Theme.getCurrentAudiVisualizerDrawable().setParentView(null);
        }
        ValueAnimator valueAnimator = this.statusDrawableAnimator;
        if (valueAnimator != null) {
            valueAnimator.removeAllListeners();
            this.statusDrawableAnimator.cancel();
        }
        this.reactionsLayoutInBubble.onDetachFromWindow();
        this.statusDrawableAnimationInProgress = false;
        Runnable runnable = this.unregisterFlagSecure;
        if (runnable != null) {
            runnable.run();
            this.unregisterFlagSecure = null;
        }
    }

    @Override // android.view.ViewGroup, android.view.View
    protected void onAttachedToWindow() {
        super.onAttachedToWindow();
        NotificationCenter.getGlobalInstance().addObserver(this, NotificationCenter.startSpoilers);
        NotificationCenter.getGlobalInstance().addObserver(this, NotificationCenter.stopSpoilers);
        NotificationCenter.getInstance(this.currentAccount).addObserver(this, NotificationCenter.userInfoDidLoad);
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null) {
            messageObject.animateComments = false;
        }
        MessageObject messageObject2 = this.messageObjectToSet;
        if (messageObject2 != null) {
            messageObject2.animateComments = false;
            setMessageContent(this.messageObjectToSet, this.groupedMessagesToSet, this.bottomNearToSet, this.topNearToSet);
            this.messageObjectToSet = null;
            this.groupedMessagesToSet = null;
        }
        CheckBoxBase checkBoxBase = this.checkBox;
        if (checkBoxBase != null) {
            checkBoxBase.onAttachedToWindow();
        }
        CheckBoxBase checkBoxBase2 = this.mediaCheckBox;
        if (checkBoxBase2 != null) {
            checkBoxBase2.onAttachedToWindow();
        }
        if (this.pollCheckBox != null) {
            int a = 0;
            while (true) {
                CheckBoxBase[] checkBoxBaseArr = this.pollCheckBox;
                if (a >= checkBoxBaseArr.length) {
                    break;
                }
                checkBoxBaseArr[a].onAttachedToWindow();
                a++;
            }
        }
        this.attachedToWindow = true;
        float f = 0.0f;
        this.animationOffsetX = 0.0f;
        this.slidingOffsetX = 0.0f;
        this.checkBoxTranslation = 0;
        updateTranslation();
        this.radialProgress.onAttachedToWindow();
        this.videoRadialProgress.onAttachedToWindow();
        this.avatarImage.setParentView((View) getParent());
        this.avatarImage.onAttachedToWindow();
        MessageObject messageObject3 = this.currentMessageObject;
        if (messageObject3 != null) {
            setAvatar(messageObject3);
        }
        if (this.pollAvatarImages != null) {
            int a2 = 0;
            while (true) {
                ImageReceiver[] imageReceiverArr = this.pollAvatarImages;
                if (a2 >= imageReceiverArr.length) {
                    break;
                }
                imageReceiverArr[a2].onAttachedToWindow();
                a2++;
            }
        }
        if (this.commentAvatarImages != null) {
            int a3 = 0;
            while (true) {
                ImageReceiver[] imageReceiverArr2 = this.commentAvatarImages;
                if (a3 >= imageReceiverArr2.length) {
                    break;
                }
                imageReceiverArr2[a3].onAttachedToWindow();
                a3++;
            }
        }
        this.replyImageReceiver.onAttachedToWindow();
        this.locationImageReceiver.onAttachedToWindow();
        if (this.photoImage.onAttachedToWindow()) {
            if (this.drawPhotoImage) {
                updateButtonState(false, false, false);
            }
        } else {
            updateButtonState(false, false, false);
        }
        MessageObject messageObject4 = this.currentMessageObject;
        if (messageObject4 != null && (this.isRoundVideo || messageObject4.isVideo())) {
            checkVideoPlayback(true, null);
        }
        int i = this.documentAttachType;
        if (i == 4 && this.autoPlayingMedia) {
            boolean isPlayingMessage = MediaController.getInstance().isPlayingMessage(this.currentMessageObject);
            this.animatingNoSoundPlaying = isPlayingMessage;
            this.animatingNoSoundProgress = isPlayingMessage ? 0.0f : 1.0f;
            this.animatingNoSound = 0;
        } else {
            this.animatingNoSoundPlaying = false;
            this.animatingNoSoundProgress = 0.0f;
            this.animatingDrawVideoImageButtonProgress = ((i == 4 || i == 2) && this.drawVideoSize) ? 1.0f : 0.0f;
        }
        if (getDelegate() != null && getDelegate().getTextSelectionHelper() != null) {
            getDelegate().getTextSelectionHelper().onChatMessageCellAttached(this);
        }
        if (this.documentAttachType == 5) {
            boolean showSeekbar = MediaController.getInstance().isPlayingMessage(this.currentMessageObject);
            if (showSeekbar) {
                f = 1.0f;
            }
            this.toSeekBarProgress = f;
        }
        this.reactionsLayoutInBubble.onAttachToWindow();
        updateFlagSecure();
    }

    /* JADX WARN: Code restructure failed: missing block: B:1442:0x1e39, code lost:
        if (r91.documentAttachType == 0) goto L1449;
     */
    /* JADX WARN: Code restructure failed: missing block: B:2471:0x3c3b, code lost:
        if (r6 < (r91.timeWidth + org.telegram.messenger.AndroidUtilities.dp((r92.isOutOwner() ? 20 : 0) + 20))) goto L2472;
     */
    /* JADX WARN: Code restructure failed: missing block: B:3109:0x4bcf, code lost:
        if (r2 >= (r91.captionWidth + org.telegram.messenger.AndroidUtilities.dp(10.0f))) goto L3114;
     */
    /* JADX WARN: Code restructure failed: missing block: B:3110:0x4bd1, code lost:
        r3 = r91.captionWidth + org.telegram.messenger.AndroidUtilities.dp(10.0f);
        r2 = org.telegram.messenger.AndroidUtilities.dp(8.0f) + r3;
        r91.backgroundWidth = r2;
     */
    /* JADX WARN: Code restructure failed: missing block: B:3111:0x4be1, code lost:
        if (r91.mediaBackground != false) goto L3113;
     */
    /* JADX WARN: Code restructure failed: missing block: B:3112:0x4be3, code lost:
        r91.backgroundWidth = r2 + org.telegram.messenger.AndroidUtilities.dp(9.0f);
     */
    /* JADX WARN: Code restructure failed: missing block: B:3113:0x4bec, code lost:
        r24 = r3;
     */
    /* JADX WARN: Code restructure failed: missing block: B:3595:0x5792, code lost:
        if (r15.type != 3) goto L3598;
     */
    /* JADX WARN: Code restructure failed: missing block: B:43:0x008e, code lost:
        if (r91.isPlayingRound != (org.telegram.messenger.MediaController.getInstance().isPlayingMessage(r91.currentMessageObject) && (r3 = r91.delegate) != null && !r3.keyboardIsOpened())) goto L45;
     */
    /* JADX WARN: Code restructure failed: missing block: B:806:0x1053, code lost:
        if (r7 != 13) goto L812;
     */
    /* JADX WARN: Code restructure failed: missing block: B:887:0x1234, code lost:
        if (r91.isSmallImage != false) goto L892;
     */
    /* JADX WARN: Multi-variable search skipped. Vars limit reached: 7718 (expected less than 5000) */
    /* JADX WARN: Multi-variable type inference failed */
    /* JADX WARN: Removed duplicated region for block: B:1004:0x14dc  */
    /* JADX WARN: Removed duplicated region for block: B:1057:0x15e3 A[Catch: Exception -> 0x1676, TRY_LEAVE, TryCatch #4 {Exception -> 0x1676, blocks: (B:1055:0x15db, B:1057:0x15e3, B:1069:0x1618), top: B:3903:0x15db }] */
    /* JADX WARN: Removed duplicated region for block: B:1099:0x1699  */
    /* JADX WARN: Removed duplicated region for block: B:1101:0x16a4  */
    /* JADX WARN: Removed duplicated region for block: B:1107:0x16b4  */
    /* JADX WARN: Removed duplicated region for block: B:1108:0x16b7  */
    /* JADX WARN: Removed duplicated region for block: B:1110:0x16bb  */
    /* JADX WARN: Removed duplicated region for block: B:1304:0x1c26  */
    /* JADX WARN: Removed duplicated region for block: B:1318:0x1c53  */
    /* JADX WARN: Removed duplicated region for block: B:1319:0x1c55  */
    /* JADX WARN: Removed duplicated region for block: B:1322:0x1c62  */
    /* JADX WARN: Removed duplicated region for block: B:1323:0x1c64  */
    /* JADX WARN: Removed duplicated region for block: B:1326:0x1c6d  */
    /* JADX WARN: Removed duplicated region for block: B:1327:0x1c78  */
    /* JADX WARN: Removed duplicated region for block: B:1330:0x1c84  */
    /* JADX WARN: Removed duplicated region for block: B:1343:0x1cab  */
    /* JADX WARN: Removed duplicated region for block: B:1454:0x1e68  */
    /* JADX WARN: Removed duplicated region for block: B:1455:0x1e78  */
    /* JADX WARN: Removed duplicated region for block: B:1458:0x1e82  */
    /* JADX WARN: Removed duplicated region for block: B:1459:0x1e8b  */
    /* JADX WARN: Removed duplicated region for block: B:1476:0x1ee8  */
    /* JADX WARN: Removed duplicated region for block: B:1481:0x1f18  */
    /* JADX WARN: Removed duplicated region for block: B:1484:0x1f31  */
    /* JADX WARN: Removed duplicated region for block: B:1490:0x1f9a  */
    /* JADX WARN: Removed duplicated region for block: B:1491:0x2000  */
    /* JADX WARN: Removed duplicated region for block: B:1620:0x2492  */
    /* JADX WARN: Removed duplicated region for block: B:1626:0x24cd  */
    /* JADX WARN: Removed duplicated region for block: B:1646:0x254b  */
    /* JADX WARN: Removed duplicated region for block: B:1664:0x2639  */
    /* JADX WARN: Removed duplicated region for block: B:1667:0x2641  */
    /* JADX WARN: Removed duplicated region for block: B:1674:0x268c  */
    /* JADX WARN: Removed duplicated region for block: B:2119:0x3274  */
    /* JADX WARN: Removed duplicated region for block: B:2136:0x32ef  */
    /* JADX WARN: Removed duplicated region for block: B:2137:0x32fb  */
    /* JADX WARN: Removed duplicated region for block: B:248:0x0351  */
    /* JADX WARN: Removed duplicated region for block: B:249:0x0358  */
    /* JADX WARN: Removed duplicated region for block: B:2712:0x42bd  */
    /* JADX WARN: Removed duplicated region for block: B:2715:0x42cb  */
    /* JADX WARN: Removed duplicated region for block: B:2719:0x42d7  */
    /* JADX WARN: Removed duplicated region for block: B:2747:0x4337  */
    /* JADX WARN: Removed duplicated region for block: B:2748:0x433d  */
    /* JADX WARN: Removed duplicated region for block: B:2773:0x438b  */
    /* JADX WARN: Removed duplicated region for block: B:2803:0x4422  */
    /* JADX WARN: Removed duplicated region for block: B:2810:0x4465  */
    /* JADX WARN: Removed duplicated region for block: B:2813:0x4472  */
    /* JADX WARN: Removed duplicated region for block: B:2816:0x449f  */
    /* JADX WARN: Removed duplicated region for block: B:2817:0x44a2  */
    /* JADX WARN: Removed duplicated region for block: B:2820:0x44aa  */
    /* JADX WARN: Removed duplicated region for block: B:2821:0x44ad  */
    /* JADX WARN: Removed duplicated region for block: B:2824:0x44b8  */
    /* JADX WARN: Removed duplicated region for block: B:2827:0x44bf  */
    /* JADX WARN: Removed duplicated region for block: B:2828:0x44d2  */
    /* JADX WARN: Removed duplicated region for block: B:2836:0x4505  */
    /* JADX WARN: Removed duplicated region for block: B:284:0x03b2  */
    /* JADX WARN: Removed duplicated region for block: B:285:0x03b9  */
    /* JADX WARN: Removed duplicated region for block: B:2991:0x48fa  */
    /* JADX WARN: Removed duplicated region for block: B:3062:0x4aa2  */
    /* JADX WARN: Removed duplicated region for block: B:3065:0x4aac  */
    /* JADX WARN: Removed duplicated region for block: B:3098:0x4ba5  */
    /* JADX WARN: Removed duplicated region for block: B:3105:0x4bbb  */
    /* JADX WARN: Removed duplicated region for block: B:3106:0x4bc5 A[ADDED_TO_REGION] */
    /* JADX WARN: Removed duplicated region for block: B:3116:0x4bf3 A[ADDED_TO_REGION] */
    /* JADX WARN: Removed duplicated region for block: B:3132:0x4ca2  */
    /* JADX WARN: Removed duplicated region for block: B:3142:0x4cc0  */
    /* JADX WARN: Removed duplicated region for block: B:3143:0x4ceb  */
    /* JADX WARN: Removed duplicated region for block: B:3146:0x4d06  */
    /* JADX WARN: Removed duplicated region for block: B:3155:0x4d1d A[ADDED_TO_REGION] */
    /* JADX WARN: Removed duplicated region for block: B:3161:0x4d2c A[ADDED_TO_REGION] */
    /* JADX WARN: Removed duplicated region for block: B:3167:0x4d3b  */
    /* JADX WARN: Removed duplicated region for block: B:3180:0x4d68  */
    /* JADX WARN: Removed duplicated region for block: B:3188:0x4d80  */
    /* JADX WARN: Removed duplicated region for block: B:3189:0x4d86 A[ADDED_TO_REGION] */
    /* JADX WARN: Removed duplicated region for block: B:3193:0x4d8d  */
    /* JADX WARN: Removed duplicated region for block: B:319:0x0460  */
    /* JADX WARN: Removed duplicated region for block: B:3204:0x4e63  */
    /* JADX WARN: Removed duplicated region for block: B:327:0x0494  */
    /* JADX WARN: Removed duplicated region for block: B:3367:0x52e8  */
    /* JADX WARN: Removed duplicated region for block: B:3378:0x530a  */
    /* JADX WARN: Removed duplicated region for block: B:3387:0x5334  */
    /* JADX WARN: Removed duplicated region for block: B:3394:0x5356  */
    /* JADX WARN: Removed duplicated region for block: B:3397:0x536e  */
    /* JADX WARN: Removed duplicated region for block: B:3408:0x53a5  */
    /* JADX WARN: Removed duplicated region for block: B:3411:0x53b4  */
    /* JADX WARN: Removed duplicated region for block: B:3412:0x53c4  */
    /* JADX WARN: Removed duplicated region for block: B:3415:0x53d7  */
    /* JADX WARN: Removed duplicated region for block: B:3421:0x53ee  */
    /* JADX WARN: Removed duplicated region for block: B:3436:0x5429  */
    /* JADX WARN: Removed duplicated region for block: B:3444:0x544f  */
    /* JADX WARN: Removed duplicated region for block: B:3451:0x546a  */
    /* JADX WARN: Removed duplicated region for block: B:351:0x056d  */
    /* JADX WARN: Removed duplicated region for block: B:3551:0x5667  */
    /* JADX WARN: Removed duplicated region for block: B:3562:0x5691  */
    /* JADX WARN: Removed duplicated region for block: B:3606:0x57c8  */
    /* JADX WARN: Removed duplicated region for block: B:3620:0x5805  */
    /* JADX WARN: Removed duplicated region for block: B:3623:0x5816  */
    /* JADX WARN: Removed duplicated region for block: B:369:0x05d0  */
    /* JADX WARN: Removed duplicated region for block: B:370:0x05e2  */
    /* JADX WARN: Removed duplicated region for block: B:3725:0x5b38  */
    /* JADX WARN: Removed duplicated region for block: B:372:0x05f1  */
    /* JADX WARN: Removed duplicated region for block: B:3732:0x5b55  */
    /* JADX WARN: Removed duplicated region for block: B:3736:0x5b67  */
    /* JADX WARN: Removed duplicated region for block: B:3737:0x5b75  */
    /* JADX WARN: Removed duplicated region for block: B:3749:0x5b99  */
    /* JADX WARN: Removed duplicated region for block: B:3754:0x5bb8  */
    /* JADX WARN: Removed duplicated region for block: B:3757:0x5bcf  */
    /* JADX WARN: Removed duplicated region for block: B:3760:0x5bdd  */
    /* JADX WARN: Removed duplicated region for block: B:3767:0x5c10  */
    /* JADX WARN: Removed duplicated region for block: B:3769:0x5c18  */
    /* JADX WARN: Removed duplicated region for block: B:3834:0x5cd7  */
    /* JADX WARN: Removed duplicated region for block: B:3842:0x5d03  */
    /* JADX WARN: Removed duplicated region for block: B:3855:0x5d4a  */
    /* JADX WARN: Removed duplicated region for block: B:3873:0x5d80  */
    /* JADX WARN: Removed duplicated region for block: B:3879:0x5d92  */
    /* JADX WARN: Removed duplicated region for block: B:3888:0x5dc7  */
    /* JADX WARN: Removed duplicated region for block: B:3923:0x558e A[EXC_TOP_SPLITTER, SYNTHETIC] */
    /* JADX WARN: Removed duplicated region for block: B:3941:0x4977 A[EXC_TOP_SPLITTER, SYNTHETIC] */
    /* JADX WARN: Removed duplicated region for block: B:3971:0x1590 A[EXC_TOP_SPLITTER, SYNTHETIC] */
    /* JADX WARN: Removed duplicated region for block: B:3979:0x04aa A[EDGE_INSN: B:3979:0x04aa->B:331:0x04aa ?: BREAK  , SYNTHETIC] */
    /* JADX WARN: Removed duplicated region for block: B:481:0x0894  */
    /* JADX WARN: Removed duplicated region for block: B:70:0x00d7  */
    /* JADX WARN: Removed duplicated region for block: B:71:0x00d9  */
    /* JADX WARN: Removed duplicated region for block: B:973:0x13f7  */
    /* JADX WARN: Removed duplicated region for block: B:980:0x1415 A[ADDED_TO_REGION] */
    /* JADX WARN: Type inference failed for: r14v1, types: [boolean, int] */
    /* JADX WARN: Type inference failed for: r14v248 */
    /* JADX WARN: Type inference failed for: r14v249 */
    /* JADX WARN: Type inference failed for: r14v6 */
    /* JADX WARN: Type inference failed for: r14v7 */
    /* JADX WARN: Type inference failed for: r2v1133 */
    /* JADX WARN: Type inference failed for: r2v1137 */
    /* JADX WARN: Type inference failed for: r2v1138 */
    /* JADX WARN: Type inference failed for: r2v75, types: [boolean, int] */
    /* JADX WARN: Type inference failed for: r2v851, types: [org.telegram.messenger.ImageReceiver] */
    /* JADX WARN: Type inference failed for: r2v853, types: [org.telegram.messenger.ImageReceiver] */
    /* JADX WARN: Type inference failed for: r4v92, types: [android.text.StaticLayout$Builder] */
    /* JADX WARN: Type inference failed for: r9v141, types: [java.util.List, java.util.ArrayList] */
    /* JADX WARN: Type inference failed for: r9v202, types: [boolean] */
    /* JADX WARN: Type inference failed for: r9v205, types: [boolean] */
    /* JADX WARN: Type inference failed for: r9v244, types: [float] */
    /* JADX WARN: Type inference failed for: r9v296 */
    /* JADX WARN: Type inference failed for: r9v298, types: [android.graphics.drawable.BitmapDrawable, android.graphics.drawable.Drawable] */
    /* JADX WARN: Type inference failed for: r9v299, types: [android.graphics.drawable.BitmapDrawable, android.graphics.drawable.Drawable] */
    /* JADX WARN: Type inference failed for: r9v310 */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    private void setMessageContent(MessageObject messageObject, MessageObject.GroupedMessages groupedMessages, boolean bottomNear, boolean topNear) {
        boolean z;
        boolean messageChanged;
        boolean groupChanged;
        boolean pollChanged;
        boolean groupChanged2;
        TranscribeButton transcribeButton;
        ChatMessageCellDelegate chatMessageCellDelegate;
        MessageObject.GroupedMessages groupedMessages2;
        MessageObject.GroupedMessages groupedMessages3;
        boolean z2;
        boolean drawAvatar;
        ?? r2;
        boolean z3;
        boolean autoDownload;
        MessageObject.GroupedMessages groupedMessages4;
        boolean linked;
        boolean linked2;
        ?? r14;
        float f;
        int additionHeight;
        int i;
        char c;
        boolean z4;
        MessageObject.GroupedMessagePosition groupedMessagePosition;
        boolean z5;
        MessageObject messageObject2;
        MessageObject.GroupedMessagePosition groupedMessagePosition2;
        HashMap<String, BotButton> oldByPosition;
        HashMap<String, BotButton> oldByPosition2;
        boolean fullWidth;
        HashMap<String, BotButton> oldByData;
        HashMap<String, BotButton> oldByData2;
        CharSequence buttonText;
        boolean z6;
        String str;
        TLRPC.User user;
        int i2;
        int i3;
        String str2;
        MessageObject.GroupedMessagePosition groupedMessagePosition3;
        String str3;
        Exception e;
        Exception e2;
        String str4;
        int i4;
        int photoHeight;
        int photoHeight2;
        int photoWidth;
        MessageObject.GroupedMessagePosition groupedMessagePosition4;
        int i5;
        int y;
        MessageObject.GroupedMessagePosition groupedMessagePosition5;
        boolean useFullWidth;
        boolean needQualityPreview;
        int imageW;
        int w;
        TLRPC.PhotoSize photoSize;
        TLRPC.PhotoSize photoSize2;
        int timeWidthTotal;
        boolean fixPhotoWidth;
        int photoHeight3;
        int timeWidthTotal2;
        MessageObject messageObject3;
        int w2;
        int h;
        int widthForCaption;
        int photoHeight4;
        int additionHeight2;
        Exception e3;
        int widthForCaption2;
        Exception e4;
        int minWidth;
        boolean noSize;
        TLRPC.PhotoSize photoSize3;
        TLRPC.PhotoSize photoSize4;
        int i6;
        boolean z7;
        int i7;
        boolean z8;
        TLRPC.VideoSize videoSize;
        TLRPC.Document document;
        boolean z9;
        TLRPC.Document document2;
        MessageObject.GroupedMessagePosition groupedMessagePosition6;
        boolean z10;
        int i8;
        int heightLocal;
        boolean fixPhotoWidth2;
        int widthForCaption3;
        int h2;
        int h3;
        int photoWidth2;
        boolean checkCaption;
        float maxHeight;
        int count;
        int i9;
        int h4;
        int photoHeight5;
        int photoWidth3;
        int widthForCaption4;
        double d;
        int h5;
        int photoHeight6;
        double d2;
        int a;
        TLRPC.PhotoSize photoSize5;
        TLRPC.PhotoSize photoSize6;
        int maxWidth;
        float maxHeight2;
        int photoHeight7;
        int photoWidth4;
        String filter;
        Object parentObject;
        int photoHeight8;
        int photoWidth5;
        int additionHeight3;
        MessageObject messageObject4;
        int i10;
        int additionHeight4;
        StaticLayout staticLayout;
        MessageObject.GroupedMessages groupedMessages5;
        StaticLayout staticLayout2;
        MessageObject.GroupedMessagePosition groupedMessagePosition7;
        float f2;
        byte[] votingFor;
        int width;
        float f3;
        int a2;
        int maxWidth2;
        MessageObject.GroupedMessages groupedMessages6;
        MessageObject.GroupedMessagePosition groupedMessagePosition8;
        int maxWidth3;
        boolean hasName;
        CharSequence phone;
        int i11;
        MessageObject.GroupedMessagePosition groupedMessagePosition9;
        int maxWidth4;
        TLRPC.Document androidThemeDocument;
        TLRPC.Message newReply;
        boolean slideshow;
        TLRPC.ThemeSettings androidThemeSettings;
        boolean z11;
        String str5;
        String title;
        String description;
        int duration;
        String title2;
        TLRPC.Photo photo;
        TLRPC.Document document3;
        String type;
        CharSequence author;
        WebFile webDocument;
        boolean isSmallImageType;
        int linkPreviewMaxWidth;
        String type2;
        int linkPreviewMaxWidth2;
        TLRPC.Document document4;
        TLRPC.Photo photo2;
        int maxWidth5;
        int timeMore;
        boolean smallImage;
        Exception e5;
        int maxWidth6;
        int restLines;
        StaticLayout staticLayout3;
        int layoutWidth;
        int height;
        int lineWidth;
        boolean smallImage2;
        boolean titleIsRTL;
        int linkPreviewMaxWidth3;
        boolean authorIsRTL;
        int restLinesCount;
        int restLinesCount2;
        int linkPreviewMaxWidth4;
        int maxWebWidth;
        MessageObject messageObject5;
        int maxPhotoWidth;
        TLRPC.Photo photo3;
        int timeMore2;
        TLRPC.Document document5;
        String type3;
        int maxWidth7;
        WebFile webDocument2;
        int i12;
        boolean z12;
        String str6;
        int timeMore3;
        int maxWidth8;
        boolean z13;
        String str7;
        int maxWidth9;
        String str8;
        int maxPhotoWidth2;
        int width2;
        int height2;
        int additinalWidth;
        String type4;
        String type5;
        String str9;
        String type6;
        TLRPC.User botUser;
        TLRPC.Document document6;
        String str10;
        boolean z14;
        boolean canChangeRadius;
        boolean canChangeRadius2;
        TLRPC.Document document7;
        String str11;
        TLRPC.Document document8;
        boolean z15;
        int height3;
        int width3;
        int height4;
        int width4;
        float scale;
        int i13;
        int maxWidth10;
        boolean isPhoto;
        TLRPC.PhotoSize photoSize7;
        float f4;
        Exception e6;
        Exception e7;
        int restLines2;
        boolean allowAllLines;
        int a3;
        int maxChildWidth;
        int a4;
        int width5;
        int maxChildWidth2;
        int width6;
        Exception e8;
        int restLinesCount3;
        int height5;
        int width7;
        String site_name;
        int duration2;
        boolean smallImage3;
        String siteName;
        ArrayList<TLRPC.PageBlock> blocks;
        MessageObject.GroupedMessagePosition groupedMessagePosition10;
        String comment;
        boolean z16;
        int length;
        ArrayList<TLRPC.Peer> recentRepliers;
        String comment2;
        TLRPC.User user2;
        MessageObject.GroupedMessagePosition groupedMessagePosition11;
        int a5;
        Drawable[] drawableArr;
        MessageObject.GroupedMessagePosition groupedMessagePosition12;
        MessageObject.GroupedMessagePosition groupedMessagePosition13;
        ChatMessageCellDelegate chatMessageCellDelegate2;
        MessageObject.GroupedMessagePosition groupedMessagePosition14;
        MessageObject.GroupedMessagePosition groupedMessagePosition15;
        boolean z17;
        String str12;
        int i14;
        MessageObject.GroupedMessagePosition groupedMessagePosition16;
        MessageObject messageObject6 = messageObject;
        if (messageObject.checkLayout() || (this.currentPosition != null && this.lastHeight != AndroidUtilities.displaySize.y)) {
            this.currentMessageObject = null;
        }
        boolean widthChanged = this.lastWidth != getParentWidth();
        this.lastHeight = AndroidUtilities.displaySize.y;
        this.lastWidth = getParentWidth();
        this.isRoundVideo = messageObject6 != null && messageObject.isRoundVideo();
        TLRPC.Message newReply2 = messageObject.hasValidReplyMessageObject() ? messageObject6.replyMessageObject.messageOwner : null;
        MessageObject messageObject7 = this.currentMessageObject;
        boolean messageIdChanged = messageObject7 == null || messageObject7.getId() != messageObject.getId();
        if (this.currentMessageObject == messageObject6 && !messageObject6.forceUpdate) {
            if (this.isRoundVideo) {
            }
            z = false;
            messageChanged = z;
            MessageObject messageObject8 = this.currentMessageObject;
            boolean dataChanged = (messageObject8 == null && messageObject8.getId() == messageObject.getId() && this.lastSendState == 3 && messageObject.isSent()) || !((this.currentMessageObject != messageObject6 || (!isUserDataChanged() && !this.photoNotSet)) && this.lastPostAuthor == messageObject6.messageOwner.post_author && this.wasPinned == this.isPinned && newReply2 == this.lastReplyMessage);
            groupChanged = groupedMessages == this.currentMessagesGroup;
            boolean pollChanged2 = false;
            this.accessibilityText = null;
            boolean dataChanged2 = (!this.drawCommentButton || this.useTranscribeButton || (this.drawSideButton == 3 && (((!this.hasDiscussion || !messageObject6.isLinkedToChat(this.linkedChatId)) && !this.isRepliesChat) || ((groupedMessagePosition16 = this.currentPosition) != null && ((groupedMessagePosition16.siblingHeights != null || (this.currentPosition.flags & 8) == 0) && (this.currentPosition.siblingHeights == null || (this.currentPosition.flags & 4) != 0)))))) ? true : dataChanged;
            if (!messageChanged && messageObject.isDice()) {
                setCurrentDiceValue(this.isUpdating);
            }
            if (!messageChanged || !messageObject.isPoll()) {
                pollChanged = false;
            } else {
                ArrayList<TLRPC.TL_pollAnswerVoters> newResults = null;
                TLRPC.Poll newPoll = null;
                int newVoters = 0;
                if (messageObject6.messageOwner.media instanceof TLRPC.TL_messageMediaPoll) {
                    TLRPC.TL_messageMediaPoll mediaPoll = (TLRPC.TL_messageMediaPoll) messageObject6.messageOwner.media;
                    newResults = mediaPoll.results.results;
                    newPoll = mediaPoll.poll;
                    newVoters = mediaPoll.results.total_voters;
                }
                if (newResults != null && this.lastPollResults != null && newVoters != this.lastPollResultsVoters) {
                    pollChanged2 = true;
                }
                if (!pollChanged2 && newResults != this.lastPollResults) {
                    pollChanged2 = true;
                }
                TLRPC.Poll poll = this.lastPoll;
                if (poll == newPoll || poll.closed == newPoll.closed) {
                    z17 = false;
                } else {
                    pollChanged2 = true;
                    if (!this.pollVoted) {
                        this.pollVoteInProgress = true;
                        z17 = false;
                        this.vibrateOnPollVote = false;
                    } else {
                        z17 = false;
                    }
                }
                this.animatePollAvatars = z17;
                if (pollChanged2 && this.attachedToWindow) {
                    this.pollAnimationProgressTime = 0.0f;
                    if (this.pollVoted && !messageObject.isVoted()) {
                        this.pollUnvoteInProgress = true;
                    }
                    int i15 = this.lastPollResultsVoters;
                    this.animatePollAvatars = i15 == 0 || (i15 != 0 && newVoters == 0);
                }
                if (messageIdChanged || newPoll == null || !this.lastPoll.quiz || !newPoll.quiz || this.currentMessageObject == null || this.pollVoted || messageObject6 == null || !messageObject.isVoted()) {
                    pollChanged = pollChanged2;
                } else {
                    TLRPC.TL_messageMediaPoll mediaPoll2 = (TLRPC.TL_messageMediaPoll) messageObject6.messageOwner.media;
                    if (mediaPoll2.results == null || mediaPoll2.results.results.isEmpty()) {
                        pollChanged = pollChanged2;
                    } else {
                        TLRPC.TL_pollAnswerVoters chosenAnswer = null;
                        int count2 = mediaPoll2.results.results.size();
                        int a6 = 0;
                        while (true) {
                            if (a6 >= count2) {
                                pollChanged = pollChanged2;
                                break;
                            }
                            ArrayList<TLRPC.TL_pollAnswerVoters> newResults2 = newResults;
                            TLRPC.TL_pollAnswerVoters answer = mediaPoll2.results.results.get(a6);
                            pollChanged = pollChanged2;
                            if (answer.chosen) {
                                chosenAnswer = answer;
                                break;
                            }
                            a6++;
                            newResults = newResults2;
                            pollChanged2 = pollChanged;
                        }
                        if (chosenAnswer != null) {
                            int i16 = a6 + 500;
                            if (chosenAnswer.correct) {
                                i14 = R.string.AccDescrQuizCorrectAnswer;
                                str12 = "AccDescrQuizCorrectAnswer";
                            } else {
                                i14 = R.string.AccDescrQuizIncorrectAnswer;
                                str12 = "AccDescrQuizIncorrectAnswer";
                            }
                            sendAccessibilityEventForVirtualView(i16, 4, LocaleController.getString(str12, i14));
                        }
                    }
                }
            }
            if (!groupChanged || groupedMessages == null) {
                groupChanged2 = groupChanged;
            } else {
                MessageObject.GroupedMessagePosition newPosition = groupedMessages.messages.size() > 1 ? this.currentMessagesGroup.positions.get(this.currentMessageObject) : null;
                groupChanged2 = newPosition != this.currentPosition;
            }
            int i17 = 1065353216;
            r9 = 1065353216;
            int i18 = 1065353216;
            i17 = 1065353216;
            if (!messageChanged || dataChanged2 || groupChanged2 || pollChanged || ((widthChanged && messageObject.isPoll()) || isPhotoDataChanged(messageObject) || this.pinnedBottom != bottomNear || this.pinnedTop != topNear)) {
                this.wasPinned = this.isPinned;
                this.pinnedBottom = bottomNear;
                this.pinnedTop = topNear;
                this.currentMessageObject = messageObject6;
                this.currentMessagesGroup = groupedMessages;
                this.lastTime = -2;
                this.lastPostAuthor = messageObject6.messageOwner.post_author;
                this.isHighlightedAnimated = false;
                this.widthBeforeNewTimeLine = -1;
                groupedMessages2 = this.currentMessagesGroup;
                if (groupedMessages2 != null || groupedMessages2.posArray.size() <= 1) {
                    this.currentMessagesGroup = null;
                    this.currentPosition = null;
                } else {
                    MessageObject.GroupedMessagePosition groupedMessagePosition17 = this.currentMessagesGroup.positions.get(this.currentMessageObject);
                    this.currentPosition = groupedMessagePosition17;
                    if (groupedMessagePosition17 == null) {
                        this.currentMessagesGroup = null;
                    }
                }
                groupedMessages3 = this.currentMessagesGroup;
                if (groupedMessages3 != null || groupedMessages3.isDocuments) {
                    this.drawPinnedTop = this.pinnedTop;
                    this.drawPinnedBottom = this.pinnedBottom;
                } else {
                    this.drawPinnedTop = this.pinnedTop && ((groupedMessagePosition15 = this.currentPosition) == null || (groupedMessagePosition15.flags & 4) != 0);
                    this.drawPinnedBottom = this.pinnedBottom && ((groupedMessagePosition14 = this.currentPosition) == null || (groupedMessagePosition14.flags & 8) != 0);
                }
                this.isPlayingRound = !this.isRoundVideo && MediaController.getInstance().isPlayingMessage(this.currentMessageObject) && (chatMessageCellDelegate2 = this.delegate) != null && !chatMessageCellDelegate2.keyboardIsOpened() && !this.delegate.isLandscape();
                this.photoImage.setCrossfadeWithOldImage(false);
                this.photoImage.setCrossfadeDuration(150);
                this.photoImage.setGradientBitmap(null);
                this.lastSendState = messageObject6.messageOwner.send_state;
                this.lastDeleteDate = messageObject6.messageOwner.destroyTime;
                this.lastViewsCount = messageObject6.messageOwner.views;
                this.lastRepliesCount = getRepliesCount();
                if (!messageIdChanged) {
                    z2 = false;
                    this.isPressed = false;
                    this.isCheckPressed = true;
                } else {
                    z2 = false;
                }
                this.gamePreviewPressed = z2;
                this.sideButtonPressed = z2;
                this.hasNewLineForTime = z2;
                this.flipImage = z2;
                boolean z18 = (this.isThreadChat || messageObject6.messageOwner.fwd_from == null || messageObject6.messageOwner.fwd_from.channel_post == 0) ? false : true;
                this.isThreadPost = z18;
                this.isAvatarVisible = z18 && this.isChat && !messageObject.isOutOwner() && messageObject.needDrawAvatar() && ((groupedMessagePosition13 = this.currentPosition) == null || groupedMessagePosition13.edge);
                boolean drawAvatar2 = !this.isChat && !this.isThreadPost && !messageObject.isOutOwner() && messageObject.needDrawAvatar();
                if (messageObject6.customAvatarDrawable == null) {
                    this.isAvatarVisible = true;
                    drawAvatar = true;
                } else {
                    drawAvatar = drawAvatar2;
                }
                this.wasLayout = false;
                this.groupPhotoInvisible = false;
                this.animatingDrawVideoImageButton = 0;
                this.drawVideoSize = false;
                this.canStreamVideo = false;
                this.animatingNoSound = 0;
                if (!MessagesController.getInstance(this.currentAccount).isChatNoForwards(messageObject.getChatId()) || (messageObject6.messageOwner != null && messageObject6.messageOwner.noforwards)) {
                    r2 = 0;
                    this.drawSideButton = 0;
                } else {
                    int i19 = (this.isRepliesChat || !checkNeedDrawShareButton(messageObject) || ((groupedMessagePosition12 = this.currentPosition) != null && !groupedMessagePosition12.last)) ? 0 : 1;
                    this.drawSideButton = i19;
                    if (this.isPinnedChat || (i19 == 1 && messageObject6.messageOwner.fwd_from != null && !messageObject.isOutOwner() && messageObject6.messageOwner.fwd_from.saved_from_peer != null && messageObject.getDialogId() == UserConfig.getInstance(this.currentAccount).getClientUserId())) {
                        this.drawSideButton = 2;
                        r2 = 0;
                    } else {
                        r2 = 0;
                    }
                }
                this.replyNameLayout = null;
                this.adminLayout = null;
                this.checkOnlyButtonPressed = r2;
                this.replyTextLayout = null;
                this.lastReplyMessage = null;
                this.hasEmbed = r2;
                this.autoPlayingMedia = r2;
                int i20 = r2 == true ? 1 : 0;
                int i21 = r2 == true ? 1 : 0;
                int i22 = r2 == true ? 1 : 0;
                this.replyNameWidth = i20;
                this.replyTextWidth = r2;
                this.viaWidth = r2;
                this.viaNameWidth = r2;
                this.addedCaptionHeight = r2;
                this.currentReplyPhoto = null;
                this.currentUser = null;
                this.currentChat = null;
                this.currentViaBotUser = null;
                this.instantViewLayout = null;
                this.drawNameLayout = false;
                this.lastLoadingSizeTotal = 0L;
                if (this.scheduledInvalidate) {
                    AndroidUtilities.cancelRunOnUIThread(this.invalidateRunnable);
                    this.scheduledInvalidate = false;
                }
                this.links.clear();
                this.pressedLink = null;
                this.pressedLinkType = -1;
                messageObject6.forceUpdate = false;
                this.drawPhotoImage = false;
                this.drawMediaCheckBox = false;
                this.hasLinkPreview = false;
                this.hasOldCaptionPreview = false;
                this.hasGamePreview = false;
                this.hasInvoicePreview = false;
                this.commentButtonPressed = false;
                this.instantButtonPressed = false;
                this.instantPressed = false;
                if (!pollChanged && Build.VERSION.SDK_INT >= 21) {
                    a5 = 0;
                    while (true) {
                        drawableArr = this.selectorDrawable;
                        if (a5 < drawableArr.length) {
                            break;
                        }
                        if (drawableArr[a5] != null) {
                            drawableArr[a5].setVisible(false, false);
                            this.selectorDrawable[a5].setState(StateSet.NOTHING);
                        }
                        a5++;
                    }
                }
                this.spoilerPressed = null;
                this.isCaptionSpoilerPressed = false;
                this.isSpoilerRevealing = false;
                this.linkPreviewPressed = false;
                this.buttonPressed = 0;
                this.additionalTimeOffsetY = 0;
                this.miniButtonPressed = 0;
                this.pressedBotButton = -1;
                this.pressedVoteButton = -1;
                this.pollHintPressed = false;
                this.psaHintPressed = false;
                this.linkPreviewHeight = 0;
                this.mediaOffsetY = 0;
                this.documentAttachType = 0;
                this.documentAttach = null;
                this.descriptionLayout = null;
                this.titleLayout = null;
                this.videoInfoLayout = null;
                this.photosCountLayout = null;
                this.siteNameLayout = null;
                this.authorLayout = null;
                this.captionLayout = null;
                this.captionWidth = 0;
                this.captionHeight = 0;
                this.captionOffsetX = 0;
                this.currentCaption = null;
                this.docTitleLayout = null;
                this.drawImageButton = false;
                this.drawVideoImageButton = false;
                this.currentPhotoObject = null;
                this.photoParentObject = null;
                this.currentPhotoObjectThumb = null;
                this.currentPhotoObjectThumbStripped = null;
                if (!messageChanged || messageIdChanged || dataChanged2) {
                    this.currentPhotoFilter = null;
                }
                this.buttonState = -1;
                this.miniButtonState = -1;
                this.hasMiniProgress = 0;
                if (this.addedForTest && this.currentUrl != null && this.currentWebFile != null) {
                    ImageLoader.getInstance().removeTestWebFile(this.currentUrl);
                }
                this.addedForTest = false;
                this.photoNotSet = false;
                this.drawBackground = true;
                this.drawName = false;
                this.useSeekBarWaveform = false;
                this.useTranscribeButton = false;
                this.drawInstantView = false;
                this.drawInstantViewType = 0;
                this.drawForwardedName = false;
                this.drawCommentButton = false;
                this.photoImage.setSideClip(0.0f);
                this.photoImage.setAspectFit(false);
                this.gradientShader = null;
                this.motionBackgroundDrawable = null;
                this.imageBackgroundColor = 0;
                this.imageBackgroundGradientColor1 = 0;
                this.imageBackgroundGradientColor2 = 0;
                this.imageBackgroundIntensity = 0.0f;
                this.imageBackgroundGradientColor3 = 0;
                this.imageBackgroundGradientRotation = 45;
                this.imageBackgroundSideColor = 0;
                this.mediaBackground = false;
                this.isMedia = false;
                this.photoImage.animatedFileDrawableRepeatMaxCount = 0;
                z3 = messageObject6.messageOwner.fwd_from == null && !TextUtils.isEmpty(messageObject6.messageOwner.fwd_from.psa_type);
                this.hasPsaHint = z3;
                if (z3) {
                    createSelectorDrawable(0);
                }
                this.photoImage.setAlpha(1.0f);
                if ((!messageChanged || dataChanged2) && !this.pollUnvoteInProgress) {
                    this.pollButtons.clear();
                }
                boolean z19 = false;
                this.availableTimeWidth = 0;
                this.photoImage.setForceLoading(false);
                this.photoImage.setNeedsQualityThumb(false);
                this.photoImage.setShouldGenerateQualityThumb(false);
                this.photoImage.setAllowDecodeSingleFrame(false);
                this.photoImage.setColorFilter(null);
                this.photoImage.setMediaStartEndTime(-1L, -1L);
                autoDownload = true;
                if (!messageIdChanged || messageObject6.reactionsChanged) {
                    messageObject6.reactionsChanged = false;
                    groupedMessagePosition11 = this.currentPosition;
                    if (groupedMessagePosition11 == null && (groupedMessagePosition11.flags & 8) == 0) {
                        this.reactionsLayoutInBubble.setMessage(null, false, this.resourcesProvider);
                    } else if (this.currentPosition == null) {
                        this.reactionsLayoutInBubble.setMessage(groupedMessages.findPrimaryMessageObject(), !messageObject.shouldDrawReactionsInLayout(), this.resourcesProvider);
                    } else {
                        this.reactionsLayoutInBubble.setMessage(messageObject6, !messageObject.shouldDrawReactionsInLayout(), this.resourcesProvider);
                    }
                }
                if (messageChanged) {
                    this.firstVisibleBlockNum = 0;
                    this.lastVisibleBlockNum = 0;
                    MessageObject messageObject9 = this.currentMessageObject;
                    if (messageObject9 != null && messageObject9.textLayoutBlocks != null && this.currentMessageObject.textLayoutBlocks.size() > 1) {
                        this.needNewVisiblePart = true;
                    }
                }
                boolean linked3 = false;
                groupedMessages4 = this.currentMessagesGroup;
                if (groupedMessages4 != null || groupedMessages4.messages.size() <= 0) {
                    boolean linked4 = messageObject6.isLinkedToChat(this.linkedChatId);
                    linked = linked4;
                } else {
                    MessageObject object = this.currentMessagesGroup.messages.get(0);
                    if (object.isLinkedToChat(this.linkedChatId)) {
                        linked3 = true;
                    }
                    linked = linked3;
                }
                linked2 = this.hasDiscussion;
                if (((linked2 || !linked) && (!this.isRepliesChat || messageObject.isOutOwner())) || ((groupedMessagePosition10 = this.currentPosition) != null && (groupedMessagePosition10.flags & 8) == 0)) {
                    this.commentLayout = null;
                    this.drawCommentNumber = false;
                } else {
                    int commentCount = getRepliesCount();
                    if (messageObject.shouldDrawWithoutBackground() || messageObject.isAnimatedEmoji()) {
                        if (this.isRepliesChat || commentCount <= 0) {
                            this.commentLayout = null;
                        } else {
                            String comment3 = LocaleController.formatShortNumber(commentCount, null);
                            int ceil = (int) Math.ceil(Theme.chat_stickerCommentCountPaint.measureText(comment3));
                            this.totalCommentWidth = ceil;
                            this.commentWidth = ceil;
                            this.commentLayout = new StaticLayout(comment3, Theme.chat_stickerCommentCountPaint, this.commentWidth + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                        }
                        this.drawCommentNumber = false;
                        this.drawSideButton = this.isRepliesChat ? 2 : 3;
                    } else {
                        this.drawCommentButton = true;
                        int avatarsOffset = 0;
                        if (this.commentProgress == null) {
                            this.commentProgress = new InfiniteProgress(AndroidUtilities.dp(7.0f));
                        }
                        if (this.isRepliesChat) {
                            comment = LocaleController.getString("ViewInChat", R.string.ViewInChat);
                        } else {
                            comment = LocaleController.isRTL ? commentCount == 0 ? LocaleController.getString("LeaveAComment", R.string.LeaveAComment) : LocaleController.formatPluralString("CommentsCount", commentCount, new Object[0]) : commentCount == 0 ? LocaleController.getString("LeaveAComment", R.string.LeaveAComment) : LocaleController.getPluralString("CommentsNoNumber", commentCount);
                            ArrayList<TLRPC.Peer> recentRepliers2 = getRecentRepliers();
                            if (commentCount == 0 || recentRepliers2 == null || recentRepliers2.isEmpty()) {
                                String comment4 = comment;
                                if (this.commentAvatarImages != null) {
                                    int a7 = 0;
                                    while (true) {
                                        ImageReceiver[] imageReceiverArr = this.commentAvatarImages;
                                        if (a7 >= imageReceiverArr.length) {
                                            break;
                                        }
                                        imageReceiverArr[a7].setImageBitmap((Drawable) null);
                                        this.commentAvatarImagesVisible[a7] = false;
                                        a7++;
                                    }
                                }
                                comment = comment4;
                            } else {
                                createCommentUI();
                                int size = recentRepliers2.size();
                                int a8 = 0;
                                while (true) {
                                    ImageReceiver[] imageReceiverArr2 = this.commentAvatarImages;
                                    length = imageReceiverArr2.length;
                                    if (a8 >= length) {
                                        break;
                                    }
                                    if (a8 < size) {
                                        comment2 = comment;
                                        imageReceiverArr2[a8].setImageCoords(0.0f, 0.0f, AndroidUtilities.dp(24.0f), AndroidUtilities.dp(24.0f));
                                        long id = MessageObject.getPeerId(recentRepliers2.get(a8));
                                        TLRPC.Chat chat = null;
                                        if (DialogObject.isUserDialog(id)) {
                                            recentRepliers = recentRepliers2;
                                            user2 = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(id));
                                        } else {
                                            recentRepliers = recentRepliers2;
                                            if (DialogObject.isChatDialog(id)) {
                                                chat = MessagesController.getInstance(this.currentAccount).getChat(Long.valueOf(-id));
                                                user2 = null;
                                            } else {
                                                user2 = null;
                                            }
                                        }
                                        if (user2 != null) {
                                            this.commentAvatarDrawables[a8].setInfo(user2);
                                            this.commentAvatarImages[a8].setForUserOrChat(user2, this.commentAvatarDrawables[a8]);
                                        } else if (chat != null) {
                                            this.commentAvatarDrawables[a8].setInfo(chat);
                                            this.commentAvatarImages[a8].setForUserOrChat(chat, this.commentAvatarDrawables[a8]);
                                        } else {
                                            this.commentAvatarDrawables[a8].setInfo(id, "", "");
                                        }
                                        this.commentAvatarImagesVisible[a8] = true;
                                        avatarsOffset += a8 == 0 ? 2 : 17;
                                    } else {
                                        comment2 = comment;
                                        recentRepliers = recentRepliers2;
                                        if (size != 0) {
                                            imageReceiverArr2[a8].setImageBitmap((Drawable) null);
                                            this.commentAvatarImagesVisible[a8] = false;
                                        }
                                    }
                                    a8++;
                                    comment = comment2;
                                    recentRepliers2 = recentRepliers;
                                }
                                i18 = length;
                            }
                        }
                        int ceil2 = (int) Math.ceil(Theme.chat_replyNamePaint.measureText(comment));
                        this.totalCommentWidth = ceil2;
                        this.commentWidth = ceil2;
                        this.commentLayout = new StaticLayout(comment, Theme.chat_replyNamePaint, this.commentWidth + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                        if (commentCount == 0 || LocaleController.isRTL) {
                            this.drawCommentNumber = false;
                            AnimatedNumberLayout animatedNumberLayout = this.commentNumberLayout;
                            if (animatedNumberLayout != null) {
                                animatedNumberLayout.setNumber(1, false);
                            }
                        } else {
                            this.drawCommentNumber = true;
                            AnimatedNumberLayout animatedNumberLayout2 = this.commentNumberLayout;
                            if (animatedNumberLayout2 == null) {
                                AnimatedNumberLayout animatedNumberLayout3 = new AnimatedNumberLayout(this, Theme.chat_replyNamePaint);
                                this.commentNumberLayout = animatedNumberLayout3;
                                z16 = false;
                                animatedNumberLayout3.setNumber(commentCount, false);
                            } else {
                                z16 = false;
                                animatedNumberLayout2.setNumber(commentCount, messageObject6.animateComments);
                            }
                            messageObject6.animateComments = z16;
                            int width8 = this.commentNumberLayout.getWidth();
                            this.commentNumberWidth = width8;
                            this.totalCommentWidth += width8 + AndroidUtilities.dp(4.0f);
                        }
                        this.totalCommentWidth += AndroidUtilities.dp(avatarsOffset + 70);
                        i17 = i18;
                    }
                }
                float f5 = 102.0f;
                if (messageObject6.type != 0) {
                    this.drawForwardedName = !this.isRepliesChat;
                    if (drawAvatar) {
                        if (AndroidUtilities.isTablet()) {
                            maxWidth4 = AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(122.0f);
                        } else {
                            int maxWidth11 = getParentWidth();
                            maxWidth4 = Math.min(maxWidth11, AndroidUtilities.displaySize.y) - AndroidUtilities.dp(122.0f);
                        }
                        this.drawName = true;
                    } else {
                        if (AndroidUtilities.isTablet()) {
                            maxWidth4 = AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(80.0f);
                        } else {
                            int maxWidth12 = getParentWidth();
                            maxWidth4 = Math.min(maxWidth12, AndroidUtilities.displaySize.y) - AndroidUtilities.dp(80.0f);
                        }
                        this.drawName = this.isPinnedChat || (messageObject6.messageOwner.peer_id.channel_id != 0 && (!messageObject.isOutOwner() || messageObject.isSupergroup())) || (messageObject.isImportedForward() && messageObject6.messageOwner.fwd_from.from_id == null);
                    }
                    this.availableTimeWidth = maxWidth4;
                    if (messageObject.isRoundVideo()) {
                        double d3 = this.availableTimeWidth;
                        double ceil3 = Math.ceil(Theme.chat_audioTimePaint.measureText("00:00"));
                        double dp = messageObject.isOutOwner() ? 0 : AndroidUtilities.dp(64.0f);
                        Double.isNaN(dp);
                        Double.isNaN(d3);
                        this.availableTimeWidth = (int) (d3 - (ceil3 + dp));
                    }
                    measureTime(messageObject);
                    int timeMore4 = this.timeWidth + AndroidUtilities.dp(6.0f);
                    if (messageObject.isOutOwner()) {
                        timeMore4 += AndroidUtilities.dp(20.5f);
                    }
                    int timeMore5 = timeMore4 + getExtraTimeX();
                    this.hasGamePreview = (messageObject6.messageOwner.media instanceof TLRPC.TL_messageMediaGame) && (messageObject6.messageOwner.media.game instanceof TLRPC.TL_game);
                    this.hasInvoicePreview = messageObject6.messageOwner.media instanceof TLRPC.TL_messageMediaInvoice;
                    boolean z20 = !messageObject6.isRestrictedMessage && (messageObject6.messageOwner.media instanceof TLRPC.TL_messageMediaWebPage) && (messageObject6.messageOwner.media.webpage instanceof TLRPC.TL_webPage);
                    this.hasLinkPreview = z20;
                    this.drawInstantView = z20 && messageObject6.messageOwner.media.webpage.cached_page != null;
                    String siteName2 = this.hasLinkPreview ? messageObject6.messageOwner.media.webpage.site_name : null;
                    this.hasEmbed = this.hasLinkPreview && !TextUtils.isEmpty(messageObject6.messageOwner.media.webpage.embed_url) && !messageObject.isGif() && !"instangram".equalsIgnoreCase(siteName2);
                    boolean slideshow2 = false;
                    String webpageType = this.hasLinkPreview ? messageObject6.messageOwner.media.webpage.type : null;
                    TLRPC.Document androidThemeDocument2 = null;
                    TLRPC.ThemeSettings androidThemeSettings2 = null;
                    androidThemeSettings = null;
                    TLRPC.ThemeSettings androidThemeSettings3 = null;
                    androidThemeSettings2 = null;
                    androidThemeSettings2 = null;
                    if (!this.drawInstantView) {
                        if ("telegram_livestream".equals(webpageType)) {
                            this.drawInstantView = true;
                            this.drawInstantViewType = 11;
                            slideshow = false;
                            newReply = newReply2;
                        } else if ("telegram_voicechat".equals(webpageType)) {
                            this.drawInstantView = true;
                            this.drawInstantViewType = 9;
                            slideshow = false;
                            newReply = newReply2;
                        } else if ("telegram_channel".equals(webpageType)) {
                            this.drawInstantView = true;
                            this.drawInstantViewType = 1;
                            slideshow = false;
                            newReply = newReply2;
                        } else if ("telegram_user".equals(webpageType)) {
                            this.drawInstantView = true;
                            this.drawInstantViewType = 13;
                            slideshow = false;
                            newReply = newReply2;
                        } else if ("telegram_megagroup".equals(webpageType)) {
                            this.drawInstantView = true;
                            this.drawInstantViewType = 2;
                            slideshow = false;
                            newReply = newReply2;
                        } else if ("telegram_message".equals(webpageType)) {
                            this.drawInstantView = true;
                            this.drawInstantViewType = 3;
                            slideshow = false;
                            newReply = newReply2;
                        } else if ("telegram_theme".equals(webpageType)) {
                            int b = 0;
                            int N2 = messageObject6.messageOwner.media.webpage.attributes.size();
                            while (true) {
                                if (b >= N2) {
                                    slideshow = slideshow2;
                                    newReply = newReply2;
                                    break;
                                }
                                TLRPC.TL_webPageAttributeTheme attribute = messageObject6.messageOwner.media.webpage.attributes.get(b);
                                ArrayList<TLRPC.Document> documents = attribute.documents;
                                slideshow = slideshow2;
                                int N = documents.size();
                                newReply = newReply2;
                                int a9 = 0;
                                while (true) {
                                    if (a9 >= N) {
                                        break;
                                    }
                                    ArrayList<TLRPC.Document> documents2 = documents;
                                    TLRPC.Document document9 = documents.get(a9);
                                    int N3 = N;
                                    TLRPC.Document androidThemeDocument3 = androidThemeDocument2;
                                    if ("application/x-tgtheme-android".equals(document9.mime_type)) {
                                        this.drawInstantView = true;
                                        this.drawInstantViewType = 7;
                                        androidThemeDocument2 = document9;
                                        break;
                                    }
                                    a9++;
                                    N = N3;
                                    documents = documents2;
                                    androidThemeDocument2 = androidThemeDocument3;
                                }
                                if (this.drawInstantView) {
                                    break;
                                } else if (attribute.settings != null) {
                                    this.drawInstantView = true;
                                    this.drawInstantViewType = 7;
                                    androidThemeSettings3 = attribute.settings;
                                    break;
                                } else {
                                    b++;
                                    slideshow2 = slideshow;
                                    newReply2 = newReply;
                                }
                            }
                            androidThemeDocument = androidThemeDocument2;
                            androidThemeSettings = androidThemeSettings3;
                            androidThemeSettings2 = androidThemeSettings3;
                        } else {
                            slideshow = false;
                            newReply = newReply2;
                            if ("telegram_background".equals(webpageType)) {
                                this.drawInstantView = true;
                                this.drawInstantViewType = 6;
                                try {
                                    Uri url = Uri.parse(messageObject6.messageOwner.media.webpage.url);
                                    this.imageBackgroundIntensity = Utilities.parseInt((CharSequence) url.getQueryParameter("intensity")).intValue();
                                    String bgColor = url.getQueryParameter("bg_color");
                                    String rotation = url.getQueryParameter("rotation");
                                    if (rotation != null) {
                                        this.imageBackgroundGradientRotation = Utilities.parseInt((CharSequence) rotation).intValue();
                                    }
                                    if (TextUtils.isEmpty(bgColor)) {
                                        TLRPC.Document document10 = messageObject.getDocument();
                                        if (document10 != null && "image/png".equals(document10.mime_type)) {
                                            bgColor = "ffffff";
                                        }
                                        if (this.imageBackgroundIntensity == 0.0f) {
                                            this.imageBackgroundIntensity = 50.0f;
                                        }
                                    }
                                    if (bgColor != null) {
                                        int averageColor = Integer.parseInt(bgColor.substring(0, 6), 16) | (-16777216);
                                        this.imageBackgroundColor = averageColor;
                                        if (bgColor.length() >= 13 && AndroidUtilities.isValidWallChar(bgColor.charAt(6))) {
                                            int parseInt = Integer.parseInt(bgColor.substring(7, 13), 16) | (-16777216);
                                            this.imageBackgroundGradientColor1 = parseInt;
                                            averageColor = AndroidUtilities.getAverageColor(this.imageBackgroundColor, parseInt);
                                        }
                                        if (bgColor.length() >= 20 && AndroidUtilities.isValidWallChar(bgColor.charAt(13))) {
                                            this.imageBackgroundGradientColor2 = Integer.parseInt(bgColor.substring(14, 20), 16) | (-16777216);
                                        }
                                        if (bgColor.length() == 27 && AndroidUtilities.isValidWallChar(bgColor.charAt(20))) {
                                            this.imageBackgroundGradientColor3 = Integer.parseInt(bgColor.substring(21), 16) | (-16777216);
                                        }
                                        if (this.imageBackgroundIntensity < 0.0f) {
                                            this.imageBackgroundSideColor = -15658735;
                                        } else {
                                            this.imageBackgroundSideColor = AndroidUtilities.getPatternSideColor(averageColor);
                                        }
                                        this.photoImage.setColorFilter(new PorterDuffColorFilter(AndroidUtilities.getPatternColor(averageColor), PorterDuff.Mode.SRC_IN));
                                        this.photoImage.setAlpha(Math.abs(this.imageBackgroundIntensity) / 100.0f);
                                    } else {
                                        String color = url.getLastPathSegment();
                                        if (color != null && color.length() >= 6) {
                                            this.imageBackgroundColor = Integer.parseInt(color.substring(0, 6), 16) | (-16777216);
                                            if (color.length() >= 13 && AndroidUtilities.isValidWallChar(color.charAt(6))) {
                                                this.imageBackgroundGradientColor1 = Integer.parseInt(color.substring(7, 13), 16) | (-16777216);
                                            }
                                            if (color.length() >= 20 && AndroidUtilities.isValidWallChar(color.charAt(13))) {
                                                this.imageBackgroundGradientColor2 = Integer.parseInt(color.substring(14, 20), 16) | (-16777216);
                                            }
                                            if (color.length() == 27 && AndroidUtilities.isValidWallChar(color.charAt(20))) {
                                                this.imageBackgroundGradientColor3 = Integer.parseInt(color.substring(21), 16) | (-16777216);
                                            }
                                            TLRPC.TL_photoSizeEmpty tL_photoSizeEmpty = new TLRPC.TL_photoSizeEmpty();
                                            this.currentPhotoObject = tL_photoSizeEmpty;
                                            tL_photoSizeEmpty.type = "s";
                                            this.currentPhotoObject.w = AndroidUtilities.dp(180.0f);
                                            this.currentPhotoObject.h = AndroidUtilities.dp(150.0f);
                                            this.currentPhotoObject.location = new TLRPC.TL_fileLocationUnavailable();
                                        }
                                    }
                                } catch (Exception e9) {
                                }
                            }
                        }
                        androidThemeDocument = null;
                        androidThemeSettings = null;
                    } else {
                        slideshow = false;
                        newReply = newReply2;
                        if (siteName2 != null) {
                            String siteName3 = siteName2.toLowerCase();
                            if (!siteName3.equals("instagram") && !siteName3.equals("twitter") && !"telegram_album".equals(webpageType)) {
                                siteName = siteName3;
                            } else if (!(messageObject6.messageOwner.media.webpage.cached_page instanceof TLRPC.TL_page)) {
                                siteName = siteName3;
                            } else if ((messageObject6.messageOwner.media.webpage.photo instanceof TLRPC.TL_photo) || MessageObject.isVideoDocument(messageObject6.messageOwner.media.webpage.document)) {
                                this.drawInstantView = false;
                                ArrayList<TLRPC.PageBlock> blocks2 = messageObject6.messageOwner.media.webpage.cached_page.blocks;
                                int count3 = 1;
                                int a10 = 0;
                                while (a10 < blocks2.size()) {
                                    TLRPC.PageBlock block = blocks2.get(a10);
                                    if (block instanceof TLRPC.TL_pageBlockSlideshow) {
                                        TLRPC.TL_pageBlockSlideshow b2 = (TLRPC.TL_pageBlockSlideshow) block;
                                        blocks = blocks2;
                                        ArrayList<TLRPC.PageBlock> blocks3 = b2.items;
                                        int count4 = blocks3.size();
                                        count3 = count4;
                                    } else {
                                        blocks = blocks2;
                                        if (block instanceof TLRPC.TL_pageBlockCollage) {
                                            TLRPC.TL_pageBlockCollage b3 = (TLRPC.TL_pageBlockCollage) block;
                                            count3 = b3.items.size();
                                        }
                                    }
                                    a10++;
                                    blocks2 = blocks;
                                }
                                String str13 = LocaleController.formatString("Of", R.string.Of, 1, Integer.valueOf(count3));
                                this.photosCountWidth = (int) Math.ceil(Theme.chat_durationPaint.measureText(str13));
                                this.photosCountLayout = new StaticLayout(str13, Theme.chat_durationPaint, this.photosCountWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                slideshow = true;
                                androidThemeDocument = null;
                                androidThemeSettings = null;
                            } else {
                                siteName = siteName3;
                            }
                            androidThemeDocument = null;
                            androidThemeSettings = null;
                        }
                        androidThemeDocument = null;
                        androidThemeSettings = null;
                    }
                    this.backgroundWidth = maxWidth4;
                    if (this.hasLinkPreview || this.hasGamePreview || this.hasInvoicePreview || maxWidth4 - messageObject6.lastLineWidth < timeMore5) {
                        int max = Math.max(this.backgroundWidth, messageObject6.lastLineWidth) + AndroidUtilities.dp(31.0f);
                        this.backgroundWidth = max;
                        this.backgroundWidth = Math.max(max, this.timeWidth + AndroidUtilities.dp(31.0f));
                    } else {
                        int diff = this.backgroundWidth - messageObject6.lastLineWidth;
                        if (diff < 0 || diff > timeMore5) {
                            this.backgroundWidth = Math.max(this.backgroundWidth, messageObject6.lastLineWidth + timeMore5) + AndroidUtilities.dp(31.0f);
                        } else {
                            this.backgroundWidth = ((this.backgroundWidth + timeMore5) - diff) + AndroidUtilities.dp(31.0f);
                        }
                    }
                    this.availableTimeWidth = this.backgroundWidth - AndroidUtilities.dp(31.0f);
                    if (messageObject.isRoundVideo()) {
                        double d4 = this.availableTimeWidth;
                        double ceil4 = Math.ceil(Theme.chat_audioTimePaint.measureText("00:00"));
                        double dp2 = messageObject.isOutOwner() ? 0 : AndroidUtilities.dp(64.0f);
                        Double.isNaN(dp2);
                        Double.isNaN(d4);
                        this.availableTimeWidth = (int) (d4 - (ceil4 + dp2));
                    }
                    setMessageObjectInternal(messageObject);
                    this.backgroundWidth = messageObject6.textWidth + (getExtraTextX() * 2) + ((this.hasGamePreview || this.hasInvoicePreview) ? AndroidUtilities.dp(10.0f) : 0);
                    this.totalHeight = messageObject6.textHeight + AndroidUtilities.dp(19.5f) + this.namesOffset;
                    if (!this.reactionsLayoutInBubble.isSmall) {
                        this.reactionsLayoutInBubble.measure(maxWidth4, 3);
                        if (!this.reactionsLayoutInBubble.isEmpty) {
                            ReactionsLayoutInBubble reactionsLayoutInBubble = this.reactionsLayoutInBubble;
                            reactionsLayoutInBubble.totalHeight = reactionsLayoutInBubble.height + AndroidUtilities.dp(8.0f);
                            if (this.reactionsLayoutInBubble.width > this.backgroundWidth) {
                                this.backgroundWidth = this.reactionsLayoutInBubble.width;
                            }
                            this.totalHeight += this.reactionsLayoutInBubble.totalHeight;
                        }
                    }
                    if (this.drawPinnedTop) {
                        this.namesOffset -= AndroidUtilities.dp(1.0f);
                    }
                    int maxChildWidth3 = Math.max(Math.max(Math.max(Math.max(this.backgroundWidth, this.nameWidth), this.forwardedNameWidth), this.replyNameWidth), this.replyTextWidth);
                    if (this.commentLayout != null && this.drawSideButton != 3) {
                        maxChildWidth3 = Math.max(maxChildWidth3, this.totalCommentWidth);
                    }
                    int maxWebWidth2 = 0;
                    if (this.hasLinkPreview || this.hasGamePreview || this.hasInvoicePreview) {
                        int linkPreviewMaxWidth5 = AndroidUtilities.isTablet() ? drawAvatar ? AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(132.0f) : AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(80.0f) : drawAvatar ? getParentWidth() - AndroidUtilities.dp(132.0f) : getParentWidth() - AndroidUtilities.dp(80.0f);
                        if (this.drawSideButton != 0) {
                            linkPreviewMaxWidth5 -= AndroidUtilities.dp(20.0f);
                        }
                        int smallImageSide = AndroidUtilities.dp(48.0f);
                        int smallSideMargin = AndroidUtilities.dp(10.0f);
                        if (this.hasLinkPreview) {
                            TLRPC.TL_webPage webPage = (TLRPC.TL_webPage) messageObject6.messageOwner.media.webpage;
                            String site_name2 = webPage.site_name;
                            int i23 = this.drawInstantViewType;
                            String title3 = (i23 == 6 || i23 == 7) ? null : webPage.title;
                            int i24 = this.drawInstantViewType;
                            CharSequence author2 = (i24 == 6 || i24 == 7) ? null : webPage.author;
                            int i25 = this.drawInstantViewType;
                            int linkPreviewMaxWidth6 = linkPreviewMaxWidth5;
                            String description2 = (i25 == 6 || i25 == 7) ? null : webPage.description;
                            TLRPC.Photo photo4 = webPage.photo;
                            description = description2;
                            String title4 = title3;
                            TLRPC.Document document11 = this.drawInstantViewType == 7 ? androidThemeSettings != null ? new DocumentObject.ThemeDocument(androidThemeSettings) : androidThemeDocument : webPage.document;
                            String type7 = webPage.type;
                            CharSequence author3 = author2;
                            int duration3 = webPage.duration;
                            if (site_name2 == null || photo4 == null) {
                                site_name = site_name2;
                            } else {
                                site_name = site_name2;
                                if (site_name2.toLowerCase().equals("instagram")) {
                                    linkPreviewMaxWidth6 = Math.max(AndroidUtilities.displaySize.y / 3, this.currentMessageObject.textWidth);
                                }
                            }
                            boolean isSmallImageType2 = "app".equals(type7) || Scopes.PROFILE.equals(type7) || "article".equals(type7) || "telegram_bot".equals(type7) || "telegram_user".equals(type7) || "telegram_channel".equals(type7) || "telegram_megagroup".equals(type7) || "telegram_voicechat".equals(type7) || "telegram_livestream".equals(type7);
                            if (!slideshow) {
                                if (this.drawInstantView) {
                                    int i26 = this.drawInstantViewType;
                                    duration2 = duration3;
                                    if (i26 != 1) {
                                        if (i26 != 9) {
                                            if (i26 != 11) {
                                            }
                                        }
                                    }
                                } else {
                                    duration2 = duration3;
                                }
                                if (document11 == null && isSmallImageType2) {
                                    smallImage3 = true;
                                    this.isSmallImage = (smallImage3 || type7 == null || this.currentMessageObject.photoThumbs == null) ? false : true;
                                    isSmallImageType = smallImage3;
                                    type = type7;
                                    photo = photo4;
                                    webDocument = null;
                                    author = author3;
                                    duration = duration2;
                                    document3 = document11;
                                    linkPreviewMaxWidth = linkPreviewMaxWidth6;
                                    title2 = title4;
                                    title = site_name;
                                }
                            } else {
                                duration2 = duration3;
                            }
                            smallImage3 = false;
                            this.isSmallImage = (smallImage3 || type7 == null || this.currentMessageObject.photoThumbs == null) ? false : true;
                            isSmallImageType = smallImage3;
                            type = type7;
                            photo = photo4;
                            webDocument = null;
                            author = author3;
                            duration = duration2;
                            document3 = document11;
                            linkPreviewMaxWidth = linkPreviewMaxWidth6;
                            title2 = title4;
                            title = site_name;
                        } else {
                            int linkPreviewMaxWidth7 = linkPreviewMaxWidth5;
                            if (this.hasInvoicePreview) {
                                TLRPC.TL_messageMediaInvoice invoice = (TLRPC.TL_messageMediaInvoice) messageObject6.messageOwner.media;
                                String site_name3 = messageObject6.messageOwner.media.title;
                                description = null;
                                WebFile webDocument3 = invoice.photo instanceof TLRPC.TL_webDocument ? WebFile.createWithWebDocument(invoice.photo) : null;
                                this.isSmallImage = false;
                                photo = null;
                                document3 = null;
                                duration = 0;
                                title = site_name3;
                                webDocument = webDocument3;
                                isSmallImageType = false;
                                linkPreviewMaxWidth = linkPreviewMaxWidth7;
                                title2 = null;
                                author = null;
                                type = "invoice";
                            } else {
                                TLRPC.TL_game game = messageObject6.messageOwner.media.game;
                                String site_name4 = game.title;
                                String description3 = TextUtils.isEmpty(messageObject6.messageText) ? game.description : null;
                                TLRPC.Photo photo5 = game.photo;
                                description = description3;
                                TLRPC.Document document12 = game.document;
                                this.isSmallImage = false;
                                photo = photo5;
                                document3 = document12;
                                isSmallImageType = false;
                                linkPreviewMaxWidth = linkPreviewMaxWidth7;
                                title2 = null;
                                author = null;
                                type = "game";
                                title = site_name4;
                                webDocument = null;
                                duration = 0;
                            }
                        }
                        int i27 = this.drawInstantViewType;
                        WebFile webDocument4 = webDocument;
                        String site_name5 = i27 == 11 ? LocaleController.getString("VoipChannelVoiceChat", R.string.VoipChannelVoiceChat) : i27 == 9 ? LocaleController.getString("VoipGroupVoiceChat", R.string.VoipGroupVoiceChat) : i27 == 6 ? LocaleController.getString("ChatBackground", R.string.ChatBackground) : "telegram_theme".equals(webpageType) ? LocaleController.getString("ColorTheme", R.string.ColorTheme) : title;
                        int additinalWidth2 = this.hasInvoicePreview ? 0 : AndroidUtilities.dp(10.0f);
                        int restLinesCount4 = 3;
                        int linkPreviewMaxWidth8 = linkPreviewMaxWidth - additinalWidth2;
                        if (this.currentMessageObject.photoThumbs != null || photo == null) {
                            type2 = type;
                        } else {
                            type2 = type;
                            this.currentMessageObject.generateThumbs(true);
                        }
                        if (site_name5 != null) {
                            try {
                                timeMore = timeMore5;
                                try {
                                    int width9 = (int) Math.ceil(Theme.chat_replyNamePaint.measureText(site_name5) + 1.0f);
                                    restLines = 0;
                                    if (!this.isSmallImage) {
                                        try {
                                            this.siteNameLayout = new StaticLayout(site_name5, Theme.chat_replyNamePaint, Math.min(width9, linkPreviewMaxWidth8), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                        } catch (Exception e10) {
                                            maxWidth5 = maxWidth4;
                                            linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                                            document4 = document3;
                                            photo2 = photo;
                                            e5 = e10;
                                            smallImage = isSmallImageType;
                                        }
                                    } else {
                                        restLines = 3;
                                        StaticLayout generateStaticLayout = generateStaticLayout(site_name5, Theme.chat_replyNamePaint, linkPreviewMaxWidth8, (linkPreviewMaxWidth8 - smallImageSide) - smallSideMargin, 3, 1);
                                        this.siteNameLayout = generateStaticLayout;
                                        restLinesCount4 = 3 - generateStaticLayout.getLineCount();
                                    }
                                    this.siteNameRtl = Math.max(this.siteNameLayout.getLineLeft(0), 0.0f) != 0.0f;
                                    int height6 = this.siteNameLayout.getLineBottom(staticLayout3.getLineCount() - 1);
                                    this.linkPreviewHeight += height6;
                                    this.totalHeight += height6;
                                    layoutWidth = 0;
                                    height = 0;
                                } catch (Exception e11) {
                                    maxWidth5 = maxWidth4;
                                    linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                                    document4 = document3;
                                    photo2 = photo;
                                    smallImage = isSmallImageType;
                                    e5 = e11;
                                }
                            } catch (Exception e12) {
                                maxWidth5 = maxWidth4;
                                linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                                document4 = document3;
                                timeMore = timeMore5;
                                photo2 = photo;
                                smallImage = isSmallImageType;
                                e5 = e12;
                            }
                            while (true) {
                                maxWidth5 = maxWidth4;
                                try {
                                    if (height >= this.siteNameLayout.getLineCount()) {
                                        break;
                                    }
                                    photo2 = photo;
                                    try {
                                        int lineLeft = (int) Math.max(0.0f, this.siteNameLayout.getLineLeft(height));
                                        if (lineLeft != 0) {
                                            try {
                                                lineWidth = this.siteNameLayout.getWidth() - lineLeft;
                                                linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                                                document4 = document3;
                                                smallImage = isSmallImageType;
                                            } catch (Exception e13) {
                                                e5 = e13;
                                                linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                                                document4 = document3;
                                                smallImage = isSmallImageType;
                                            }
                                        } else {
                                            int max2 = linkPreviewMaxWidth8;
                                            try {
                                                if (height >= restLines) {
                                                    if (lineLeft != 0) {
                                                        document4 = document3;
                                                        try {
                                                        } catch (Exception e14) {
                                                            e5 = e14;
                                                            linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                                                            smallImage = isSmallImageType;
                                                        }
                                                    } else {
                                                        document4 = document3;
                                                    }
                                                    linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                                                    smallImage = isSmallImageType;
                                                    lineWidth = (int) Math.min(max2, Math.ceil(this.siteNameLayout.getLineWidth(height)));
                                                } else {
                                                    document4 = document3;
                                                }
                                                lineWidth = (int) Math.min(max2, Math.ceil(this.siteNameLayout.getLineWidth(height)));
                                            } catch (Exception e15) {
                                                e5 = e15;
                                            }
                                            max2 -= smallImageSide + smallSideMargin;
                                            linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                                            smallImage = isSmallImageType;
                                        }
                                        if (height < restLines || (lineLeft != 0 && this.isSmallImage)) {
                                            lineWidth += smallImageSide + smallSideMargin;
                                        }
                                        layoutWidth = Math.max(layoutWidth, lineWidth);
                                        height++;
                                        isSmallImageType = smallImage;
                                        maxWidth4 = maxWidth5;
                                        photo = photo2;
                                        document3 = document4;
                                        linkPreviewMaxWidth8 = linkPreviewMaxWidth2;
                                    } catch (Exception e16) {
                                        linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                                        document4 = document3;
                                        smallImage = isSmallImageType;
                                        e5 = e16;
                                    }
                                    e5 = e15;
                                } catch (Exception e17) {
                                    linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                                    document4 = document3;
                                    photo2 = photo;
                                    smallImage = isSmallImageType;
                                    e5 = e17;
                                }
                                FileLog.e(e5);
                                maxWidth6 = restLinesCount4;
                            }
                            linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                            document4 = document3;
                            photo2 = photo;
                            smallImage = isSmallImageType;
                            int width10 = layoutWidth;
                            this.siteNameWidth = layoutWidth;
                            maxChildWidth3 = Math.max(maxChildWidth3, width10 + additinalWidth2);
                            maxWebWidth2 = Math.max(0, width10 + additinalWidth2);
                            maxWidth6 = restLinesCount4;
                        } else {
                            maxWidth5 = maxWidth4;
                            linkPreviewMaxWidth2 = linkPreviewMaxWidth8;
                            document4 = document3;
                            timeMore = timeMore5;
                            photo2 = photo;
                            smallImage = isSmallImageType;
                            maxWidth6 = 3;
                        }
                        boolean titleIsRTL2 = false;
                        if (title2 != null) {
                            try {
                                this.titleX = Integer.MAX_VALUE;
                                int i28 = this.linkPreviewHeight;
                                if (i28 != 0) {
                                    try {
                                        this.linkPreviewHeight = i28 + AndroidUtilities.dp(2.0f);
                                        this.totalHeight += AndroidUtilities.dp(2.0f);
                                    } catch (Exception e18) {
                                        e8 = e18;
                                        smallImage2 = smallImage;
                                        FileLog.e(e8);
                                        if (titleIsRTL2) {
                                        }
                                        titleIsRTL = titleIsRTL2;
                                        linkPreviewMaxWidth3 = linkPreviewMaxWidth2;
                                        boolean authorIsRTL2 = false;
                                        if (author == null) {
                                        }
                                        restLinesCount = maxWidth6;
                                        authorIsRTL = false;
                                        if (description != null) {
                                        }
                                        if (smallImage2) {
                                        }
                                        if (smallImage2) {
                                        }
                                        if (document4 != null) {
                                        }
                                        f = 0.0f;
                                        additionHeight = str5;
                                        r14 = z11;
                                        if (this.currentPosition == null) {
                                        }
                                        if (!messageObject.isAnyKindOfSticker()) {
                                        }
                                        c = 2;
                                        i3 = 0;
                                        z4 = z19;
                                        i = i3;
                                        groupedMessagePosition = this.currentPosition;
                                        if (groupedMessagePosition != null) {
                                        }
                                        this.totalHeight += AndroidUtilities.dp(14.0f);
                                        if (this.currentMessageObject.eventId == 0) {
                                        }
                                        if (messageObject.isSponsored()) {
                                        }
                                        this.botButtons.clear();
                                        if (messageIdChanged) {
                                        }
                                        if (!messageObject6.isRestrictedMessage) {
                                        }
                                        this.substractBackgroundHeight = 0;
                                        this.keyboardHeight = 0;
                                        if (this.drawCommentButton) {
                                        }
                                        z5 = this.drawPinnedBottom;
                                        if (!z5) {
                                        }
                                        if (z5) {
                                        }
                                        if (!messageObject.isAnyKindOfSticker()) {
                                        }
                                        if (messageObject.isAnimatedEmoji()) {
                                        }
                                        if (!this.drawPhotoImage) {
                                        }
                                        if (this.documentAttachType != 5) {
                                        }
                                        if (autoDownload) {
                                        }
                                        messageObject2 = this.currentMessageObject;
                                        if (messageObject2 != null) {
                                        }
                                        if (messageIdChanged) {
                                        }
                                        transcribeButton = this.transcribeButton;
                                        if (transcribeButton != null) {
                                        }
                                        updateWaveform();
                                        updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                        if (!this.currentMessageObject.loadingCancelled) {
                                        }
                                        chatMessageCellDelegate = this.delegate;
                                        if (chatMessageCellDelegate != null) {
                                        }
                                        this.accessibilityVirtualViewBounds.clear();
                                        this.transitionParams.updatePhotoImageX = true;
                                        updateFlagSecure();
                                    }
                                }
                                int restLines3 = 0;
                                if (!this.isSmallImage) {
                                    this.titleLayout = StaticLayoutEx.createStaticLayout(title2, Theme.chat_replyNamePaint, linkPreviewMaxWidth2, Layout.Alignment.ALIGN_NORMAL, 1.0f, AndroidUtilities.dp(1.0f), false, TextUtils.TruncateAt.END, linkPreviewMaxWidth2, 4);
                                } else {
                                    restLines3 = maxWidth6;
                                    StaticLayout generateStaticLayout2 = generateStaticLayout(title2, Theme.chat_replyNamePaint, linkPreviewMaxWidth2, (linkPreviewMaxWidth2 - smallImageSide) - smallSideMargin, maxWidth6, 4);
                                    this.titleLayout = generateStaticLayout2;
                                    maxWidth6 -= generateStaticLayout2.getLineCount();
                                }
                                try {
                                    StaticLayout staticLayout4 = this.titleLayout;
                                    int height7 = staticLayout4.getLineBottom(staticLayout4.getLineCount() - 1);
                                    this.linkPreviewHeight += height7;
                                    this.totalHeight += height7;
                                    int a11 = 0;
                                    while (a11 < this.titleLayout.getLineCount()) {
                                        int lineLeft2 = (int) Math.max(0.0f, this.titleLayout.getLineLeft(a11));
                                        if (lineLeft2 != 0) {
                                            titleIsRTL2 = true;
                                        }
                                        int i29 = this.titleX;
                                        if (i29 == Integer.MAX_VALUE) {
                                            this.titleX = -lineLeft2;
                                        } else {
                                            this.titleX = Math.max(i29, -lineLeft2);
                                        }
                                        if (lineLeft2 != 0) {
                                            width7 = this.titleLayout.getWidth() - lineLeft2;
                                            restLinesCount3 = maxWidth6;
                                            height5 = height7;
                                            smallImage2 = smallImage;
                                        } else {
                                            int max3 = linkPreviewMaxWidth2;
                                            if (a11 < restLines3 || (lineLeft2 != 0 && this.isSmallImage)) {
                                                max3 -= smallImageSide + smallSideMargin;
                                            }
                                            height5 = height7;
                                            boolean smallImage4 = smallImage;
                                            restLinesCount3 = maxWidth6;
                                            try {
                                                smallImage2 = smallImage4;
                                            } catch (Exception e19) {
                                                smallImage2 = smallImage4;
                                                e8 = e19;
                                                maxWidth6 = restLinesCount3;
                                            }
                                            try {
                                                width7 = (int) Math.min(max3, Math.ceil(this.titleLayout.getLineWidth(a11)));
                                            } catch (Exception e20) {
                                                e8 = e20;
                                                maxWidth6 = restLinesCount3;
                                                FileLog.e(e8);
                                                if (titleIsRTL2) {
                                                }
                                                titleIsRTL = titleIsRTL2;
                                                linkPreviewMaxWidth3 = linkPreviewMaxWidth2;
                                                boolean authorIsRTL22 = false;
                                                if (author == null) {
                                                }
                                                restLinesCount = maxWidth6;
                                                authorIsRTL = false;
                                                if (description != null) {
                                                }
                                                if (smallImage2) {
                                                }
                                                if (smallImage2) {
                                                }
                                                if (document4 != null) {
                                                }
                                                f = 0.0f;
                                                additionHeight = str5;
                                                r14 = z11;
                                                if (this.currentPosition == null) {
                                                }
                                                if (!messageObject.isAnyKindOfSticker()) {
                                                }
                                                c = 2;
                                                i3 = 0;
                                                z4 = z19;
                                                i = i3;
                                                groupedMessagePosition = this.currentPosition;
                                                if (groupedMessagePosition != null) {
                                                }
                                                this.totalHeight += AndroidUtilities.dp(14.0f);
                                                if (this.currentMessageObject.eventId == 0) {
                                                }
                                                if (messageObject.isSponsored()) {
                                                }
                                                this.botButtons.clear();
                                                if (messageIdChanged) {
                                                }
                                                if (!messageObject6.isRestrictedMessage) {
                                                }
                                                this.substractBackgroundHeight = 0;
                                                this.keyboardHeight = 0;
                                                if (this.drawCommentButton) {
                                                }
                                                z5 = this.drawPinnedBottom;
                                                if (!z5) {
                                                }
                                                if (z5) {
                                                }
                                                if (!messageObject.isAnyKindOfSticker()) {
                                                }
                                                if (messageObject.isAnimatedEmoji()) {
                                                }
                                                if (!this.drawPhotoImage) {
                                                }
                                                if (this.documentAttachType != 5) {
                                                }
                                                if (autoDownload) {
                                                }
                                                messageObject2 = this.currentMessageObject;
                                                if (messageObject2 != null) {
                                                }
                                                if (messageIdChanged) {
                                                }
                                                transcribeButton = this.transcribeButton;
                                                if (transcribeButton != null) {
                                                }
                                                updateWaveform();
                                                updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                                if (!this.currentMessageObject.loadingCancelled) {
                                                }
                                                chatMessageCellDelegate = this.delegate;
                                                if (chatMessageCellDelegate != null) {
                                                }
                                                this.accessibilityVirtualViewBounds.clear();
                                                this.transitionParams.updatePhotoImageX = true;
                                                updateFlagSecure();
                                            }
                                        }
                                        if (a11 < restLines3 || (lineLeft2 != 0 && this.isSmallImage)) {
                                            width7 += smallImageSide + smallSideMargin;
                                        }
                                        maxChildWidth3 = Math.max(maxChildWidth3, width7 + additinalWidth2);
                                        maxWebWidth2 = Math.max(maxWebWidth2, width7 + additinalWidth2);
                                        a11++;
                                        height7 = height5;
                                        maxWidth6 = restLinesCount3;
                                        smallImage = smallImage2;
                                    }
                                    smallImage2 = smallImage;
                                } catch (Exception e21) {
                                    smallImage2 = smallImage;
                                    e8 = e21;
                                }
                            } catch (Exception e22) {
                                smallImage2 = smallImage;
                                e8 = e22;
                            }
                            if (titleIsRTL2 || !this.isSmallImage) {
                                titleIsRTL = titleIsRTL2;
                                linkPreviewMaxWidth3 = linkPreviewMaxWidth2;
                            } else {
                                titleIsRTL = titleIsRTL2;
                                linkPreviewMaxWidth3 = linkPreviewMaxWidth2 - AndroidUtilities.dp(48.0f);
                            }
                        } else {
                            smallImage2 = smallImage;
                            titleIsRTL = false;
                            linkPreviewMaxWidth3 = linkPreviewMaxWidth2;
                        }
                        boolean authorIsRTL222 = false;
                        if (author == null && title2 == null) {
                            try {
                                int i30 = this.linkPreviewHeight;
                                if (i30 != 0) {
                                    this.linkPreviewHeight = i30 + AndroidUtilities.dp(2.0f);
                                    this.totalHeight += AndroidUtilities.dp(2.0f);
                                }
                                try {
                                    author = Emoji.replaceEmoji(author, Theme.chat_replyNamePaint.getFontMetricsInt(), AndroidUtilities.dp(14.0f), false);
                                } catch (Exception e23) {
                                }
                                if (maxWidth6 != 3 || (this.isSmallImage && description != null)) {
                                    StaticLayout generateStaticLayout3 = generateStaticLayout(author, Theme.chat_replyNamePaint, linkPreviewMaxWidth3, (linkPreviewMaxWidth3 - smallImageSide) - smallSideMargin, maxWidth6, 1);
                                    this.authorLayout = generateStaticLayout3;
                                    maxWidth6 -= generateStaticLayout3.getLineCount();
                                } else {
                                    this.authorLayout = new StaticLayout(author, Theme.chat_replyNamePaint, linkPreviewMaxWidth3, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                }
                                StaticLayout staticLayout5 = this.authorLayout;
                                int height8 = staticLayout5.getLineBottom(staticLayout5.getLineCount() - 1);
                                this.linkPreviewHeight += height8;
                                this.totalHeight += height8;
                                int lineLeft3 = (int) Math.max(this.authorLayout.getLineLeft(0), 0.0f);
                                this.authorX = -lineLeft3;
                                if (lineLeft3 != 0) {
                                    width6 = this.authorLayout.getWidth() - lineLeft3;
                                    authorIsRTL222 = true;
                                } else {
                                    width6 = (int) Math.ceil(this.authorLayout.getLineWidth(0));
                                }
                                maxChildWidth3 = Math.max(maxChildWidth3, width6 + additinalWidth2);
                                maxWebWidth2 = Math.max(maxWebWidth2, width6 + additinalWidth2);
                                restLinesCount = maxWidth6;
                                authorIsRTL = authorIsRTL222;
                            } catch (Exception e24) {
                                FileLog.e(e24);
                                restLinesCount = maxWidth6;
                                authorIsRTL = authorIsRTL222;
                            }
                        } else {
                            restLinesCount = maxWidth6;
                            authorIsRTL = false;
                        }
                        if (description != null) {
                            try {
                                this.descriptionX = 0;
                                this.currentMessageObject.generateLinkDescription();
                                int i31 = this.linkPreviewHeight;
                                if (i31 != 0) {
                                    try {
                                        this.linkPreviewHeight = i31 + AndroidUtilities.dp(2.0f);
                                        this.totalHeight += AndroidUtilities.dp(2.0f);
                                    } catch (Exception e25) {
                                        messageObject5 = messageObject;
                                        e6 = e25;
                                        restLinesCount2 = restLinesCount;
                                        linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                        FileLog.e(e6);
                                        maxWebWidth = maxWebWidth2;
                                        if (smallImage2) {
                                        }
                                        if (smallImage2) {
                                        }
                                        if (document4 != null) {
                                        }
                                        f = 0.0f;
                                        additionHeight = str5;
                                        r14 = z11;
                                        if (this.currentPosition == null) {
                                        }
                                        if (!messageObject.isAnyKindOfSticker()) {
                                        }
                                        c = 2;
                                        i3 = 0;
                                        z4 = z19;
                                        i = i3;
                                        groupedMessagePosition = this.currentPosition;
                                        if (groupedMessagePosition != null) {
                                        }
                                        this.totalHeight += AndroidUtilities.dp(14.0f);
                                        if (this.currentMessageObject.eventId == 0) {
                                        }
                                        if (messageObject.isSponsored()) {
                                        }
                                        this.botButtons.clear();
                                        if (messageIdChanged) {
                                        }
                                        if (!messageObject6.isRestrictedMessage) {
                                        }
                                        this.substractBackgroundHeight = 0;
                                        this.keyboardHeight = 0;
                                        if (this.drawCommentButton) {
                                        }
                                        z5 = this.drawPinnedBottom;
                                        if (!z5) {
                                        }
                                        if (z5) {
                                        }
                                        if (!messageObject.isAnyKindOfSticker()) {
                                        }
                                        if (messageObject.isAnimatedEmoji()) {
                                        }
                                        if (!this.drawPhotoImage) {
                                        }
                                        if (this.documentAttachType != 5) {
                                        }
                                        if (autoDownload) {
                                        }
                                        messageObject2 = this.currentMessageObject;
                                        if (messageObject2 != null) {
                                        }
                                        if (messageIdChanged) {
                                        }
                                        transcribeButton = this.transcribeButton;
                                        if (transcribeButton != null) {
                                        }
                                        updateWaveform();
                                        updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                        if (!this.currentMessageObject.loadingCancelled) {
                                        }
                                        chatMessageCellDelegate = this.delegate;
                                        if (chatMessageCellDelegate != null) {
                                        }
                                        this.accessibilityVirtualViewBounds.clear();
                                        this.transitionParams.updatePhotoImageX = true;
                                        updateFlagSecure();
                                    }
                                }
                                restLines2 = 0;
                                allowAllLines = site_name5 != null && site_name5.toLowerCase().equals("twitter");
                            } catch (Exception e26) {
                                e7 = e26;
                                messageObject5 = messageObject;
                            }
                            try {
                                try {
                                    if (restLinesCount == 3) {
                                        if (!this.isSmallImage) {
                                            messageObject5 = messageObject;
                                            try {
                                                this.descriptionLayout = StaticLayoutEx.createStaticLayout(messageObject5.linkDescription, Theme.chat_replyTextPaint, linkPreviewMaxWidth3, Layout.Alignment.ALIGN_NORMAL, 1.0f, AndroidUtilities.dp(1.0f), false, TextUtils.TruncateAt.END, linkPreviewMaxWidth3, allowAllLines ? 100 : 6);
                                                StaticLayout staticLayout6 = this.descriptionLayout;
                                                int height9 = staticLayout6.getLineBottom(staticLayout6.getLineCount() - 1);
                                                this.linkPreviewHeight += height9;
                                                this.totalHeight += height9;
                                                boolean hasRTL = false;
                                                a3 = 0;
                                                while (a3 < this.descriptionLayout.getLineCount()) {
                                                    try {
                                                        int lineLeft4 = (int) Math.ceil(this.descriptionLayout.getLineLeft(a3));
                                                        if (lineLeft4 > 0) {
                                                            hasRTL = true;
                                                            int i32 = this.descriptionX;
                                                            if (i32 == 0) {
                                                                this.descriptionX = -lineLeft4;
                                                                maxChildWidth2 = maxChildWidth3;
                                                            } else {
                                                                maxChildWidth2 = maxChildWidth3;
                                                                try {
                                                                    this.descriptionX = Math.max(i32, -lineLeft4);
                                                                } catch (Exception e27) {
                                                                    e6 = e27;
                                                                    restLinesCount2 = restLinesCount;
                                                                    linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                                                    maxChildWidth3 = maxChildWidth2;
                                                                    FileLog.e(e6);
                                                                    maxWebWidth = maxWebWidth2;
                                                                    if (smallImage2) {
                                                                        this.isSmallImage = false;
                                                                        smallImage2 = false;
                                                                    }
                                                                    if (smallImage2) {
                                                                    }
                                                                    if (document4 != null) {
                                                                    }
                                                                    f = 0.0f;
                                                                    additionHeight = str5;
                                                                    r14 = z11;
                                                                    if (this.currentPosition == null) {
                                                                    }
                                                                    if (!messageObject.isAnyKindOfSticker()) {
                                                                    }
                                                                    c = 2;
                                                                    i3 = 0;
                                                                    z4 = z19;
                                                                    i = i3;
                                                                    groupedMessagePosition = this.currentPosition;
                                                                    if (groupedMessagePosition != null) {
                                                                    }
                                                                    this.totalHeight += AndroidUtilities.dp(14.0f);
                                                                    if (this.currentMessageObject.eventId == 0) {
                                                                    }
                                                                    if (messageObject.isSponsored()) {
                                                                    }
                                                                    this.botButtons.clear();
                                                                    if (messageIdChanged) {
                                                                    }
                                                                    if (!messageObject6.isRestrictedMessage) {
                                                                    }
                                                                    this.substractBackgroundHeight = 0;
                                                                    this.keyboardHeight = 0;
                                                                    if (this.drawCommentButton) {
                                                                    }
                                                                    z5 = this.drawPinnedBottom;
                                                                    if (!z5) {
                                                                    }
                                                                    if (z5) {
                                                                    }
                                                                    if (!messageObject.isAnyKindOfSticker()) {
                                                                    }
                                                                    if (messageObject.isAnimatedEmoji()) {
                                                                    }
                                                                    if (!this.drawPhotoImage) {
                                                                    }
                                                                    if (this.documentAttachType != 5) {
                                                                    }
                                                                    if (autoDownload) {
                                                                    }
                                                                    messageObject2 = this.currentMessageObject;
                                                                    if (messageObject2 != null) {
                                                                    }
                                                                    if (messageIdChanged) {
                                                                    }
                                                                    transcribeButton = this.transcribeButton;
                                                                    if (transcribeButton != null) {
                                                                    }
                                                                    updateWaveform();
                                                                    updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                                                    if (!this.currentMessageObject.loadingCancelled) {
                                                                    }
                                                                    chatMessageCellDelegate = this.delegate;
                                                                    if (chatMessageCellDelegate != null) {
                                                                    }
                                                                    this.accessibilityVirtualViewBounds.clear();
                                                                    this.transitionParams.updatePhotoImageX = true;
                                                                    updateFlagSecure();
                                                                }
                                                            }
                                                        } else {
                                                            maxChildWidth2 = maxChildWidth3;
                                                        }
                                                        a3++;
                                                        maxChildWidth3 = maxChildWidth2;
                                                    } catch (Exception e28) {
                                                        e6 = e28;
                                                        restLinesCount2 = restLinesCount;
                                                        linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                                    }
                                                }
                                                maxChildWidth = maxChildWidth3;
                                                int textWidth = this.descriptionLayout.getWidth();
                                                a4 = 0;
                                                int maxWebWidth3 = maxWebWidth2;
                                                int maxChildWidth4 = maxChildWidth;
                                                while (a4 < this.descriptionLayout.getLineCount()) {
                                                    try {
                                                        boolean allowAllLines2 = allowAllLines;
                                                        int height10 = height9;
                                                        int lineLeft5 = (int) Math.ceil(this.descriptionLayout.getLineLeft(a4));
                                                        if (lineLeft5 == 0) {
                                                            try {
                                                                if (this.descriptionX != 0) {
                                                                    this.descriptionX = 0;
                                                                }
                                                            } catch (Exception e29) {
                                                                e6 = e29;
                                                                maxChildWidth3 = maxChildWidth4;
                                                                maxWebWidth2 = maxWebWidth3;
                                                                restLinesCount2 = restLinesCount;
                                                                linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                                                FileLog.e(e6);
                                                                maxWebWidth = maxWebWidth2;
                                                                if (smallImage2) {
                                                                }
                                                                if (smallImage2) {
                                                                }
                                                                if (document4 != null) {
                                                                }
                                                                f = 0.0f;
                                                                additionHeight = str5;
                                                                r14 = z11;
                                                                if (this.currentPosition == null) {
                                                                }
                                                                if (!messageObject.isAnyKindOfSticker()) {
                                                                }
                                                                c = 2;
                                                                i3 = 0;
                                                                z4 = z19;
                                                                i = i3;
                                                                groupedMessagePosition = this.currentPosition;
                                                                if (groupedMessagePosition != null) {
                                                                }
                                                                this.totalHeight += AndroidUtilities.dp(14.0f);
                                                                if (this.currentMessageObject.eventId == 0) {
                                                                }
                                                                if (messageObject.isSponsored()) {
                                                                }
                                                                this.botButtons.clear();
                                                                if (messageIdChanged) {
                                                                }
                                                                if (!messageObject6.isRestrictedMessage) {
                                                                }
                                                                this.substractBackgroundHeight = 0;
                                                                this.keyboardHeight = 0;
                                                                if (this.drawCommentButton) {
                                                                }
                                                                z5 = this.drawPinnedBottom;
                                                                if (!z5) {
                                                                }
                                                                if (z5) {
                                                                }
                                                                if (!messageObject.isAnyKindOfSticker()) {
                                                                }
                                                                if (messageObject.isAnimatedEmoji()) {
                                                                }
                                                                if (!this.drawPhotoImage) {
                                                                }
                                                                if (this.documentAttachType != 5) {
                                                                }
                                                                if (autoDownload) {
                                                                }
                                                                messageObject2 = this.currentMessageObject;
                                                                if (messageObject2 != null) {
                                                                }
                                                                if (messageIdChanged) {
                                                                }
                                                                transcribeButton = this.transcribeButton;
                                                                if (transcribeButton != null) {
                                                                }
                                                                updateWaveform();
                                                                updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                                                if (!this.currentMessageObject.loadingCancelled) {
                                                                }
                                                                chatMessageCellDelegate = this.delegate;
                                                                if (chatMessageCellDelegate != null) {
                                                                }
                                                                this.accessibilityVirtualViewBounds.clear();
                                                                this.transitionParams.updatePhotoImageX = true;
                                                                updateFlagSecure();
                                                            }
                                                        }
                                                        if (lineLeft5 > 0) {
                                                            width5 = textWidth - lineLeft5;
                                                            restLinesCount2 = restLinesCount;
                                                            linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                                        } else if (hasRTL) {
                                                            width5 = textWidth;
                                                            restLinesCount2 = restLinesCount;
                                                            linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                                        } else {
                                                            restLinesCount2 = restLinesCount;
                                                            linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                                            try {
                                                                width5 = Math.min((int) Math.ceil(this.descriptionLayout.getLineWidth(a4)), textWidth);
                                                            } catch (Exception e30) {
                                                                e6 = e30;
                                                                maxChildWidth3 = maxChildWidth4;
                                                                maxWebWidth2 = maxWebWidth3;
                                                                FileLog.e(e6);
                                                                maxWebWidth = maxWebWidth2;
                                                                if (smallImage2) {
                                                                }
                                                                if (smallImage2) {
                                                                }
                                                                if (document4 != null) {
                                                                }
                                                                f = 0.0f;
                                                                additionHeight = str5;
                                                                r14 = z11;
                                                                if (this.currentPosition == null) {
                                                                }
                                                                if (!messageObject.isAnyKindOfSticker()) {
                                                                }
                                                                c = 2;
                                                                i3 = 0;
                                                                z4 = z19;
                                                                i = i3;
                                                                groupedMessagePosition = this.currentPosition;
                                                                if (groupedMessagePosition != null) {
                                                                }
                                                                this.totalHeight += AndroidUtilities.dp(14.0f);
                                                                if (this.currentMessageObject.eventId == 0) {
                                                                }
                                                                if (messageObject.isSponsored()) {
                                                                }
                                                                this.botButtons.clear();
                                                                if (messageIdChanged) {
                                                                }
                                                                if (!messageObject6.isRestrictedMessage) {
                                                                }
                                                                this.substractBackgroundHeight = 0;
                                                                this.keyboardHeight = 0;
                                                                if (this.drawCommentButton) {
                                                                }
                                                                z5 = this.drawPinnedBottom;
                                                                if (!z5) {
                                                                }
                                                                if (z5) {
                                                                }
                                                                if (!messageObject.isAnyKindOfSticker()) {
                                                                }
                                                                if (messageObject.isAnimatedEmoji()) {
                                                                }
                                                                if (!this.drawPhotoImage) {
                                                                }
                                                                if (this.documentAttachType != 5) {
                                                                }
                                                                if (autoDownload) {
                                                                }
                                                                messageObject2 = this.currentMessageObject;
                                                                if (messageObject2 != null) {
                                                                }
                                                                if (messageIdChanged) {
                                                                }
                                                                transcribeButton = this.transcribeButton;
                                                                if (transcribeButton != null) {
                                                                }
                                                                updateWaveform();
                                                                updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                                                if (!this.currentMessageObject.loadingCancelled) {
                                                                }
                                                                chatMessageCellDelegate = this.delegate;
                                                                if (chatMessageCellDelegate != null) {
                                                                }
                                                                this.accessibilityVirtualViewBounds.clear();
                                                                this.transitionParams.updatePhotoImageX = true;
                                                                updateFlagSecure();
                                                            }
                                                        }
                                                        if (a4 < restLines2 || (restLines2 != 0 && lineLeft5 != 0 && this.isSmallImage)) {
                                                            width5 += smallImageSide + smallSideMargin;
                                                        }
                                                        if (maxWebWidth3 < width5 + additinalWidth2) {
                                                            if (titleIsRTL) {
                                                                this.titleX += (width5 + additinalWidth2) - maxWebWidth3;
                                                            }
                                                            if (authorIsRTL) {
                                                                this.authorX += (width5 + additinalWidth2) - maxWebWidth3;
                                                            }
                                                            maxWebWidth3 = width5 + additinalWidth2;
                                                        }
                                                        maxChildWidth4 = Math.max(maxChildWidth4, width5 + additinalWidth2);
                                                        a4++;
                                                        allowAllLines = allowAllLines2;
                                                        height9 = height10;
                                                        linkPreviewMaxWidth3 = linkPreviewMaxWidth4;
                                                        restLinesCount = restLinesCount2;
                                                    } catch (Exception e31) {
                                                        restLinesCount2 = restLinesCount;
                                                        linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                                        e6 = e31;
                                                        maxChildWidth3 = maxChildWidth4;
                                                        maxWebWidth2 = maxWebWidth3;
                                                    }
                                                }
                                                restLinesCount2 = restLinesCount;
                                                linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                                maxChildWidth3 = maxChildWidth4;
                                                maxWebWidth = maxWebWidth3;
                                            } catch (Exception e32) {
                                                e6 = e32;
                                                restLinesCount2 = restLinesCount;
                                                linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                                FileLog.e(e6);
                                                maxWebWidth = maxWebWidth2;
                                                if (smallImage2) {
                                                }
                                                if (smallImage2) {
                                                }
                                                if (document4 != null) {
                                                }
                                                f = 0.0f;
                                                additionHeight = str5;
                                                r14 = z11;
                                                if (this.currentPosition == null) {
                                                }
                                                if (!messageObject.isAnyKindOfSticker()) {
                                                }
                                                c = 2;
                                                i3 = 0;
                                                z4 = z19;
                                                i = i3;
                                                groupedMessagePosition = this.currentPosition;
                                                if (groupedMessagePosition != null) {
                                                }
                                                this.totalHeight += AndroidUtilities.dp(14.0f);
                                                if (this.currentMessageObject.eventId == 0) {
                                                }
                                                if (messageObject.isSponsored()) {
                                                }
                                                this.botButtons.clear();
                                                if (messageIdChanged) {
                                                }
                                                if (!messageObject6.isRestrictedMessage) {
                                                }
                                                this.substractBackgroundHeight = 0;
                                                this.keyboardHeight = 0;
                                                if (this.drawCommentButton) {
                                                }
                                                z5 = this.drawPinnedBottom;
                                                if (!z5) {
                                                }
                                                if (z5) {
                                                }
                                                if (!messageObject.isAnyKindOfSticker()) {
                                                }
                                                if (messageObject.isAnimatedEmoji()) {
                                                }
                                                if (!this.drawPhotoImage) {
                                                }
                                                if (this.documentAttachType != 5) {
                                                }
                                                if (autoDownload) {
                                                }
                                                messageObject2 = this.currentMessageObject;
                                                if (messageObject2 != null) {
                                                }
                                                if (messageIdChanged) {
                                                }
                                                transcribeButton = this.transcribeButton;
                                                if (transcribeButton != null) {
                                                }
                                                updateWaveform();
                                                updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                                if (!this.currentMessageObject.loadingCancelled) {
                                                }
                                                chatMessageCellDelegate = this.delegate;
                                                if (chatMessageCellDelegate != null) {
                                                }
                                                this.accessibilityVirtualViewBounds.clear();
                                                this.transitionParams.updatePhotoImageX = true;
                                                updateFlagSecure();
                                            }
                                        }
                                    }
                                    int textWidth2 = this.descriptionLayout.getWidth();
                                    a4 = 0;
                                    int maxWebWidth32 = maxWebWidth2;
                                    int maxChildWidth42 = maxChildWidth;
                                    while (a4 < this.descriptionLayout.getLineCount()) {
                                    }
                                    restLinesCount2 = restLinesCount;
                                    linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                    maxChildWidth3 = maxChildWidth42;
                                    maxWebWidth = maxWebWidth32;
                                } catch (Exception e33) {
                                    restLinesCount2 = restLinesCount;
                                    linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                    e6 = e33;
                                    maxChildWidth3 = maxChildWidth;
                                }
                                this.descriptionLayout = generateStaticLayout(messageObject5.linkDescription, Theme.chat_replyTextPaint, linkPreviewMaxWidth3, (linkPreviewMaxWidth3 - smallImageSide) - smallSideMargin, restLinesCount, allowAllLines ? 100 : 6);
                                StaticLayout staticLayout62 = this.descriptionLayout;
                                int height92 = staticLayout62.getLineBottom(staticLayout62.getLineCount() - 1);
                                this.linkPreviewHeight += height92;
                                this.totalHeight += height92;
                                boolean hasRTL2 = false;
                                a3 = 0;
                                while (a3 < this.descriptionLayout.getLineCount()) {
                                }
                                maxChildWidth = maxChildWidth3;
                            } catch (Exception e34) {
                                e7 = e34;
                                restLinesCount2 = restLinesCount;
                                linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                                e6 = e7;
                                FileLog.e(e6);
                                maxWebWidth = maxWebWidth2;
                                if (smallImage2) {
                                }
                                if (smallImage2) {
                                }
                                if (document4 != null) {
                                }
                                f = 0.0f;
                                additionHeight = str5;
                                r14 = z11;
                                if (this.currentPosition == null) {
                                }
                                if (!messageObject.isAnyKindOfSticker()) {
                                }
                                c = 2;
                                i3 = 0;
                                z4 = z19;
                                i = i3;
                                groupedMessagePosition = this.currentPosition;
                                if (groupedMessagePosition != null) {
                                }
                                this.totalHeight += AndroidUtilities.dp(14.0f);
                                if (this.currentMessageObject.eventId == 0) {
                                }
                                if (messageObject.isSponsored()) {
                                }
                                this.botButtons.clear();
                                if (messageIdChanged) {
                                }
                                if (!messageObject6.isRestrictedMessage) {
                                }
                                this.substractBackgroundHeight = 0;
                                this.keyboardHeight = 0;
                                if (this.drawCommentButton) {
                                }
                                z5 = this.drawPinnedBottom;
                                if (!z5) {
                                }
                                if (z5) {
                                }
                                if (!messageObject.isAnyKindOfSticker()) {
                                }
                                if (messageObject.isAnimatedEmoji()) {
                                }
                                if (!this.drawPhotoImage) {
                                }
                                if (this.documentAttachType != 5) {
                                }
                                if (autoDownload) {
                                }
                                messageObject2 = this.currentMessageObject;
                                if (messageObject2 != null) {
                                }
                                if (messageIdChanged) {
                                }
                                transcribeButton = this.transcribeButton;
                                if (transcribeButton != null) {
                                }
                                updateWaveform();
                                updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                if (!this.currentMessageObject.loadingCancelled) {
                                }
                                chatMessageCellDelegate = this.delegate;
                                if (chatMessageCellDelegate != null) {
                                }
                                this.accessibilityVirtualViewBounds.clear();
                                this.transitionParams.updatePhotoImageX = true;
                                updateFlagSecure();
                            }
                            messageObject5 = messageObject;
                            restLines2 = restLinesCount;
                        } else {
                            messageObject5 = messageObject;
                            restLinesCount2 = restLinesCount;
                            linkPreviewMaxWidth4 = linkPreviewMaxWidth3;
                            maxWebWidth = maxWebWidth2;
                        }
                        if (smallImage2 && this.descriptionLayout == null && this.titleLayout == null) {
                            this.isSmallImage = false;
                            smallImage2 = false;
                        }
                        int maxPhotoWidth3 = smallImage2 ? smallImageSide : linkPreviewMaxWidth4;
                        if (document4 != null) {
                            if (MessageObject.isRoundVideoDocument(document4)) {
                                document5 = document4;
                                this.currentPhotoObject = FileLoader.getClosestPhotoSizeWithSize(document5.thumbs, 90);
                                this.photoParentObject = document5;
                                this.documentAttach = document5;
                                this.documentAttachType = 7;
                                maxPhotoWidth = maxPhotoWidth3;
                                webDocument2 = webDocument4;
                                type3 = type2;
                                timeMore2 = timeMore;
                                maxWidth10 = maxWidth5;
                                photo3 = photo2;
                            } else {
                                document5 = document4;
                                if (MessageObject.isGifDocument(document5, messageObject.hasValidGroupId())) {
                                    if (messageObject.isGame() || SharedConfig.autoplayGifs) {
                                        f4 = 1.0f;
                                    } else {
                                        f4 = 1.0f;
                                        messageObject5.gifState = 1.0f;
                                    }
                                    this.photoImage.setAllowStartAnimation(messageObject5.gifState != f4);
                                    TLRPC.PhotoSize closestPhotoSizeWithSize = FileLoader.getClosestPhotoSizeWithSize(document5.thumbs, 90);
                                    this.currentPhotoObject = closestPhotoSizeWithSize;
                                    if (closestPhotoSizeWithSize != null) {
                                        this.photoParentObject = document5;
                                        photo3 = photo2;
                                    } else if (photo2 != null) {
                                        photo3 = photo2;
                                        this.currentPhotoObject = FileLoader.getClosestPhotoSizeWithSize(photo3.sizes, 90);
                                        this.photoParentObject = photo3;
                                    } else {
                                        photo3 = photo2;
                                    }
                                    TLRPC.PhotoSize photoSize8 = this.currentPhotoObject;
                                    if (photoSize8 != null && (photoSize8.w == 0 || this.currentPhotoObject.h == 0)) {
                                        for (int a12 = 0; a12 < document5.attributes.size(); a12++) {
                                            TLRPC.DocumentAttribute attribute2 = document5.attributes.get(a12);
                                            if ((attribute2 instanceof TLRPC.TL_documentAttributeImageSize) || (attribute2 instanceof TLRPC.TL_documentAttributeVideo)) {
                                                this.currentPhotoObject.w = attribute2.w;
                                                this.currentPhotoObject.h = attribute2.h;
                                                break;
                                            }
                                        }
                                        if (this.currentPhotoObject.w == 0 || this.currentPhotoObject.h == 0) {
                                            TLRPC.PhotoSize photoSize9 = this.currentPhotoObject;
                                            int dp3 = AndroidUtilities.dp(150.0f);
                                            photoSize9.h = dp3;
                                            photoSize9.w = dp3;
                                        }
                                    }
                                    this.documentAttach = document5;
                                    this.documentAttachType = 2;
                                    maxPhotoWidth = maxPhotoWidth3;
                                    webDocument2 = webDocument4;
                                    type3 = type2;
                                    timeMore2 = timeMore;
                                    maxWidth10 = maxWidth5;
                                } else {
                                    photo3 = photo2;
                                    if (MessageObject.isVideoDocument(document5)) {
                                        if (photo3 != null) {
                                            this.currentPhotoObject = FileLoader.getClosestPhotoSizeWithSize(photo3.sizes, AndroidUtilities.getPhotoSize(), true);
                                            this.currentPhotoObjectThumb = FileLoader.getClosestPhotoSizeWithSize(photo3.sizes, 40);
                                            this.photoParentObject = photo3;
                                        }
                                        if (this.currentPhotoObject == null) {
                                            this.currentPhotoObject = FileLoader.getClosestPhotoSizeWithSize(document5.thumbs, GroupCallActivity.TABLET_LIST_SIZE);
                                            this.currentPhotoObjectThumb = FileLoader.getClosestPhotoSizeWithSize(document5.thumbs, 40);
                                            this.photoParentObject = document5;
                                        }
                                        if (this.currentPhotoObject == this.currentPhotoObjectThumb) {
                                            photoSize7 = null;
                                            this.currentPhotoObjectThumb = null;
                                        } else {
                                            photoSize7 = null;
                                        }
                                        if (this.currentMessageObject.strippedThumb != null) {
                                            this.currentPhotoObjectThumb = photoSize7;
                                            this.currentPhotoObjectThumbStripped = this.currentMessageObject.strippedThumb;
                                        }
                                        if (this.currentPhotoObject == null) {
                                            TLRPC.TL_photoSize tL_photoSize = new TLRPC.TL_photoSize();
                                            this.currentPhotoObject = tL_photoSize;
                                            tL_photoSize.type = "s";
                                            this.currentPhotoObject.location = new TLRPC.TL_fileLocationUnavailable();
                                        }
                                        TLRPC.PhotoSize photoSize10 = this.currentPhotoObject;
                                        if (photoSize10 != null && (photoSize10.w == 0 || this.currentPhotoObject.h == 0 || (this.currentPhotoObject instanceof TLRPC.TL_photoStrippedSize))) {
                                            int a13 = 0;
                                            while (true) {
                                                if (a13 >= document5.attributes.size()) {
                                                    break;
                                                }
                                                TLRPC.DocumentAttribute attribute3 = document5.attributes.get(a13);
                                                if (attribute3 instanceof TLRPC.TL_documentAttributeVideo) {
                                                    TLRPC.PhotoSize photoSize11 = this.currentPhotoObject;
                                                    if (photoSize11 instanceof TLRPC.TL_photoStrippedSize) {
                                                        float scale2 = Math.max(attribute3.w, attribute3.w) / 50.0f;
                                                        this.currentPhotoObject.w = (int) (attribute3.w / scale2);
                                                        this.currentPhotoObject.h = (int) (attribute3.h / scale2);
                                                    } else {
                                                        photoSize11.w = attribute3.w;
                                                        this.currentPhotoObject.h = attribute3.h;
                                                    }
                                                } else {
                                                    a13++;
                                                }
                                            }
                                            if (this.currentPhotoObject.w == 0 || this.currentPhotoObject.h == 0) {
                                                TLRPC.PhotoSize photoSize12 = this.currentPhotoObject;
                                                int dp4 = AndroidUtilities.dp(150.0f);
                                                photoSize12.h = dp4;
                                                photoSize12.w = dp4;
                                            }
                                        }
                                        createDocumentLayout(0, messageObject5);
                                        maxPhotoWidth = maxPhotoWidth3;
                                        webDocument2 = webDocument4;
                                        type3 = type2;
                                        timeMore2 = timeMore;
                                        maxWidth10 = maxWidth5;
                                    } else {
                                        if (MessageObject.isStickerDocument(document5)) {
                                            maxPhotoWidth = maxPhotoWidth3;
                                            timeMore2 = timeMore;
                                            maxWidth10 = maxWidth5;
                                        } else if (MessageObject.isAnimatedStickerDocument(document5, true)) {
                                            maxPhotoWidth = maxPhotoWidth3;
                                            timeMore2 = timeMore;
                                            maxWidth10 = maxWidth5;
                                        } else {
                                            int i33 = this.drawInstantViewType;
                                            if (i33 == 6) {
                                                TLRPC.PhotoSize closestPhotoSizeWithSize2 = FileLoader.getClosestPhotoSizeWithSize(document5.thumbs, GroupCallActivity.TABLET_LIST_SIZE);
                                                this.currentPhotoObject = closestPhotoSizeWithSize2;
                                                this.photoParentObject = document5;
                                                if (closestPhotoSizeWithSize2 != null && (closestPhotoSizeWithSize2.w == 0 || this.currentPhotoObject.h == 0)) {
                                                    int a14 = 0;
                                                    while (true) {
                                                        if (a14 >= document5.attributes.size()) {
                                                            break;
                                                        }
                                                        TLRPC.DocumentAttribute attribute4 = document5.attributes.get(a14);
                                                        if (attribute4 instanceof TLRPC.TL_documentAttributeImageSize) {
                                                            this.currentPhotoObject.w = attribute4.w;
                                                            this.currentPhotoObject.h = attribute4.h;
                                                            break;
                                                        }
                                                        a14++;
                                                    }
                                                    if (this.currentPhotoObject.w == 0 || this.currentPhotoObject.h == 0) {
                                                        TLRPC.PhotoSize photoSize13 = this.currentPhotoObject;
                                                        int dp5 = AndroidUtilities.dp(150.0f);
                                                        photoSize13.h = dp5;
                                                        photoSize13.w = dp5;
                                                    }
                                                }
                                                this.documentAttach = document5;
                                                this.documentAttachType = 8;
                                                String str14 = AndroidUtilities.formatFileSize(document5.size);
                                                this.durationWidth = (int) Math.ceil(Theme.chat_durationPaint.measureText(str14));
                                                this.videoInfoLayout = new StaticLayout(str14, Theme.chat_durationPaint, this.durationWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                                maxPhotoWidth = maxPhotoWidth3;
                                                webDocument2 = webDocument4;
                                                type3 = type2;
                                                timeMore2 = timeMore;
                                                maxWidth10 = maxWidth5;
                                            } else if (i33 == 7) {
                                                this.currentPhotoObject = FileLoader.getClosestPhotoSizeWithSize(document5.thumbs, 700);
                                                if (this.currentMessageObject.strippedThumb == null) {
                                                    this.currentPhotoObjectThumb = FileLoader.getClosestPhotoSizeWithSize(document5.thumbs, 40);
                                                } else {
                                                    this.currentPhotoObjectThumbStripped = this.currentMessageObject.strippedThumb;
                                                }
                                                this.photoParentObject = document5;
                                                TLRPC.PhotoSize photoSize14 = this.currentPhotoObject;
                                                if (photoSize14 != null && (photoSize14.w == 0 || this.currentPhotoObject.h == 0)) {
                                                    int a15 = 0;
                                                    while (true) {
                                                        if (a15 >= document5.attributes.size()) {
                                                            break;
                                                        }
                                                        TLRPC.DocumentAttribute attribute5 = document5.attributes.get(a15);
                                                        if (attribute5 instanceof TLRPC.TL_documentAttributeImageSize) {
                                                            this.currentPhotoObject.w = attribute5.w;
                                                            this.currentPhotoObject.h = attribute5.h;
                                                            break;
                                                        }
                                                        a15++;
                                                    }
                                                    if (this.currentPhotoObject.w == 0 || this.currentPhotoObject.h == 0) {
                                                        TLRPC.PhotoSize photoSize15 = this.currentPhotoObject;
                                                        int dp6 = AndroidUtilities.dp(150.0f);
                                                        photoSize15.h = dp6;
                                                        photoSize15.w = dp6;
                                                    }
                                                }
                                                this.documentAttach = document5;
                                                this.documentAttachType = 9;
                                                maxPhotoWidth = maxPhotoWidth3;
                                                webDocument2 = webDocument4;
                                                type3 = type2;
                                                timeMore2 = timeMore;
                                                maxWidth10 = maxWidth5;
                                            } else {
                                                timeMore2 = timeMore;
                                                maxWidth10 = maxWidth5;
                                                calcBackgroundWidth(maxWidth10, timeMore2, maxChildWidth3);
                                                if (this.backgroundWidth < AndroidUtilities.dp(20.0f) + maxWidth10) {
                                                    this.backgroundWidth = AndroidUtilities.dp(20.0f) + maxWidth10;
                                                }
                                                if (MessageObject.isVoiceDocument(document5)) {
                                                    createDocumentLayout(this.backgroundWidth - AndroidUtilities.dp(10.0f), messageObject5);
                                                    this.mediaOffsetY = this.currentMessageObject.textHeight + AndroidUtilities.dp(8.0f) + this.linkPreviewHeight;
                                                    this.totalHeight += AndroidUtilities.dp(44.0f);
                                                    this.linkPreviewHeight += AndroidUtilities.dp(44.0f);
                                                    int maxWidth13 = maxWidth10 - AndroidUtilities.dp(86.0f);
                                                    maxChildWidth3 = AndroidUtilities.isTablet() ? Math.max(maxChildWidth3, (Math.min(AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(drawAvatar ? 52.0f : 0.0f), AndroidUtilities.dp(220.0f)) - AndroidUtilities.dp(30.0f)) + additinalWidth2) : Math.max(maxChildWidth3, (Math.min(getParentWidth() - AndroidUtilities.dp(drawAvatar ? 52.0f : 0.0f), AndroidUtilities.dp(220.0f)) - AndroidUtilities.dp(30.0f)) + additinalWidth2);
                                                    calcBackgroundWidth(maxWidth13, timeMore2, maxChildWidth3);
                                                    maxPhotoWidth = maxPhotoWidth3;
                                                    maxWidth7 = maxWidth13;
                                                    webDocument2 = webDocument4;
                                                    type3 = type2;
                                                } else if (MessageObject.isMusicDocument(document5)) {
                                                    int durationWidth = createDocumentLayout(this.backgroundWidth - AndroidUtilities.dp(10.0f), messageObject5);
                                                    this.mediaOffsetY = this.currentMessageObject.textHeight + AndroidUtilities.dp(8.0f) + this.linkPreviewHeight;
                                                    this.totalHeight += AndroidUtilities.dp(56.0f);
                                                    this.linkPreviewHeight += AndroidUtilities.dp(56.0f);
                                                    int maxWidth14 = maxWidth10 - AndroidUtilities.dp(86.0f);
                                                    maxChildWidth3 = Math.max(maxChildWidth3, durationWidth + additinalWidth2 + AndroidUtilities.dp(94.0f));
                                                    StaticLayout staticLayout7 = this.songLayout;
                                                    if (staticLayout7 != null && staticLayout7.getLineCount() > 0) {
                                                        maxChildWidth3 = (int) Math.max(maxChildWidth3, this.songLayout.getLineWidth(0) + additinalWidth2 + AndroidUtilities.dp(86.0f));
                                                    }
                                                    StaticLayout staticLayout8 = this.performerLayout;
                                                    if (staticLayout8 != null && staticLayout8.getLineCount() > 0) {
                                                        maxChildWidth3 = (int) Math.max(maxChildWidth3, this.performerLayout.getLineWidth(0) + additinalWidth2 + AndroidUtilities.dp(86.0f));
                                                    }
                                                    calcBackgroundWidth(maxWidth14, timeMore2, maxChildWidth3);
                                                    maxPhotoWidth = maxPhotoWidth3;
                                                    maxWidth7 = maxWidth14;
                                                    webDocument2 = webDocument4;
                                                    type3 = type2;
                                                } else {
                                                    createDocumentLayout(this.backgroundWidth - AndroidUtilities.dp(168.0f), messageObject5);
                                                    this.drawImageButton = true;
                                                    if (this.drawPhotoImage) {
                                                        this.totalHeight += AndroidUtilities.dp(100.0f);
                                                        this.linkPreviewHeight += AndroidUtilities.dp(86.0f);
                                                        maxPhotoWidth = maxPhotoWidth3;
                                                        this.photoImage.setImageCoords(0.0f, this.totalHeight + this.namesOffset, AndroidUtilities.dp(86.0f), AndroidUtilities.dp(86.0f));
                                                        webDocument2 = webDocument4;
                                                        type3 = type2;
                                                    } else {
                                                        maxPhotoWidth = maxPhotoWidth3;
                                                        this.mediaOffsetY = this.currentMessageObject.textHeight + AndroidUtilities.dp(8.0f) + this.linkPreviewHeight;
                                                        this.photoImage.setImageCoords(0.0f, (this.totalHeight + this.namesOffset) - AndroidUtilities.dp(14.0f), AndroidUtilities.dp(56.0f), AndroidUtilities.dp(56.0f));
                                                        this.totalHeight += AndroidUtilities.dp(64.0f);
                                                        this.linkPreviewHeight += AndroidUtilities.dp(50.0f);
                                                        StaticLayout staticLayout9 = this.docTitleLayout;
                                                        if (staticLayout9 == null || staticLayout9.getLineCount() <= 1) {
                                                            webDocument2 = webDocument4;
                                                            type3 = type2;
                                                        } else {
                                                            int h6 = (this.docTitleLayout.getLineCount() - 1) * AndroidUtilities.dp(16.0f);
                                                            this.totalHeight += h6;
                                                            this.linkPreviewHeight += h6;
                                                            webDocument2 = webDocument4;
                                                            type3 = type2;
                                                        }
                                                    }
                                                }
                                                i12 = this.documentAttachType;
                                                if (i12 != 5 || i12 == 3 || i12 == 1) {
                                                    z12 = true;
                                                    messageObject6 = messageObject5;
                                                    str6 = type3;
                                                } else {
                                                    if (this.currentPhotoObject == null && webDocument2 == null && i12 != 8) {
                                                        if (i12 != 9) {
                                                            this.photoImage.setImageBitmap((Drawable) null);
                                                            this.linkPreviewHeight -= AndroidUtilities.dp(6.0f);
                                                            this.totalHeight += AndroidUtilities.dp(4.0f);
                                                            maxWidth8 = maxWidth7;
                                                            timeMore3 = timeMore2;
                                                            z13 = true;
                                                            messageObject6 = messageObject5;
                                                            str7 = type3;
                                                            if (!this.hasInvoicePreview) {
                                                                CharSequence str15 = (messageObject6.messageOwner.media.flags & 4) != 0 ? LocaleController.getString("PaymentReceipt", R.string.PaymentReceipt).toUpperCase() : messageObject6.messageOwner.media.test ? LocaleController.getString("PaymentTestInvoice", R.string.PaymentTestInvoice).toUpperCase() : LocaleController.getString("PaymentInvoice", R.string.PaymentInvoice).toUpperCase();
                                                                String price = LocaleController.getInstance().formatCurrencyString(messageObject6.messageOwner.media.total_amount, messageObject6.messageOwner.media.currency);
                                                                SpannableStringBuilder stringBuilder = new SpannableStringBuilder(price + " " + ((Object) str15));
                                                                stringBuilder.setSpan(new TypefaceSpan(AndroidUtilities.getTypeface(AndroidUtilities.TYPEFACE_ROBOTO_MEDIUM)), 0, price.length(), 33);
                                                                this.durationWidth = (int) Math.ceil((double) Theme.chat_shipmentPaint.measureText(stringBuilder, 0, stringBuilder.length()));
                                                                TextPaint textPaint = Theme.chat_shipmentPaint;
                                                                int i34 = this.durationWidth;
                                                                this.videoInfoLayout = new StaticLayout(stringBuilder, textPaint, i34 + AndroidUtilities.dp(10.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                                                if (!this.drawPhotoImage) {
                                                                    this.totalHeight += AndroidUtilities.dp(6.0f);
                                                                    int timeWidthTotal3 = this.timeWidth + AndroidUtilities.dp((messageObject.isOutOwner() ? 20 : 0) + 14);
                                                                    int i35 = this.durationWidth;
                                                                    maxWidth9 = maxWidth8;
                                                                    if (i35 + timeWidthTotal3 > maxWidth9) {
                                                                        maxChildWidth3 = Math.max(i35, maxChildWidth3);
                                                                        int dp7 = this.totalHeight + AndroidUtilities.dp(12.0f);
                                                                        this.totalHeight = dp7;
                                                                        str8 = dp7;
                                                                    } else {
                                                                        int i36 = i35 + timeWidthTotal3;
                                                                        maxChildWidth3 = Math.max(i36, maxChildWidth3);
                                                                        str8 = i36;
                                                                    }
                                                                } else {
                                                                    maxWidth9 = maxWidth8;
                                                                    str8 = i34;
                                                                }
                                                            } else {
                                                                maxWidth9 = maxWidth8;
                                                                str8 = str7;
                                                            }
                                                            if (this.hasGamePreview && messageObject6.textHeight != 0) {
                                                                this.linkPreviewHeight += messageObject6.textHeight + AndroidUtilities.dp(6.0f);
                                                                this.totalHeight += AndroidUtilities.dp(4.0f);
                                                            }
                                                            calcBackgroundWidth(maxWidth9, timeMore3, maxChildWidth3);
                                                            str6 = str8;
                                                            z12 = z13;
                                                        }
                                                    }
                                                    this.drawImageButton = (photo3 != null && !smallImage2) || (type3 != null && (type3.equals("photo") || ((type3.equals("document") && this.documentAttachType != 6) || type3.equals("gif") || (i13 = this.documentAttachType) == 4 || i13 == 8)));
                                                    int i37 = this.linkPreviewHeight;
                                                    if (i37 != 0) {
                                                        this.linkPreviewHeight = i37 + AndroidUtilities.dp(2.0f);
                                                        this.totalHeight += AndroidUtilities.dp(2.0f);
                                                    }
                                                    if (this.imageBackgroundSideColor != 0) {
                                                        maxPhotoWidth2 = AndroidUtilities.dp(208.0f);
                                                    } else {
                                                        TLRPC.PhotoSize photoSize16 = this.currentPhotoObject;
                                                        if (!(photoSize16 instanceof TLRPC.TL_photoSizeEmpty) || photoSize16.w == 0) {
                                                            int maxPhotoWidth4 = this.documentAttachType;
                                                            if (maxPhotoWidth4 == 6 || maxPhotoWidth4 == 8 || maxPhotoWidth4 == 9) {
                                                                maxPhotoWidth2 = AndroidUtilities.isTablet() ? (int) (AndroidUtilities.getMinTabletSide() * 0.5f) : (int) (getParentWidth() * 0.5f);
                                                            } else if (maxPhotoWidth4 == 7) {
                                                                maxPhotoWidth2 = AndroidUtilities.roundMessageSize;
                                                                this.photoImage.setAllowDecodeSingleFrame(true);
                                                            } else {
                                                                maxPhotoWidth2 = maxPhotoWidth;
                                                            }
                                                        } else {
                                                            maxPhotoWidth2 = this.currentPhotoObject.w;
                                                        }
                                                    }
                                                    int maxPhotoWidth5 = (!this.hasInvoicePreview || maxPhotoWidth2 >= messageObject5.textWidth) ? maxPhotoWidth2 : messageObject5.textWidth + AndroidUtilities.dp(22.0f);
                                                    int maxChildWidth5 = Math.max(maxChildWidth3, (maxPhotoWidth5 - (this.hasInvoicePreview ? AndroidUtilities.dp(12.0f) : 0)) + additinalWidth2);
                                                    TLRPC.PhotoSize photoSize17 = this.currentPhotoObject;
                                                    if (photoSize17 != null) {
                                                        photoSize17.size = -1;
                                                        TLRPC.PhotoSize photoSize18 = this.currentPhotoObjectThumb;
                                                        if (photoSize18 != null) {
                                                            photoSize18.size = -1;
                                                        }
                                                    } else if (webDocument2 != null) {
                                                        webDocument2.size = -1;
                                                    }
                                                    if (this.imageBackgroundSideColor != 0) {
                                                        this.imageBackgroundSideWidth = maxChildWidth5 - AndroidUtilities.dp(13.0f);
                                                    }
                                                    if (!smallImage2 && this.documentAttachType != 7) {
                                                        if (!this.hasGamePreview && !this.hasInvoicePreview) {
                                                            if (this.drawInstantViewType == 7) {
                                                                width4 = 560;
                                                                height4 = 678;
                                                            } else {
                                                                TLRPC.PhotoSize photoSize19 = this.currentPhotoObject;
                                                                if (photoSize19 != null) {
                                                                    width4 = photoSize19.w;
                                                                    height4 = this.currentPhotoObject.h;
                                                                } else {
                                                                    width4 = 30;
                                                                    height4 = 50;
                                                                }
                                                            }
                                                            float scale3 = width4 / (maxPhotoWidth5 - AndroidUtilities.dp(2.0f));
                                                            int width11 = (int) (width4 / scale3);
                                                            int height11 = (int) (height4 / scale3);
                                                            if (site_name5 != null) {
                                                                if (site_name5 != null) {
                                                                    scale = scale3;
                                                                    if (!site_name5.toLowerCase().equals("instagram")) {
                                                                    }
                                                                } else {
                                                                    scale = scale3;
                                                                }
                                                                if (height11 > AndroidUtilities.displaySize.y / 2) {
                                                                    height11 = AndroidUtilities.displaySize.y / 2;
                                                                }
                                                                if (this.imageBackgroundSideColor == 0) {
                                                                    float scale4 = height11 / AndroidUtilities.dp(160.0f);
                                                                    width11 = (int) (width11 / scale4);
                                                                    height11 = (int) (height11 / scale4);
                                                                }
                                                                if (height11 >= AndroidUtilities.dp(60.0f)) {
                                                                    width2 = width11;
                                                                    height2 = AndroidUtilities.dp(60.0f);
                                                                } else {
                                                                    width2 = width11;
                                                                    height2 = height11;
                                                                }
                                                                if (!this.isSmallImage) {
                                                                    if (AndroidUtilities.dp(50.0f) > this.linkPreviewHeight) {
                                                                        additinalWidth = additinalWidth2;
                                                                        this.totalHeight += (AndroidUtilities.dp(50.0f) - this.linkPreviewHeight) + AndroidUtilities.dp(8.0f);
                                                                        this.linkPreviewHeight = AndroidUtilities.dp(50.0f);
                                                                    } else {
                                                                        additinalWidth = additinalWidth2;
                                                                    }
                                                                    this.linkPreviewHeight -= AndroidUtilities.dp(8.0f);
                                                                } else {
                                                                    additinalWidth = additinalWidth2;
                                                                    this.totalHeight += AndroidUtilities.dp(12.0f) + height2;
                                                                    this.linkPreviewHeight += height2;
                                                                }
                                                                if (this.documentAttachType == 8 || this.imageBackgroundSideColor != 0) {
                                                                    type4 = type3;
                                                                    this.photoImage.setImageCoords(0.0f, 0.0f, width2, height2);
                                                                } else {
                                                                    type4 = type3;
                                                                    this.photoImage.setImageCoords(0.0f, 0.0f, Math.max(maxChildWidth5 - AndroidUtilities.dp(13.0f), width2), height2);
                                                                }
                                                                int w3 = (int) (width2 / AndroidUtilities.density);
                                                                int h7 = (int) (height2 / AndroidUtilities.density);
                                                                this.currentPhotoFilter = String.format(Locale.US, "%d_%d", Integer.valueOf(w3), Integer.valueOf(h7));
                                                                this.currentPhotoFilterThumb = String.format(Locale.US, "%d_%d_b", Integer.valueOf(w3), Integer.valueOf(h7));
                                                                if (webDocument2 == null) {
                                                                    maxWidth8 = maxWidth7;
                                                                    type5 = type4;
                                                                    str10 = 0;
                                                                    this.photoImage.setImage(ImageLocation.getForWebFile(webDocument2), this.currentPhotoFilter, null, null, webDocument2.size, null, messageObject, 1);
                                                                    messageObject6 = messageObject5;
                                                                    document6 = document5;
                                                                    timeMore3 = timeMore2;
                                                                } else {
                                                                    maxWidth8 = maxWidth7;
                                                                    int timeMore6 = timeMore2;
                                                                    type5 = type4;
                                                                    TLRPC.Document document13 = document5;
                                                                    int i38 = this.documentAttachType;
                                                                    if (i38 == 8) {
                                                                        if (messageObject5.mediaExists) {
                                                                            this.photoImage.setImage(ImageLocation.getForDocument(this.documentAttach), this.currentPhotoFilter, ImageLocation.getForDocument(this.currentPhotoObject, document13), "b1", 0L, "jpg", messageObject, 1);
                                                                            messageObject6 = messageObject5;
                                                                            document6 = document13;
                                                                            timeMore3 = timeMore6;
                                                                            str10 = "jpg";
                                                                        } else {
                                                                            this.photoImage.setImage(null, null, ImageLocation.getForDocument(this.currentPhotoObject, document13), "b1", 0L, "jpg", messageObject, 1);
                                                                            messageObject6 = messageObject5;
                                                                            document6 = document13;
                                                                            timeMore3 = timeMore6;
                                                                            str10 = "jpg";
                                                                        }
                                                                    } else if (i38 != 9) {
                                                                        messageObject6 = messageObject5;
                                                                        timeMore3 = timeMore6;
                                                                        if (i38 == 6) {
                                                                            boolean isWebpSticker = messageObject.isSticker();
                                                                            if (!SharedConfig.loopStickers && messageObject.isVideoSticker()) {
                                                                                this.photoImage.animatedFileDrawableRepeatMaxCount = 1;
                                                                            }
                                                                            if (!SharedConfig.loopStickers && (!isWebpSticker || messageObject.isVideoSticker())) {
                                                                                this.currentPhotoFilter = String.format(Locale.US, "%d_%d_nr_messageId=%d", Integer.valueOf(w3), Integer.valueOf(h7), Integer.valueOf(messageObject6.stableId));
                                                                                ImageReceiver imageReceiver = this.photoImage;
                                                                                ChatMessageCellDelegate chatMessageCellDelegate3 = this.delegate;
                                                                                imageReceiver.setAutoRepeat((chatMessageCellDelegate3 == null || !chatMessageCellDelegate3.shouldRepeatSticker(messageObject6)) ? 3 : 2);
                                                                                String str16 = "webp";
                                                                                this.photoImage.setImage(ImageLocation.getForDocument(this.documentAttach), this.currentPhotoFilter, ImageLocation.getForDocument(this.currentPhotoObject, this.documentAttach), "b1", this.documentAttach.size, str16, messageObject, 1);
                                                                                document6 = document13;
                                                                                str10 = str16;
                                                                            }
                                                                            this.photoImage.setAutoRepeat(1);
                                                                            String str162 = "webp";
                                                                            this.photoImage.setImage(ImageLocation.getForDocument(this.documentAttach), this.currentPhotoFilter, ImageLocation.getForDocument(this.currentPhotoObject, this.documentAttach), "b1", this.documentAttach.size, str162, messageObject, 1);
                                                                            document6 = document13;
                                                                            str10 = str162;
                                                                        } else if (i38 == 4) {
                                                                            this.photoImage.setNeedsQualityThumb(true);
                                                                            this.photoImage.setShouldGenerateQualityThumb(true);
                                                                            if (!SharedConfig.autoplayVideo) {
                                                                                document6 = document13;
                                                                            } else if (this.currentMessageObject.mediaExists || (messageObject.canStreamVideo() && DownloadController.getInstance(this.currentAccount).canDownloadMedia(this.currentMessageObject))) {
                                                                                this.photoImage.setAllowDecodeSingleFrame(true);
                                                                                this.photoImage.setAllowStartAnimation(true);
                                                                                this.photoImage.startAnimation();
                                                                                ImageReceiver imageReceiver2 = this.photoImage;
                                                                                ImageLocation forDocument = ImageLocation.getForDocument(this.documentAttach);
                                                                                ImageLocation forObject = ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject);
                                                                                String str17 = this.currentPhotoFilter;
                                                                                ImageLocation forDocument2 = ImageLocation.getForDocument(this.currentPhotoObjectThumb, this.documentAttach);
                                                                                String str18 = this.currentPhotoFilterThumb;
                                                                                BitmapDrawable bitmapDrawable = this.currentPhotoObjectThumbStripped;
                                                                                document6 = document13;
                                                                                imageReceiver2.setImage(forDocument, ImageLoader.AUTOPLAY_FILTER, forObject, str17, forDocument2, str18, bitmapDrawable, this.documentAttach.size, null, messageObject, 0);
                                                                                this.autoPlayingMedia = true;
                                                                                messageObject6 = messageObject;
                                                                                str10 = bitmapDrawable;
                                                                            } else {
                                                                                document6 = document13;
                                                                            }
                                                                            if (this.currentPhotoObjectThumb == null && this.currentPhotoObjectThumbStripped == null) {
                                                                                ImageReceiver imageReceiver3 = this.photoImage;
                                                                                ImageLocation forObject2 = ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject);
                                                                                TLRPC.PhotoSize photoSize20 = this.currentPhotoObject;
                                                                                imageReceiver3.setImage(null, null, forObject2, ((photoSize20 instanceof TLRPC.TL_photoStrippedSize) || "s".equals(photoSize20.type)) ? this.currentPhotoFilterThumb : this.currentPhotoFilter, this.currentPhotoObjectThumbStripped, 0L, null, messageObject, 0);
                                                                                messageObject6 = messageObject;
                                                                                str10 = "%d_%d_b";
                                                                            } else {
                                                                                this.photoImage.setImage(ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, 0L, null, messageObject, 0);
                                                                                messageObject6 = messageObject;
                                                                                str10 = "%d_%d_b";
                                                                            }
                                                                        } else {
                                                                            document6 = document13;
                                                                            if (i38 == 2) {
                                                                                messageObject6 = messageObject;
                                                                                z14 = true;
                                                                            } else if (i38 == 7) {
                                                                                messageObject6 = messageObject;
                                                                                z14 = true;
                                                                            } else {
                                                                                messageObject6 = messageObject;
                                                                                boolean photoExist = messageObject6.mediaExists;
                                                                                String fileName = FileLoader.getAttachFileName(this.currentPhotoObject);
                                                                                if (this.hasGamePreview || photoExist || DownloadController.getInstance(this.currentAccount).canDownloadMedia(this.currentMessageObject)) {
                                                                                    z15 = false;
                                                                                } else if (FileLoader.getInstance(this.currentAccount).isLoadingFile(fileName)) {
                                                                                    z15 = false;
                                                                                } else {
                                                                                    this.photoNotSet = true;
                                                                                    TLRPC.PhotoSize photoSize21 = this.currentPhotoObjectThumb;
                                                                                    if (photoSize21 == null && this.currentPhotoObjectThumbStripped == null) {
                                                                                        this.photoImage.setImageBitmap((Drawable) null);
                                                                                        str10 = "%d_%d_b";
                                                                                    } else {
                                                                                        this.photoImage.setImage(null, null, ImageLocation.getForObject(photoSize21, this.photoParentObject), String.format(Locale.US, "%d_%d_b", Integer.valueOf(w3), Integer.valueOf(h7)), this.currentPhotoObjectThumbStripped, 0L, null, messageObject, 0);
                                                                                        str10 = "%d_%d_b";
                                                                                    }
                                                                                }
                                                                                this.photoNotSet = z15;
                                                                                this.photoImage.setImage(ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, 0L, null, messageObject, 0);
                                                                                str10 = "%d_%d_b";
                                                                            }
                                                                            this.photoImage.setAllowDecodeSingleFrame(z14);
                                                                            if (MessageObject.isRoundVideoDocument(document6)) {
                                                                                this.photoImage.setRoundRadius(AndroidUtilities.roundMessageSize / 2);
                                                                                canChangeRadius2 = DownloadController.getInstance(this.currentAccount).canDownloadMedia(this.currentMessageObject);
                                                                                canChangeRadius = false;
                                                                                document7 = document6;
                                                                            } else {
                                                                                document7 = document6;
                                                                                if (MessageObject.isGifDocument(document7, messageObject.hasValidGroupId())) {
                                                                                    canChangeRadius = true;
                                                                                    canChangeRadius2 = DownloadController.getInstance(this.currentAccount).canDownloadMedia(this.currentMessageObject);
                                                                                } else {
                                                                                    canChangeRadius = true;
                                                                                    canChangeRadius2 = false;
                                                                                }
                                                                            }
                                                                            TLRPC.PhotoSize photoSize22 = this.currentPhotoObject;
                                                                            String filter2 = ((photoSize22 instanceof TLRPC.TL_photoStrippedSize) || "s".equals(photoSize22.type)) ? this.currentPhotoFilterThumb : this.currentPhotoFilter;
                                                                            if (messageObject6.mediaExists || canChangeRadius2) {
                                                                                this.autoPlayingMedia = z14;
                                                                                TLRPC.VideoSize videoSize2 = MessageObject.getDocumentVideoThumb(document7);
                                                                                if (messageObject6.mediaExists || videoSize2 == null) {
                                                                                    document8 = document7;
                                                                                } else if (this.currentPhotoObject == null || this.currentPhotoObjectThumb == null) {
                                                                                    ?? r22 = this.photoImage;
                                                                                    ImageLocation forDocument3 = ImageLocation.getForDocument(document7);
                                                                                    String str19 = document7.size < 32768 ? null : ImageLoader.AUTOPLAY_FILTER;
                                                                                    ImageLocation forDocument4 = ImageLocation.getForDocument(videoSize2, this.documentAttach);
                                                                                    TLRPC.PhotoSize photoSize23 = this.currentPhotoObject;
                                                                                    if (photoSize23 == null) {
                                                                                        photoSize23 = this.currentPhotoObjectThumb;
                                                                                    }
                                                                                    ImageLocation forDocument5 = ImageLocation.getForDocument(photoSize23, this.documentAttach);
                                                                                    String str20 = this.currentPhotoObject != null ? filter2 : this.currentPhotoFilterThumb;
                                                                                    ?? r9 = this.currentPhotoObjectThumbStripped;
                                                                                    r22.setImage(forDocument3, str19, forDocument4, null, forDocument5, str20, r9, document7.size, null, messageObject, 0);
                                                                                    str11 = r9;
                                                                                } else {
                                                                                    document8 = document7;
                                                                                }
                                                                                ?? r23 = this.photoImage;
                                                                                ImageLocation forDocument6 = ImageLocation.getForDocument(document8);
                                                                                TLRPC.Document document14 = document8;
                                                                                String str21 = document14.size < 32768 ? null : ImageLoader.AUTOPLAY_FILTER;
                                                                                ImageLocation forDocument7 = ImageLocation.getForDocument(this.currentPhotoObject, this.documentAttach);
                                                                                ImageLocation forDocument8 = ImageLocation.getForDocument(this.currentPhotoObjectThumb, this.documentAttach);
                                                                                String str22 = this.currentPhotoFilterThumb;
                                                                                ?? r92 = this.currentPhotoObjectThumbStripped;
                                                                                r23.setImage(forDocument6, str21, forDocument7, filter2, forDocument8, str22, r92, document14.size, null, messageObject, 0);
                                                                                str11 = r92;
                                                                            } else {
                                                                                this.photoImage.setImage(null, null, ImageLocation.getForDocument(this.currentPhotoObject, this.documentAttach), filter2, 0L, null, this.currentMessageObject, 0);
                                                                                str11 = "%d_%d_b";
                                                                            }
                                                                            autoDownload = canChangeRadius;
                                                                            str9 = str11;
                                                                            z13 = true;
                                                                            this.drawPhotoImage = true;
                                                                            type6 = type5;
                                                                            if (type6 == null && type6.equals("video") && duration != 0) {
                                                                                String str23 = AndroidUtilities.formatShortDuration(duration);
                                                                                this.durationWidth = (int) Math.ceil(Theme.chat_durationPaint.measureText(str23));
                                                                                this.videoInfoLayout = new StaticLayout(str23, Theme.chat_durationPaint, this.durationWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                                                            } else if (this.hasGamePreview) {
                                                                                boolean showGameOverlay = true;
                                                                                try {
                                                                                    long bot_id = messageObject6.messageOwner.via_bot_id != 0 ? messageObject6.messageOwner.via_bot_id : messageObject6.messageOwner.from_id.user_id;
                                                                                    if (bot_id != 0 && (botUser = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(bot_id))) != null && botUser.username != null) {
                                                                                        if (botUser.username.equals("donate")) {
                                                                                            showGameOverlay = false;
                                                                                        }
                                                                                    }
                                                                                } catch (Exception e35) {
                                                                                }
                                                                                if (showGameOverlay) {
                                                                                    String str24 = LocaleController.getString("AttachGame", R.string.AttachGame).toUpperCase();
                                                                                    this.durationWidth = (int) Math.ceil(Theme.chat_gamePaint.measureText(str24));
                                                                                    this.videoInfoLayout = new StaticLayout(str24, Theme.chat_gamePaint, this.durationWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                                                                }
                                                                            }
                                                                            maxChildWidth3 = maxChildWidth5;
                                                                            str7 = str9;
                                                                            if (!this.hasInvoicePreview) {
                                                                            }
                                                                            if (this.hasGamePreview) {
                                                                                this.linkPreviewHeight += messageObject6.textHeight + AndroidUtilities.dp(6.0f);
                                                                                this.totalHeight += AndroidUtilities.dp(4.0f);
                                                                            }
                                                                            calcBackgroundWidth(maxWidth9, timeMore3, maxChildWidth3);
                                                                            str6 = str8;
                                                                            z12 = z13;
                                                                        }
                                                                    } else if (document13 instanceof DocumentObject.ThemeDocument) {
                                                                        this.photoImage.setImage(ImageLocation.getForDocument(document13), this.currentPhotoFilter, null, "b1", 0L, "jpg", messageObject, 1);
                                                                        messageObject6 = messageObject5;
                                                                        document6 = document13;
                                                                        timeMore3 = timeMore6;
                                                                        str10 = "jpg";
                                                                    } else {
                                                                        messageObject6 = messageObject5;
                                                                        timeMore3 = timeMore6;
                                                                        this.photoImage.setImage(ImageLocation.getForDocument(this.currentPhotoObject, document13), this.currentPhotoFilter, ImageLocation.getForDocument(this.currentPhotoObjectThumb, document13), "b1", this.currentPhotoObjectThumbStripped, 0L, "jpg", messageObject, 1);
                                                                        document6 = document13;
                                                                        str10 = "%d_%d_b";
                                                                    }
                                                                }
                                                                str9 = str10;
                                                                z13 = true;
                                                                this.drawPhotoImage = true;
                                                                type6 = type5;
                                                                if (type6 == null) {
                                                                }
                                                                if (this.hasGamePreview) {
                                                                }
                                                                maxChildWidth3 = maxChildWidth5;
                                                                str7 = str9;
                                                                if (!this.hasInvoicePreview) {
                                                                }
                                                                if (this.hasGamePreview) {
                                                                }
                                                                calcBackgroundWidth(maxWidth9, timeMore3, maxChildWidth3);
                                                                str6 = str8;
                                                                z12 = z13;
                                                            } else {
                                                                scale = scale3;
                                                            }
                                                            if (height11 > AndroidUtilities.displaySize.y / 3) {
                                                                height11 = AndroidUtilities.displaySize.y / 3;
                                                            }
                                                            if (this.imageBackgroundSideColor == 0) {
                                                            }
                                                            if (height11 >= AndroidUtilities.dp(60.0f)) {
                                                            }
                                                            if (!this.isSmallImage) {
                                                            }
                                                            if (this.documentAttachType == 8) {
                                                            }
                                                            type4 = type3;
                                                            this.photoImage.setImageCoords(0.0f, 0.0f, width2, height2);
                                                            int w32 = (int) (width2 / AndroidUtilities.density);
                                                            int h72 = (int) (height2 / AndroidUtilities.density);
                                                            this.currentPhotoFilter = String.format(Locale.US, "%d_%d", Integer.valueOf(w32), Integer.valueOf(h72));
                                                            this.currentPhotoFilterThumb = String.format(Locale.US, "%d_%d_b", Integer.valueOf(w32), Integer.valueOf(h72));
                                                            if (webDocument2 == null) {
                                                            }
                                                            str9 = str10;
                                                            z13 = true;
                                                            this.drawPhotoImage = true;
                                                            type6 = type5;
                                                            if (type6 == null) {
                                                            }
                                                            if (this.hasGamePreview) {
                                                            }
                                                            maxChildWidth3 = maxChildWidth5;
                                                            str7 = str9;
                                                            if (!this.hasInvoicePreview) {
                                                            }
                                                            if (this.hasGamePreview) {
                                                            }
                                                            calcBackgroundWidth(maxWidth9, timeMore3, maxChildWidth3);
                                                            str6 = str8;
                                                            z12 = z13;
                                                        }
                                                        if (this.hasInvoicePreview) {
                                                            width3 = 640;
                                                            height3 = 360;
                                                            int a16 = 0;
                                                            int N4 = webDocument2.attributes.size();
                                                            while (true) {
                                                                if (a16 >= N4) {
                                                                    break;
                                                                }
                                                                int width12 = width3;
                                                                TLRPC.DocumentAttribute attribute6 = webDocument2.attributes.get(a16);
                                                                int height12 = height3;
                                                                if (attribute6 instanceof TLRPC.TL_documentAttributeImageSize) {
                                                                    int width13 = attribute6.w;
                                                                    height3 = attribute6.h;
                                                                    width3 = width13;
                                                                    break;
                                                                }
                                                                a16++;
                                                                width3 = width12;
                                                                height3 = height12;
                                                            }
                                                        } else {
                                                            width3 = 640;
                                                            height3 = 360;
                                                        }
                                                        float scale5 = width3 / (maxPhotoWidth5 - AndroidUtilities.dp(2.0f));
                                                        width2 = (int) (width3 / scale5);
                                                        height2 = (int) (height3 / scale5);
                                                        if (!this.isSmallImage) {
                                                        }
                                                        if (this.documentAttachType == 8) {
                                                        }
                                                        type4 = type3;
                                                        this.photoImage.setImageCoords(0.0f, 0.0f, width2, height2);
                                                        int w322 = (int) (width2 / AndroidUtilities.density);
                                                        int h722 = (int) (height2 / AndroidUtilities.density);
                                                        this.currentPhotoFilter = String.format(Locale.US, "%d_%d", Integer.valueOf(w322), Integer.valueOf(h722));
                                                        this.currentPhotoFilterThumb = String.format(Locale.US, "%d_%d_b", Integer.valueOf(w322), Integer.valueOf(h722));
                                                        if (webDocument2 == null) {
                                                        }
                                                        str9 = str10;
                                                        z13 = true;
                                                        this.drawPhotoImage = true;
                                                        type6 = type5;
                                                        if (type6 == null) {
                                                        }
                                                        if (this.hasGamePreview) {
                                                        }
                                                        maxChildWidth3 = maxChildWidth5;
                                                        str7 = str9;
                                                        if (!this.hasInvoicePreview) {
                                                        }
                                                        if (this.hasGamePreview) {
                                                        }
                                                        calcBackgroundWidth(maxWidth9, timeMore3, maxChildWidth3);
                                                        str6 = str8;
                                                        z12 = z13;
                                                    }
                                                    width2 = maxPhotoWidth5;
                                                    height2 = maxPhotoWidth5;
                                                    if (!this.isSmallImage) {
                                                    }
                                                    if (this.documentAttachType == 8) {
                                                    }
                                                    type4 = type3;
                                                    this.photoImage.setImageCoords(0.0f, 0.0f, width2, height2);
                                                    int w3222 = (int) (width2 / AndroidUtilities.density);
                                                    int h7222 = (int) (height2 / AndroidUtilities.density);
                                                    this.currentPhotoFilter = String.format(Locale.US, "%d_%d", Integer.valueOf(w3222), Integer.valueOf(h7222));
                                                    this.currentPhotoFilterThumb = String.format(Locale.US, "%d_%d_b", Integer.valueOf(w3222), Integer.valueOf(h7222));
                                                    if (webDocument2 == null) {
                                                    }
                                                    str9 = str10;
                                                    z13 = true;
                                                    this.drawPhotoImage = true;
                                                    type6 = type5;
                                                    if (type6 == null) {
                                                    }
                                                    if (this.hasGamePreview) {
                                                    }
                                                    maxChildWidth3 = maxChildWidth5;
                                                    str7 = str9;
                                                    if (!this.hasInvoicePreview) {
                                                    }
                                                    if (this.hasGamePreview) {
                                                    }
                                                    calcBackgroundWidth(maxWidth9, timeMore3, maxChildWidth3);
                                                    str6 = str8;
                                                    z12 = z13;
                                                }
                                                createInstantViewButton();
                                                str5 = str6;
                                                z11 = z12;
                                            }
                                        }
                                        TLRPC.PhotoSize closestPhotoSizeWithSize3 = FileLoader.getClosestPhotoSizeWithSize(document5.thumbs, 90);
                                        this.currentPhotoObject = closestPhotoSizeWithSize3;
                                        this.photoParentObject = document5;
                                        if (closestPhotoSizeWithSize3 != null && (closestPhotoSizeWithSize3.w == 0 || this.currentPhotoObject.h == 0)) {
                                            int a17 = 0;
                                            while (true) {
                                                if (a17 >= document5.attributes.size()) {
                                                    break;
                                                }
                                                TLRPC.DocumentAttribute attribute7 = document5.attributes.get(a17);
                                                if (attribute7 instanceof TLRPC.TL_documentAttributeImageSize) {
                                                    this.currentPhotoObject.w = attribute7.w;
                                                    this.currentPhotoObject.h = attribute7.h;
                                                    break;
                                                }
                                                a17++;
                                            }
                                            if (this.currentPhotoObject.w == 0 || this.currentPhotoObject.h == 0) {
                                                TLRPC.PhotoSize photoSize24 = this.currentPhotoObject;
                                                int dp8 = AndroidUtilities.dp(150.0f);
                                                photoSize24.h = dp8;
                                                photoSize24.w = dp8;
                                            }
                                        }
                                        this.documentAttach = document5;
                                        this.documentAttachType = 6;
                                        webDocument2 = webDocument4;
                                        type3 = type2;
                                    }
                                }
                            }
                            maxWidth7 = maxWidth10;
                            i12 = this.documentAttachType;
                            if (i12 != 5) {
                            }
                            z12 = true;
                            messageObject6 = messageObject5;
                            str6 = type3;
                            createInstantViewButton();
                            str5 = str6;
                            z11 = z12;
                        } else {
                            maxPhotoWidth = maxPhotoWidth3;
                            timeMore2 = timeMore;
                            maxWidth10 = maxWidth5;
                            photo3 = photo2;
                            document5 = document4;
                            if (photo3 != null) {
                                if (type2 != null) {
                                    type3 = type2;
                                    if (type3.equals("photo")) {
                                        isPhoto = true;
                                        this.currentPhotoObject = FileLoader.getClosestPhotoSizeWithSize(messageObject5.photoThumbs, (!isPhoto || !smallImage2) ? AndroidUtilities.getPhotoSize() : maxPhotoWidth, isPhoto);
                                        this.photoParentObject = messageObject5.photoThumbsObject;
                                        this.checkOnlyButtonPressed = isPhoto;
                                        if (this.currentMessageObject.strippedThumb != null) {
                                            this.currentPhotoObjectThumb = FileLoader.getClosestPhotoSizeWithSize(messageObject5.photoThumbs, 40);
                                        } else {
                                            this.currentPhotoObjectThumbStripped = this.currentMessageObject.strippedThumb;
                                        }
                                        if (this.currentPhotoObjectThumb == this.currentPhotoObject) {
                                            this.currentPhotoObjectThumb = null;
                                        }
                                        webDocument2 = webDocument4;
                                    }
                                } else {
                                    type3 = type2;
                                }
                                isPhoto = false;
                                this.currentPhotoObject = FileLoader.getClosestPhotoSizeWithSize(messageObject5.photoThumbs, (!isPhoto || !smallImage2) ? AndroidUtilities.getPhotoSize() : maxPhotoWidth, isPhoto);
                                this.photoParentObject = messageObject5.photoThumbsObject;
                                this.checkOnlyButtonPressed = isPhoto;
                                if (this.currentMessageObject.strippedThumb != null) {
                                }
                                if (this.currentPhotoObjectThumb == this.currentPhotoObject) {
                                }
                                webDocument2 = webDocument4;
                            } else {
                                type3 = type2;
                                if (webDocument4 != null) {
                                    WebFile webDocument5 = !webDocument4.mime_type.startsWith("image/") ? null : webDocument4;
                                    this.drawImageButton = false;
                                    webDocument2 = webDocument5;
                                    maxWidth7 = maxWidth10;
                                    i12 = this.documentAttachType;
                                    if (i12 != 5) {
                                    }
                                    z12 = true;
                                    messageObject6 = messageObject5;
                                    str6 = type3;
                                    createInstantViewButton();
                                    str5 = str6;
                                    z11 = z12;
                                } else {
                                    webDocument2 = webDocument4;
                                }
                            }
                            maxWidth7 = maxWidth10;
                            i12 = this.documentAttachType;
                            if (i12 != 5) {
                            }
                            z12 = true;
                            messageObject6 = messageObject5;
                            str6 = type3;
                            createInstantViewButton();
                            str5 = str6;
                            z11 = z12;
                        }
                    } else {
                        this.photoImage.setImageBitmap((Drawable) null);
                        calcBackgroundWidth(maxWidth4, timeMore5, maxChildWidth3);
                        z11 = true;
                        str5 = androidThemeSettings2;
                    }
                    f = 0.0f;
                    additionHeight = str5;
                    r14 = z11;
                } else {
                    r14 = 1;
                    if (messageObject6.type == 16) {
                        createSelectorDrawable(0);
                        this.drawName = false;
                        this.drawForwardedName = false;
                        this.drawPhotoImage = false;
                        if (AndroidUtilities.isTablet()) {
                            this.backgroundWidth = Math.min(AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(270.0f));
                        } else {
                            this.backgroundWidth = Math.min(getParentWidth() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(270.0f));
                        }
                        this.availableTimeWidth = this.backgroundWidth - AndroidUtilities.dp(31.0f);
                        int maxWidth15 = getMaxNameWidth() - AndroidUtilities.dp(50.0f);
                        if (maxWidth15 < 0) {
                            maxWidth15 = AndroidUtilities.dp(10.0f);
                        }
                        String time = LocaleController.getInstance().formatterDay.format(messageObject6.messageOwner.date * 1000);
                        TLRPC.TL_messageActionPhoneCall call = (TLRPC.TL_messageActionPhoneCall) messageObject6.messageOwner.action;
                        boolean isMissed = call.reason instanceof TLRPC.TL_phoneCallDiscardReasonMissed;
                        String text = messageObject.isOutOwner() ? isMissed ? call.video ? LocaleController.getString("CallMessageVideoOutgoingMissed", R.string.CallMessageVideoOutgoingMissed) : LocaleController.getString("CallMessageOutgoingMissed", R.string.CallMessageOutgoingMissed) : call.video ? LocaleController.getString("CallMessageVideoOutgoing", R.string.CallMessageVideoOutgoing) : LocaleController.getString("CallMessageOutgoing", R.string.CallMessageOutgoing) : isMissed ? call.video ? LocaleController.getString("CallMessageVideoIncomingMissed", R.string.CallMessageVideoIncomingMissed) : LocaleController.getString("CallMessageIncomingMissed", R.string.CallMessageIncomingMissed) : call.reason instanceof TLRPC.TL_phoneCallDiscardReasonBusy ? call.video ? LocaleController.getString("CallMessageVideoIncomingDeclined", R.string.CallMessageVideoIncomingDeclined) : LocaleController.getString("CallMessageIncomingDeclined", R.string.CallMessageIncomingDeclined) : call.video ? LocaleController.getString("CallMessageVideoIncoming", R.string.CallMessageVideoIncoming) : LocaleController.getString("CallMessageIncoming", R.string.CallMessageIncoming);
                        if (call.duration > 0) {
                            time = time + ", " + LocaleController.formatCallDuration(call.duration);
                        }
                        this.titleLayout = new StaticLayout(TextUtils.ellipsize(text, Theme.chat_audioTitlePaint, maxWidth15, TextUtils.TruncateAt.END), Theme.chat_audioTitlePaint, maxWidth15 + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                        ?? r93 = maxWidth15;
                        this.docTitleLayout = new StaticLayout(TextUtils.ellipsize(time, Theme.chat_contactPhonePaint, r93, TextUtils.TruncateAt.END), Theme.chat_contactPhonePaint, maxWidth15 + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                        setMessageObjectInternal(messageObject);
                        int dp9 = AndroidUtilities.dp(65.0f);
                        int i39 = this.namesOffset;
                        this.totalHeight = dp9 + i39;
                        str4 = r93;
                        if (this.drawPinnedTop) {
                            this.namesOffset = i39 - AndroidUtilities.dp(1.0f);
                            str4 = r93;
                        }
                    } else if (messageObject6.type == 12) {
                        this.drawName = (messageObject.isFromGroup() && messageObject.isSupergroup()) || (messageObject.isImportedForward() && messageObject6.messageOwner.fwd_from.from_id == null);
                        this.drawForwardedName = !this.isRepliesChat;
                        this.drawPhotoImage = true;
                        this.photoImage.setRoundRadius(AndroidUtilities.dp(22.0f));
                        autoDownload = false;
                        if (AndroidUtilities.isTablet()) {
                            this.backgroundWidth = Math.min(AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(270.0f));
                        } else {
                            this.backgroundWidth = Math.min(getParentWidth() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(270.0f));
                        }
                        this.availableTimeWidth = this.backgroundWidth - AndroidUtilities.dp(31.0f);
                        long uid = messageObject6.messageOwner.media.user_id;
                        TLRPC.User user3 = null;
                        if (uid != 0) {
                            user3 = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(uid));
                        }
                        int maxWidth16 = getMaxNameWidth() - AndroidUtilities.dp(80.0f);
                        if (maxWidth16 < 0) {
                            maxWidth16 = AndroidUtilities.dp(10.0f);
                        }
                        if (user3 != null) {
                            this.contactAvatarDrawable.setInfo(user3);
                            hasName = true;
                        } else if (!TextUtils.isEmpty(messageObject6.messageOwner.media.first_name) || !TextUtils.isEmpty(messageObject6.messageOwner.media.last_name)) {
                            this.contactAvatarDrawable.setInfo(0L, messageObject6.messageOwner.media.first_name, messageObject6.messageOwner.media.last_name);
                            hasName = true;
                        } else {
                            hasName = false;
                        }
                        this.photoImage.setForUserOrChat(user3, hasName ? this.contactAvatarDrawable : Theme.chat_contactDrawable[messageObject.isOutOwner() ? 1 : 0], messageObject6);
                        if (!TextUtils.isEmpty(messageObject6.vCardData)) {
                            phone = messageObject6.vCardData;
                            this.drawInstantView = true;
                            this.drawInstantViewType = 5;
                        } else if (user3 == null || TextUtils.isEmpty(user3.phone)) {
                            CharSequence phone2 = messageObject6.messageOwner.media.phone_number;
                            phone = !TextUtils.isEmpty(phone2) ? PhoneFormat.getInstance().format((String) phone2) : LocaleController.getString("NumberUnknown", R.string.NumberUnknown);
                        } else {
                            phone = PhoneFormat.getInstance().format("+" + user3.phone);
                        }
                        CharSequence currentNameString = ContactsController.formatName(messageObject6.messageOwner.media.first_name, messageObject6.messageOwner.media.last_name).replace('\n', ' ');
                        if (currentNameString.length() == 0 && (currentNameString = messageObject6.messageOwner.media.phone_number) == null) {
                            currentNameString = "";
                        }
                        this.titleLayout = new StaticLayout(TextUtils.ellipsize(currentNameString, Theme.chat_contactNamePaint, maxWidth16, TextUtils.TruncateAt.END), Theme.chat_contactNamePaint, maxWidth16 + AndroidUtilities.dp(4.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                        this.docTitleLayout = new StaticLayout(phone, Theme.chat_contactPhonePaint, maxWidth16 + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, AndroidUtilities.dp(1.0f), false);
                        setMessageObjectInternal(messageObject);
                        if (this.drawForwardedName && messageObject.needDrawForwarded() && ((groupedMessagePosition9 = this.currentPosition) == null || groupedMessagePosition9.minY == 0)) {
                            this.namesOffset += AndroidUtilities.dp(5.0f);
                        } else if (this.drawNameLayout && messageObject.getReplyMsgId() == 0) {
                            this.namesOffset += AndroidUtilities.dp(7.0f);
                        }
                        this.totalHeight = AndroidUtilities.dp(55.0f) + this.namesOffset + this.docTitleLayout.getHeight();
                        if (this.drawPinnedTop) {
                            this.namesOffset -= AndroidUtilities.dp(1.0f);
                        }
                        if (this.drawInstantView) {
                            createInstantViewButton();
                        } else if (this.docTitleLayout.getLineCount() > 0) {
                            int dp10 = this.backgroundWidth - AndroidUtilities.dp(110.0f);
                            StaticLayout staticLayout10 = this.docTitleLayout;
                            int timeLeft = dp10 - ((int) Math.ceil(staticLayout10.getLineWidth(staticLayout10.getLineCount() - 1)));
                            if (timeLeft < this.timeWidth) {
                                this.totalHeight += AndroidUtilities.dp(8.0f);
                            }
                        }
                        ?? r94 = this.reactionsLayoutInBubble.isSmall;
                        if (r94 == 0) {
                            ?? r95 = this.reactionsLayoutInBubble.isEmpty;
                            if (r95 == 0) {
                                this.reactionsLayoutInBubble.measure(this.backgroundWidth - AndroidUtilities.dp(32.0f), 3);
                                ReactionsLayoutInBubble reactionsLayoutInBubble2 = this.reactionsLayoutInBubble;
                                reactionsLayoutInBubble2.totalHeight = reactionsLayoutInBubble2.height + AndroidUtilities.dp(12.0f);
                                this.reactionsLayoutInBubble.positionOffsetY += -AndroidUtilities.dp(4.0f);
                                if ((this.backgroundWidth - AndroidUtilities.dp(32.0f)) - this.reactionsLayoutInBubble.lastLineX < this.timeWidth) {
                                    this.reactionsLayoutInBubble.totalHeight += AndroidUtilities.dp(12.0f);
                                    this.reactionsLayoutInBubble.positionOffsetY += -AndroidUtilities.dp(12.0f);
                                }
                                int i40 = this.totalHeight + this.reactionsLayoutInBubble.totalHeight;
                                this.totalHeight = i40;
                                i11 = i40;
                            } else {
                                i11 = r95;
                            }
                        } else {
                            i11 = r94;
                        }
                        f = 0.0f;
                        additionHeight = i11;
                    } else if (messageObject6.type == 2) {
                        this.drawForwardedName = !this.isRepliesChat;
                        this.drawName = (messageObject.isFromGroup() && messageObject.isSupergroup()) || (messageObject.isImportedForward() && messageObject6.messageOwner.fwd_from.from_id == null);
                        if (AndroidUtilities.isTablet()) {
                            int min = Math.min(AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(270.0f));
                            maxWidth3 = min;
                            this.backgroundWidth = min;
                        } else {
                            int min2 = Math.min(getParentWidth() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(270.0f));
                            maxWidth3 = min2;
                            this.backgroundWidth = min2;
                        }
                        createDocumentLayout(this.backgroundWidth, messageObject6);
                        setMessageObjectInternal(messageObject);
                        int dp11 = AndroidUtilities.dp(70.0f);
                        int i41 = this.namesOffset;
                        this.totalHeight = dp11 + i41;
                        if (this.drawPinnedTop) {
                            this.namesOffset = i41 - AndroidUtilities.dp(1.0f);
                        }
                        str4 = i17;
                        if (!this.reactionsLayoutInBubble.isSmall) {
                            this.reactionsLayoutInBubble.measure(maxWidth3 - AndroidUtilities.dp(24.0f), 3);
                            str4 = i17;
                            if (!this.reactionsLayoutInBubble.isEmpty) {
                                ReactionsLayoutInBubble reactionsLayoutInBubble3 = this.reactionsLayoutInBubble;
                                reactionsLayoutInBubble3.totalHeight = reactionsLayoutInBubble3.height;
                                if (TextUtils.isEmpty(messageObject6.caption)) {
                                    this.reactionsLayoutInBubble.totalHeight += AndroidUtilities.dp(12.0f);
                                } else {
                                    this.reactionsLayoutInBubble.totalHeight += AndroidUtilities.dp(8.0f);
                                }
                                measureTime(messageObject);
                                if (this.reactionsLayoutInBubble.width > this.backgroundWidth) {
                                    this.backgroundWidth = this.reactionsLayoutInBubble.width;
                                }
                                if (this.reactionsLayoutInBubble.lastLineX + this.timeWidth + AndroidUtilities.dp(24.0f) > this.backgroundWidth) {
                                    this.reactionsLayoutInBubble.totalHeight += AndroidUtilities.dp(12.0f);
                                    this.reactionsLayoutInBubble.positionOffsetY -= AndroidUtilities.dp(12.0f);
                                }
                                this.totalHeight += this.reactionsLayoutInBubble.totalHeight;
                                str4 = i17;
                            }
                        }
                    } else if (messageObject6.type == 14) {
                        this.drawName = ((messageObject.isFromGroup() && messageObject.isSupergroup()) || (messageObject.isImportedForward() && messageObject6.messageOwner.fwd_from.from_id == null)) && ((groupedMessagePosition8 = this.currentPosition) == null || (groupedMessagePosition8.flags & 4) != 0);
                        if (AndroidUtilities.isTablet()) {
                            int min3 = Math.min(AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(270.0f));
                            maxWidth2 = min3;
                            this.backgroundWidth = min3;
                        } else {
                            int min4 = Math.min(getParentWidth() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(270.0f));
                            maxWidth2 = min4;
                            this.backgroundWidth = min4;
                        }
                        createDocumentLayout(this.backgroundWidth, messageObject6);
                        setMessageObjectInternal(messageObject);
                        this.totalHeight = AndroidUtilities.dp(82.0f) + this.namesOffset;
                        if (this.currentPosition != null && (groupedMessages6 = this.currentMessagesGroup) != null && groupedMessages6.messages.size() > 1) {
                            if ((this.currentPosition.flags & 4) == 0) {
                                this.totalHeight -= AndroidUtilities.dp(6.0f);
                                this.mediaOffsetY -= AndroidUtilities.dp(6.0f);
                            }
                            if ((this.currentPosition.flags & 8) == 0) {
                                this.totalHeight -= AndroidUtilities.dp(6.0f);
                            }
                        }
                        if (this.drawPinnedTop) {
                            this.namesOffset -= AndroidUtilities.dp(1.0f);
                        }
                        str4 = i17;
                        if (!this.reactionsLayoutInBubble.isSmall) {
                            this.reactionsLayoutInBubble.measure(maxWidth2 - AndroidUtilities.dp(24.0f), 3);
                            str4 = i17;
                            if (!this.reactionsLayoutInBubble.isEmpty) {
                                ReactionsLayoutInBubble reactionsLayoutInBubble4 = this.reactionsLayoutInBubble;
                                reactionsLayoutInBubble4.totalHeight = reactionsLayoutInBubble4.height + AndroidUtilities.dp(12.0f);
                                measureTime(messageObject);
                                if (this.reactionsLayoutInBubble.width > this.backgroundWidth) {
                                    this.backgroundWidth = this.reactionsLayoutInBubble.width;
                                }
                                if (this.reactionsLayoutInBubble.lastLineX + this.timeWidth + AndroidUtilities.dp(24.0f) > this.backgroundWidth) {
                                    this.reactionsLayoutInBubble.totalHeight += AndroidUtilities.dp(12.0f);
                                    this.reactionsLayoutInBubble.positionOffsetY -= AndroidUtilities.dp(12.0f);
                                }
                                if (!messageObject6.isRestrictedMessage && messageObject6.caption != null) {
                                    this.reactionsLayoutInBubble.positionOffsetY += AndroidUtilities.dp(14.0f);
                                }
                                this.totalHeight += this.reactionsLayoutInBubble.totalHeight;
                                str4 = i17;
                            }
                        }
                    } else if (messageObject6.type == 17) {
                        if (this.timerParticles == null) {
                            this.timerParticles = new TimerParticles();
                        }
                        createSelectorDrawable(0);
                        this.drawName = true;
                        this.drawForwardedName = !this.isRepliesChat;
                        this.drawPhotoImage = false;
                        int maxWidth17 = Math.min(AndroidUtilities.dp(500.0f), messageObject.getMaxMessageTextWidth());
                        this.backgroundWidth = AndroidUtilities.dp(31.0f) + maxWidth17;
                        TLRPC.TL_messageMediaPoll media = (TLRPC.TL_messageMediaPoll) messageObject6.messageOwner.media;
                        this.timerTransitionProgress = media.poll.close_date - ConnectionsManager.getInstance(this.currentAccount).getCurrentTime() < 60 ? 0.0f : 1.0f;
                        this.pollClosed = media.poll.closed;
                        boolean isVoted = messageObject.isVoted();
                        this.pollVoted = isVoted;
                        if (isVoted) {
                            messageObject6.checkedVotes.clear();
                        }
                        StaticLayout staticLayout11 = new StaticLayout(Emoji.replaceEmoji(media.poll.question, Theme.chat_audioTitlePaint.getFontMetricsInt(), AndroidUtilities.dp(16.0f), false), Theme.chat_audioTitlePaint, (AndroidUtilities.dp(2.0f) + maxWidth17) - (getExtraTextX() * 2), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                        this.titleLayout = staticLayout11;
                        boolean titleRtl = false;
                        int a18 = 0;
                        int N5 = staticLayout11.getLineCount();
                        while (true) {
                            if (a18 >= N5) {
                                f2 = 0.0f;
                                break;
                            }
                            f2 = 0.0f;
                            if (this.titleLayout.getLineLeft(a18) > 0.0f) {
                                titleRtl = true;
                                break;
                            }
                            a18++;
                        }
                        String title5 = this.pollClosed ? LocaleController.getString("FinalResults", R.string.FinalResults) : media.poll.quiz ? media.poll.public_voters ? LocaleController.getString("QuizPoll", R.string.QuizPoll) : LocaleController.getString("AnonymousQuizPoll", R.string.AnonymousQuizPoll) : media.poll.public_voters ? LocaleController.getString("PublicPoll", R.string.PublicPoll) : LocaleController.getString("AnonymousPoll", R.string.AnonymousPoll);
                        StaticLayout staticLayout12 = new StaticLayout(TextUtils.ellipsize(title5, Theme.chat_timePaint, maxWidth17, TextUtils.TruncateAt.END), Theme.chat_timePaint, (AndroidUtilities.dp(2.0f) + maxWidth17) - (getExtraTextX() * 2), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                        this.docTitleLayout = staticLayout12;
                        if (staticLayout12.getLineCount() > 0) {
                            if (titleRtl && !LocaleController.isRTL) {
                                this.docTitleOffsetX = (int) Math.ceil(maxWidth17 - this.docTitleLayout.getLineWidth(0));
                            } else if (titleRtl || !LocaleController.isRTL) {
                                this.docTitleOffsetX = 0;
                            } else {
                                this.docTitleOffsetX = -((int) Math.ceil(this.docTitleLayout.getLineLeft(0)));
                            }
                        }
                        int w4 = maxWidth17 - AndroidUtilities.dp(messageObject.isOutOwner() ? 28.0f : 8.0f);
                        if (!this.isBot) {
                            TextPaint textPaint2 = (media.poll.public_voters || media.poll.multiple_choice) ? Theme.chat_locationAddressPaint : Theme.chat_livePaint;
                            CharSequence votes = media.poll.quiz ? TextUtils.ellipsize(media.results.total_voters == 0 ? LocaleController.getString("NoVotesQuiz", R.string.NoVotesQuiz) : LocaleController.formatPluralString("Answer", media.results.total_voters, new Object[0]), textPaint2, w4, TextUtils.TruncateAt.END) : TextUtils.ellipsize(media.results.total_voters == 0 ? LocaleController.getString("NoVotes", R.string.NoVotes) : LocaleController.formatPluralString("Vote", media.results.total_voters, new Object[0]), textPaint2, w4, TextUtils.TruncateAt.END);
                            this.infoLayout = new StaticLayout(votes, textPaint2, w4, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                            if (media.poll.public_voters || media.poll.multiple_choice) {
                                double dp12 = this.backgroundWidth - AndroidUtilities.dp(28.0f);
                                double ceil5 = Math.ceil(this.infoLayout.getLineWidth(0));
                                Double.isNaN(dp12);
                                double lineLeft6 = this.infoLayout.getLineLeft(0);
                                Double.isNaN(lineLeft6);
                                this.infoX = (int) (((dp12 - ceil5) / 2.0d) - lineLeft6);
                                this.availableTimeWidth = maxWidth17;
                            } else {
                                this.infoX = (int) Math.ceil(this.infoLayout.getLineCount() > 0 ? -this.infoLayout.getLineLeft(0) : FirebaseRemoteConfig.DEFAULT_VALUE_FOR_DOUBLE);
                                this.availableTimeWidth = (int) ((maxWidth17 - this.infoLayout.getLineWidth(0)) - AndroidUtilities.dp(16.0f));
                            }
                        }
                        measureTime(messageObject);
                        this.lastPoll = media.poll;
                        this.lastPollResults = media.results.results;
                        this.lastPollResultsVoters = media.results.total_voters;
                        if ((media.poll.multiple_choice && !this.pollVoted && !this.pollClosed) || (!this.isBot && ((media.poll.public_voters && this.pollVoted) || (this.pollClosed && media.results != null && media.results.total_voters != 0 && media.poll.public_voters)))) {
                            this.drawInstantView = true;
                            this.drawInstantViewType = 8;
                            createInstantViewButton();
                        }
                        if (media.poll.multiple_choice) {
                            createPollUI();
                        }
                        if (media.results != null) {
                            createPollUI();
                            int size2 = media.results.recent_voters.size();
                            int a19 = 0;
                            while (true) {
                                ImageReceiver[] imageReceiverArr3 = this.pollAvatarImages;
                                if (a19 >= imageReceiverArr3.length) {
                                    break;
                                }
                                if (!this.isBot && a19 < size2) {
                                    imageReceiverArr3[a19].setImageCoords(f2, f2, AndroidUtilities.dp(16.0f), AndroidUtilities.dp(16.0f));
                                    Long id2 = media.results.recent_voters.get(a19);
                                    TLRPC.User user4 = MessagesController.getInstance(this.currentAccount).getUser(id2);
                                    if (user4 != null) {
                                        this.pollAvatarDrawables[a19].setInfo(user4);
                                        this.pollAvatarImages[a19].setForUserOrChat(user4, this.pollAvatarDrawables[a19]);
                                    } else {
                                        this.pollAvatarDrawables[a19].setInfo(id2.longValue(), "", "");
                                    }
                                    this.pollAvatarImagesVisible[a19] = true;
                                } else if (!this.pollUnvoteInProgress || size2 != 0) {
                                    imageReceiverArr3[a19].setImageBitmap((Drawable) null);
                                    this.pollAvatarImagesVisible[a19] = false;
                                }
                                a19++;
                                f2 = 0.0f;
                            }
                        } else if (this.pollAvatarImages != null) {
                            int a20 = 0;
                            while (true) {
                                ImageReceiver[] imageReceiverArr4 = this.pollAvatarImages;
                                if (a20 >= imageReceiverArr4.length) {
                                    break;
                                }
                                imageReceiverArr4[a20].setImageBitmap((Drawable) null);
                                this.pollAvatarImagesVisible[a20] = false;
                                a20++;
                            }
                        }
                        int maxVote = 0;
                        if (!this.animatePollAnswer && this.pollVoteInProgress && this.vibrateOnPollVote) {
                            performHapticFeedback(3, 2);
                        }
                        boolean z21 = this.attachedToWindow && (this.pollVoteInProgress || this.pollUnvoteInProgress);
                        this.animatePollAnswer = z21;
                        this.animatePollAnswerAlpha = z21;
                        ArrayList<PollButton> previousPollButtons = null;
                        ?? arrayList = new ArrayList();
                        if (!this.pollButtons.isEmpty()) {
                            previousPollButtons = new ArrayList<>(this.pollButtons);
                            this.pollButtons.clear();
                            if (!this.animatePollAnswer) {
                                this.animatePollAnswer = this.attachedToWindow && (this.pollVoted || this.pollClosed);
                            }
                            float f6 = this.pollAnimationProgress;
                            if (f6 > 0.0f && f6 < 1.0f) {
                                int N22 = previousPollButtons.size();
                                for (int b4 = 0; b4 < N22; b4++) {
                                    PollButton button = previousPollButtons.get(b4);
                                    button.percent = (int) Math.ceil(button.prevPercent + ((button.percent - button.prevPercent) * this.pollAnimationProgress));
                                    button.percentProgress = button.prevPercentProgress + ((button.percentProgress - button.prevPercentProgress) * this.pollAnimationProgress);
                                }
                            }
                        }
                        this.pollAnimationProgress = this.animatePollAnswer ? 0.0f : 1.0f;
                        if (!this.animatePollAnswerAlpha) {
                            this.pollVoteInProgress = false;
                            this.pollVoteInProgressNum = -1;
                            votingFor = SendMessagesHelper.getInstance(this.currentAccount).isSendingVote(this.currentMessageObject);
                        } else {
                            votingFor = null;
                        }
                        StaticLayout staticLayout13 = this.titleLayout;
                        int height13 = staticLayout13 != null ? staticLayout13.getHeight() : 0;
                        int restPercent = 100;
                        boolean hasDifferent = false;
                        int previousPercent = 0;
                        int N6 = media.poll.answers.size();
                        int a21 = 0;
                        while (a21 < N6) {
                            PollButton button2 = new PollButton();
                            boolean titleRtl2 = titleRtl;
                            int w5 = w4;
                            button2.answer = media.poll.answers.get(a21);
                            int N7 = N6;
                            String str25 = button2.answer.text;
                            boolean hasDifferent2 = hasDifferent;
                            Paint.FontMetricsInt fontMetricsInt = Theme.chat_audioPerformerPaint.getFontMetricsInt();
                            int a22 = a21;
                            int a23 = AndroidUtilities.dp(15.0f);
                            byte[] votingFor2 = votingFor;
                            button2.title = new StaticLayout(Emoji.replaceEmoji(str25, fontMetricsInt, a23, false), Theme.chat_audioPerformerPaint, maxWidth17 - AndroidUtilities.dp(33.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                            button2.y = AndroidUtilities.dp(52.0f) + height13;
                            button2.height = button2.title.getHeight();
                            this.pollButtons.add(button2);
                            arrayList.add(button2);
                            height13 += button2.height + AndroidUtilities.dp(26.0f);
                            if (!media.results.results.isEmpty()) {
                                int N23 = media.results.results.size();
                                for (int b5 = 0; b5 < N23; b5++) {
                                    TLRPC.TL_pollAnswerVoters answer2 = media.results.results.get(b5);
                                    if (Arrays.equals(button2.answer.option, answer2.option)) {
                                        button2.chosen = answer2.chosen;
                                        button2.count = answer2.voters;
                                        button2.correct = answer2.correct;
                                        if ((this.pollVoted || this.pollClosed) && media.results.total_voters > 0) {
                                            button2.decimal = (answer2.voters / media.results.total_voters) * 100.0f;
                                            button2.percent = (int) button2.decimal;
                                            PollButton.access$2424(button2, button2.percent);
                                        } else {
                                            button2.percent = 0;
                                            button2.decimal = 0.0f;
                                        }
                                        if (previousPercent == 0) {
                                            previousPercent = button2.percent;
                                            hasDifferent = hasDifferent2;
                                        } else {
                                            hasDifferent = (button2.percent == 0 || previousPercent == button2.percent) ? hasDifferent2 : true;
                                        }
                                        restPercent -= button2.percent;
                                        maxVote = Math.max(button2.percent, maxVote);
                                        if (previousPollButtons != null) {
                                            int b6 = 0;
                                            int N24 = previousPollButtons.size();
                                            while (true) {
                                                if (b6 >= N24) {
                                                    break;
                                                }
                                                PollButton prevButton = previousPollButtons.get(b6);
                                                int N25 = N24;
                                                if (Arrays.equals(button2.answer.option, prevButton.answer.option)) {
                                                    button2.prevPercent = prevButton.percent;
                                                    button2.prevPercentProgress = prevButton.percentProgress;
                                                    button2.prevChosen = prevButton.chosen;
                                                    break;
                                                }
                                                b6++;
                                                N24 = N25;
                                            }
                                        }
                                        if (votingFor2 != null || button2.answer.option.length <= 0) {
                                            votingFor = votingFor2;
                                            a2 = a22;
                                        } else {
                                            votingFor = votingFor2;
                                            if (Arrays.binarySearch(votingFor, button2.answer.option[0]) >= 0) {
                                                a2 = a22;
                                                this.pollVoteInProgressNum = a2;
                                                this.pollVoteInProgress = true;
                                                this.vibrateOnPollVote = true;
                                                votingFor = null;
                                            } else {
                                                a2 = a22;
                                            }
                                        }
                                        if (!this.currentMessageObject.checkedVotes.contains(button2.answer)) {
                                            this.pollCheckBox[a2].setChecked(true, false);
                                        } else {
                                            this.pollCheckBox[a2].setChecked(false, false);
                                        }
                                        a21 = a2 + 1;
                                        titleRtl = titleRtl2;
                                        N6 = N7;
                                        w4 = w5;
                                    }
                                }
                            }
                            hasDifferent = hasDifferent2;
                            if (previousPollButtons != null) {
                            }
                            if (votingFor2 != null) {
                            }
                            votingFor = votingFor2;
                            a2 = a22;
                            if (!this.currentMessageObject.checkedVotes.contains(button2.answer)) {
                            }
                            a21 = a2 + 1;
                            titleRtl = titleRtl2;
                            N6 = N7;
                            w4 = w5;
                        }
                        if (hasDifferent && restPercent != 0) {
                            Collections.sort(arrayList, ChatMessageCell$$ExternalSyntheticLambda6.INSTANCE);
                            int N8 = Math.min(restPercent, arrayList.size());
                            for (int a24 = 0; a24 < N8; a24++) {
                                PollButton.access$1712((PollButton) arrayList.get(a24), 1);
                            }
                        }
                        int a25 = this.backgroundWidth;
                        int width14 = a25 - AndroidUtilities.dp(76.0f);
                        int b7 = 0;
                        int N26 = this.pollButtons.size();
                        while (b7 < N26) {
                            PollButton button3 = this.pollButtons.get(b7);
                            int N27 = N26;
                            float dp13 = AndroidUtilities.dp(5.0f) / width14;
                            if (maxVote != 0) {
                                width = width14;
                                f3 = button3.percent / maxVote;
                            } else {
                                width = width14;
                                f3 = 0.0f;
                            }
                            button3.percentProgress = Math.max(dp13, f3);
                            b7++;
                            N26 = N27;
                            width14 = width;
                        }
                        setMessageObjectInternal(messageObject);
                        if (this.isBot && !this.drawInstantView) {
                            height13 -= AndroidUtilities.dp(10.0f);
                        } else if (media.poll.public_voters || media.poll.multiple_choice) {
                            height13 += AndroidUtilities.dp(13.0f);
                        }
                        int dp14 = AndroidUtilities.dp(73.0f);
                        int i42 = this.namesOffset;
                        this.totalHeight = dp14 + i42 + height13;
                        if (this.drawPinnedTop) {
                            this.namesOffset = i42 - AndroidUtilities.dp(1.0f);
                        }
                        this.instantTextNewLine = false;
                        if (media.poll.public_voters || media.poll.multiple_choice) {
                            int instantTextWidth = 0;
                            int a26 = 0;
                            while (a26 < 3) {
                                String str26 = a26 == 0 ? LocaleController.getString("PollViewResults", R.string.PollViewResults) : a26 == 1 ? LocaleController.getString("PollSubmitVotes", R.string.PollSubmitVotes) : LocaleController.getString("NoVotes", R.string.NoVotes);
                                instantTextWidth = Math.max(instantTextWidth, (int) Math.ceil(Theme.chat_instantViewPaint.measureText(str26)));
                                a26++;
                                maxVote = maxVote;
                            }
                            int a27 = this.timeWidth;
                            int timeWidthTotal4 = a27 + (messageObject.isOutOwner() ? AndroidUtilities.dp(20.0f) : 0) + getExtraTimeX();
                            if (!this.reactionsLayoutInBubble.isSmall && this.reactionsLayoutInBubble.isEmpty && timeWidthTotal4 >= ((this.backgroundWidth - AndroidUtilities.dp(76.0f)) - instantTextWidth) / 2) {
                                this.totalHeight += AndroidUtilities.dp(18.0f);
                                this.instantTextNewLine = true;
                            }
                        }
                        str4 = arrayList;
                        if (!this.reactionsLayoutInBubble.isSmall) {
                            str4 = arrayList;
                            if (!this.reactionsLayoutInBubble.isEmpty) {
                                this.reactionsLayoutInBubble.measure(maxWidth17, 3);
                                this.totalHeight += this.reactionsLayoutInBubble.height + AndroidUtilities.dp(12.0f);
                                int timeWidthTotal5 = this.timeWidth + (messageObject.isOutOwner() ? AndroidUtilities.dp(20.0f) : 0) + getExtraTimeX();
                                str4 = arrayList;
                                if (timeWidthTotal5 >= (this.backgroundWidth - AndroidUtilities.dp(24.0f)) - this.reactionsLayoutInBubble.lastLineX) {
                                    this.totalHeight += AndroidUtilities.dp(16.0f);
                                    this.reactionsLayoutInBubble.positionOffsetY -= AndroidUtilities.dp(16.0f);
                                    str4 = arrayList;
                                }
                            }
                        }
                    } else {
                        messageObject6 = messageObject;
                        this.drawForwardedName = messageObject6.messageOwner.fwd_from != null && (!messageObject.isAnyKindOfSticker() || !messageObject.isDice());
                        if (!messageObject.isAnyKindOfSticker() && messageObject6.type != 5) {
                            this.drawName = ((messageObject.isFromGroup() && messageObject.isSupergroup()) || (messageObject.isImportedForward() && messageObject6.messageOwner.fwd_from.from_id == null)) && ((groupedMessagePosition7 = this.currentPosition) == null || (groupedMessagePosition7.flags & 4) != 0);
                        }
                        boolean z22 = messageObject6.type != 9;
                        this.isMedia = z22;
                        this.mediaBackground = z22;
                        this.drawImageButton = true;
                        this.drawPhotoImage = true;
                        int photoWidth6 = 0;
                        int photoHeight9 = 0;
                        int additionHeight5 = 0;
                        if (messageObject6.gifState != 2.0f && !SharedConfig.autoplayGifs && (messageObject6.type == 8 || messageObject6.type == 5)) {
                            messageObject6.gifState = 1.0f;
                        }
                        this.photoImage.setAllowDecodeSingleFrame(true);
                        if (messageObject.isVideo()) {
                            this.photoImage.setAllowStartAnimation(true);
                        } else if (messageObject.isRoundVideo()) {
                            MessageObject playingMessage = MediaController.getInstance().getPlayingMessageObject();
                            this.photoImage.setAllowStartAnimation(playingMessage == null || !playingMessage.isRoundVideo());
                        } else {
                            this.photoImage.setAllowStartAnimation(messageObject6.gifState == 0.0f);
                        }
                        this.photoImage.setForcePreview(messageObject.needDrawBluredPreview());
                        if (messageObject6.type == 9) {
                            if (AndroidUtilities.isTablet()) {
                                this.backgroundWidth = Math.min(AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(300.0f));
                            } else {
                                this.backgroundWidth = Math.min(getParentWidth() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(300.0f));
                            }
                            if (checkNeedDrawShareButton(messageObject)) {
                                this.backgroundWidth -= AndroidUtilities.dp(20.0f);
                            }
                            int maxTextWidth = 0;
                            int maxWidth18 = this.backgroundWidth - AndroidUtilities.dp(138.0f);
                            createDocumentLayout(maxWidth18, messageObject6);
                            int widthForCaption5 = ((this.backgroundWidth - AndroidUtilities.dp(31.0f)) - AndroidUtilities.dp(10.0f)) - (getExtraTextX() * 2);
                            if (!messageObject6.isRestrictedMessage && !TextUtils.isEmpty(messageObject6.caption)) {
                                try {
                                    this.currentCaption = messageObject6.caption;
                                    if (Build.VERSION.SDK_INT >= 24) {
                                        this.captionLayout = StaticLayout.Builder.obtain(messageObject6.caption, 0, messageObject6.caption.length(), Theme.chat_msgTextPaint, widthForCaption5).setBreakStrategy(1).setHyphenationFrequency(0).setAlignment(Layout.Alignment.ALIGN_NORMAL).build();
                                    } else {
                                        this.captionLayout = new StaticLayout(messageObject6.caption, Theme.chat_msgTextPaint, widthForCaption5, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                    }
                                    updateCaptionSpoilers();
                                } catch (Exception e36) {
                                    FileLog.e(e36);
                                }
                            }
                            StaticLayout staticLayout14 = this.docTitleLayout;
                            if (staticLayout14 != null) {
                                int N9 = staticLayout14.getLineCount();
                                for (int a28 = 0; a28 < N9; a28++) {
                                    maxTextWidth = Math.max(maxTextWidth, ((int) Math.ceil(this.docTitleLayout.getLineWidth(a28) + this.docTitleLayout.getLineLeft(a28))) + AndroidUtilities.dp((this.drawPhotoImage ? 52 : 22) + 86));
                                }
                            }
                            StaticLayout staticLayout15 = this.infoLayout;
                            if (staticLayout15 != null) {
                                int N10 = staticLayout15.getLineCount();
                                for (int a29 = 0; a29 < N10; a29++) {
                                    maxTextWidth = Math.max(maxTextWidth, this.infoWidth + AndroidUtilities.dp((this.drawPhotoImage ? 52 : 22) + 86));
                                }
                            }
                            StaticLayout staticLayout16 = this.captionLayout;
                            if (staticLayout16 != null) {
                                int N11 = staticLayout16.getLineCount();
                                for (int a30 = 0; a30 < N11; a30++) {
                                    int w6 = ((int) Math.ceil(Math.min(widthForCaption5, this.captionLayout.getLineWidth(a30) + this.captionLayout.getLineLeft(a30)))) + AndroidUtilities.dp(31.0f);
                                    if (w6 > maxTextWidth) {
                                        maxTextWidth = w6;
                                    }
                                }
                            }
                            if (!this.reactionsLayoutInBubble.isSmall) {
                                this.reactionsLayoutInBubble.measure(widthForCaption5, 3);
                                if (!this.reactionsLayoutInBubble.isEmpty && this.reactionsLayoutInBubble.width + AndroidUtilities.dp(31.0f) > maxTextWidth) {
                                    maxTextWidth = this.reactionsLayoutInBubble.width + AndroidUtilities.dp(31.0f);
                                }
                            }
                            if (maxTextWidth > 0 && this.currentPosition == null) {
                                this.backgroundWidth = maxTextWidth;
                                maxWidth18 = maxTextWidth - AndroidUtilities.dp(31.0f);
                            }
                            this.availableTimeWidth = maxWidth18;
                            if (this.drawPhotoImage) {
                                photoWidth = AndroidUtilities.dp(86.0f);
                                photoHeight2 = AndroidUtilities.dp(86.0f);
                                this.availableTimeWidth -= photoWidth;
                            } else {
                                photoWidth = AndroidUtilities.dp(56.0f);
                                photoHeight2 = AndroidUtilities.dp(56.0f);
                                StaticLayout staticLayout17 = this.docTitleLayout;
                                if (staticLayout17 != null && staticLayout17.getLineCount() > 1) {
                                    photoHeight2 += (this.docTitleLayout.getLineCount() - 1) * AndroidUtilities.dp(16.0f);
                                }
                                if (TextUtils.isEmpty(messageObject6.caption) && (staticLayout2 = this.infoLayout) != null) {
                                    int lineCount = staticLayout2.getLineCount();
                                    measureTime(messageObject);
                                    int timeLeft2 = (this.backgroundWidth - AndroidUtilities.dp(122.0f)) - this.infoWidth;
                                    if (this.reactionsLayoutInBubble.isSmall || this.reactionsLayoutInBubble.isEmpty) {
                                        if (timeLeft2 < this.timeWidth) {
                                            photoHeight2 += AndroidUtilities.dp(12.0f);
                                        } else if (lineCount == 1) {
                                            photoHeight2 += AndroidUtilities.dp(4.0f);
                                        }
                                    }
                                }
                            }
                            if (!this.reactionsLayoutInBubble.isSmall && !this.reactionsLayoutInBubble.isEmpty) {
                                if (!this.drawPhotoImage) {
                                    this.reactionsLayoutInBubble.positionOffsetY += AndroidUtilities.dp(2.0f);
                                }
                                if (this.captionLayout != null && this.currentPosition != null && (groupedMessages5 = this.currentMessagesGroup) != null && groupedMessages5.isDocuments) {
                                    this.reactionsLayoutInBubble.positionOffsetY += AndroidUtilities.dp(10.0f);
                                } else if (!this.drawPhotoImage && !TextUtils.isEmpty(messageObject6.caption) && (((staticLayout = this.docTitleLayout) != null && staticLayout.getLineCount() > 1) || this.currentMessageObject.hasValidReplyMessageObject())) {
                                    this.reactionsLayoutInBubble.positionOffsetY += AndroidUtilities.dp(10.0f);
                                } else if (!this.drawPhotoImage && !TextUtils.isEmpty(messageObject6.caption) && !this.currentMessageObject.isOutOwner()) {
                                    this.reactionsLayoutInBubble.positionOffsetY += AndroidUtilities.dp(10.0f);
                                }
                                ReactionsLayoutInBubble reactionsLayoutInBubble5 = this.reactionsLayoutInBubble;
                                reactionsLayoutInBubble5.totalHeight = reactionsLayoutInBubble5.height + AndroidUtilities.dp(8.0f);
                                measureTime(messageObject);
                                if (this.drawPhotoImage && this.captionLayout == null) {
                                    this.reactionsLayoutInBubble.totalHeight += AndroidUtilities.dp(8.0f);
                                }
                                int timeLeft3 = (this.backgroundWidth - this.reactionsLayoutInBubble.lastLineX) - AndroidUtilities.dp(24.0f);
                                if (timeLeft3 < this.timeWidth) {
                                    this.reactionsLayoutInBubble.totalHeight += AndroidUtilities.dp(12.0f);
                                    this.reactionsLayoutInBubble.positionOffsetY -= AndroidUtilities.dp(12.0f);
                                }
                                additionHeight5 = 0 + this.reactionsLayoutInBubble.totalHeight;
                            }
                            photoHeight = 5;
                            i4 = 1;
                        } else if (messageObject6.type == 4) {
                            TLRPC.GeoPoint point = messageObject6.messageOwner.media.geo;
                            double lat = point.lat;
                            double lon = point._long;
                            int provider = ((int) messageObject.getDialogId()) == 0 ? SharedConfig.mapPreviewType == 0 ? -1 : SharedConfig.mapPreviewType == 1 ? 4 : SharedConfig.mapPreviewType == 3 ? 1 : -1 : -1;
                            if (messageObject6.messageOwner.media instanceof TLRPC.TL_messageMediaGeoLive) {
                                if (AndroidUtilities.isTablet()) {
                                    this.backgroundWidth = Math.min(AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(289.0f));
                                } else {
                                    this.backgroundWidth = Math.min(getParentWidth() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(289.0f));
                                }
                                this.backgroundWidth -= AndroidUtilities.dp(4.0f);
                                if (checkNeedDrawShareButton(messageObject)) {
                                    this.backgroundWidth -= AndroidUtilities.dp(20.0f);
                                }
                                int maxWidth19 = this.backgroundWidth - AndroidUtilities.dp(37.0f);
                                this.availableTimeWidth = maxWidth19;
                                int maxWidth20 = maxWidth19 - AndroidUtilities.dp(54.0f);
                                int photoWidth7 = this.backgroundWidth - AndroidUtilities.dp(17.0f);
                                int photoHeight10 = AndroidUtilities.dp(195.0f);
                                double d5 = 268435456;
                                Double.isNaN(d5);
                                double rad = d5 / 3.141592653589793d;
                                double d6 = 268435456;
                                Double.isNaN(d6);
                                double y2 = Math.round(d6 - ((Math.log((Math.sin((3.141592653589793d * lat) / 180.0d) + 1.0d) / (1.0d - Math.sin((3.141592653589793d * lat) / 180.0d))) * rad) / 2.0d)) - (AndroidUtilities.dp(10.3f) << 6);
                                double d7 = 268435456;
                                Double.isNaN(y2);
                                Double.isNaN(d7);
                                double lat2 = ((1.5707963267948966d - (Math.atan(Math.exp((y2 - d7) / rad)) * 2.0d)) * 180.0d) / 3.141592653589793d;
                                int offset = this.currentAccount;
                                this.currentUrl = AndroidUtilities.formapMapUrl(offset, lat2, lon, (int) (photoWidth7 / AndroidUtilities.density), (int) (photoHeight10 / AndroidUtilities.density), false, 15, provider);
                                this.lastWebFile = this.currentWebFile;
                                photoWidth5 = photoWidth7;
                                photoHeight8 = photoHeight10;
                                this.currentWebFile = WebFile.createWithGeoPoint(lat2, lon, point.access_hash, (int) (photoWidth7 / AndroidUtilities.density), (int) (photoHeight10 / AndroidUtilities.density), 15, Math.min(2, (int) Math.ceil(AndroidUtilities.density)));
                                boolean isCurrentLocationTimeExpired = isCurrentLocationTimeExpired(messageObject);
                                this.locationExpired = isCurrentLocationTimeExpired;
                                if (!isCurrentLocationTimeExpired) {
                                    this.photoImage.setCrossfadeWithOldImage(true);
                                    this.mediaBackground = false;
                                    additionHeight4 = AndroidUtilities.dp(56.0f);
                                    AndroidUtilities.runOnUIThread(this.invalidateRunnable, 1000L);
                                    this.scheduledInvalidate = true;
                                } else {
                                    this.backgroundWidth -= AndroidUtilities.dp(9.0f);
                                    additionHeight4 = 0;
                                }
                                this.docTitleLayout = new StaticLayout(TextUtils.ellipsize(LocaleController.getString("AttachLiveLocation", R.string.AttachLiveLocation), Theme.chat_locationTitlePaint, maxWidth20, TextUtils.TruncateAt.END), Theme.chat_locationTitlePaint, maxWidth20 + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                updateCurrentUserAndChat();
                                TLRPC.User user5 = this.currentUser;
                                if (user5 != null) {
                                    this.contactAvatarDrawable.setInfo(user5);
                                    this.locationImageReceiver.setForUserOrChat(this.currentUser, this.contactAvatarDrawable);
                                } else {
                                    TLRPC.Chat chat2 = this.currentChat;
                                    if (chat2 != null) {
                                        if (chat2.photo != null) {
                                            this.currentPhoto = this.currentChat.photo.photo_small;
                                        }
                                        this.contactAvatarDrawable.setInfo(this.currentChat);
                                        this.locationImageReceiver.setForUserOrChat(this.currentChat, this.contactAvatarDrawable);
                                    } else {
                                        this.locationImageReceiver.setImage(null, null, this.contactAvatarDrawable, null, null, 0);
                                    }
                                }
                                messageObject4 = messageObject;
                                this.infoLayout = new StaticLayout(TextUtils.ellipsize(LocaleController.formatLocationUpdateDate(messageObject4.messageOwner.edit_date != 0 ? messageObject4.messageOwner.edit_date : messageObject4.messageOwner.date), Theme.chat_locationAddressPaint, AndroidUtilities.dp(2.0f) + maxWidth20, TextUtils.TruncateAt.END), Theme.chat_locationAddressPaint, maxWidth20, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                additionHeight3 = additionHeight4;
                            } else {
                                additionHeight3 = 0;
                                messageObject4 = messageObject6;
                                if (!TextUtils.isEmpty(messageObject4.messageOwner.media.title)) {
                                    if (AndroidUtilities.isTablet()) {
                                        this.backgroundWidth = Math.min(AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(289.0f));
                                    } else {
                                        this.backgroundWidth = Math.min(getParentWidth() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(289.0f));
                                    }
                                    this.backgroundWidth -= AndroidUtilities.dp(4.0f);
                                    if (checkNeedDrawShareButton(messageObject)) {
                                        this.backgroundWidth -= AndroidUtilities.dp(20.0f);
                                    }
                                    int maxWidth21 = this.backgroundWidth - AndroidUtilities.dp(34.0f);
                                    this.availableTimeWidth = maxWidth21;
                                    int photoWidth8 = this.backgroundWidth - AndroidUtilities.dp(17.0f);
                                    int photoHeight11 = AndroidUtilities.dp(195.0f);
                                    this.mediaBackground = false;
                                    this.currentUrl = AndroidUtilities.formapMapUrl(this.currentAccount, lat, lon, (int) (photoWidth8 / AndroidUtilities.density), (int) (photoHeight11 / AndroidUtilities.density), true, 15, provider);
                                    this.currentWebFile = WebFile.createWithGeoPoint(point, (int) (photoWidth8 / AndroidUtilities.density), (int) (photoHeight11 / AndroidUtilities.density), 15, Math.min(2, (int) Math.ceil(AndroidUtilities.density)));
                                    this.docTitleLayout = StaticLayoutEx.createStaticLayout(messageObject4.messageOwner.media.title, Theme.chat_locationTitlePaint, maxWidth21 + AndroidUtilities.dp(4.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false, TextUtils.TruncateAt.END, maxWidth21, 1);
                                    int additionHeight6 = 0 + AndroidUtilities.dp(50.0f);
                                    this.docTitleLayout.getLineCount();
                                    if (!TextUtils.isEmpty(messageObject4.messageOwner.media.address)) {
                                        this.infoLayout = StaticLayoutEx.createStaticLayout(messageObject4.messageOwner.media.address, Theme.chat_locationAddressPaint, maxWidth21, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false, TextUtils.TruncateAt.END, maxWidth21, 1);
                                        measureTime(messageObject);
                                        int timeLeft4 = (this.backgroundWidth - ((int) Math.ceil(this.infoLayout.getLineWidth(0)))) - AndroidUtilities.dp(24.0f);
                                        boolean isRtl = this.infoLayout.getLineLeft(0) > 0.0f;
                                        if (!isRtl) {
                                        }
                                        additionHeight6 += AndroidUtilities.dp(isRtl ? 10.0f : 8.0f);
                                    } else {
                                        this.infoLayout = null;
                                    }
                                    photoHeight8 = photoHeight11;
                                    photoWidth5 = photoWidth8;
                                    additionHeight3 = additionHeight6;
                                } else {
                                    if (AndroidUtilities.isTablet()) {
                                        this.backgroundWidth = Math.min(AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(289.0f));
                                    } else {
                                        this.backgroundWidth = Math.min(getParentWidth() - AndroidUtilities.dp(drawAvatar ? 102.0f : 50.0f), AndroidUtilities.dp(289.0f));
                                    }
                                    this.backgroundWidth -= AndroidUtilities.dp(4.0f);
                                    if (checkNeedDrawShareButton(messageObject)) {
                                        this.backgroundWidth -= AndroidUtilities.dp(20.0f);
                                    }
                                    this.availableTimeWidth = this.backgroundWidth - AndroidUtilities.dp(34.0f);
                                    int photoWidth9 = this.backgroundWidth - AndroidUtilities.dp(8.0f);
                                    int photoHeight12 = AndroidUtilities.dp(195.0f);
                                    int photoHeight13 = this.currentAccount;
                                    this.currentUrl = AndroidUtilities.formapMapUrl(photoHeight13, lat, lon, (int) (photoWidth9 / AndroidUtilities.density), (int) (photoHeight12 / AndroidUtilities.density), true, 15, provider);
                                    this.currentWebFile = WebFile.createWithGeoPoint(point, (int) (photoWidth9 / AndroidUtilities.density), (int) (photoHeight12 / AndroidUtilities.density), 15, Math.min(2, (int) Math.ceil(AndroidUtilities.density)));
                                    photoHeight8 = photoHeight12;
                                    photoWidth5 = photoWidth9;
                                }
                            }
                            if (((int) messageObject.getDialogId()) != 0) {
                                i10 = -1;
                                this.currentMapProvider = MessagesController.getInstance(messageObject4.currentAccount).mapProvider;
                            } else if (SharedConfig.mapPreviewType == 0) {
                                this.currentMapProvider = 2;
                                i10 = -1;
                            } else if (SharedConfig.mapPreviewType == 1) {
                                this.currentMapProvider = 1;
                                i10 = -1;
                            } else if (SharedConfig.mapPreviewType == 3) {
                                this.currentMapProvider = 1;
                                i10 = -1;
                            } else {
                                i10 = -1;
                                this.currentMapProvider = -1;
                            }
                            int i43 = this.currentMapProvider;
                            if (i43 == i10) {
                                messageObject6 = messageObject4;
                                this.photoImage.setImage(null, null, null, null, messageObject, 0);
                            } else {
                                messageObject6 = messageObject4;
                                if (i43 != 2) {
                                    if (i43 == 3 || i43 == 4) {
                                        ImageLoader.getInstance().addTestWebFile(this.currentUrl, this.currentWebFile);
                                        this.addedForTest = true;
                                    }
                                    String str27 = this.currentUrl;
                                    if (str27 != null) {
                                        this.photoImage.setImage(str27, null, null, null, 0L);
                                    }
                                } else if (this.currentWebFile != null) {
                                    WebFile webFile = this.lastWebFile;
                                    ImageLocation lastLocation = webFile == null ? null : ImageLocation.getForWebFile(webFile);
                                    this.photoImage.setImage(ImageLocation.getForWebFile(this.currentWebFile), (String) null, lastLocation, (String) null, (Drawable) null, messageObject, 0);
                                }
                            }
                            if (this.reactionsLayoutInBubble.isSmall || this.reactionsLayoutInBubble.isEmpty) {
                                additionHeight5 = additionHeight3;
                            } else {
                                this.reactionsLayoutInBubble.measure(this.backgroundWidth - AndroidUtilities.dp(16.0f), 3);
                                ReactionsLayoutInBubble reactionsLayoutInBubble6 = this.reactionsLayoutInBubble;
                                reactionsLayoutInBubble6.totalHeight = reactionsLayoutInBubble6.height + AndroidUtilities.dp(14.0f);
                                measureTime(messageObject);
                                if (this.reactionsLayoutInBubble.lastLineX + this.timeWidth + AndroidUtilities.dp(24.0f) > this.backgroundWidth) {
                                    this.reactionsLayoutInBubble.totalHeight += AndroidUtilities.dp(12.0f);
                                    this.reactionsLayoutInBubble.positionOffsetY -= AndroidUtilities.dp(12.0f);
                                }
                                additionHeight5 = additionHeight3 + this.reactionsLayoutInBubble.totalHeight;
                            }
                            photoWidth = photoWidth5;
                            photoHeight2 = photoHeight8;
                            photoHeight = 5;
                            i4 = 1;
                        } else if (messageObject.isAnyKindOfSticker()) {
                            this.drawBackground = false;
                            boolean isWebpSticker2 = messageObject6.type == 13;
                            int a31 = 0;
                            while (true) {
                                if (a31 >= messageObject.getDocument().attributes.size()) {
                                    break;
                                }
                                TLRPC.DocumentAttribute attribute8 = messageObject.getDocument().attributes.get(a31);
                                if (attribute8 instanceof TLRPC.TL_documentAttributeImageSize) {
                                    photoWidth6 = attribute8.w;
                                    photoHeight9 = attribute8.h;
                                    break;
                                } else if (attribute8 instanceof TLRPC.TL_documentAttributeVideo) {
                                    photoWidth6 = attribute8.w;
                                    photoHeight9 = attribute8.h;
                                    break;
                                } else {
                                    a31++;
                                }
                            }
                            if ((messageObject.isAnimatedSticker() || messageObject.isVideoSticker()) && photoWidth6 == 0 && photoHeight9 == 0) {
                                photoHeight9 = 512;
                                photoWidth6 = 512;
                            }
                            if (AndroidUtilities.isTablet()) {
                                int maxWidth22 = (int) (AndroidUtilities.getMinTabletSide() * 0.4f);
                                maxHeight2 = maxWidth22;
                                maxWidth = maxWidth22;
                            } else {
                                int maxWidth23 = (int) (Math.min(getParentWidth(), AndroidUtilities.displaySize.y) * 0.5f);
                                maxHeight2 = maxWidth23;
                                maxWidth = maxWidth23;
                            }
                            if (messageObject.isAnimatedEmoji() || messageObject.isDice()) {
                                float zoom = MessagesController.getInstance(this.currentAccount).animatedEmojisZoom;
                                photoWidth4 = (int) ((photoWidth6 / 512.0f) * maxWidth * zoom);
                                photoHeight7 = (int) ((photoHeight9 / 512.0f) * maxHeight2 * zoom);
                            } else {
                                if (photoWidth6 == 0) {
                                    photoHeight9 = (int) maxHeight2;
                                    photoWidth6 = photoHeight9 + AndroidUtilities.dp(100.0f);
                                }
                                int photoHeight14 = (int) (photoHeight9 * (maxWidth / photoWidth6));
                                int photoWidth10 = maxWidth;
                                if (photoHeight14 > maxHeight2) {
                                    int photoHeight15 = (int) maxHeight2;
                                    photoWidth4 = (int) (photoWidth10 * (maxHeight2 / photoHeight14));
                                    photoHeight7 = photoHeight15;
                                } else {
                                    photoWidth4 = photoWidth10;
                                    photoHeight7 = photoHeight14;
                                }
                            }
                            int w7 = (int) (photoWidth4 / AndroidUtilities.density);
                            int h8 = (int) (photoHeight7 / AndroidUtilities.density);
                            ChatMessageCellDelegate chatMessageCellDelegate4 = this.delegate;
                            boolean shouldRepeatSticker = chatMessageCellDelegate4 != null && chatMessageCellDelegate4.shouldRepeatSticker(messageObject6);
                            if (this.currentMessageObject.strippedThumb == null) {
                                this.currentPhotoObjectThumb = FileLoader.getClosestPhotoSizeWithSize(messageObject6.photoThumbs, 40);
                            } else {
                                this.currentPhotoObjectThumbStripped = this.currentMessageObject.strippedThumb;
                            }
                            this.photoParentObject = messageObject6.photoThumbsObject;
                            if (messageObject.isDice()) {
                                String filter3 = String.format(Locale.US, "%d_%d_dice_%s_%s", Integer.valueOf(w7), Integer.valueOf(h8), messageObject.getDiceEmoji(), messageObject.toString());
                                this.photoImage.setAutoRepeat(2);
                                String emoji = this.currentMessageObject.getDiceEmoji();
                                TLRPC.TL_messages_stickerSet stickerSet = MediaDataController.getInstance(this.currentAccount).getStickerSetByEmojiOrName(emoji);
                                if (stickerSet == null) {
                                    parentObject = messageObject;
                                    filter = filter3;
                                } else if (stickerSet.documents.size() > 0) {
                                    int value = this.currentMessageObject.getDiceValue();
                                    if (value <= 0) {
                                        parentObject = messageObject;
                                        TLRPC.Document document15 = stickerSet.documents.get(0);
                                        if ("".equals(emoji)) {
                                            this.currentPhotoObjectThumb = null;
                                            filter = filter3;
                                        } else {
                                            filter = filter3;
                                            this.currentPhotoObjectThumb = FileLoader.getClosestPhotoSizeWithSize(document15.thumbs, 40);
                                        }
                                        this.photoParentObject = document15;
                                    } else {
                                        parentObject = messageObject;
                                        filter = filter3;
                                    }
                                } else {
                                    parentObject = messageObject;
                                    filter = filter3;
                                }
                            } else {
                                parentObject = messageObject;
                                if (messageObject.isAnimatedEmoji()) {
                                    String filter4 = String.format(Locale.US, "%d_%d_nr_messageId=%d" + messageObject6.emojiAnimatedStickerColor, Integer.valueOf(w7), Integer.valueOf(h8), Integer.valueOf(messageObject6.stableId));
                                    this.photoImage.setAutoRepeat(shouldRepeatSticker ? 2 : 3);
                                    parentObject = MessageObject.getInputStickerSet(messageObject6.emojiAnimatedSticker);
                                    filter = filter4;
                                } else if (SharedConfig.loopStickers || (isWebpSticker2 && !messageObject.isVideoSticker())) {
                                    String filter5 = String.format(Locale.US, "%d_%d", Integer.valueOf(w7), Integer.valueOf(h8));
                                    this.photoImage.setAutoRepeat(1);
                                    filter = filter5;
                                } else {
                                    String filter6 = String.format(Locale.US, "%d_%d_nr_messageId=%d", Integer.valueOf(w7), Integer.valueOf(h8), Integer.valueOf(messageObject6.stableId));
                                    this.photoImage.setAutoRepeat(shouldRepeatSticker ? 2 : 3);
                                    filter = filter6;
                                }
                            }
                            this.documentAttachType = 6;
                            this.availableTimeWidth = photoWidth4 - AndroidUtilities.dp(14.0f);
                            this.backgroundWidth = AndroidUtilities.dp(12.0f) + photoWidth4;
                            this.photoImage.setRoundRadius(0);
                            autoDownload = false;
                            if (!messageObject.isOutOwner() && MessageObject.isPremiumSticker(messageObject.getDocument())) {
                                this.flipImage = true;
                            }
                            if (messageObject.isVideoSticker()) {
                                if (!SharedConfig.loopStickers) {
                                    this.photoImage.animatedFileDrawableRepeatMaxCount = 1;
                                }
                                this.photoImage.setImage(ImageLocation.getForDocument(messageObject.getDocument()), ImageLoader.AUTOPLAY_FILTER, null, null, messageObject6.pathThumb, messageObject.getDocument().size, isWebpSticker2 ? "webp" : null, parentObject, 1);
                            } else if (messageObject6.pathThumb != null) {
                                this.photoImage.setImage(ImageLocation.getForDocument(messageObject.getDocument()), filter, messageObject6.pathThumb, messageObject.getDocument().size, isWebpSticker2 ? "webp" : null, parentObject, 1);
                            } else if (messageObject6.attachPathExists) {
                                this.photoImage.setImage(ImageLocation.getForPath(messageObject6.messageOwner.attachPath), filter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), "b1", this.currentPhotoObjectThumbStripped, messageObject.getDocument().size, isWebpSticker2 ? "webp" : null, parentObject, 1);
                            } else if (messageObject.getDocument().id != 0) {
                                this.photoImage.setImage(ImageLocation.getForDocument(messageObject.getDocument()), filter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), "b1", this.currentPhotoObjectThumbStripped, messageObject.getDocument().size, isWebpSticker2 ? "webp" : null, parentObject, 1);
                            } else {
                                this.photoImage.setImage(null, null, null, null, messageObject, 0);
                            }
                            if (!this.reactionsLayoutInBubble.isSmall) {
                                this.reactionsLayoutInBubble.measure(maxWidth, 3);
                                this.reactionsLayoutInBubble.drawServiceShaderBackground = true;
                                ReactionsLayoutInBubble reactionsLayoutInBubble7 = this.reactionsLayoutInBubble;
                                reactionsLayoutInBubble7.totalHeight = reactionsLayoutInBubble7.height + AndroidUtilities.dp(8.0f);
                                int additionHeight7 = 0 + this.reactionsLayoutInBubble.totalHeight;
                                this.reactionsLayoutInBubble.positionOffsetY += AndroidUtilities.dp(4.0f);
                                additionHeight5 = additionHeight7;
                            } else {
                                additionHeight5 = 0;
                            }
                            photoWidth = photoWidth4;
                            photoHeight2 = photoHeight7;
                            photoHeight = 5;
                            i4 = 1;
                        } else {
                            this.currentPhotoObject = FileLoader.getClosestPhotoSizeWithSize(messageObject6.photoThumbs, AndroidUtilities.getPhotoSize());
                            this.photoParentObject = messageObject6.photoThumbsObject;
                            if (messageObject6.type == 5) {
                                this.documentAttach = messageObject.getDocument();
                                this.documentAttachType = 7;
                                useFullWidth = false;
                            } else if (AndroidUtilities.isTablet()) {
                                photoWidth6 = (int) (AndroidUtilities.getMinTabletSide() * 0.7f);
                                useFullWidth = false;
                            } else if (this.currentPhotoObject == null || (!(messageObject6.type == 1 || messageObject6.type == 3 || messageObject6.type == 8) || this.currentPhotoObject.w < this.currentPhotoObject.h)) {
                                photoWidth6 = (int) (Math.min(getParentWidth(), AndroidUtilities.displaySize.y) * 0.7f);
                                useFullWidth = false;
                            } else {
                                photoWidth6 = Math.min(getParentWidth(), AndroidUtilities.displaySize.y) - AndroidUtilities.dp((checkNeedDrawShareButton(messageObject) ? 10 : 0) + 64);
                                useFullWidth = true;
                            }
                            int photoHeight16 = AndroidUtilities.dp(100.0f) + photoWidth6;
                            if (!useFullWidth) {
                                if (messageObject6.type != 5 && checkNeedDrawShareButton(messageObject)) {
                                    photoWidth6 -= AndroidUtilities.dp(20.0f);
                                }
                                if (photoWidth6 > AndroidUtilities.getPhotoSize()) {
                                    photoWidth6 = AndroidUtilities.getPhotoSize();
                                }
                                if (photoHeight16 > AndroidUtilities.getPhotoSize()) {
                                    photoHeight16 = AndroidUtilities.getPhotoSize();
                                }
                            } else if (drawAvatar) {
                                photoWidth6 -= AndroidUtilities.dp(52.0f);
                            }
                            if (messageObject6.type == 1) {
                                updateSecretTimeText(messageObject);
                                this.currentPhotoObjectThumb = FileLoader.getClosestPhotoSizeWithSize(messageObject6.photoThumbs, 40);
                            } else {
                                if (messageObject6.type == 3 || messageObject6.type == 8) {
                                    createDocumentLayout(0, messageObject6);
                                    this.currentPhotoObjectThumb = FileLoader.getClosestPhotoSizeWithSize(messageObject6.photoThumbs, 40);
                                    updateSecretTimeText(messageObject);
                                    needQualityPreview = true;
                                } else if (messageObject6.type == 5) {
                                    this.currentPhotoObjectThumb = FileLoader.getClosestPhotoSizeWithSize(messageObject6.photoThumbs, 40);
                                    needQualityPreview = true;
                                }
                                if (this.currentMessageObject.strippedThumb != null) {
                                    this.currentPhotoObjectThumb = null;
                                    this.currentPhotoObjectThumbStripped = this.currentMessageObject.strippedThumb;
                                }
                                if (messageObject6.type == 5) {
                                    TLRPC.PhotoSize size3 = this.currentPhotoObject;
                                    if (size3 == null) {
                                        size3 = this.currentPhotoObjectThumb;
                                    }
                                    int imageW2 = 0;
                                    int imageH = 0;
                                    if (size3 == null || (size3 instanceof TLRPC.TL_photoStrippedSize)) {
                                        TLRPC.Document document16 = this.documentAttach;
                                        if (document16 != null) {
                                            int N12 = document16.attributes.size();
                                            for (int a32 = 0; a32 < N12; a32++) {
                                                TLRPC.DocumentAttribute attribute9 = this.documentAttach.attributes.get(a32);
                                                if (attribute9 instanceof TLRPC.TL_documentAttributeVideo) {
                                                    imageW2 = attribute9.w;
                                                    imageH = attribute9.h;
                                                }
                                            }
                                        }
                                    } else {
                                        imageW2 = size3.w;
                                        imageH = size3.h;
                                    }
                                    Point point2 = getMessageSize(imageW2, imageH, photoWidth6, photoHeight16);
                                    w = (int) point2.x;
                                    imageW = (int) point2.y;
                                } else if (this.isPlayingRound) {
                                    w = AndroidUtilities.roundPlayingMessageSize;
                                    imageW = w;
                                } else {
                                    w = AndroidUtilities.roundMessageSize;
                                    imageW = w;
                                }
                                photoSize = this.currentPhotoObject;
                                if (photoSize != null && "s".equals(photoSize.type)) {
                                    this.currentPhotoObject = null;
                                }
                                photoSize2 = this.currentPhotoObject;
                                if (photoSize2 != null && photoSize2 == this.currentPhotoObjectThumb) {
                                    if (messageObject6.type != 1) {
                                        this.currentPhotoObjectThumb = null;
                                        this.currentPhotoObjectThumbStripped = null;
                                    } else {
                                        this.currentPhotoObject = null;
                                    }
                                }
                                if (needQualityPreview && !messageObject.needDrawBluredPreview() && (((photoSize5 = this.currentPhotoObject) == null || photoSize5 == this.currentPhotoObjectThumb) && ((photoSize6 = this.currentPhotoObjectThumb) == null || !"m".equals(photoSize6.type)))) {
                                    this.photoImage.setNeedsQualityThumb(true);
                                    this.photoImage.setShouldGenerateQualityThumb(true);
                                }
                                if (this.currentMessagesGroup == null && messageObject6.caption != null) {
                                    this.mediaBackground = false;
                                }
                                if ((w != 0 || imageW == 0) && messageObject6.type == 8) {
                                    for (a = 0; a < messageObject.getDocument().attributes.size(); a++) {
                                        TLRPC.DocumentAttribute attribute10 = messageObject.getDocument().attributes.get(a);
                                        if ((attribute10 instanceof TLRPC.TL_documentAttributeImageSize) || (attribute10 instanceof TLRPC.TL_documentAttributeVideo)) {
                                            float scale6 = attribute10.w / photoWidth6;
                                            w = (int) (attribute10.w / scale6);
                                            imageW = (int) (attribute10.h / scale6);
                                            if (imageW > photoHeight16) {
                                                float scale22 = imageW;
                                                imageW = photoHeight16;
                                                w = (int) (w / (scale22 / imageW));
                                            } else if (imageW < AndroidUtilities.dp(120.0f)) {
                                                imageW = AndroidUtilities.dp(120.0f);
                                                float hScale = attribute10.h / imageW;
                                                if (attribute10.w / hScale < photoWidth6) {
                                                    w = (int) (attribute10.w / hScale);
                                                }
                                            }
                                        }
                                    }
                                }
                                if (w != 0 || imageW == 0) {
                                    int dp15 = AndroidUtilities.dp(150.0f);
                                    imageW = dp15;
                                    w = dp15;
                                }
                                if (messageObject6.type == 3 && w < this.infoWidth + AndroidUtilities.dp(40.0f)) {
                                    w = this.infoWidth + AndroidUtilities.dp(40.0f);
                                }
                                if (this.commentLayout != null && this.drawSideButton != 3 && w < this.totalCommentWidth + AndroidUtilities.dp(10.0f)) {
                                    w = this.totalCommentWidth + AndroidUtilities.dp(10.0f);
                                }
                                if (this.currentMessagesGroup == null) {
                                    int firstLineWidth = 0;
                                    int dWidth = getGroupPhotosWidth();
                                    for (int a33 = 0; a33 < this.currentMessagesGroup.posArray.size(); a33++) {
                                        MessageObject.GroupedMessagePosition position = this.currentMessagesGroup.posArray.get(a33);
                                        if (position.minY != 0) {
                                            break;
                                        }
                                        double d8 = firstLineWidth;
                                        double ceil6 = Math.ceil(((position.pw + position.leftSpanOffset) / 1000.0f) * dWidth);
                                        Double.isNaN(d8);
                                        firstLineWidth = (int) (d8 + ceil6);
                                    }
                                    this.availableTimeWidth = firstLineWidth - AndroidUtilities.dp(35.0f);
                                } else {
                                    this.availableTimeWidth = photoWidth6 - AndroidUtilities.dp(14.0f);
                                }
                                if (messageObject6.type == 5) {
                                    double d9 = AndroidUtilities.roundMessageSize;
                                    double ceil7 = Math.ceil(Theme.chat_audioTimePaint.measureText("00:00"));
                                    Double.isNaN(d9);
                                    double d10 = d9 - ceil7;
                                    double dp16 = AndroidUtilities.dp(46.0f);
                                    Double.isNaN(dp16);
                                    this.availableTimeWidth = (int) (d10 - dp16);
                                }
                                measureTime(messageObject);
                                timeWidthTotal = this.timeWidth + AndroidUtilities.dp((SharedConfig.bubbleRadius < 10 ? 22 : 18) + (!messageObject.isOutOwner() ? 20 : 0));
                                if (w < timeWidthTotal) {
                                    w = timeWidthTotal;
                                }
                                if (!messageObject.isRoundVideo()) {
                                    int min5 = Math.min(w, imageW);
                                    imageW = min5;
                                    w = min5;
                                    this.drawBackground = false;
                                    this.photoImage.setRoundRadius(w / 2);
                                    autoDownload = false;
                                } else if (messageObject.needDrawBluredPreview()) {
                                    if (AndroidUtilities.isTablet()) {
                                        int minTabletSide = (int) (AndroidUtilities.getMinTabletSide() * 0.5f);
                                        imageW = minTabletSide;
                                        w = minTabletSide;
                                    } else {
                                        int min6 = (int) (Math.min(getParentWidth(), AndroidUtilities.displaySize.y) * 0.5f);
                                        imageW = min6;
                                        w = min6;
                                    }
                                }
                                int widthForCaption6 = 0;
                                boolean fixPhotoWidth3 = false;
                                if (this.currentMessagesGroup == null) {
                                    float maxHeight3 = Math.max(getParentWidth(), AndroidUtilities.displaySize.y) * 0.5f;
                                    int dWidth2 = getGroupPhotosWidth();
                                    int w8 = (int) Math.ceil((this.currentPosition.pw / 1000.0f) * dWidth2);
                                    if (this.currentPosition.minY == 0 || ((!messageObject.isOutOwner() || (this.currentPosition.flags & 1) == 0) && (messageObject.isOutOwner() || (this.currentPosition.flags & 2) == 0))) {
                                        widthForCaption3 = 0;
                                        fixPhotoWidth = false;
                                        timeWidthTotal2 = timeWidthTotal;
                                    } else {
                                        int firstLineWidth2 = 0;
                                        int currentLineWidth = 0;
                                        int a34 = 0;
                                        while (true) {
                                            if (a34 >= this.currentMessagesGroup.posArray.size()) {
                                                widthForCaption3 = widthForCaption6;
                                                fixPhotoWidth = fixPhotoWidth3;
                                                timeWidthTotal2 = timeWidthTotal;
                                                break;
                                            }
                                            MessageObject.GroupedMessagePosition position2 = this.currentMessagesGroup.posArray.get(a34);
                                            int photoWidth11 = photoWidth6;
                                            if (position2.minY != 0) {
                                                photoHeight6 = photoHeight16;
                                                h5 = imageW;
                                                widthForCaption3 = widthForCaption6;
                                                fixPhotoWidth = fixPhotoWidth3;
                                                timeWidthTotal2 = timeWidthTotal;
                                                if (position2.minY != this.currentPosition.minY) {
                                                    int currentLineWidth2 = position2.minY;
                                                    if (currentLineWidth2 > this.currentPosition.minY) {
                                                        break;
                                                    }
                                                } else {
                                                    double d11 = currentLineWidth;
                                                    double ceil8 = Math.ceil((position2.pw / 1000.0f) * dWidth2);
                                                    double ceil9 = position2.leftSpanOffset != 0 ? Math.ceil((position2.leftSpanOffset / 1000.0f) * dWidth2) : FirebaseRemoteConfig.DEFAULT_VALUE_FOR_DOUBLE;
                                                    Double.isNaN(d11);
                                                    currentLineWidth = (int) (d11 + ceil8 + ceil9);
                                                }
                                            } else {
                                                timeWidthTotal2 = timeWidthTotal;
                                                double d12 = firstLineWidth2;
                                                photoHeight6 = photoHeight16;
                                                h5 = imageW;
                                                double ceil10 = Math.ceil((position2.pw / 1000.0f) * dWidth2);
                                                if (position2.leftSpanOffset != 0) {
                                                    fixPhotoWidth = fixPhotoWidth3;
                                                    widthForCaption3 = widthForCaption6;
                                                    d2 = Math.ceil((position2.leftSpanOffset / 1000.0f) * dWidth2);
                                                } else {
                                                    widthForCaption3 = widthForCaption6;
                                                    fixPhotoWidth = fixPhotoWidth3;
                                                    d2 = FirebaseRemoteConfig.DEFAULT_VALUE_FOR_DOUBLE;
                                                }
                                                Double.isNaN(d12);
                                                firstLineWidth2 = (int) (d12 + ceil10 + d2);
                                            }
                                            a34++;
                                            photoWidth6 = photoWidth11;
                                            timeWidthTotal = timeWidthTotal2;
                                            photoHeight16 = photoHeight6;
                                            imageW = h5;
                                            fixPhotoWidth3 = fixPhotoWidth;
                                            widthForCaption6 = widthForCaption3;
                                        }
                                        w8 += firstLineWidth2 - currentLineWidth;
                                    }
                                    int w9 = w8 - AndroidUtilities.dp(9.0f);
                                    if (this.isAvatarVisible) {
                                        w9 -= AndroidUtilities.dp(48.0f);
                                    }
                                    if (this.currentPosition.siblingHeights != null) {
                                        int h9 = 0;
                                        for (int a35 = 0; a35 < this.currentPosition.siblingHeights.length; a35++) {
                                            h9 += (int) Math.ceil(this.currentPosition.siblingHeights[a35] * maxHeight3);
                                        }
                                        h2 = h9 + ((this.currentPosition.maxY - this.currentPosition.minY) * Math.round(AndroidUtilities.density * 7.0f));
                                    } else {
                                        h2 = (int) Math.ceil(this.currentPosition.ph * maxHeight3);
                                    }
                                    this.backgroundWidth = w9;
                                    int w10 = ((this.currentPosition.flags & 2) == 0 || (this.currentPosition.flags & 1) == 0) ? ((this.currentPosition.flags & 2) == 0 && (this.currentPosition.flags & 1) == 0) ? w9 - AndroidUtilities.dp(11.0f) : (this.currentPosition.flags & 2) != 0 ? w9 - AndroidUtilities.dp(10.0f) : w9 - AndroidUtilities.dp(9.0f) : w9 - AndroidUtilities.dp(8.0f);
                                    int photoWidth12 = w10;
                                    if (!this.currentPosition.edge) {
                                        photoWidth12 += AndroidUtilities.dp(10.0f);
                                    }
                                    int photoHeight17 = h2;
                                    widthForCaption = widthForCaption3 + (photoWidth12 - AndroidUtilities.dp(10.0f));
                                    boolean checkCaption2 = true;
                                    if ((this.currentPosition.flags & 8) != 0 || (this.currentMessagesGroup.hasSibling && (this.currentPosition.flags & 4) == 0)) {
                                        widthForCaption += getAdditionalWidthForPosition(this.currentPosition);
                                        int count5 = this.currentMessagesGroup.messages.size();
                                        int i44 = 0;
                                        while (i44 < count5) {
                                            MessageObject m = this.currentMessagesGroup.messages.get(i44);
                                            MessageObject.GroupedMessagePosition rowPosition = this.currentMessagesGroup.posArray.get(i44);
                                            if (rowPosition == this.currentPosition || (rowPosition.flags & 8) == 0) {
                                                photoWidth3 = photoWidth12;
                                                photoHeight5 = photoHeight17;
                                                h4 = h2;
                                                checkCaption = checkCaption2;
                                                maxHeight = maxHeight3;
                                                count = count5;
                                                i9 = i44;
                                                widthForCaption = widthForCaption;
                                            } else {
                                                int w11 = (int) Math.ceil((rowPosition.pw / 1000.0f) * dWidth2);
                                                if (rowPosition.minY == 0 || ((!messageObject.isOutOwner() || (rowPosition.flags & 1) == 0) && (messageObject.isOutOwner() || (rowPosition.flags & 2) == 0))) {
                                                    photoWidth3 = photoWidth12;
                                                    photoHeight5 = photoHeight17;
                                                    h4 = h2;
                                                    widthForCaption4 = widthForCaption;
                                                    checkCaption = checkCaption2;
                                                    maxHeight = maxHeight3;
                                                    count = count5;
                                                    i9 = i44;
                                                } else {
                                                    int firstLineWidth3 = 0;
                                                    int currentLineWidth3 = 0;
                                                    photoWidth3 = photoWidth12;
                                                    int photoWidth13 = 0;
                                                    while (true) {
                                                        photoHeight5 = photoHeight17;
                                                        if (photoWidth13 >= this.currentMessagesGroup.posArray.size()) {
                                                            h4 = h2;
                                                            widthForCaption4 = widthForCaption;
                                                            checkCaption = checkCaption2;
                                                            maxHeight = maxHeight3;
                                                            count = count5;
                                                            i9 = i44;
                                                            break;
                                                        }
                                                        MessageObject.GroupedMessagePosition position3 = this.currentMessagesGroup.posArray.get(photoWidth13);
                                                        h4 = h2;
                                                        if (position3.minY != 0) {
                                                            widthForCaption4 = widthForCaption;
                                                            checkCaption = checkCaption2;
                                                            maxHeight = maxHeight3;
                                                            count = count5;
                                                            i9 = i44;
                                                            if (position3.minY != rowPosition.minY) {
                                                                int currentLineWidth4 = position3.minY;
                                                                if (currentLineWidth4 > rowPosition.minY) {
                                                                    break;
                                                                }
                                                            } else {
                                                                double d13 = currentLineWidth3;
                                                                double ceil11 = Math.ceil((position3.pw / 1000.0f) * dWidth2);
                                                                double ceil12 = position3.leftSpanOffset != 0 ? Math.ceil((position3.leftSpanOffset / 1000.0f) * dWidth2) : FirebaseRemoteConfig.DEFAULT_VALUE_FOR_DOUBLE;
                                                                Double.isNaN(d13);
                                                                currentLineWidth3 = (int) (d13 + ceil11 + ceil12);
                                                            }
                                                        } else {
                                                            int count6 = count5;
                                                            i9 = i44;
                                                            double d14 = firstLineWidth3;
                                                            count = count6;
                                                            int count7 = position3.pw;
                                                            maxHeight = maxHeight3;
                                                            checkCaption = checkCaption2;
                                                            double ceil13 = Math.ceil((count7 / 1000.0f) * dWidth2);
                                                            if (position3.leftSpanOffset != 0) {
                                                                widthForCaption4 = widthForCaption;
                                                                d = Math.ceil((position3.leftSpanOffset / 1000.0f) * dWidth2);
                                                            } else {
                                                                widthForCaption4 = widthForCaption;
                                                                d = FirebaseRemoteConfig.DEFAULT_VALUE_FOR_DOUBLE;
                                                            }
                                                            Double.isNaN(d14);
                                                            firstLineWidth3 = (int) (d14 + ceil13 + d);
                                                        }
                                                        photoWidth13++;
                                                        photoHeight17 = photoHeight5;
                                                        h2 = h4;
                                                        i44 = i9;
                                                        count5 = count;
                                                        maxHeight3 = maxHeight;
                                                        checkCaption2 = checkCaption;
                                                        widthForCaption = widthForCaption4;
                                                    }
                                                    int a36 = firstLineWidth3 - currentLineWidth3;
                                                    w11 += a36;
                                                }
                                                int w12 = w11 - AndroidUtilities.dp(9.0f);
                                                int w13 = ((rowPosition.flags & 2) == 0 || (rowPosition.flags & 1) == 0) ? ((rowPosition.flags & 2) == 0 && (rowPosition.flags & 1) == 0) ? w12 - AndroidUtilities.dp(11.0f) : (rowPosition.flags & 2) != 0 ? w12 - AndroidUtilities.dp(10.0f) : w12 - AndroidUtilities.dp(9.0f) : w12 - AndroidUtilities.dp(8.0f);
                                                if (this.isChat && !this.isThreadPost && !m.isOutOwner() && m.needDrawAvatar() && (rowPosition == null || rowPosition.edge)) {
                                                    w13 -= AndroidUtilities.dp(48.0f);
                                                }
                                                w10 = w13 + getAdditionalWidthForPosition(rowPosition);
                                                if (!rowPosition.edge) {
                                                    w10 += AndroidUtilities.dp(10.0f);
                                                }
                                                widthForCaption = widthForCaption4 + w10;
                                                if (rowPosition.minX < this.currentPosition.minX || (this.currentMessagesGroup.hasSibling && rowPosition.minY != rowPosition.maxY)) {
                                                    this.captionOffsetX -= w10;
                                                }
                                            }
                                            if (checkCaption && m.caption != null) {
                                                if (this.currentCaption != null) {
                                                    this.currentCaption = null;
                                                    checkCaption2 = false;
                                                    i44 = i9 + 1;
                                                    photoWidth12 = photoWidth3;
                                                    photoHeight17 = photoHeight5;
                                                    h2 = h4;
                                                    count5 = count;
                                                    maxHeight3 = maxHeight;
                                                } else {
                                                    this.currentCaption = m.caption;
                                                }
                                            }
                                            checkCaption2 = checkCaption;
                                            i44 = i9 + 1;
                                            photoWidth12 = photoWidth3;
                                            photoHeight17 = photoHeight5;
                                            h2 = h4;
                                            count5 = count;
                                            maxHeight3 = maxHeight;
                                        }
                                        photoWidth2 = photoWidth12;
                                        photoHeight3 = photoHeight17;
                                        h3 = h2;
                                    } else {
                                        photoWidth2 = photoWidth12;
                                        photoHeight3 = photoHeight17;
                                        h3 = h2;
                                    }
                                    messageObject3 = messageObject;
                                    w2 = w10;
                                    photoHeight4 = photoWidth2;
                                    h = h3;
                                } else {
                                    int h10 = imageW;
                                    timeWidthTotal2 = timeWidthTotal;
                                    int photoWidth14 = w;
                                    messageObject3 = messageObject;
                                    this.currentCaption = messageObject3.caption;
                                    int minCaptionWidth = AndroidUtilities.isTablet() ? (int) (AndroidUtilities.getMinTabletSide() * 0.65f) : (int) (Math.min(getParentWidth(), AndroidUtilities.displaySize.y) * 0.65f);
                                    if (messageObject.needDrawBluredPreview() || ((this.currentCaption == null && (this.reactionsLayoutInBubble.isEmpty || this.reactionsLayoutInBubble.isSmall)) || photoWidth14 >= minCaptionWidth)) {
                                        widthForCaption = photoWidth14 - AndroidUtilities.dp(10.0f);
                                        fixPhotoWidth2 = false;
                                    } else {
                                        widthForCaption = minCaptionWidth;
                                        fixPhotoWidth2 = true;
                                    }
                                    int dp17 = AndroidUtilities.dp(8.0f) + photoWidth14;
                                    this.backgroundWidth = dp17;
                                    if (!this.mediaBackground) {
                                        this.backgroundWidth = dp17 + AndroidUtilities.dp(9.0f);
                                    }
                                    photoHeight3 = h10;
                                    w2 = w;
                                    photoHeight4 = photoWidth14;
                                    fixPhotoWidth = fixPhotoWidth2;
                                    h = h10;
                                }
                                if (this.currentCaption == null) {
                                    try {
                                        widthForCaption -= getExtraTextX() * 2;
                                        if (Build.VERSION.SDK_INT >= 24) {
                                            try {
                                                CharSequence charSequence = this.currentCaption;
                                                this.captionLayout = StaticLayout.Builder.obtain(charSequence, 0, charSequence.length(), Theme.chat_msgTextPaint, widthForCaption).setBreakStrategy(1).setHyphenationFrequency(0).setAlignment(Layout.Alignment.ALIGN_NORMAL).build();
                                            } catch (Exception e37) {
                                                e3 = e37;
                                                additionHeight2 = 0;
                                                FileLog.e(e3);
                                                widthForCaption2 = widthForCaption;
                                                if (!this.reactionsLayoutInBubble.isSmall) {
                                                }
                                                int additionHeight8 = additionHeight2;
                                                minWidth = (int) (Theme.chat_infoPaint.measureText("100%") + AndroidUtilities.dp(100.0f));
                                                if (this.currentMessagesGroup != null) {
                                                }
                                                int photoWidth15 = photoHeight4;
                                                if (!messageChanged) {
                                                }
                                                String format = String.format(Locale.US, "%d_%d", Integer.valueOf((int) (w2 / AndroidUtilities.density)), Integer.valueOf((int) (h / AndroidUtilities.density)));
                                                this.currentPhotoFilterThumb = format;
                                                this.currentPhotoFilter = format;
                                                if (messageObject3.photoThumbs != null) {
                                                }
                                                if (!messageObject.needDrawBluredPreview()) {
                                                }
                                                if (messageObject3.type == 3) {
                                                }
                                                noSize = true;
                                                photoSize3 = this.currentPhotoObject;
                                                if (photoSize3 != null) {
                                                }
                                                photoSize4 = this.currentPhotoObjectThumb;
                                                if (photoSize4 != null) {
                                                }
                                                if (!SharedConfig.autoplayVideo) {
                                                }
                                                if (this.autoPlayingMedia) {
                                                }
                                                additionHeight5 = additionHeight8;
                                                photoWidth = photoWidth15;
                                                photoHeight2 = photoHeight3;
                                                i4 = i6;
                                                setMessageObjectInternal(messageObject);
                                                if (this.drawForwardedName) {
                                                }
                                                if (this.drawNameLayout) {
                                                    this.namesOffset += AndroidUtilities.dp(7.0f);
                                                }
                                                this.totalHeight = AndroidUtilities.dp(14.0f) + photoHeight2 + this.namesOffset + additionHeight5;
                                                groupedMessagePosition4 = this.currentPosition;
                                                if (groupedMessagePosition4 != null) {
                                                    this.totalHeight -= AndroidUtilities.dp(3.0f);
                                                }
                                                if (this.currentMessageObject.isDice()) {
                                                }
                                                int additionalTop = 0;
                                                if (this.currentPosition != null) {
                                                }
                                                i5 = 4;
                                                if (this.drawPinnedTop) {
                                                }
                                                if (this.namesOffset <= 0) {
                                                }
                                                if (this.currentPosition != null) {
                                                    if ((this.currentPosition.flags & i5) == 0) {
                                                    }
                                                    if ((this.currentPosition.flags & 8) == 0) {
                                                    }
                                                }
                                                f = 0.0f;
                                                this.photoImage.setImageCoords(0.0f, this.namesOffset + y + additionalTop, photoWidth, photoHeight2);
                                                invalidate();
                                                additionHeight = additionHeight5;
                                                r14 = i4;
                                                if (this.currentPosition == null) {
                                                }
                                                if (!messageObject.isAnyKindOfSticker()) {
                                                }
                                                c = 2;
                                                i3 = 0;
                                                z4 = z19;
                                                i = i3;
                                                groupedMessagePosition = this.currentPosition;
                                                if (groupedMessagePosition != null) {
                                                }
                                                this.totalHeight += AndroidUtilities.dp(14.0f);
                                                if (this.currentMessageObject.eventId == 0) {
                                                }
                                                if (messageObject.isSponsored()) {
                                                }
                                                this.botButtons.clear();
                                                if (messageIdChanged) {
                                                }
                                                if (!messageObject6.isRestrictedMessage) {
                                                }
                                                this.substractBackgroundHeight = 0;
                                                this.keyboardHeight = 0;
                                                if (this.drawCommentButton) {
                                                }
                                                z5 = this.drawPinnedBottom;
                                                if (!z5) {
                                                }
                                                if (z5) {
                                                }
                                                if (!messageObject.isAnyKindOfSticker()) {
                                                }
                                                if (messageObject.isAnimatedEmoji()) {
                                                }
                                                if (!this.drawPhotoImage) {
                                                }
                                                if (this.documentAttachType != 5) {
                                                }
                                                if (autoDownload) {
                                                }
                                                messageObject2 = this.currentMessageObject;
                                                if (messageObject2 != null) {
                                                }
                                                if (messageIdChanged) {
                                                }
                                                transcribeButton = this.transcribeButton;
                                                if (transcribeButton != null) {
                                                }
                                                updateWaveform();
                                                updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                                if (!this.currentMessageObject.loadingCancelled) {
                                                }
                                                chatMessageCellDelegate = this.delegate;
                                                if (chatMessageCellDelegate != null) {
                                                }
                                                this.accessibilityVirtualViewBounds.clear();
                                                this.transitionParams.updatePhotoImageX = true;
                                                updateFlagSecure();
                                            }
                                        } else {
                                            this.captionLayout = new StaticLayout(this.currentCaption, Theme.chat_msgTextPaint, widthForCaption, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                        }
                                        updateCaptionSpoilers();
                                        int lineCount2 = this.captionLayout.getLineCount();
                                        if (lineCount2 > 0) {
                                            try {
                                                if (fixPhotoWidth) {
                                                    this.captionWidth = 0;
                                                    int a37 = 0;
                                                    while (true) {
                                                        if (a37 >= lineCount2) {
                                                            break;
                                                        }
                                                        this.captionWidth = (int) Math.max(this.captionWidth, Math.ceil(this.captionLayout.getLineWidth(a37)));
                                                        if (this.captionLayout.getLineLeft(a37) != 0.0f) {
                                                            this.captionWidth = widthForCaption;
                                                            break;
                                                        }
                                                        a37++;
                                                    }
                                                    int a38 = this.captionWidth;
                                                    if (a38 > widthForCaption) {
                                                        this.captionWidth = widthForCaption;
                                                    }
                                                } else {
                                                    this.captionWidth = widthForCaption;
                                                }
                                                int height14 = this.captionLayout.getHeight();
                                                this.captionHeight = height14;
                                                this.addedCaptionHeight = height14 + AndroidUtilities.dp(9.0f);
                                                MessageObject.GroupedMessagePosition groupedMessagePosition18 = this.currentPosition;
                                                if (groupedMessagePosition18 != null && (groupedMessagePosition18.flags & 8) == 0) {
                                                    this.captionLayout = null;
                                                    updateCaptionSpoilers();
                                                }
                                                additionHeight2 = 0 + this.addedCaptionHeight;
                                            } catch (Exception e38) {
                                                e4 = e38;
                                                e3 = e4;
                                                additionHeight2 = 0;
                                                FileLog.e(e3);
                                                widthForCaption2 = widthForCaption;
                                                if (!this.reactionsLayoutInBubble.isSmall) {
                                                }
                                                int additionHeight82 = additionHeight2;
                                                minWidth = (int) (Theme.chat_infoPaint.measureText("100%") + AndroidUtilities.dp(100.0f));
                                                if (this.currentMessagesGroup != null) {
                                                }
                                                int photoWidth152 = photoHeight4;
                                                if (!messageChanged) {
                                                }
                                                String format2 = String.format(Locale.US, "%d_%d", Integer.valueOf((int) (w2 / AndroidUtilities.density)), Integer.valueOf((int) (h / AndroidUtilities.density)));
                                                this.currentPhotoFilterThumb = format2;
                                                this.currentPhotoFilter = format2;
                                                if (messageObject3.photoThumbs != null) {
                                                }
                                                if (!messageObject.needDrawBluredPreview()) {
                                                }
                                                if (messageObject3.type == 3) {
                                                }
                                                noSize = true;
                                                photoSize3 = this.currentPhotoObject;
                                                if (photoSize3 != null) {
                                                }
                                                photoSize4 = this.currentPhotoObjectThumb;
                                                if (photoSize4 != null) {
                                                }
                                                if (!SharedConfig.autoplayVideo) {
                                                }
                                                if (this.autoPlayingMedia) {
                                                }
                                                additionHeight5 = additionHeight82;
                                                photoWidth = photoWidth152;
                                                photoHeight2 = photoHeight3;
                                                i4 = i6;
                                                setMessageObjectInternal(messageObject);
                                                if (this.drawForwardedName) {
                                                }
                                                if (this.drawNameLayout) {
                                                }
                                                this.totalHeight = AndroidUtilities.dp(14.0f) + photoHeight2 + this.namesOffset + additionHeight5;
                                                groupedMessagePosition4 = this.currentPosition;
                                                if (groupedMessagePosition4 != null) {
                                                }
                                                if (this.currentMessageObject.isDice()) {
                                                }
                                                int additionalTop2 = 0;
                                                if (this.currentPosition != null) {
                                                }
                                                i5 = 4;
                                                if (this.drawPinnedTop) {
                                                }
                                                if (this.namesOffset <= 0) {
                                                }
                                                if (this.currentPosition != null) {
                                                }
                                                f = 0.0f;
                                                this.photoImage.setImageCoords(0.0f, this.namesOffset + y + additionalTop2, photoWidth, photoHeight2);
                                                invalidate();
                                                additionHeight = additionHeight5;
                                                r14 = i4;
                                                if (this.currentPosition == null) {
                                                }
                                                if (!messageObject.isAnyKindOfSticker()) {
                                                }
                                                c = 2;
                                                i3 = 0;
                                                z4 = z19;
                                                i = i3;
                                                groupedMessagePosition = this.currentPosition;
                                                if (groupedMessagePosition != null) {
                                                }
                                                this.totalHeight += AndroidUtilities.dp(14.0f);
                                                if (this.currentMessageObject.eventId == 0) {
                                                }
                                                if (messageObject.isSponsored()) {
                                                }
                                                this.botButtons.clear();
                                                if (messageIdChanged) {
                                                }
                                                if (!messageObject6.isRestrictedMessage) {
                                                }
                                                this.substractBackgroundHeight = 0;
                                                this.keyboardHeight = 0;
                                                if (this.drawCommentButton) {
                                                }
                                                z5 = this.drawPinnedBottom;
                                                if (!z5) {
                                                }
                                                if (z5) {
                                                }
                                                if (!messageObject.isAnyKindOfSticker()) {
                                                }
                                                if (messageObject.isAnimatedEmoji()) {
                                                }
                                                if (!this.drawPhotoImage) {
                                                }
                                                if (this.documentAttachType != 5) {
                                                }
                                                if (autoDownload) {
                                                }
                                                messageObject2 = this.currentMessageObject;
                                                if (messageObject2 != null) {
                                                }
                                                if (messageIdChanged) {
                                                }
                                                transcribeButton = this.transcribeButton;
                                                if (transcribeButton != null) {
                                                }
                                                updateWaveform();
                                                updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                                if (!this.currentMessageObject.loadingCancelled) {
                                                }
                                                chatMessageCellDelegate = this.delegate;
                                                if (chatMessageCellDelegate != null) {
                                                }
                                                this.accessibilityVirtualViewBounds.clear();
                                                this.transitionParams.updatePhotoImageX = true;
                                                updateFlagSecure();
                                            }
                                            try {
                                                int widthToCheck = Math.max(this.captionWidth, photoHeight4 - AndroidUtilities.dp(10.0f));
                                                StaticLayout staticLayout18 = this.captionLayout;
                                                float lineWidth2 = staticLayout18.getLineWidth(staticLayout18.getLineCount() - 1);
                                                StaticLayout staticLayout19 = this.captionLayout;
                                                float lastLineWidth = lineWidth2 + staticLayout19.getLineLeft(staticLayout19.getLineCount() - 1);
                                                if ((this.reactionsLayoutInBubble.isEmpty || this.reactionsLayoutInBubble.isSmall) && !shouldDrawTimeOnMedia() && (AndroidUtilities.dp(2.0f) + widthToCheck) - lastLineWidth < timeWidthTotal2 + getExtraTimeX()) {
                                                    additionHeight2 += AndroidUtilities.dp(14.0f);
                                                    this.addedCaptionHeight += AndroidUtilities.dp(14.0f);
                                                    z19 = true;
                                                }
                                                widthForCaption2 = widthForCaption;
                                            } catch (Exception e39) {
                                                e3 = e39;
                                                FileLog.e(e3);
                                                widthForCaption2 = widthForCaption;
                                                if (!this.reactionsLayoutInBubble.isSmall) {
                                                }
                                                int additionHeight822 = additionHeight2;
                                                minWidth = (int) (Theme.chat_infoPaint.measureText("100%") + AndroidUtilities.dp(100.0f));
                                                if (this.currentMessagesGroup != null) {
                                                }
                                                int photoWidth1522 = photoHeight4;
                                                if (!messageChanged) {
                                                }
                                                String format22 = String.format(Locale.US, "%d_%d", Integer.valueOf((int) (w2 / AndroidUtilities.density)), Integer.valueOf((int) (h / AndroidUtilities.density)));
                                                this.currentPhotoFilterThumb = format22;
                                                this.currentPhotoFilter = format22;
                                                if (messageObject3.photoThumbs != null) {
                                                }
                                                if (!messageObject.needDrawBluredPreview()) {
                                                }
                                                if (messageObject3.type == 3) {
                                                }
                                                noSize = true;
                                                photoSize3 = this.currentPhotoObject;
                                                if (photoSize3 != null) {
                                                }
                                                photoSize4 = this.currentPhotoObjectThumb;
                                                if (photoSize4 != null) {
                                                }
                                                if (!SharedConfig.autoplayVideo) {
                                                }
                                                if (this.autoPlayingMedia) {
                                                }
                                                additionHeight5 = additionHeight822;
                                                photoWidth = photoWidth1522;
                                                photoHeight2 = photoHeight3;
                                                i4 = i6;
                                                setMessageObjectInternal(messageObject);
                                                if (this.drawForwardedName) {
                                                }
                                                if (this.drawNameLayout) {
                                                }
                                                this.totalHeight = AndroidUtilities.dp(14.0f) + photoHeight2 + this.namesOffset + additionHeight5;
                                                groupedMessagePosition4 = this.currentPosition;
                                                if (groupedMessagePosition4 != null) {
                                                }
                                                if (this.currentMessageObject.isDice()) {
                                                }
                                                int additionalTop22 = 0;
                                                if (this.currentPosition != null) {
                                                }
                                                i5 = 4;
                                                if (this.drawPinnedTop) {
                                                }
                                                if (this.namesOffset <= 0) {
                                                }
                                                if (this.currentPosition != null) {
                                                }
                                                f = 0.0f;
                                                this.photoImage.setImageCoords(0.0f, this.namesOffset + y + additionalTop22, photoWidth, photoHeight2);
                                                invalidate();
                                                additionHeight = additionHeight5;
                                                r14 = i4;
                                                if (this.currentPosition == null) {
                                                }
                                                if (!messageObject.isAnyKindOfSticker()) {
                                                }
                                                c = 2;
                                                i3 = 0;
                                                z4 = z19;
                                                i = i3;
                                                groupedMessagePosition = this.currentPosition;
                                                if (groupedMessagePosition != null) {
                                                }
                                                this.totalHeight += AndroidUtilities.dp(14.0f);
                                                if (this.currentMessageObject.eventId == 0) {
                                                }
                                                if (messageObject.isSponsored()) {
                                                }
                                                this.botButtons.clear();
                                                if (messageIdChanged) {
                                                }
                                                if (!messageObject6.isRestrictedMessage) {
                                                }
                                                this.substractBackgroundHeight = 0;
                                                this.keyboardHeight = 0;
                                                if (this.drawCommentButton) {
                                                }
                                                z5 = this.drawPinnedBottom;
                                                if (!z5) {
                                                }
                                                if (z5) {
                                                }
                                                if (!messageObject.isAnyKindOfSticker()) {
                                                }
                                                if (messageObject.isAnimatedEmoji()) {
                                                }
                                                if (!this.drawPhotoImage) {
                                                }
                                                if (this.documentAttachType != 5) {
                                                }
                                                if (autoDownload) {
                                                }
                                                messageObject2 = this.currentMessageObject;
                                                if (messageObject2 != null) {
                                                }
                                                if (messageIdChanged) {
                                                }
                                                transcribeButton = this.transcribeButton;
                                                if (transcribeButton != null) {
                                                }
                                                updateWaveform();
                                                updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                                if (!this.currentMessageObject.loadingCancelled) {
                                                }
                                                chatMessageCellDelegate = this.delegate;
                                                if (chatMessageCellDelegate != null) {
                                                }
                                                this.accessibilityVirtualViewBounds.clear();
                                                this.transitionParams.updatePhotoImageX = true;
                                                updateFlagSecure();
                                            }
                                        }
                                        additionHeight2 = 0;
                                        widthForCaption2 = widthForCaption;
                                    } catch (Exception e40) {
                                        e4 = e40;
                                    }
                                } else {
                                    widthForCaption2 = widthForCaption;
                                    additionHeight2 = 0;
                                }
                                if (!this.reactionsLayoutInBubble.isSmall) {
                                    boolean useBackgroundWidth = this.backgroundWidth - AndroidUtilities.dp(24.0f) > widthForCaption2;
                                    int maxWidth24 = Math.max(this.backgroundWidth - AndroidUtilities.dp(36.0f), widthForCaption2);
                                    this.reactionsLayoutInBubble.measure(maxWidth24, 3);
                                    if (!this.reactionsLayoutInBubble.isEmpty) {
                                        if (shouldDrawTimeOnMedia()) {
                                            this.reactionsLayoutInBubble.drawServiceShaderBackground = true;
                                        }
                                        int heightLocal2 = this.reactionsLayoutInBubble.height;
                                        if (this.captionLayout == null) {
                                            heightLocal = heightLocal2 + AndroidUtilities.dp(12.0f) + AndroidUtilities.dp(4.0f);
                                        } else {
                                            heightLocal = heightLocal2 + AndroidUtilities.dp(12.0f);
                                            this.reactionsLayoutInBubble.positionOffsetY += AndroidUtilities.dp(12.0f);
                                        }
                                        this.reactionsLayoutInBubble.totalHeight = heightLocal;
                                        additionHeight2 += this.reactionsLayoutInBubble.totalHeight;
                                        if (!shouldDrawTimeOnMedia()) {
                                            int widthToCheck2 = Math.min(maxWidth24, this.reactionsLayoutInBubble.width + timeWidthTotal2 + getExtraTimeX() + AndroidUtilities.dp(2.0f));
                                            float lastLineWidth2 = this.reactionsLayoutInBubble.lastLineX;
                                            if (!shouldDrawTimeOnMedia() && widthToCheck2 - lastLineWidth2 < timeWidthTotal2 + getExtraTimeX()) {
                                                additionHeight2 += AndroidUtilities.dp(14.0f);
                                                this.reactionsLayoutInBubble.totalHeight += AndroidUtilities.dp(14.0f);
                                                this.reactionsLayoutInBubble.positionOffsetY -= AndroidUtilities.dp(14.0f);
                                                z19 = true;
                                                if (!useBackgroundWidth && this.captionWidth < this.reactionsLayoutInBubble.width) {
                                                    this.captionWidth = this.reactionsLayoutInBubble.width;
                                                }
                                            } else if (!useBackgroundWidth) {
                                                if (this.reactionsLayoutInBubble.lastLineX + timeWidthTotal2 > this.captionWidth) {
                                                    this.captionWidth = this.reactionsLayoutInBubble.lastLineX + timeWidthTotal2;
                                                }
                                                if (this.reactionsLayoutInBubble.width > this.captionWidth) {
                                                    this.captionWidth = this.reactionsLayoutInBubble.width;
                                                }
                                            }
                                        }
                                    }
                                }
                                int additionHeight8222 = additionHeight2;
                                minWidth = (int) (Theme.chat_infoPaint.measureText("100%") + AndroidUtilities.dp(100.0f));
                                if (this.currentMessagesGroup != null && (((i8 = this.documentAttachType) == 4 || i8 == 2) && photoHeight4 < minWidth)) {
                                    photoHeight4 = minWidth;
                                    int dp18 = AndroidUtilities.dp(8.0f) + photoHeight4;
                                    this.backgroundWidth = dp18;
                                    if (!this.mediaBackground) {
                                        this.backgroundWidth = dp18 + AndroidUtilities.dp(9.0f);
                                    }
                                }
                                int photoWidth15222 = photoHeight4;
                                if (!messageChanged || messageIdChanged || dataChanged2) {
                                    String format222 = String.format(Locale.US, "%d_%d", Integer.valueOf((int) (w2 / AndroidUtilities.density)), Integer.valueOf((int) (h / AndroidUtilities.density)));
                                    this.currentPhotoFilterThumb = format222;
                                    this.currentPhotoFilter = format222;
                                    if ((messageObject3.photoThumbs != null && messageObject3.photoThumbs.size() > 1) || messageObject3.type == 3 || messageObject3.type == 8 || messageObject3.type == 5) {
                                        if (!messageObject.needDrawBluredPreview()) {
                                            this.currentPhotoFilter += "_b2";
                                            this.currentPhotoFilterThumb += "_b2";
                                        } else {
                                            this.currentPhotoFilterThumb += "_b";
                                        }
                                    }
                                } else {
                                    String filterNew = String.format(Locale.US, "%d_%d", Integer.valueOf((int) (w2 / AndroidUtilities.density)), Integer.valueOf((int) (h / AndroidUtilities.density)));
                                    if (!messageObject.needDrawBluredPreview() && !filterNew.equals(this.currentPhotoFilter)) {
                                        ImageLocation location = ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject);
                                        if (location != null) {
                                            if (ImageLoader.getInstance().isInMemCache(location.getKey(this.photoParentObject, null, false) + "@" + this.currentPhotoFilter, false)) {
                                                this.currentPhotoObjectThumb = this.currentPhotoObject;
                                                this.currentPhotoFilterThumb = this.currentPhotoFilter;
                                                this.currentPhotoFilter = filterNew;
                                            }
                                        }
                                    }
                                }
                                if (messageObject3.type == 3 && messageObject3.type != 8) {
                                    if (messageObject3.type != 5) {
                                        noSize = false;
                                        photoSize3 = this.currentPhotoObject;
                                        if (photoSize3 != null && !noSize && photoSize3.size == 0) {
                                            this.currentPhotoObject.size = -1;
                                        }
                                        photoSize4 = this.currentPhotoObjectThumb;
                                        if (photoSize4 != null && !noSize && photoSize4.size == 0) {
                                            this.currentPhotoObjectThumb.size = -1;
                                        }
                                        if (!SharedConfig.autoplayVideo && messageObject3.type == 3 && !messageObject.needDrawBluredPreview()) {
                                            if (!this.currentMessageObject.mediaExists || (messageObject.canStreamVideo() && DownloadController.getInstance(this.currentAccount).canDownloadMedia(this.currentMessageObject))) {
                                                groupedMessagePosition6 = this.currentPosition;
                                                if (groupedMessagePosition6 == null) {
                                                    if ((groupedMessagePosition6.flags & 1) != 0 && (this.currentPosition.flags & 2) != 0) {
                                                        z10 = true;
                                                        this.autoPlayingMedia = z10;
                                                    }
                                                    z10 = false;
                                                    this.autoPlayingMedia = z10;
                                                } else {
                                                    this.autoPlayingMedia = true;
                                                }
                                            }
                                            if (this.autoPlayingMedia) {
                                                this.photoImage.setAllowStartAnimation(true);
                                                this.photoImage.startAnimation();
                                                TLRPC.Document document17 = messageObject.getDocument();
                                                if (this.currentMessageObject.videoEditedInfo == null || !this.currentMessageObject.videoEditedInfo.canAutoPlaySourceVideo()) {
                                                    if (!messageIdChanged && !dataChanged2) {
                                                        this.photoImage.setCrossfadeWithOldImage(true);
                                                    }
                                                    this.photoImage.setImage(ImageLocation.getForDocument(document17), ImageLoader.AUTOPLAY_FILTER, ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, ImageLocation.getForDocument(this.currentPhotoObjectThumb, document17), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, messageObject.getDocument().size, null, messageObject, 0);
                                                } else {
                                                    this.photoImage.setImage(ImageLocation.getForPath(this.currentMessageObject.videoEditedInfo.originalPath), ImageLoader.AUTOPLAY_FILTER, ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, ImageLocation.getForDocument(this.currentPhotoObjectThumb, document17), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, messageObject.getDocument().size, null, messageObject, 0);
                                                    this.photoImage.setMediaStartEndTime(this.currentMessageObject.videoEditedInfo.startTime / 1000, this.currentMessageObject.videoEditedInfo.endTime / 1000);
                                                }
                                                messageObject6 = messageObject;
                                                photoHeight = 5;
                                                i6 = 1;
                                            } else {
                                                messageObject6 = messageObject;
                                                i6 = 1;
                                                i6 = 1;
                                                i6 = 1;
                                                i6 = 1;
                                                i6 = 1;
                                                if (messageObject6.type != 1) {
                                                    if (messageObject6.type != 8) {
                                                        photoHeight = 5;
                                                        if (messageObject6.type != 5) {
                                                            if (messageObject6.videoEditedInfo == null || messageObject6.type != 5 || this.currentMessageObject.needDrawBluredPreview()) {
                                                                if (!messageIdChanged && !this.currentMessageObject.needDrawBluredPreview()) {
                                                                    this.photoImage.setCrossfadeWithOldImage(true);
                                                                    this.photoImage.setCrossfadeDuration(ItemTouchHelper.Callback.DEFAULT_SWIPE_ANIMATION_DURATION);
                                                                }
                                                                this.photoImage.setImage(ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, 0L, null, messageObject, this.currentMessageObject.shouldEncryptPhotoOrVideo() ? 2 : 0);
                                                            } else {
                                                                this.photoImage.setImage(ImageLocation.getForPath(messageObject6.videoEditedInfo.originalPath), this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, 0L, null, messageObject, this.currentMessageObject.shouldEncryptPhotoOrVideo() ? 2 : 0);
                                                                this.photoImage.setMediaStartEndTime(this.currentMessageObject.videoEditedInfo.startTime / 1000, this.currentMessageObject.videoEditedInfo.endTime / 1000);
                                                            }
                                                        }
                                                    } else {
                                                        photoHeight = 5;
                                                    }
                                                    String fileName2 = FileLoader.getAttachFileName(messageObject.getDocument());
                                                    if (messageObject6.attachPathExists) {
                                                        DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
                                                        z7 = true;
                                                    } else {
                                                        z7 = messageObject6.mediaExists ? true : false;
                                                    }
                                                    TLRPC.Document document18 = messageObject.getDocument();
                                                    boolean autoDownload2 = (MessageObject.isGifDocument(document18, messageObject.hasValidGroupId()) || messageObject6.type == photoHeight) ? DownloadController.getInstance(this.currentAccount).canDownloadMedia(this.currentMessageObject) : false;
                                                    TLRPC.VideoSize videoSize3 = MessageObject.getDocumentVideoThumb(document18);
                                                    if ((MessageObject.isGifDocument(document18, messageObject.hasValidGroupId()) && messageObject6.videoEditedInfo == null) || (!messageObject.isSending() && !messageObject.isEditing())) {
                                                        if (z7 || FileLoader.getInstance(this.currentAccount).isLoadingFile(fileName2) || autoDownload2) {
                                                            if (z7 || messageObject.needDrawBluredPreview()) {
                                                                videoSize = videoSize3;
                                                                z8 = z7;
                                                                document = document18;
                                                                z9 = true;
                                                            } else if (z7 || (messageObject.canStreamVideo() && autoDownload2)) {
                                                                this.autoPlayingMedia = true;
                                                                if (!messageIdChanged) {
                                                                    this.photoImage.setCrossfadeWithOldImage(true);
                                                                    this.photoImage.setCrossfadeDuration(ItemTouchHelper.Callback.DEFAULT_SWIPE_ANIMATION_DURATION);
                                                                }
                                                                if (z7 || videoSize3 == null) {
                                                                    document2 = document18;
                                                                } else if (this.currentPhotoObject == null || this.currentPhotoObjectThumb == null) {
                                                                    ImageReceiver imageReceiver4 = this.photoImage;
                                                                    ImageLocation forDocument9 = ImageLocation.getForDocument(document18);
                                                                    ImageLocation forDocument10 = ImageLocation.getForDocument(videoSize3, this.documentAttach);
                                                                    TLRPC.PhotoSize photoSize25 = this.currentPhotoObject;
                                                                    if (photoSize25 == null) {
                                                                        photoSize25 = this.currentPhotoObjectThumb;
                                                                    }
                                                                    imageReceiver4.setImage(forDocument9, ImageLoader.AUTOPLAY_FILTER, forDocument10, null, ImageLocation.getForDocument(photoSize25, this.documentAttach), this.currentPhotoObject != null ? this.currentPhotoFilter : this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, document18.size, null, messageObject, 0);
                                                                    messageObject6 = messageObject;
                                                                    photoHeight = 5;
                                                                    i6 = 1;
                                                                } else {
                                                                    document2 = document18;
                                                                }
                                                                if (!this.isRoundVideo || messageIdChanged || !this.photoImage.hasStaticThumb()) {
                                                                    this.photoImage.setImage(ImageLocation.getForDocument(document2), ImageLoader.AUTOPLAY_FILTER, ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, document2.size, null, messageObject, 0);
                                                                    messageObject6 = messageObject;
                                                                    photoHeight = 5;
                                                                    i6 = 1;
                                                                } else {
                                                                    this.photoImage.setImage(ImageLocation.getForDocument(document2), ImageLoader.AUTOPLAY_FILTER, ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, null, null, this.photoImage.getStaticThumb(), document2.size, null, messageObject, 0);
                                                                    messageObject6 = messageObject;
                                                                    photoHeight = 5;
                                                                    i6 = 1;
                                                                }
                                                            } else {
                                                                videoSize = videoSize3;
                                                                z8 = z7;
                                                                document = document18;
                                                                z9 = true;
                                                            }
                                                            if (z8 == z9) {
                                                                messageObject6 = messageObject;
                                                                this.photoImage.setImage(ImageLocation.getForPath(messageObject.isSendError() ? null : messageObject6.messageOwner.attachPath), null, ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, 0L, null, messageObject, 0);
                                                                photoHeight = 5;
                                                                i6 = 1;
                                                            } else {
                                                                messageObject6 = messageObject;
                                                                TLRPC.VideoSize videoSize4 = videoSize;
                                                                if (videoSize4 != null && (this.currentPhotoObject == null || this.currentPhotoObjectThumb == null)) {
                                                                    ImageReceiver imageReceiver5 = this.photoImage;
                                                                    ImageLocation forDocument11 = ImageLocation.getForDocument(document);
                                                                    ImageLocation forDocument12 = ImageLocation.getForDocument(videoSize4, this.documentAttach);
                                                                    TLRPC.PhotoSize photoSize26 = this.currentPhotoObject;
                                                                    if (photoSize26 == null) {
                                                                        photoSize26 = this.currentPhotoObjectThumb;
                                                                    }
                                                                    imageReceiver5.setImage(forDocument11, null, forDocument12, null, ImageLocation.getForDocument(photoSize26, this.documentAttach), this.currentPhotoObject != null ? this.currentPhotoFilter : this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, document.size, null, messageObject, 0);
                                                                    photoHeight = 5;
                                                                    i6 = 1;
                                                                }
                                                                this.photoImage.setImage(ImageLocation.getForDocument(document), null, ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, document.size, null, messageObject, 0);
                                                                photoHeight = 5;
                                                                i6 = 1;
                                                            }
                                                        }
                                                    }
                                                    if (messageObject6.videoEditedInfo != null) {
                                                        photoHeight = 5;
                                                        if (messageObject6.type == 5 && !this.currentMessageObject.needDrawBluredPreview()) {
                                                            this.photoImage.setImage(ImageLocation.getForPath(messageObject6.videoEditedInfo.originalPath), this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, 0L, null, messageObject, 0);
                                                            this.photoImage.setMediaStartEndTime(this.currentMessageObject.videoEditedInfo.startTime / 1000, this.currentMessageObject.videoEditedInfo.endTime / 1000);
                                                            i6 = 1;
                                                        }
                                                    } else {
                                                        photoHeight = 5;
                                                    }
                                                    if (messageIdChanged || this.currentMessageObject.needDrawBluredPreview()) {
                                                        i7 = 1;
                                                    } else {
                                                        i7 = 1;
                                                        this.photoImage.setCrossfadeWithOldImage(true);
                                                        this.photoImage.setCrossfadeDuration(ItemTouchHelper.Callback.DEFAULT_SWIPE_ANIMATION_DURATION);
                                                    }
                                                    this.photoImage.setImage(ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, 0L, null, messageObject, 0);
                                                    i6 = i7;
                                                } else if (messageObject6.useCustomPhoto) {
                                                    this.photoImage.setImageBitmap(getResources().getDrawable(R.drawable.theme_preview_image));
                                                    photoHeight = 5;
                                                } else {
                                                    TLRPC.PhotoSize photoSize27 = this.currentPhotoObject;
                                                    if (photoSize27 != null) {
                                                        boolean photoExist2 = true;
                                                        String fileName3 = FileLoader.getAttachFileName(photoSize27);
                                                        if (messageObject6.mediaExists) {
                                                            DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
                                                        } else {
                                                            photoExist2 = false;
                                                        }
                                                        if (photoExist2 || ((!this.currentMessageObject.loadingCancelled && DownloadController.getInstance(this.currentAccount).canDownloadMedia(this.currentMessageObject)) || FileLoader.getInstance(this.currentAccount).isLoadingFile(fileName3))) {
                                                            ImageReceiver imageReceiver6 = this.photoImage;
                                                            ImageLocation forObject3 = ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject);
                                                            String str28 = this.currentPhotoFilter;
                                                            ImageLocation forObject4 = ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject);
                                                            String str29 = this.currentPhotoFilterThumb;
                                                            BitmapDrawable bitmapDrawable2 = this.currentPhotoObjectThumbStripped;
                                                            long j = this.currentPhotoObject.size;
                                                            MessageObject messageObject10 = this.currentMessageObject;
                                                            imageReceiver6.setImage(forObject3, str28, forObject4, str29, bitmapDrawable2, j, null, messageObject10, messageObject10.shouldEncryptPhotoOrVideo() ? 2 : 0);
                                                        } else {
                                                            this.photoNotSet = true;
                                                            TLRPC.PhotoSize photoSize28 = this.currentPhotoObjectThumb;
                                                            if (photoSize28 == null && this.currentPhotoObjectThumbStripped == null) {
                                                                this.photoImage.setImageBitmap((Drawable) null);
                                                            } else {
                                                                ImageReceiver imageReceiver7 = this.photoImage;
                                                                ImageLocation forObject5 = ImageLocation.getForObject(photoSize28, this.photoParentObject);
                                                                String str30 = this.currentPhotoFilterThumb;
                                                                BitmapDrawable bitmapDrawable3 = this.currentPhotoObjectThumbStripped;
                                                                MessageObject messageObject11 = this.currentMessageObject;
                                                                imageReceiver7.setImage(null, null, forObject5, str30, bitmapDrawable3, 0L, null, messageObject11, messageObject11.shouldEncryptPhotoOrVideo() ? 2 : 0);
                                                            }
                                                        }
                                                        photoHeight = 5;
                                                    } else {
                                                        this.photoImage.setImageBitmap((Drawable) null);
                                                        photoHeight = 5;
                                                    }
                                                }
                                            }
                                            additionHeight5 = additionHeight8222;
                                            photoWidth = photoWidth15222;
                                            photoHeight2 = photoHeight3;
                                            i4 = i6;
                                        }
                                        if (this.autoPlayingMedia) {
                                        }
                                        additionHeight5 = additionHeight8222;
                                        photoWidth = photoWidth15222;
                                        photoHeight2 = photoHeight3;
                                        i4 = i6;
                                    }
                                }
                                noSize = true;
                                photoSize3 = this.currentPhotoObject;
                                if (photoSize3 != null) {
                                    this.currentPhotoObject.size = -1;
                                }
                                photoSize4 = this.currentPhotoObjectThumb;
                                if (photoSize4 != null) {
                                    this.currentPhotoObjectThumb.size = -1;
                                }
                                if (!SharedConfig.autoplayVideo) {
                                    if (!this.currentMessageObject.mediaExists) {
                                    }
                                    groupedMessagePosition6 = this.currentPosition;
                                    if (groupedMessagePosition6 == null) {
                                    }
                                    if (this.autoPlayingMedia) {
                                    }
                                    additionHeight5 = additionHeight8222;
                                    photoWidth = photoWidth15222;
                                    photoHeight2 = photoHeight3;
                                    i4 = i6;
                                }
                                if (this.autoPlayingMedia) {
                                }
                                additionHeight5 = additionHeight8222;
                                photoWidth = photoWidth15222;
                                photoHeight2 = photoHeight3;
                                i4 = i6;
                            }
                            needQualityPreview = false;
                            if (this.currentMessageObject.strippedThumb != null) {
                            }
                            if (messageObject6.type == 5) {
                            }
                            photoSize = this.currentPhotoObject;
                            if (photoSize != null) {
                                this.currentPhotoObject = null;
                            }
                            photoSize2 = this.currentPhotoObject;
                            if (photoSize2 != null) {
                                if (messageObject6.type != 1) {
                                }
                            }
                            if (needQualityPreview) {
                                this.photoImage.setNeedsQualityThumb(true);
                                this.photoImage.setShouldGenerateQualityThumb(true);
                            }
                            if (this.currentMessagesGroup == null) {
                                this.mediaBackground = false;
                            }
                            if (w != 0) {
                            }
                            while (a < messageObject.getDocument().attributes.size()) {
                            }
                            if (w != 0) {
                            }
                            int dp152 = AndroidUtilities.dp(150.0f);
                            imageW = dp152;
                            w = dp152;
                            if (messageObject6.type == 3) {
                                w = this.infoWidth + AndroidUtilities.dp(40.0f);
                            }
                            if (this.commentLayout != null) {
                                w = this.totalCommentWidth + AndroidUtilities.dp(10.0f);
                            }
                            if (this.currentMessagesGroup == null) {
                            }
                            if (messageObject6.type == 5) {
                            }
                            measureTime(messageObject);
                            timeWidthTotal = this.timeWidth + AndroidUtilities.dp((SharedConfig.bubbleRadius < 10 ? 22 : 18) + (!messageObject.isOutOwner() ? 20 : 0));
                            if (w < timeWidthTotal) {
                            }
                            if (!messageObject.isRoundVideo()) {
                            }
                            int widthForCaption62 = 0;
                            boolean fixPhotoWidth32 = false;
                            if (this.currentMessagesGroup == null) {
                            }
                            if (this.currentCaption == null) {
                            }
                            if (!this.reactionsLayoutInBubble.isSmall) {
                            }
                            int additionHeight82222 = additionHeight2;
                            minWidth = (int) (Theme.chat_infoPaint.measureText("100%") + AndroidUtilities.dp(100.0f));
                            if (this.currentMessagesGroup != null) {
                                photoHeight4 = minWidth;
                                int dp182 = AndroidUtilities.dp(8.0f) + photoHeight4;
                                this.backgroundWidth = dp182;
                                if (!this.mediaBackground) {
                                }
                            }
                            int photoWidth152222 = photoHeight4;
                            if (!messageChanged) {
                            }
                            String format2222 = String.format(Locale.US, "%d_%d", Integer.valueOf((int) (w2 / AndroidUtilities.density)), Integer.valueOf((int) (h / AndroidUtilities.density)));
                            this.currentPhotoFilterThumb = format2222;
                            this.currentPhotoFilter = format2222;
                            if (messageObject3.photoThumbs != null) {
                                if (!messageObject.needDrawBluredPreview()) {
                                }
                                if (messageObject3.type == 3) {
                                }
                                noSize = true;
                                photoSize3 = this.currentPhotoObject;
                                if (photoSize3 != null) {
                                }
                                photoSize4 = this.currentPhotoObjectThumb;
                                if (photoSize4 != null) {
                                }
                                if (!SharedConfig.autoplayVideo) {
                                }
                                if (this.autoPlayingMedia) {
                                }
                                additionHeight5 = additionHeight82222;
                                photoWidth = photoWidth152222;
                                photoHeight2 = photoHeight3;
                                i4 = i6;
                            }
                            if (!messageObject.needDrawBluredPreview()) {
                            }
                            if (messageObject3.type == 3) {
                            }
                            noSize = true;
                            photoSize3 = this.currentPhotoObject;
                            if (photoSize3 != null) {
                            }
                            photoSize4 = this.currentPhotoObjectThumb;
                            if (photoSize4 != null) {
                            }
                            if (!SharedConfig.autoplayVideo) {
                            }
                            if (this.autoPlayingMedia) {
                            }
                            additionHeight5 = additionHeight82222;
                            photoWidth = photoWidth152222;
                            photoHeight2 = photoHeight3;
                            i4 = i6;
                        }
                        setMessageObjectInternal(messageObject);
                        if (this.drawForwardedName || !messageObject.needDrawForwarded() || !((groupedMessagePosition5 = this.currentPosition) == null || groupedMessagePosition5.minY == 0)) {
                            if (this.drawNameLayout && (messageObject.getReplyMsgId() == 0 || (this.isThreadChat && messageObject.getReplyTopMsgId() == 0))) {
                                this.namesOffset += AndroidUtilities.dp(7.0f);
                            }
                        } else if (messageObject6.type != photoHeight) {
                            this.namesOffset += AndroidUtilities.dp(5.0f);
                        }
                        this.totalHeight = AndroidUtilities.dp(14.0f) + photoHeight2 + this.namesOffset + additionHeight5;
                        groupedMessagePosition4 = this.currentPosition;
                        if (groupedMessagePosition4 != null && (groupedMessagePosition4.flags & 8) == 0 && !this.currentMessageObject.isDocument()) {
                            this.totalHeight -= AndroidUtilities.dp(3.0f);
                        }
                        if (this.currentMessageObject.isDice()) {
                            this.totalHeight += AndroidUtilities.dp(21.0f);
                            this.additionalTimeOffsetY = AndroidUtilities.dp(21.0f);
                        }
                        int additionalTop222 = 0;
                        if (this.currentPosition != null || this.currentMessageObject.isDocument()) {
                            i5 = 4;
                        } else {
                            photoWidth += getAdditionalWidthForPosition(this.currentPosition);
                            i5 = 4;
                            if ((this.currentPosition.flags & 4) == 0) {
                                photoHeight2 += AndroidUtilities.dp(4.0f);
                                additionalTop222 = 0 - AndroidUtilities.dp(4.0f);
                            }
                            if ((this.currentPosition.flags & 8) == 0) {
                                photoHeight2 += AndroidUtilities.dp(1.0f);
                            }
                        }
                        if (this.drawPinnedTop) {
                            this.namesOffset -= AndroidUtilities.dp(1.0f);
                        }
                        if (this.namesOffset <= 0) {
                            y = AndroidUtilities.dp(7.0f);
                            this.totalHeight -= AndroidUtilities.dp(2.0f);
                        } else {
                            y = AndroidUtilities.dp(5.0f);
                            this.totalHeight -= AndroidUtilities.dp(4.0f);
                        }
                        if (this.currentPosition != null && this.currentMessagesGroup.isDocuments && this.currentMessagesGroup.messages.size() > i4) {
                            if ((this.currentPosition.flags & i5) == 0) {
                                this.totalHeight -= AndroidUtilities.dp(this.drawPhotoImage ? 3.0f : 6.0f);
                                this.mediaOffsetY -= AndroidUtilities.dp(this.drawPhotoImage ? 3.0f : 6.0f);
                                y -= AndroidUtilities.dp(this.drawPhotoImage ? 3.0f : 6.0f);
                            }
                            if ((this.currentPosition.flags & 8) == 0) {
                                this.totalHeight -= AndroidUtilities.dp(this.drawPhotoImage ? 3.0f : 6.0f);
                            }
                        }
                        f = 0.0f;
                        this.photoImage.setImageCoords(0.0f, this.namesOffset + y + additionalTop222, photoWidth, photoHeight2);
                        invalidate();
                        additionHeight = additionHeight5;
                        r14 = i4;
                    }
                    messageObject6 = messageObject;
                    f = 0.0f;
                    r14 = 1;
                    additionHeight = str4;
                }
                if (this.currentPosition == null && !this.currentMessageObject.isMusic() && !this.currentMessageObject.isDocument()) {
                    c = 2;
                    i3 = 0;
                } else if (!messageObject.isAnyKindOfSticker() || this.addedCaptionHeight != 0) {
                    c = 2;
                    i3 = 0;
                } else {
                    if (messageObject6.isRestrictedMessage || this.captionLayout != null) {
                        c = 2;
                        str2 = 0;
                    } else if (messageObject6.caption != null || messageObject.isVoiceTranscriptionOpen()) {
                        CharSequence voiceTranscription = messageObject.isVoiceTranscriptionOpen() ? messageObject.getVoiceTranscription() : messageObject6.caption;
                        this.currentCaption = voiceTranscription;
                        if (voiceTranscription != null && !TextUtils.isEmpty(messageObject6.messageOwner.voiceTranscription) && this.currentMessageObject.isVoiceTranscriptionOpen() && !this.currentMessageObject.messageOwner.voiceTranscriptionFinal) {
                            String str31 = ((Object) this.currentCaption) + " ";
                            this.currentCaption = str31;
                            if (!(str31 instanceof Spannable)) {
                                this.currentCaption = new SpannableString(this.currentCaption);
                            }
                            ((SpannableString) this.currentCaption).setSpan(new TranscribeButton.LoadingPointsSpan(), this.currentCaption.length() - r14, this.currentCaption.length(), 33);
                        }
                        try {
                            int width15 = this.backgroundWidth;
                            if (messageObject.isVoiceTranscriptionOpen()) {
                                try {
                                    if (AndroidUtilities.isTablet()) {
                                        int minTabletSide2 = AndroidUtilities.getMinTabletSide();
                                        if (!drawAvatar) {
                                            f5 = 50.0f;
                                        }
                                        width15 = minTabletSide2 - AndroidUtilities.dp(f5);
                                    } else {
                                        int parentWidth = getParentWidth();
                                        if (!drawAvatar) {
                                            f5 = 50.0f;
                                        }
                                        width15 = parentWidth - AndroidUtilities.dp(f5);
                                    }
                                } catch (Exception e41) {
                                    e = e41;
                                    c = 2;
                                    str3 = 0;
                                    FileLog.e(e);
                                    str2 = str3;
                                    i3 = str2;
                                    if (this.captionLayout != null) {
                                    }
                                    z4 = z19;
                                    i = i3;
                                    groupedMessagePosition = this.currentPosition;
                                    if (groupedMessagePosition != null) {
                                    }
                                    this.totalHeight += AndroidUtilities.dp(14.0f);
                                    if (this.currentMessageObject.eventId == 0) {
                                    }
                                    if (messageObject.isSponsored()) {
                                    }
                                    this.botButtons.clear();
                                    if (messageIdChanged) {
                                    }
                                    if (!messageObject6.isRestrictedMessage) {
                                    }
                                    this.substractBackgroundHeight = 0;
                                    this.keyboardHeight = 0;
                                    if (this.drawCommentButton) {
                                    }
                                    z5 = this.drawPinnedBottom;
                                    if (!z5) {
                                    }
                                    if (z5) {
                                    }
                                    if (!messageObject.isAnyKindOfSticker()) {
                                    }
                                    if (messageObject.isAnimatedEmoji()) {
                                    }
                                    if (!this.drawPhotoImage) {
                                    }
                                    if (this.documentAttachType != 5) {
                                    }
                                    if (autoDownload) {
                                    }
                                    messageObject2 = this.currentMessageObject;
                                    if (messageObject2 != null) {
                                    }
                                    if (messageIdChanged) {
                                    }
                                    transcribeButton = this.transcribeButton;
                                    if (transcribeButton != null) {
                                    }
                                    updateWaveform();
                                    updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                    if (!this.currentMessageObject.loadingCancelled) {
                                    }
                                    chatMessageCellDelegate = this.delegate;
                                    if (chatMessageCellDelegate != null) {
                                    }
                                    this.accessibilityVirtualViewBounds.clear();
                                    this.transitionParams.updatePhotoImageX = true;
                                    updateFlagSecure();
                                }
                            }
                            c = 2;
                            int widthForCaption7 = ((width15 - AndroidUtilities.dp(31.0f)) - AndroidUtilities.dp(10.0f)) - (getExtraTextX() * 2);
                            try {
                                try {
                                    if (Build.VERSION.SDK_INT >= 24) {
                                        CharSequence charSequence2 = this.currentCaption;
                                        additionHeight = 0;
                                        this.captionLayout = StaticLayout.Builder.obtain(charSequence2, 0, charSequence2.length(), Theme.chat_msgTextPaint, widthForCaption7).setBreakStrategy(r14).setHyphenationFrequency(0).setAlignment(Layout.Alignment.ALIGN_NORMAL).build();
                                    } else {
                                        additionHeight = 0;
                                        this.captionLayout = new StaticLayout(this.currentCaption, Theme.chat_msgTextPaint, widthForCaption7, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                    }
                                    updateSeekBarWaveformWidth();
                                    updateCaptionSpoilers();
                                    str2 = additionHeight;
                                } catch (Exception e42) {
                                    e2 = e42;
                                    e = e2;
                                    str3 = additionHeight;
                                    FileLog.e(e);
                                    str2 = str3;
                                    i3 = str2;
                                    if (this.captionLayout != null) {
                                    }
                                    z4 = z19;
                                    i = i3;
                                    groupedMessagePosition = this.currentPosition;
                                    if (groupedMessagePosition != null) {
                                    }
                                    this.totalHeight += AndroidUtilities.dp(14.0f);
                                    if (this.currentMessageObject.eventId == 0) {
                                    }
                                    if (messageObject.isSponsored()) {
                                    }
                                    this.botButtons.clear();
                                    if (messageIdChanged) {
                                    }
                                    if (!messageObject6.isRestrictedMessage) {
                                    }
                                    this.substractBackgroundHeight = 0;
                                    this.keyboardHeight = 0;
                                    if (this.drawCommentButton) {
                                    }
                                    z5 = this.drawPinnedBottom;
                                    if (!z5) {
                                    }
                                    if (z5) {
                                    }
                                    if (!messageObject.isAnyKindOfSticker()) {
                                    }
                                    if (messageObject.isAnimatedEmoji()) {
                                    }
                                    if (!this.drawPhotoImage) {
                                    }
                                    if (this.documentAttachType != 5) {
                                    }
                                    if (autoDownload) {
                                    }
                                    messageObject2 = this.currentMessageObject;
                                    if (messageObject2 != null) {
                                    }
                                    if (messageIdChanged) {
                                    }
                                    transcribeButton = this.transcribeButton;
                                    if (transcribeButton != null) {
                                    }
                                    updateWaveform();
                                    updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                    if (!this.currentMessageObject.loadingCancelled) {
                                    }
                                    chatMessageCellDelegate = this.delegate;
                                    if (chatMessageCellDelegate != null) {
                                    }
                                    this.accessibilityVirtualViewBounds.clear();
                                    this.transitionParams.updatePhotoImageX = true;
                                    updateFlagSecure();
                                }
                            } catch (Exception e43) {
                                e2 = e43;
                                additionHeight = 0;
                                e = e2;
                                str3 = additionHeight;
                                FileLog.e(e);
                                str2 = str3;
                                i3 = str2;
                                if (this.captionLayout != null) {
                                }
                                z4 = z19;
                                i = i3;
                                groupedMessagePosition = this.currentPosition;
                                if (groupedMessagePosition != null) {
                                }
                                this.totalHeight += AndroidUtilities.dp(14.0f);
                                if (this.currentMessageObject.eventId == 0) {
                                }
                                if (messageObject.isSponsored()) {
                                }
                                this.botButtons.clear();
                                if (messageIdChanged) {
                                }
                                if (!messageObject6.isRestrictedMessage) {
                                }
                                this.substractBackgroundHeight = 0;
                                this.keyboardHeight = 0;
                                if (this.drawCommentButton) {
                                }
                                z5 = this.drawPinnedBottom;
                                if (!z5) {
                                }
                                if (z5) {
                                }
                                if (!messageObject.isAnyKindOfSticker()) {
                                }
                                if (messageObject.isAnimatedEmoji()) {
                                }
                                if (!this.drawPhotoImage) {
                                }
                                if (this.documentAttachType != 5) {
                                }
                                if (autoDownload) {
                                }
                                messageObject2 = this.currentMessageObject;
                                if (messageObject2 != null) {
                                }
                                if (messageIdChanged) {
                                }
                                transcribeButton = this.transcribeButton;
                                if (transcribeButton != null) {
                                }
                                updateWaveform();
                                updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
                                if (!this.currentMessageObject.loadingCancelled) {
                                }
                                chatMessageCellDelegate = this.delegate;
                                if (chatMessageCellDelegate != null) {
                                }
                                this.accessibilityVirtualViewBounds.clear();
                                this.transitionParams.updatePhotoImageX = true;
                                updateFlagSecure();
                            }
                        } catch (Exception e44) {
                            e2 = e44;
                            c = 2;
                        }
                    } else {
                        c = 2;
                        str2 = 0;
                    }
                    i3 = str2;
                    if (this.captionLayout != null) {
                        try {
                            if (messageObject.isVoiceTranscriptionOpen()) {
                                float startMaxWidth = ((this.backgroundWidth - AndroidUtilities.dp(31.0f)) - AndroidUtilities.dp(10.0f)) - (getExtraTextX() * 2);
                                float maxWidth25 = startMaxWidth;
                                for (int i45 = 0; i45 < this.captionLayout.getLineCount(); i45++) {
                                    float captionLineWidth = this.captionLayout.getLineWidth(i45);
                                    if (captionLineWidth > maxWidth25) {
                                        maxWidth25 = captionLineWidth;
                                    }
                                }
                                int i46 = this.backgroundWidth;
                                this.backgroundWidth = (int) (i46 + (maxWidth25 - startMaxWidth));
                            }
                            int width16 = this.backgroundWidth - AndroidUtilities.dp(31.0f);
                            StaticLayout staticLayout20 = this.captionLayout;
                            if (staticLayout20 != null && staticLayout20.getLineCount() > 0) {
                                this.captionWidth = width16;
                                int height15 = this.captionLayout.getHeight();
                                this.captionHeight = height15;
                                this.totalHeight += height15 + AndroidUtilities.dp(9.0f);
                                if ((this.reactionsLayoutInBubble.isEmpty || this.reactionsLayoutInBubble.isSmall) && ((groupedMessagePosition3 = this.currentPosition) == null || (groupedMessagePosition3.flags & 8) != 0)) {
                                    int timeWidthTotal6 = this.timeWidth + (messageObject.isOutOwner() ? AndroidUtilities.dp(20.0f) : 0) + getExtraTimeX();
                                    StaticLayout staticLayout21 = this.captionLayout;
                                    float lineWidth3 = staticLayout21.getLineWidth(staticLayout21.getLineCount() - r14);
                                    StaticLayout staticLayout22 = this.captionLayout;
                                    float lastLineWidth3 = lineWidth3 + staticLayout22.getLineLeft(staticLayout22.getLineCount() - r14);
                                    if ((width16 - AndroidUtilities.dp(8.0f)) - lastLineWidth3 < timeWidthTotal6) {
                                        this.totalHeight += AndroidUtilities.dp(14.0f);
                                        this.captionHeight += AndroidUtilities.dp(14.0f);
                                        z19 = true;
                                    }
                                }
                            }
                            z4 = z19;
                            i = str2;
                        } catch (Exception e45) {
                            FileLog.e(e45);
                            i3 = str2;
                        }
                        groupedMessagePosition = this.currentPosition;
                        if ((groupedMessagePosition != null || (groupedMessagePosition.flags & 8) != 0) && this.captionLayout == null && (i2 = this.widthBeforeNewTimeLine) != -1 && this.availableTimeWidth - i2 < this.timeWidth) {
                            this.totalHeight += AndroidUtilities.dp(14.0f);
                        }
                        if (this.currentMessageObject.eventId == 0 && !this.currentMessageObject.isMediaEmpty() && this.currentMessageObject.messageOwner.media.webpage != null) {
                            int linkPreviewMaxWidth9 = this.backgroundWidth - AndroidUtilities.dp(41.0f);
                            this.hasOldCaptionPreview = r14;
                            int i47 = i == 1 ? 1 : 0;
                            int i48 = i == 1 ? 1 : 0;
                            int i49 = i == 1 ? 1 : 0;
                            int i50 = i == 1 ? 1 : 0;
                            int i51 = i == 1 ? 1 : 0;
                            int i52 = i == 1 ? 1 : 0;
                            int i53 = i == 1 ? 1 : 0;
                            int i54 = i == 1 ? 1 : 0;
                            int i55 = i == 1 ? 1 : 0;
                            int i56 = i == 1 ? 1 : 0;
                            int i57 = i == 1 ? 1 : 0;
                            int i58 = i == 1 ? 1 : 0;
                            int i59 = i == 1 ? 1 : 0;
                            this.linkPreviewHeight = i47;
                            TLRPC.WebPage webPage2 = this.currentMessageObject.messageOwner.media.webpage;
                            try {
                                int width17 = (int) Math.ceil(Theme.chat_replyNamePaint.measureText(webPage2.site_name) + 1.0f);
                                this.siteNameWidth = width17;
                                StaticLayout staticLayout23 = new StaticLayout(webPage2.site_name, Theme.chat_replyNamePaint, Math.min(width17, linkPreviewMaxWidth9), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                this.siteNameLayout = staticLayout23;
                                this.siteNameRtl = staticLayout23.getLineLeft(i) != f;
                                StaticLayout staticLayout24 = this.siteNameLayout;
                                int height16 = staticLayout24.getLineBottom(staticLayout24.getLineCount() - r14);
                                this.linkPreviewHeight += height16;
                                this.totalHeight += height16;
                            } catch (Exception e46) {
                                FileLog.e(e46);
                            }
                            try {
                                this.descriptionX = i;
                                if (this.linkPreviewHeight != 0) {
                                    this.totalHeight += AndroidUtilities.dp(2.0f);
                                }
                                StaticLayout createStaticLayout = StaticLayoutEx.createStaticLayout(webPage2.description, Theme.chat_replyTextPaint, linkPreviewMaxWidth9, Layout.Alignment.ALIGN_NORMAL, 1.0f, AndroidUtilities.dp(1.0f), false, TextUtils.TruncateAt.END, linkPreviewMaxWidth9, 6);
                                this.descriptionLayout = createStaticLayout;
                                int height17 = createStaticLayout.getLineBottom(createStaticLayout.getLineCount() - r14);
                                this.linkPreviewHeight += height17;
                                this.totalHeight += height17;
                                boolean hasNonRtl = false;
                                for (int a39 = 0; a39 < this.descriptionLayout.getLineCount(); a39++) {
                                    int lineLeft7 = (int) Math.ceil(this.descriptionLayout.getLineLeft(a39));
                                    if (lineLeft7 != 0) {
                                        int i60 = this.descriptionX;
                                        if (i60 == 0) {
                                            this.descriptionX = -lineLeft7;
                                        } else {
                                            this.descriptionX = Math.max(i60, -lineLeft7);
                                        }
                                    } else {
                                        hasNonRtl = true;
                                    }
                                }
                                if (hasNonRtl) {
                                    this.descriptionX = i;
                                }
                            } catch (Exception e47) {
                                FileLog.e(e47);
                            }
                            if (messageObject6.type == r14) {
                            }
                            this.totalHeight += AndroidUtilities.dp(6.0f);
                            int dp19 = this.totalHeight + AndroidUtilities.dp(17.0f);
                            this.totalHeight = dp19;
                            if (z4) {
                                this.totalHeight = dp19 - AndroidUtilities.dp(14.0f);
                                if (z4 == c) {
                                    this.captionHeight -= AndroidUtilities.dp(14.0f);
                                }
                            }
                        }
                        if (messageObject.isSponsored()) {
                            this.drawInstantView = r14;
                            if (messageObject6.sponsoredChannelPost != 0) {
                                this.drawInstantViewType = 12;
                            } else {
                                int i61 = r14 == true ? 1 : 0;
                                int i62 = r14 == true ? 1 : 0;
                                int i63 = r14 == true ? 1 : 0;
                                int i64 = r14 == true ? 1 : 0;
                                int i65 = r14 == true ? 1 : 0;
                                int i66 = r14 == true ? 1 : 0;
                                int i67 = r14 == true ? 1 : 0;
                                int i68 = r14 == true ? 1 : 0;
                                int i69 = r14 == true ? 1 : 0;
                                int i70 = r14 == true ? 1 : 0;
                                int i71 = r14 == true ? 1 : 0;
                                int i72 = r14 == true ? 1 : 0;
                                int i73 = r14 == true ? 1 : 0;
                                int i74 = r14 == true ? 1 : 0;
                                int i75 = r14 == true ? 1 : 0;
                                int i76 = r14 == true ? 1 : 0;
                                int i77 = r14 == true ? 1 : 0;
                                int i78 = r14 == true ? 1 : 0;
                                int i79 = r14 == true ? 1 : 0;
                                int i80 = r14 == true ? 1 : 0;
                                int i81 = r14 == true ? 1 : 0;
                                int i82 = r14 == true ? 1 : 0;
                                int i83 = r14 == true ? 1 : 0;
                                int i84 = r14 == true ? 1 : 0;
                                int i85 = r14 == true ? 1 : 0;
                                int i86 = r14 == true ? 1 : 0;
                                int i87 = r14 == true ? 1 : 0;
                                int i88 = r14 == true ? 1 : 0;
                                int i89 = r14 == true ? 1 : 0;
                                int i90 = r14 == true ? 1 : 0;
                                this.drawInstantViewType = i61;
                            }
                            long id3 = MessageObject.getPeerId(messageObject6.messageOwner.from_id);
                            if (id3 > 0 && (user = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(id3))) != null && user.bot) {
                                this.drawInstantViewType = 10;
                            }
                            createInstantViewButton();
                        }
                        this.botButtons.clear();
                        if (messageIdChanged) {
                            this.botButtonsByData.clear();
                            this.botButtonsByPosition.clear();
                            this.botButtonsLayout = null;
                        }
                        if (!messageObject6.isRestrictedMessage || this.currentPosition != null || !(messageObject6.messageOwner.reply_markup instanceof TLRPC.TL_replyInlineMarkup)) {
                            this.substractBackgroundHeight = 0;
                            this.keyboardHeight = 0;
                        } else {
                            int rows = messageObject6.messageOwner.reply_markup instanceof TLRPC.TL_replyInlineMarkup ? messageObject6.messageOwner.reply_markup.rows.size() : 1;
                            int dp20 = (AndroidUtilities.dp(48.0f) * rows) + AndroidUtilities.dp(1.0f);
                            this.keyboardHeight = dp20;
                            this.substractBackgroundHeight = dp20;
                            this.widthForButtons = this.backgroundWidth - AndroidUtilities.dp(this.mediaBackground ? 0.0f : 9.0f);
                            boolean fullWidth2 = false;
                            if (messageObject6.wantedBotKeyboardWidth > this.widthForButtons) {
                                int maxButtonWidth = -AndroidUtilities.dp(drawAvatar ? 62.0f : 10.0f);
                                this.widthForButtons = Math.max(this.backgroundWidth, Math.min(messageObject6.wantedBotKeyboardWidth, AndroidUtilities.isTablet() ? maxButtonWidth + AndroidUtilities.getMinTabletSide() : maxButtonWidth + (Math.min(getParentWidth(), AndroidUtilities.displaySize.y) - AndroidUtilities.dp(5.0f))));
                            }
                            int maxButtonsWidth = 0;
                            HashMap<String, BotButton> oldByData3 = new HashMap<>(this.botButtonsByData);
                            if (messageObject6.botButtonsLayout == null || (str = this.botButtonsLayout) == null || !str.equals(messageObject6.botButtonsLayout.toString())) {
                                if (messageObject6.botButtonsLayout != null) {
                                    this.botButtonsLayout = messageObject6.botButtonsLayout.toString();
                                }
                                oldByPosition = null;
                            } else {
                                oldByPosition = new HashMap<>(this.botButtonsByPosition);
                            }
                            this.botButtonsByData.clear();
                            if (messageObject6.messageOwner.reply_markup instanceof TLRPC.TL_replyInlineMarkup) {
                                int a40 = 0;
                                while (a40 < rows) {
                                    TLRPC.TL_keyboardButtonRow row = messageObject6.messageOwner.reply_markup.rows.get(a40);
                                    int buttonsCount = row.buttons.size();
                                    if (buttonsCount != 0) {
                                        int buttonWidth = ((this.widthForButtons - (AndroidUtilities.dp(5.0f) * (buttonsCount - 1))) - AndroidUtilities.dp(2.0f)) / buttonsCount;
                                        int b8 = 0;
                                        while (b8 < row.buttons.size()) {
                                            BotButton botButton = new BotButton();
                                            botButton.button = row.buttons.get(b8);
                                            String key = Utilities.bytesToHex(botButton.button.data);
                                            boolean z23 = z4;
                                            StringBuilder sb = new StringBuilder();
                                            sb.append(a40);
                                            int rows2 = rows;
                                            sb.append("");
                                            sb.append(b8);
                                            String position4 = sb.toString();
                                            BotButton oldButton = oldByPosition != null ? oldByPosition.get(position4) : oldByData3.get(key);
                                            if (oldButton != null) {
                                                fullWidth = fullWidth2;
                                                botButton.progressAlpha = oldButton.progressAlpha;
                                                botButton.angle = oldButton.angle;
                                                oldByData = oldByData3;
                                                oldByPosition2 = oldByPosition;
                                                botButton.lastUpdateTime = oldButton.lastUpdateTime;
                                            } else {
                                                fullWidth = fullWidth2;
                                                oldByData = oldByData3;
                                                oldByPosition2 = oldByPosition;
                                                botButton.lastUpdateTime = System.currentTimeMillis();
                                            }
                                            this.botButtonsByData.put(key, botButton);
                                            this.botButtonsByPosition.put(position4, botButton);
                                            botButton.x = (AndroidUtilities.dp(5.0f) + buttonWidth) * b8;
                                            botButton.y = (AndroidUtilities.dp(48.0f) * a40) + AndroidUtilities.dp(5.0f);
                                            botButton.width = buttonWidth;
                                            botButton.height = AndroidUtilities.dp(44.0f);
                                            TextPaint botButtonPaint = (TextPaint) getThemedPaint(Theme.key_paint_chatBotButton);
                                            if (!(botButton.button instanceof TLRPC.TL_keyboardButtonBuy) || (messageObject6.messageOwner.media.flags & 4) == 0) {
                                                String buttonText2 = botButton.button.text == null ? "" : botButton.button.text;
                                                oldByData2 = oldByData;
                                                buttonText = TextUtils.ellipsize(Emoji.replaceEmoji(buttonText2, botButtonPaint.getFontMetricsInt(), AndroidUtilities.dp(15.0f), false), botButtonPaint, buttonWidth - AndroidUtilities.dp(10.0f), TextUtils.TruncateAt.END);
                                            } else {
                                                buttonText = LocaleController.getString("PaymentReceipt", R.string.PaymentReceipt);
                                                oldByData2 = oldByData;
                                            }
                                            botButton.title = new StaticLayout(buttonText, botButtonPaint, buttonWidth - AndroidUtilities.dp(10.0f), Layout.Alignment.ALIGN_CENTER, 1.0f, 0.0f, false);
                                            this.botButtons.add(botButton);
                                            if (b8 == row.buttons.size() - 1) {
                                                maxButtonsWidth = Math.max(maxButtonsWidth, botButton.x + botButton.width);
                                            }
                                            if (messageObject.isFromUser() && (botButton.button instanceof TLRPC.TL_keyboardButtonUrl)) {
                                                try {
                                                    Uri uri = Uri.parse(botButton.button.url);
                                                    String host = uri.getHost().toLowerCase();
                                                    if (uri.getQueryParameter("startgroup") != null) {
                                                        try {
                                                            CharSequence buttonText3 = uri.getScheme();
                                                            if ((("http".equals(buttonText3) || "https".equals(uri.getScheme())) && ("t.me".equals(host) || "telegram.me".equals(host) || "telegram.dog".equals(host))) || ("tg".equals(uri.getScheme()) && (botButton.button.url.startsWith("tg:resolve") || botButton.button.url.startsWith("tg://resolve")))) {
                                                                z6 = true;
                                                                botButton.isInviteButton = z6;
                                                            }
                                                        } catch (Exception e48) {
                                                        }
                                                    }
                                                    z6 = false;
                                                    botButton.isInviteButton = z6;
                                                } catch (Exception e49) {
                                                }
                                            }
                                            b8++;
                                            z4 = z23;
                                            rows = rows2;
                                            fullWidth2 = fullWidth;
                                            oldByPosition = oldByPosition2;
                                            oldByData3 = oldByData2;
                                        }
                                    }
                                    a40++;
                                    z4 = z4;
                                    rows = rows;
                                    fullWidth2 = fullWidth2;
                                    oldByPosition = oldByPosition;
                                    oldByData3 = oldByData3;
                                }
                            }
                            this.widthForButtons = maxButtonsWidth;
                        }
                        if (this.drawCommentButton) {
                            this.totalHeight += AndroidUtilities.dp(shouldDrawTimeOnMedia() ? 41.3f : 43.0f);
                            createSelectorDrawable(1);
                        }
                        z5 = this.drawPinnedBottom;
                        if (!z5 && this.drawPinnedTop) {
                            this.totalHeight -= AndroidUtilities.dp(2.0f);
                        } else if (z5) {
                            this.totalHeight -= AndroidUtilities.dp(1.0f);
                        } else if (this.drawPinnedTop && this.pinnedBottom && (groupedMessagePosition2 = this.currentPosition) != null && groupedMessagePosition2.siblingHeights == null) {
                            this.totalHeight -= AndroidUtilities.dp(1.0f);
                        }
                        if (!messageObject.isAnyKindOfSticker() && this.totalHeight < AndroidUtilities.dp(70.0f)) {
                            int dp21 = AndroidUtilities.dp(70.0f);
                            int i91 = this.totalHeight;
                            int i92 = dp21 - i91;
                            this.additionalTimeOffsetY = i92;
                            this.totalHeight = i91 + i92;
                        } else if (messageObject.isAnimatedEmoji()) {
                            this.additionalTimeOffsetY = AndroidUtilities.dp(16.0f);
                            this.totalHeight += AndroidUtilities.dp(16.0f);
                        }
                        if (!this.drawPhotoImage) {
                            this.photoImage.setImageBitmap((Drawable) null);
                        }
                        if (this.documentAttachType != 5) {
                            this.radialProgress.setImageOverlay(null, null, null);
                        } else if (MessageObject.isDocumentHasThumb(this.documentAttach)) {
                            TLRPC.PhotoSize thumb = FileLoader.getClosestPhotoSizeWithSize(this.documentAttach.thumbs, 90);
                            this.radialProgress.setImageOverlay(thumb, this.documentAttach, messageObject6);
                        } else {
                            String artworkUrl = messageObject6.getArtworkUrl(true);
                            if (!TextUtils.isEmpty(artworkUrl)) {
                                this.radialProgress.setImageOverlay(artworkUrl);
                            } else {
                                this.radialProgress.setImageOverlay(null, null, null);
                            }
                        }
                        if (autoDownload) {
                            int minRad = AndroidUtilities.dp(4.0f);
                            int rad2 = SharedConfig.bubbleRadius > 2 ? AndroidUtilities.dp(SharedConfig.bubbleRadius - 2) : AndroidUtilities.dp(SharedConfig.bubbleRadius);
                            int nearRad = Math.min(AndroidUtilities.dp(3.0f), rad2);
                            int br = rad2;
                            int bl = rad2;
                            int tr = rad2;
                            int tl = rad2;
                            if (minRad > tl) {
                                minRad = tl;
                            }
                            if (this.hasLinkPreview || this.hasGamePreview || this.hasInvoicePreview) {
                                br = minRad;
                                bl = minRad;
                                tr = minRad;
                                tl = minRad;
                            }
                            if (this.forwardedNameLayout[0] != null || this.replyNameLayout != null || this.drawNameLayout) {
                                tr = minRad;
                                tl = minRad;
                            }
                            if (this.captionLayout != null || this.drawCommentButton) {
                                br = minRad;
                                bl = minRad;
                            }
                            if (this.documentAttachType == 1) {
                                br = minRad;
                                tr = minRad;
                            }
                            MessageObject.GroupedMessagePosition groupedMessagePosition19 = this.currentPosition;
                            if (groupedMessagePosition19 != null && this.currentMessagesGroup != null) {
                                if ((groupedMessagePosition19.flags & 2) == 0) {
                                    br = minRad;
                                    tr = minRad;
                                }
                                if ((this.currentPosition.flags & 1) == 0) {
                                    bl = minRad;
                                    tl = minRad;
                                }
                                if ((this.currentPosition.flags & 8) == 0) {
                                    br = minRad;
                                    bl = minRad;
                                }
                                if ((this.currentPosition.flags & 4) == 0) {
                                    tr = minRad;
                                    tl = minRad;
                                }
                            }
                            if (this.pinnedTop) {
                                if (this.currentMessageObject.isOutOwner()) {
                                    tr = nearRad;
                                } else {
                                    tl = nearRad;
                                }
                            }
                            if (this.pinnedBottom) {
                                if (this.currentMessageObject.isOutOwner()) {
                                    br = nearRad;
                                } else {
                                    bl = nearRad;
                                }
                            }
                            if (!this.mediaBackground && !this.currentMessageObject.isOutOwner()) {
                                bl = nearRad;
                            }
                            this.photoImage.setRoundRadius(tl, tr, br, bl);
                        }
                        messageObject2 = this.currentMessageObject;
                        if (messageObject2 != null && messageObject2.viewRef != null && (this.currentMessageObject.viewRef.get() == null || this.currentMessageObject.viewRef.get().get() != this)) {
                            this.currentMessageObject.viewRef.set(new WeakReference<>(this));
                        }
                    }
                }
                z4 = z19;
                i = i3;
                groupedMessagePosition = this.currentPosition;
                if (groupedMessagePosition != null) {
                }
                this.totalHeight += AndroidUtilities.dp(14.0f);
                if (this.currentMessageObject.eventId == 0) {
                }
                if (messageObject.isSponsored()) {
                }
                this.botButtons.clear();
                if (messageIdChanged) {
                }
                if (!messageObject6.isRestrictedMessage) {
                }
                this.substractBackgroundHeight = 0;
                this.keyboardHeight = 0;
                if (this.drawCommentButton) {
                }
                z5 = this.drawPinnedBottom;
                if (!z5) {
                }
                if (z5) {
                }
                if (!messageObject.isAnyKindOfSticker()) {
                }
                if (messageObject.isAnimatedEmoji()) {
                }
                if (!this.drawPhotoImage) {
                }
                if (this.documentAttachType != 5) {
                }
                if (autoDownload) {
                }
                messageObject2 = this.currentMessageObject;
                if (messageObject2 != null) {
                    this.currentMessageObject.viewRef.set(new WeakReference<>(this));
                }
            }
            if (messageIdChanged) {
                this.currentUrl = null;
                this.currentWebFile = null;
                this.lastWebFile = null;
                this.loadingProgressLayout = null;
                this.animatingLoadingProgressProgress = 0.0f;
                this.lastLoadingSizeTotal = 0L;
                this.selectedBackgroundProgress = 0.0f;
                ValueAnimator valueAnimator = this.statusDrawableAnimator;
                if (valueAnimator != null) {
                    valueAnimator.removeAllListeners();
                    this.statusDrawableAnimator.cancel();
                }
                this.transitionParams.lastStatusDrawableParams = -1;
                this.statusDrawableAnimationInProgress = false;
                if (this.documentAttachType == 5) {
                    boolean showSeekbar = MediaController.getInstance().isPlayingMessage(this.currentMessageObject);
                    this.toSeekBarProgress = showSeekbar ? 1.0f : 0.0f;
                }
                this.seekBarWaveform.setProgress(0.0f);
            }
            transcribeButton = this.transcribeButton;
            if (transcribeButton != null) {
                transcribeButton.setOpen(this.currentMessageObject.messageOwner != null && this.currentMessageObject.messageOwner.voiceTranscriptionOpen && this.currentMessageObject.messageOwner.voiceTranscriptionFinal, !messageIdChanged);
                this.transcribeButton.setLoading(TranscribeButton.isTranscribing(this.currentMessageObject), !messageIdChanged);
            }
            updateWaveform();
            updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
            if (!this.currentMessageObject.loadingCancelled && this.buttonState == 2 && this.documentAttachType == 3 && DownloadController.getInstance(this.currentAccount).canDownloadMedia(messageObject6)) {
                FileLoader.getInstance(this.currentAccount).loadFile(this.documentAttach, this.currentMessageObject, 1, 0);
                this.buttonState = 4;
                this.radialProgress.setIcon(getIconForCurrentState(), false, false);
            }
            chatMessageCellDelegate = this.delegate;
            if (chatMessageCellDelegate != null && chatMessageCellDelegate.getTextSelectionHelper() != null && !messageIdChanged && messageChanged && messageObject6 != null) {
                this.delegate.getTextSelectionHelper().checkDataChanged(messageObject6);
            }
            this.accessibilityVirtualViewBounds.clear();
            this.transitionParams.updatePhotoImageX = true;
            updateFlagSecure();
        }
        z = true;
        messageChanged = z;
        MessageObject messageObject82 = this.currentMessageObject;
        if (messageObject82 == null) {
        }
        if (groupedMessages == this.currentMessagesGroup) {
        }
        boolean pollChanged22 = false;
        this.accessibilityText = null;
        if (!this.drawCommentButton) {
        }
        if (!messageChanged) {
            setCurrentDiceValue(this.isUpdating);
        }
        if (!messageChanged) {
        }
        pollChanged = false;
        if (!groupChanged) {
        }
        groupChanged2 = groupChanged;
        int i172 = 1065353216;
        i18 = 1065353216;
        int i182 = 1065353216;
        i172 = 1065353216;
        if (!messageChanged) {
        }
        this.wasPinned = this.isPinned;
        this.pinnedBottom = bottomNear;
        this.pinnedTop = topNear;
        this.currentMessageObject = messageObject6;
        this.currentMessagesGroup = groupedMessages;
        this.lastTime = -2;
        this.lastPostAuthor = messageObject6.messageOwner.post_author;
        this.isHighlightedAnimated = false;
        this.widthBeforeNewTimeLine = -1;
        groupedMessages2 = this.currentMessagesGroup;
        if (groupedMessages2 != null) {
        }
        this.currentMessagesGroup = null;
        this.currentPosition = null;
        groupedMessages3 = this.currentMessagesGroup;
        if (groupedMessages3 != null) {
        }
        this.drawPinnedTop = this.pinnedTop;
        this.drawPinnedBottom = this.pinnedBottom;
        this.isPlayingRound = !this.isRoundVideo && MediaController.getInstance().isPlayingMessage(this.currentMessageObject) && (chatMessageCellDelegate2 = this.delegate) != null && !chatMessageCellDelegate2.keyboardIsOpened() && !this.delegate.isLandscape();
        this.photoImage.setCrossfadeWithOldImage(false);
        this.photoImage.setCrossfadeDuration(150);
        this.photoImage.setGradientBitmap(null);
        this.lastSendState = messageObject6.messageOwner.send_state;
        this.lastDeleteDate = messageObject6.messageOwner.destroyTime;
        this.lastViewsCount = messageObject6.messageOwner.views;
        this.lastRepliesCount = getRepliesCount();
        if (!messageIdChanged) {
        }
        this.gamePreviewPressed = z2;
        this.sideButtonPressed = z2;
        this.hasNewLineForTime = z2;
        this.flipImage = z2;
        if (this.isThreadChat) {
        }
        this.isThreadPost = z18;
        this.isAvatarVisible = z18 && this.isChat && !messageObject.isOutOwner() && messageObject.needDrawAvatar() && ((groupedMessagePosition13 = this.currentPosition) == null || groupedMessagePosition13.edge);
        if (!this.isChat) {
        }
        if (messageObject6.customAvatarDrawable == null) {
        }
        this.wasLayout = false;
        this.groupPhotoInvisible = false;
        this.animatingDrawVideoImageButton = 0;
        this.drawVideoSize = false;
        this.canStreamVideo = false;
        this.animatingNoSound = 0;
        if (!MessagesController.getInstance(this.currentAccount).isChatNoForwards(messageObject.getChatId())) {
        }
        r2 = 0;
        this.drawSideButton = 0;
        this.replyNameLayout = null;
        this.adminLayout = null;
        this.checkOnlyButtonPressed = r2;
        this.replyTextLayout = null;
        this.lastReplyMessage = null;
        this.hasEmbed = r2;
        this.autoPlayingMedia = r2;
        int i202 = r2 == true ? 1 : 0;
        int i212 = r2 == true ? 1 : 0;
        int i222 = r2 == true ? 1 : 0;
        this.replyNameWidth = i202;
        this.replyTextWidth = r2;
        this.viaWidth = r2;
        this.viaNameWidth = r2;
        this.addedCaptionHeight = r2;
        this.currentReplyPhoto = null;
        this.currentUser = null;
        this.currentChat = null;
        this.currentViaBotUser = null;
        this.instantViewLayout = null;
        this.drawNameLayout = false;
        this.lastLoadingSizeTotal = 0L;
        if (this.scheduledInvalidate) {
        }
        this.links.clear();
        this.pressedLink = null;
        this.pressedLinkType = -1;
        messageObject6.forceUpdate = false;
        this.drawPhotoImage = false;
        this.drawMediaCheckBox = false;
        this.hasLinkPreview = false;
        this.hasOldCaptionPreview = false;
        this.hasGamePreview = false;
        this.hasInvoicePreview = false;
        this.commentButtonPressed = false;
        this.instantButtonPressed = false;
        this.instantPressed = false;
        if (!pollChanged) {
            a5 = 0;
            while (true) {
                drawableArr = this.selectorDrawable;
                if (a5 < drawableArr.length) {
                }
                a5++;
            }
        }
        this.spoilerPressed = null;
        this.isCaptionSpoilerPressed = false;
        this.isSpoilerRevealing = false;
        this.linkPreviewPressed = false;
        this.buttonPressed = 0;
        this.additionalTimeOffsetY = 0;
        this.miniButtonPressed = 0;
        this.pressedBotButton = -1;
        this.pressedVoteButton = -1;
        this.pollHintPressed = false;
        this.psaHintPressed = false;
        this.linkPreviewHeight = 0;
        this.mediaOffsetY = 0;
        this.documentAttachType = 0;
        this.documentAttach = null;
        this.descriptionLayout = null;
        this.titleLayout = null;
        this.videoInfoLayout = null;
        this.photosCountLayout = null;
        this.siteNameLayout = null;
        this.authorLayout = null;
        this.captionLayout = null;
        this.captionWidth = 0;
        this.captionHeight = 0;
        this.captionOffsetX = 0;
        this.currentCaption = null;
        this.docTitleLayout = null;
        this.drawImageButton = false;
        this.drawVideoImageButton = false;
        this.currentPhotoObject = null;
        this.photoParentObject = null;
        this.currentPhotoObjectThumb = null;
        this.currentPhotoObjectThumbStripped = null;
        if (!messageChanged) {
        }
        this.currentPhotoFilter = null;
        this.buttonState = -1;
        this.miniButtonState = -1;
        this.hasMiniProgress = 0;
        if (this.addedForTest) {
            ImageLoader.getInstance().removeTestWebFile(this.currentUrl);
        }
        this.addedForTest = false;
        this.photoNotSet = false;
        this.drawBackground = true;
        this.drawName = false;
        this.useSeekBarWaveform = false;
        this.useTranscribeButton = false;
        this.drawInstantView = false;
        this.drawInstantViewType = 0;
        this.drawForwardedName = false;
        this.drawCommentButton = false;
        this.photoImage.setSideClip(0.0f);
        this.photoImage.setAspectFit(false);
        this.gradientShader = null;
        this.motionBackgroundDrawable = null;
        this.imageBackgroundColor = 0;
        this.imageBackgroundGradientColor1 = 0;
        this.imageBackgroundGradientColor2 = 0;
        this.imageBackgroundIntensity = 0.0f;
        this.imageBackgroundGradientColor3 = 0;
        this.imageBackgroundGradientRotation = 45;
        this.imageBackgroundSideColor = 0;
        this.mediaBackground = false;
        this.isMedia = false;
        this.photoImage.animatedFileDrawableRepeatMaxCount = 0;
        if (messageObject6.messageOwner.fwd_from == null) {
        }
        this.hasPsaHint = z3;
        if (z3) {
        }
        this.photoImage.setAlpha(1.0f);
        if (!messageChanged) {
        }
        this.pollButtons.clear();
        boolean z192 = false;
        this.availableTimeWidth = 0;
        this.photoImage.setForceLoading(false);
        this.photoImage.setNeedsQualityThumb(false);
        this.photoImage.setShouldGenerateQualityThumb(false);
        this.photoImage.setAllowDecodeSingleFrame(false);
        this.photoImage.setColorFilter(null);
        this.photoImage.setMediaStartEndTime(-1L, -1L);
        autoDownload = true;
        if (!messageIdChanged) {
        }
        messageObject6.reactionsChanged = false;
        groupedMessagePosition11 = this.currentPosition;
        if (groupedMessagePosition11 == null) {
        }
        if (this.currentPosition == null) {
        }
        if (messageChanged) {
        }
        boolean linked32 = false;
        groupedMessages4 = this.currentMessagesGroup;
        if (groupedMessages4 != null) {
        }
        boolean linked42 = messageObject6.isLinkedToChat(this.linkedChatId);
        linked = linked42;
        linked2 = this.hasDiscussion;
        if (linked2) {
        }
        this.commentLayout = null;
        this.drawCommentNumber = false;
        float f52 = 102.0f;
        if (messageObject6.type != 0) {
        }
        if (this.currentPosition == null) {
        }
        if (!messageObject.isAnyKindOfSticker()) {
        }
        c = 2;
        i3 = 0;
        z4 = z192;
        i = i3;
        groupedMessagePosition = this.currentPosition;
        if (groupedMessagePosition != null) {
        }
        this.totalHeight += AndroidUtilities.dp(14.0f);
        if (this.currentMessageObject.eventId == 0) {
        }
        if (messageObject.isSponsored()) {
        }
        this.botButtons.clear();
        if (messageIdChanged) {
        }
        if (!messageObject6.isRestrictedMessage) {
        }
        this.substractBackgroundHeight = 0;
        this.keyboardHeight = 0;
        if (this.drawCommentButton) {
        }
        z5 = this.drawPinnedBottom;
        if (!z5) {
        }
        if (z5) {
        }
        if (!messageObject.isAnyKindOfSticker()) {
        }
        if (messageObject.isAnimatedEmoji()) {
        }
        if (!this.drawPhotoImage) {
        }
        if (this.documentAttachType != 5) {
        }
        if (autoDownload) {
        }
        messageObject2 = this.currentMessageObject;
        if (messageObject2 != null) {
        }
        if (messageIdChanged) {
        }
        transcribeButton = this.transcribeButton;
        if (transcribeButton != null) {
        }
        updateWaveform();
        updateButtonState(false, messageIdChanged && !messageObject6.cancelEditing, true);
        if (!this.currentMessageObject.loadingCancelled) {
            FileLoader.getInstance(this.currentAccount).loadFile(this.documentAttach, this.currentMessageObject, 1, 0);
            this.buttonState = 4;
            this.radialProgress.setIcon(getIconForCurrentState(), false, false);
        }
        chatMessageCellDelegate = this.delegate;
        if (chatMessageCellDelegate != null) {
            this.delegate.getTextSelectionHelper().checkDataChanged(messageObject6);
        }
        this.accessibilityVirtualViewBounds.clear();
        this.transitionParams.updatePhotoImageX = true;
        updateFlagSecure();
    }

    public static /* synthetic */ int lambda$setMessageContent$5(PollButton o1, PollButton o2) {
        if (o1.decimal > o2.decimal) {
            return -1;
        }
        if (o1.decimal < o2.decimal) {
            return 1;
        }
        if (o1.decimal == o2.decimal) {
            if (o1.percent > o2.percent) {
                return 1;
            }
            return o1.percent < o2.percent ? -1 : 0;
        }
        return 0;
    }

    private void updateFlagSecure() {
        Runnable runnable;
        MessageObject messageObject = this.currentMessageObject;
        boolean flagSecure = (messageObject == null || messageObject.messageOwner == null || !this.currentMessageObject.messageOwner.noforwards) ? false : true;
        Activity activity = AndroidUtilities.findActivity(getContext());
        if (flagSecure && this.unregisterFlagSecure == null && activity != null) {
            this.unregisterFlagSecure = AndroidUtilities.registerFlagSecure(activity.getWindow());
        } else if (!flagSecure && (runnable = this.unregisterFlagSecure) != null) {
            runnable.run();
            this.unregisterFlagSecure = null;
        }
    }

    public void checkVideoPlayback(boolean allowStart, Bitmap thumb) {
        boolean z = false;
        if (this.currentMessageObject.isVideo()) {
            if (MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
                this.photoImage.setAllowStartAnimation(false);
                this.photoImage.stopAnimation();
                return;
            }
            this.photoImage.setAllowStartAnimation(true);
            this.photoImage.startAnimation();
            return;
        }
        if (allowStart) {
            MessageObject playingMessage = MediaController.getInstance().getPlayingMessageObject();
            if (playingMessage == null || !playingMessage.isRoundVideo()) {
                z = true;
            }
            allowStart = z;
        }
        this.photoImage.setAllowStartAnimation(allowStart);
        if (thumb != null) {
            this.photoImage.startCrossfadeFromStaticThumb(thumb);
        }
        if (allowStart) {
            this.photoImage.startAnimation();
        } else {
            this.photoImage.stopAnimation();
        }
    }

    private static boolean spanSupportsLongPress(CharacterStyle span) {
        return (span instanceof URLSpanMono) || (span instanceof URLSpan);
    }

    @Override // org.telegram.ui.Cells.BaseCell
    protected boolean onLongPress() {
        int id;
        if (this.isRoundVideo && this.isPlayingRound && MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
            float touchRadius = ((this.lastTouchX - this.photoImage.getCenterX()) * (this.lastTouchX - this.photoImage.getCenterX())) + ((this.lastTouchY - this.photoImage.getCenterY()) * (this.lastTouchY - this.photoImage.getCenterY()));
            float r1 = (this.photoImage.getImageWidth() / 2.0f) * (this.photoImage.getImageWidth() / 2.0f);
            if (touchRadius < r1 && (this.lastTouchX > this.photoImage.getCenterX() + (this.photoImage.getImageWidth() / 4.0f) || this.lastTouchX < this.photoImage.getCenterX() - (this.photoImage.getImageWidth() / 4.0f))) {
                boolean forward = this.lastTouchX > this.photoImage.getCenterX();
                if (this.videoPlayerRewinder == null) {
                    this.videoForwardDrawable = new VideoForwardDrawable(true);
                    this.videoPlayerRewinder = new VideoPlayerRewinder() { // from class: org.telegram.ui.Cells.ChatMessageCell.4
                        @Override // org.telegram.messenger.video.VideoPlayerRewinder
                        protected void onRewindCanceled() {
                            ChatMessageCell.this.onTouchEvent(MotionEvent.obtain(0L, 0L, 3, 0.0f, 0.0f, 0));
                            ChatMessageCell.this.videoForwardDrawable.setShowing(false);
                        }

                        @Override // org.telegram.messenger.video.VideoPlayerRewinder
                        protected void updateRewindProgressUi(long timeDiff, float progress, boolean rewindByBackSeek) {
                            ChatMessageCell.this.videoForwardDrawable.setTime(Math.abs(timeDiff));
                            if (rewindByBackSeek) {
                                ChatMessageCell.this.currentMessageObject.audioProgress = progress;
                                ChatMessageCell.this.updatePlayingMessageProgress();
                            }
                        }

                        @Override // org.telegram.messenger.video.VideoPlayerRewinder
                        protected void onRewindStart(boolean rewindForward) {
                            ChatMessageCell.this.videoForwardDrawable.setDelegate(new VideoForwardDrawable.VideoForwardDrawableDelegate() { // from class: org.telegram.ui.Cells.ChatMessageCell.4.1
                                @Override // org.telegram.ui.Components.VideoForwardDrawable.VideoForwardDrawableDelegate
                                public void onAnimationEnd() {
                                }

                                @Override // org.telegram.ui.Components.VideoForwardDrawable.VideoForwardDrawableDelegate
                                public void invalidate() {
                                    ChatMessageCell.this.invalidate();
                                }
                            });
                            ChatMessageCell.this.videoForwardDrawable.setOneShootAnimation(false);
                            ChatMessageCell.this.videoForwardDrawable.setLeftSide(!rewindForward);
                            ChatMessageCell.this.videoForwardDrawable.setShowing(true);
                            ChatMessageCell.this.invalidate();
                        }
                    };
                    getParent().requestDisallowInterceptTouchEvent(true);
                }
                this.videoPlayerRewinder.startRewind(MediaController.getInstance().getVideoPlayer(), forward, MediaController.getInstance().getPlaybackSpeed(false));
                return false;
            }
        }
        LinkSpanDrawable linkSpanDrawable = this.pressedLink;
        if (linkSpanDrawable != null) {
            if (linkSpanDrawable.getSpan() instanceof URLSpanMono) {
                this.hadLongPress = true;
                this.delegate.didPressUrl(this, this.pressedLink.getSpan(), true);
                return true;
            } else if (this.pressedLink.getSpan() instanceof URLSpanNoUnderline) {
                URLSpanNoUnderline url = (URLSpanNoUnderline) this.pressedLink.getSpan();
                if (ChatActivity.isClickableLink(url.getURL()) || url.getURL().startsWith("/")) {
                    this.hadLongPress = true;
                    this.delegate.didPressUrl(this, this.pressedLink.getSpan(), true);
                    return true;
                }
            } else if (this.pressedLink.getSpan() instanceof URLSpan) {
                this.hadLongPress = true;
                this.delegate.didPressUrl(this, this.pressedLink.getSpan(), true);
                return true;
            }
        }
        resetPressedLink(-1);
        if (this.buttonPressed != 0 || this.miniButtonPressed != 0 || this.videoButtonPressed != 0 || this.pressedBotButton != -1) {
            this.buttonPressed = 0;
            this.miniButtonPressed = 0;
            this.videoButtonPressed = 0;
            this.pressedBotButton = -1;
            invalidate();
        }
        this.linkPreviewPressed = false;
        this.sideButtonPressed = false;
        this.imagePressed = false;
        this.timePressed = false;
        this.gamePreviewPressed = false;
        if (this.pressedVoteButton != -1 || this.pollHintPressed || this.psaHintPressed || this.instantPressed || this.otherPressed || this.commentButtonPressed) {
            this.commentButtonPressed = false;
            this.instantButtonPressed = false;
            this.instantPressed = false;
            this.pressedVoteButton = -1;
            this.pollHintPressed = false;
            this.psaHintPressed = false;
            this.otherPressed = false;
            if (Build.VERSION.SDK_INT >= 21) {
                int a = 0;
                while (true) {
                    Drawable[] drawableArr = this.selectorDrawable;
                    if (a >= drawableArr.length) {
                        break;
                    }
                    if (drawableArr[a] != null) {
                        drawableArr[a].setState(StateSet.NOTHING);
                    }
                    a++;
                }
            }
            invalidate();
        }
        if (this.delegate != null) {
            boolean handled = false;
            if (this.avatarPressed) {
                TLRPC.User user = this.currentUser;
                if (user != null) {
                    if (user.id != 0) {
                        handled = this.delegate.didLongPressUserAvatar(this, this.currentUser, this.lastTouchX, this.lastTouchY);
                    }
                } else if (this.currentChat != null) {
                    if (this.currentMessageObject.messageOwner.fwd_from != null) {
                        if ((this.currentMessageObject.messageOwner.fwd_from.flags & 16) != 0) {
                            id = this.currentMessageObject.messageOwner.fwd_from.saved_from_msg_id;
                        } else {
                            id = this.currentMessageObject.messageOwner.fwd_from.channel_post;
                        }
                    } else {
                        id = 0;
                    }
                    handled = this.delegate.didLongPressChannelAvatar(this, this.currentChat, id, this.lastTouchX, this.lastTouchY);
                }
            }
            if (!handled) {
                this.delegate.didLongPress(this, this.lastTouchX, this.lastTouchY);
            }
        }
        return true;
    }

    public void showHintButton(boolean show, boolean animated, int type) {
        float f = 1.0f;
        if (type == -1 || type == 0) {
            if (this.hintButtonVisible == show) {
                return;
            }
            this.hintButtonVisible = show;
            if (!animated) {
                this.hintButtonProgress = show ? 1.0f : 0.0f;
            } else {
                invalidate();
            }
        }
        if ((type != -1 && type != 1) || this.psaButtonVisible == show) {
            return;
        }
        this.psaButtonVisible = show;
        if (!animated) {
            if (!show) {
                f = 0.0f;
            }
            this.psaButtonProgress = f;
            return;
        }
        setInvalidatesParent(true);
        invalidate();
    }

    public void setCheckPressed(boolean value, boolean pressed) {
        this.isCheckPressed = value;
        this.isPressed = pressed;
        updateRadialProgressBackground();
        if (this.useSeekBarWaveform) {
            this.seekBarWaveform.setSelected(isDrawSelectionBackground());
        } else {
            this.seekBar.setSelected(isDrawSelectionBackground());
        }
        invalidate();
    }

    public void setInvalidateSpoilersParent(boolean invalidateSpoilersParent) {
        this.invalidateSpoilersParent = invalidateSpoilersParent;
    }

    public void setInvalidatesParent(boolean value) {
        this.invalidatesParent = value;
    }

    @Override // android.view.View, org.telegram.ui.Cells.TextSelectionHelper.SelectableView
    public void invalidate() {
        ChatMessageCellDelegate chatMessageCellDelegate;
        if (this.currentMessageObject == null) {
            return;
        }
        super.invalidate();
        if ((this.invalidatesParent || (this.currentMessagesGroup != null && !this.links.isEmpty())) && getParent() != null) {
            View parent = (View) getParent();
            if (parent.getParent() != null) {
                parent.invalidate();
                ((View) parent.getParent()).invalidate();
            }
        }
        if (this.isBlurred && (chatMessageCellDelegate = this.delegate) != null) {
            chatMessageCellDelegate.invalidateBlur();
        }
    }

    @Override // android.view.View
    public void invalidate(int l, int t, int r, int b) {
        if (this.currentMessageObject == null) {
            return;
        }
        super.invalidate(l, t, r, b);
        if (this.invalidatesParent && getParent() != null) {
            View parent = (View) getParent();
            parent.invalidate(((int) getX()) + l, ((int) getY()) + t, ((int) getX()) + r, ((int) getY()) + b);
        }
    }

    public boolean isHighlightedAnimated() {
        return this.isHighlightedAnimated;
    }

    public void setHighlightedAnimated() {
        this.isHighlightedAnimated = true;
        this.highlightProgress = 1000;
        this.lastHighlightProgressTime = System.currentTimeMillis();
        invalidate();
        if (getParent() != null) {
            ((View) getParent()).invalidate();
        }
    }

    public boolean isHighlighted() {
        return this.isHighlighted;
    }

    public void setHighlighted(boolean value) {
        if (this.isHighlighted == value) {
            return;
        }
        this.isHighlighted = value;
        if (!value) {
            this.lastHighlightProgressTime = System.currentTimeMillis();
            this.isHighlightedAnimated = true;
            this.highlightProgress = 300;
        } else {
            this.isHighlightedAnimated = false;
            this.highlightProgress = 0;
        }
        updateRadialProgressBackground();
        if (this.useSeekBarWaveform) {
            this.seekBarWaveform.setSelected(isDrawSelectionBackground());
        } else {
            this.seekBar.setSelected(isDrawSelectionBackground());
        }
        invalidate();
        if (getParent() != null) {
            ((View) getParent()).invalidate();
        }
    }

    @Override // android.view.View
    public void setPressed(boolean pressed) {
        super.setPressed(pressed);
        updateRadialProgressBackground();
        if (this.useSeekBarWaveform) {
            this.seekBarWaveform.setSelected(isDrawSelectionBackground());
        } else {
            this.seekBar.setSelected(isDrawSelectionBackground());
        }
        invalidate();
    }

    private void updateRadialProgressBackground() {
        if (this.drawRadialCheckBackground) {
            return;
        }
        boolean z = true;
        boolean forcePressed = (this.isHighlighted || this.isPressed || isPressed()) && (!this.drawPhotoImage || !this.photoImage.hasBitmapImage());
        this.radialProgress.setPressed(forcePressed || this.buttonPressed != 0, false);
        if (this.hasMiniProgress != 0) {
            this.radialProgress.setPressed(forcePressed || this.miniButtonPressed != 0, true);
        }
        RadialProgress2 radialProgress2 = this.videoRadialProgress;
        if (!forcePressed && this.videoButtonPressed == 0) {
            z = false;
        }
        radialProgress2.setPressed(z, false);
    }

    @Override // org.telegram.ui.Components.SeekBar.SeekBarDelegate
    public void onSeekBarDrag(float progress) {
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject == null) {
            return;
        }
        messageObject.audioProgress = progress;
        MediaController.getInstance().seekToProgress(this.currentMessageObject, progress);
        updatePlayingMessageProgress();
    }

    @Override // org.telegram.ui.Components.SeekBar.SeekBarDelegate
    public void onSeekBarContinuousDrag(float progress) {
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject == null) {
            return;
        }
        messageObject.audioProgress = progress;
        MessageObject messageObject2 = this.currentMessageObject;
        messageObject2.audioProgressSec = (int) (messageObject2.getDuration() * progress);
        updatePlayingMessageProgress();
    }

    public boolean isAnimatingPollAnswer() {
        return this.animatePollAnswerAlpha;
    }

    private void updateWaveform() {
        boolean z;
        if (this.currentMessageObject == null || this.documentAttachType != 3) {
            return;
        }
        int a = 0;
        while (true) {
            z = false;
            if (a >= this.documentAttach.attributes.size()) {
                break;
            }
            TLRPC.DocumentAttribute attribute = this.documentAttach.attributes.get(a);
            if (!(attribute instanceof TLRPC.TL_documentAttributeAudio)) {
                a++;
            } else {
                if (attribute.waveform == null || attribute.waveform.length == 0) {
                    MediaController.getInstance().generateWaveform(this.currentMessageObject);
                }
                this.useSeekBarWaveform = attribute.waveform != null;
                this.seekBarWaveform.setWaveform(attribute.waveform);
            }
        }
        if (this.currentMessageObject.isVoice() && this.useSeekBarWaveform && this.currentMessageObject.messageOwner != null && !(this.currentMessageObject.messageOwner.media instanceof TLRPC.TL_messageMediaWebPage) && UserConfig.getInstance(this.currentAccount).isPremium()) {
            z = true;
        }
        this.useTranscribeButton = z;
        updateSeekBarWaveformWidth();
    }

    private void updateSeekBarWaveformWidth() {
        if (this.seekBarWaveform != null) {
            int offset = (-AndroidUtilities.dp((this.hasLinkPreview ? 10 : 0) + 92)) - AndroidUtilities.dp(this.useTranscribeButton ? 34.0f : 0.0f);
            if (this.transitionParams.animateBackgroundBoundsInner && this.documentAttachType == 3) {
                int fromBackgroundWidth = this.backgroundWidth;
                int toBackgroundWidth = (int) ((this.backgroundWidth - this.transitionParams.toDeltaLeft) + this.transitionParams.toDeltaRight);
                int backgroundWidth = (int) ((this.backgroundWidth - this.transitionParams.deltaLeft) + this.transitionParams.deltaRight);
                this.seekBarWaveform.setSize(backgroundWidth + offset, AndroidUtilities.dp(30.0f), fromBackgroundWidth + offset, toBackgroundWidth + offset);
                return;
            }
            this.seekBarWaveform.setSize(this.backgroundWidth + offset, AndroidUtilities.dp(30.0f));
        }
    }

    private int createDocumentLayout(int maxWidth, MessageObject messageObject) {
        int maxWidth2;
        String name;
        int width;
        if (messageObject.type == 0) {
            this.documentAttach = messageObject.messageOwner.media.webpage.document;
        } else {
            this.documentAttach = messageObject.getDocument();
        }
        TLRPC.Document document = this.documentAttach;
        if (document == null) {
            return 0;
        }
        if (MessageObject.isVoiceDocument(document)) {
            this.documentAttachType = 3;
            int duration = 0;
            int a = 0;
            while (true) {
                if (a >= this.documentAttach.attributes.size()) {
                    break;
                }
                TLRPC.DocumentAttribute attribute = this.documentAttach.attributes.get(a);
                if (!(attribute instanceof TLRPC.TL_documentAttributeAudio)) {
                    a++;
                } else {
                    duration = attribute.duration;
                    break;
                }
            }
            this.widthBeforeNewTimeLine = (maxWidth - AndroidUtilities.dp(94.0f)) - ((int) Math.ceil(Theme.chat_audioTimePaint.measureText("00:00")));
            this.availableTimeWidth = maxWidth - AndroidUtilities.dp(18.0f);
            measureTime(messageObject);
            int minSize = AndroidUtilities.dp(174.0f) + this.timeWidth;
            if (!this.hasLinkPreview) {
                String timeString = AndroidUtilities.formatLongDuration(duration);
                int w = (int) Math.ceil(Theme.chat_audioTimePaint.measureText(timeString));
                this.backgroundWidth = Math.min(maxWidth, minSize + w);
            }
            this.seekBarWaveform.setMessageObject(messageObject);
            return 0;
        } else if (MessageObject.isVideoDocument(this.documentAttach)) {
            this.documentAttachType = 4;
            if (!messageObject.needDrawBluredPreview()) {
                updatePlayingMessageProgress();
                String str = String.format("%s", AndroidUtilities.formatFileSize(this.documentAttach.size));
                this.docTitleWidth = (int) Math.ceil(Theme.chat_infoPaint.measureText(str));
                this.docTitleLayout = new StaticLayout(str, Theme.chat_infoPaint, this.docTitleWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
            }
            return 0;
        } else if (MessageObject.isMusicDocument(this.documentAttach)) {
            this.documentAttachType = 5;
            int maxWidth3 = maxWidth - AndroidUtilities.dp(92.0f);
            if (maxWidth3 < 0) {
                maxWidth3 = AndroidUtilities.dp(100.0f);
            }
            CharSequence stringFinal = TextUtils.ellipsize(messageObject.getMusicTitle().replace('\n', ' '), Theme.chat_audioTitlePaint, maxWidth3 - AndroidUtilities.dp(12.0f), TextUtils.TruncateAt.END);
            StaticLayout staticLayout = new StaticLayout(stringFinal, Theme.chat_audioTitlePaint, maxWidth3, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
            this.songLayout = staticLayout;
            if (staticLayout.getLineCount() > 0) {
                this.songX = -((int) Math.ceil(this.songLayout.getLineLeft(0)));
            }
            CharSequence stringFinal2 = TextUtils.ellipsize(messageObject.getMusicAuthor().replace('\n', ' '), Theme.chat_audioPerformerPaint, maxWidth3, TextUtils.TruncateAt.END);
            StaticLayout staticLayout2 = new StaticLayout(stringFinal2, Theme.chat_audioPerformerPaint, maxWidth3, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
            this.performerLayout = staticLayout2;
            if (staticLayout2.getLineCount() > 0) {
                this.performerX = -((int) Math.ceil(this.performerLayout.getLineLeft(0)));
            }
            int duration2 = 0;
            int a2 = 0;
            while (true) {
                if (a2 >= this.documentAttach.attributes.size()) {
                    break;
                }
                TLRPC.DocumentAttribute attribute2 = this.documentAttach.attributes.get(a2);
                if (!(attribute2 instanceof TLRPC.TL_documentAttributeAudio)) {
                    a2++;
                } else {
                    duration2 = attribute2.duration;
                    break;
                }
            }
            int durationWidth = (int) Math.ceil(Theme.chat_audioTimePaint.measureText(AndroidUtilities.formatShortDuration(duration2, duration2)));
            this.widthBeforeNewTimeLine = (this.backgroundWidth - AndroidUtilities.dp(86.0f)) - durationWidth;
            this.availableTimeWidth = this.backgroundWidth - AndroidUtilities.dp(28.0f);
            return durationWidth;
        } else if (MessageObject.isGifDocument(this.documentAttach, messageObject.hasValidGroupId())) {
            this.documentAttachType = 2;
            if (!messageObject.needDrawBluredPreview()) {
                String str2 = LocaleController.getString("AttachGif", R.string.AttachGif);
                this.infoWidth = (int) Math.ceil(Theme.chat_infoPaint.measureText(str2));
                this.infoLayout = new StaticLayout(str2, Theme.chat_infoPaint, this.infoWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                String str3 = String.format("%s", AndroidUtilities.formatFileSize(this.documentAttach.size));
                this.docTitleWidth = (int) Math.ceil(Theme.chat_infoPaint.measureText(str3));
                this.docTitleLayout = new StaticLayout(str3, Theme.chat_infoPaint, this.docTitleWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
            }
            return 0;
        } else {
            boolean z = (this.documentAttach.mime_type != null && (this.documentAttach.mime_type.toLowerCase().startsWith("image/") || this.documentAttach.mime_type.toLowerCase().startsWith(MimeTypes.VIDEO_MP4))) || MessageObject.isDocumentHasThumb(this.documentAttach);
            this.drawPhotoImage = z;
            if (z) {
                maxWidth2 = maxWidth;
            } else {
                maxWidth2 = maxWidth + AndroidUtilities.dp(30.0f);
            }
            this.documentAttachType = 1;
            String name2 = FileLoader.getDocumentFileName(this.documentAttach);
            if (name2.length() != 0) {
                name = name2;
            } else {
                name = LocaleController.getString("AttachDocument", R.string.AttachDocument);
            }
            StaticLayout createStaticLayout = StaticLayoutEx.createStaticLayout(name, Theme.chat_docNamePaint, maxWidth2, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false, TextUtils.TruncateAt.MIDDLE, maxWidth2, 2, false);
            this.docTitleLayout = createStaticLayout;
            this.docTitleOffsetX = Integer.MIN_VALUE;
            if (createStaticLayout != null && createStaticLayout.getLineCount() > 0) {
                int maxLineWidth = 0;
                for (int a3 = 0; a3 < this.docTitleLayout.getLineCount(); a3++) {
                    maxLineWidth = Math.max(maxLineWidth, (int) Math.ceil(this.docTitleLayout.getLineWidth(a3)));
                    this.docTitleOffsetX = Math.max(this.docTitleOffsetX, (int) Math.ceil(-this.docTitleLayout.getLineLeft(a3)));
                }
                width = Math.min(maxWidth2, maxLineWidth);
            } else {
                int width2 = maxWidth2;
                this.docTitleOffsetX = 0;
                width = width2;
            }
            TextPaint textPaint = Theme.chat_infoPaint;
            this.infoWidth = Math.min(maxWidth2 - AndroidUtilities.dp(30.0f), (int) Math.ceil(textPaint.measureText("000.0 mm / " + AndroidUtilities.formatFileSize(this.documentAttach.size))));
            CharSequence str22 = TextUtils.ellipsize(AndroidUtilities.formatFileSize(this.documentAttach.size) + " " + FileLoader.getDocumentExtension(this.documentAttach), Theme.chat_infoPaint, (float) this.infoWidth, TextUtils.TruncateAt.END);
            try {
                if (this.infoWidth < 0) {
                    this.infoWidth = AndroidUtilities.dp(10.0f);
                }
                this.infoLayout = new StaticLayout(str22, Theme.chat_infoPaint, this.infoWidth + AndroidUtilities.dp(6.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
            } catch (Exception e) {
                FileLog.e(e);
            }
            if (this.drawPhotoImage) {
                this.currentPhotoObject = FileLoader.getClosestPhotoSizeWithSize(messageObject.photoThumbs, GroupCallActivity.TABLET_LIST_SIZE);
                this.currentPhotoObjectThumb = FileLoader.getClosestPhotoSizeWithSize(messageObject.photoThumbs, 40);
                if ((DownloadController.getInstance(this.currentAccount).getAutodownloadMask() & 1) == 0) {
                    this.currentPhotoObject = null;
                }
                TLRPC.PhotoSize photoSize = this.currentPhotoObject;
                if (photoSize == null || photoSize == this.currentPhotoObjectThumb) {
                    this.currentPhotoObject = null;
                    this.photoImage.setNeedsQualityThumb(true);
                    this.photoImage.setShouldGenerateQualityThumb(true);
                } else if (this.currentMessageObject.strippedThumb != null) {
                    this.currentPhotoObjectThumb = null;
                    this.currentPhotoObjectThumbStripped = this.currentMessageObject.strippedThumb;
                }
                this.currentPhotoFilter = "86_86_b";
                this.photoImage.setImage(ImageLocation.getForObject(this.currentPhotoObject, messageObject.photoThumbsObject), "86_86", ImageLocation.getForObject(this.currentPhotoObjectThumb, messageObject.photoThumbsObject), this.currentPhotoFilter, this.currentPhotoObjectThumbStripped, 0L, null, messageObject, 1);
            }
            return width;
        }
    }

    private void calcBackgroundWidth(int maxWidth, int timeMore, int maxChildWidth) {
        boolean newLineForTime;
        int lastLineWidth = (this.reactionsLayoutInBubble.isEmpty || this.reactionsLayoutInBubble.isSmall) ? this.currentMessageObject.lastLineWidth : this.reactionsLayoutInBubble.lastLineX;
        boolean z = false;
        if (!this.reactionsLayoutInBubble.isEmpty && !this.reactionsLayoutInBubble.isSmall) {
            if (maxWidth - lastLineWidth < timeMore || this.currentMessageObject.hasRtl) {
                z = true;
            }
            newLineForTime = z;
            if (this.hasInvoicePreview) {
                this.totalHeight += AndroidUtilities.dp(14.0f);
            }
        } else {
            boolean newLineForTime2 = this.hasLinkPreview;
            if (newLineForTime2 || this.hasOldCaptionPreview || this.hasGamePreview || this.hasInvoicePreview || maxWidth - lastLineWidth < timeMore || this.currentMessageObject.hasRtl) {
                z = true;
            }
            newLineForTime = z;
        }
        if (newLineForTime) {
            this.totalHeight += AndroidUtilities.dp(14.0f);
            this.hasNewLineForTime = true;
            int max = Math.max(maxChildWidth, lastLineWidth) + AndroidUtilities.dp(31.0f);
            this.backgroundWidth = max;
            this.backgroundWidth = Math.max(max, (this.currentMessageObject.isOutOwner() ? this.timeWidth + AndroidUtilities.dp(17.0f) : this.timeWidth) + AndroidUtilities.dp(31.0f));
            return;
        }
        int diff = (maxChildWidth - getExtraTextX()) - lastLineWidth;
        if (diff < 0 || diff > timeMore) {
            this.backgroundWidth = Math.max(maxChildWidth, lastLineWidth + timeMore) + AndroidUtilities.dp(31.0f);
        } else {
            this.backgroundWidth = ((maxChildWidth + timeMore) - diff) + AndroidUtilities.dp(31.0f);
        }
    }

    public void setHighlightedText(String text) {
        MessageObject messageObject = this.messageObjectToSet;
        if (messageObject == null) {
            messageObject = this.currentMessageObject;
        }
        MessageObject messageObject2 = messageObject;
        if (messageObject2 == null || messageObject2.messageOwner.message == null || TextUtils.isEmpty(text)) {
            if (!this.urlPathSelection.isEmpty()) {
                this.linkSelectionBlockNum = -1;
                resetUrlPaths();
                invalidate();
                return;
            }
            return;
        }
        String text2 = text.toLowerCase();
        String message = messageObject2.messageOwner.message.toLowerCase();
        int start = -1;
        int length = -1;
        int N1 = message.length();
        for (int a = 0; a < N1; a++) {
            int currentLen = 0;
            int N2 = Math.min(text2.length(), N1 - a);
            for (int b = 0; b < N2; b++) {
                boolean match = message.charAt(a + b) == text2.charAt(b);
                if (match) {
                    if (currentLen != 0 || a == 0 || " !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~\n".indexOf(message.charAt(a - 1)) >= 0) {
                        currentLen++;
                    } else {
                        match = false;
                    }
                }
                if (!match || b == N2 - 1) {
                    if (currentLen > 0 && currentLen > length) {
                        length = currentLen;
                        start = a;
                    }
                }
            }
        }
        if (start == -1) {
            if (!this.urlPathSelection.isEmpty()) {
                this.linkSelectionBlockNum = -1;
                resetUrlPaths();
                invalidate();
                return;
            }
            return;
        }
        int N = message.length();
        for (int a2 = start + length; a2 < N && " !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~\n".indexOf(message.charAt(a2)) < 0; a2++) {
            length++;
        }
        int N3 = start + length;
        if (this.captionLayout != null && !TextUtils.isEmpty(messageObject2.caption)) {
            resetUrlPaths();
            try {
                LinkPath path = obtainNewUrlPath();
                path.setCurrentLayout(this.captionLayout, start, 0.0f);
                this.captionLayout.getSelectionPath(start, N3, path);
            } catch (Exception e) {
                FileLog.e(e);
            }
            invalidate();
        } else if (messageObject2.textLayoutBlocks != null) {
            for (int c = 0; c < messageObject2.textLayoutBlocks.size(); c++) {
                MessageObject.TextLayoutBlock block = messageObject2.textLayoutBlocks.get(c);
                if (start >= block.charactersOffset && start < block.charactersEnd) {
                    this.linkSelectionBlockNum = c;
                    resetUrlPaths();
                    try {
                        LinkPath path2 = obtainNewUrlPath();
                        path2.setCurrentLayout(block.textLayout, start, 0.0f);
                        block.textLayout.getSelectionPath(start, N3, path2);
                        if (N3 >= block.charactersOffset + length) {
                            for (int a3 = c + 1; a3 < messageObject2.textLayoutBlocks.size(); a3++) {
                                MessageObject.TextLayoutBlock nextBlock = messageObject2.textLayoutBlocks.get(a3);
                                int length2 = nextBlock.charactersEnd - nextBlock.charactersOffset;
                                LinkPath path3 = obtainNewUrlPath();
                                path3.setCurrentLayout(nextBlock.textLayout, 0, nextBlock.height);
                                nextBlock.textLayout.getSelectionPath(0, N3 - nextBlock.charactersOffset, path3);
                                if (N3 < (block.charactersOffset + length2) - 1) {
                                    break;
                                }
                            }
                        }
                    } catch (Exception e2) {
                        FileLog.e(e2);
                    }
                    invalidate();
                    return;
                }
            }
        }
    }

    @Override // android.view.View
    protected boolean verifyDrawable(Drawable who) {
        if (!super.verifyDrawable(who)) {
            Drawable[] drawableArr = this.selectorDrawable;
            if (who != drawableArr[0] && who != drawableArr[1]) {
                return false;
            }
        }
        return true;
    }

    @Override // android.view.View, android.graphics.drawable.Drawable.Callback
    public void invalidateDrawable(Drawable drawable) {
        super.invalidateDrawable(drawable);
        if (this.currentMessagesGroup != null) {
            invalidateWithParent();
        }
    }

    private boolean isCurrentLocationTimeExpired(MessageObject messageObject) {
        return this.currentMessageObject.messageOwner.media.period % 60 == 0 ? Math.abs(ConnectionsManager.getInstance(this.currentAccount).getCurrentTime() - messageObject.messageOwner.date) > messageObject.messageOwner.media.period : Math.abs(ConnectionsManager.getInstance(this.currentAccount).getCurrentTime() - messageObject.messageOwner.date) > messageObject.messageOwner.media.period + (-5);
    }

    public void checkLocationExpired() {
        boolean newExpired;
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null && (newExpired = isCurrentLocationTimeExpired(messageObject)) != this.locationExpired) {
            this.locationExpired = newExpired;
            if (!newExpired) {
                AndroidUtilities.runOnUIThread(this.invalidateRunnable, 1000L);
                this.scheduledInvalidate = true;
                int maxWidth = this.backgroundWidth - AndroidUtilities.dp(91.0f);
                this.docTitleLayout = new StaticLayout(TextUtils.ellipsize(LocaleController.getString("AttachLiveLocation", R.string.AttachLiveLocation), Theme.chat_locationTitlePaint, maxWidth, TextUtils.TruncateAt.END), Theme.chat_locationTitlePaint, maxWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                return;
            }
            MessageObject messageObject2 = this.currentMessageObject;
            this.currentMessageObject = null;
            setMessageObject(messageObject2, this.currentMessagesGroup, this.pinnedBottom, this.pinnedTop);
        }
    }

    public void setIsUpdating(boolean value) {
        this.isUpdating = true;
    }

    public void setMessageObject(MessageObject messageObject, MessageObject.GroupedMessages groupedMessages, boolean bottomNear, boolean topNear) {
        if (this.attachedToWindow) {
            setMessageContent(messageObject, groupedMessages, bottomNear, topNear);
            return;
        }
        this.messageObjectToSet = messageObject;
        this.groupedMessagesToSet = groupedMessages;
        this.bottomNearToSet = bottomNear;
        this.topNearToSet = topNear;
    }

    private int getAdditionalWidthForPosition(MessageObject.GroupedMessagePosition position) {
        int w = 0;
        if (position == null) {
            return 0;
        }
        if ((position.flags & 2) == 0) {
            w = 0 + AndroidUtilities.dp(4.0f);
        }
        if ((position.flags & 1) == 0) {
            return w + AndroidUtilities.dp(4.0f);
        }
        return w;
    }

    public void createSelectorDrawable(final int num) {
        int color;
        if (Build.VERSION.SDK_INT < 21) {
            return;
        }
        boolean z = this.psaHintPressed;
        String str = Theme.key_chat_outPreviewInstantText;
        if (z) {
            color = getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outViews : Theme.key_chat_inViews);
        } else {
            color = getThemedColor(this.currentMessageObject.isOutOwner() ? str : Theme.key_chat_inPreviewInstantText);
        }
        Drawable[] drawableArr = this.selectorDrawable;
        if (drawableArr[num] == null) {
            final Paint maskPaint = new Paint(1);
            maskPaint.setColor(-1);
            Drawable maskDrawable = new Drawable() { // from class: org.telegram.ui.Cells.ChatMessageCell.5
                RectF rect = new RectF();
                Path path = new Path();

                @Override // android.graphics.drawable.Drawable
                public void draw(Canvas canvas) {
                    Rect bounds = getBounds();
                    this.rect.set(bounds.left, bounds.top, bounds.right, bounds.bottom);
                    if (ChatMessageCell.this.selectorDrawableMaskType[num] != 3 && ChatMessageCell.this.selectorDrawableMaskType[num] != 4) {
                        float f = 0.0f;
                        if (ChatMessageCell.this.selectorDrawableMaskType[num] == 2) {
                            this.path.reset();
                            boolean out = ChatMessageCell.this.currentMessageObject != null && ChatMessageCell.this.currentMessageObject.isOutOwner();
                            for (int a = 0; a < 4; a++) {
                                if (!ChatMessageCell.this.instantTextNewLine) {
                                    if (a == 2 && !out) {
                                        float dp = AndroidUtilities.dp(SharedConfig.bubbleRadius);
                                        ChatMessageCell.radii[(a * 2) + 1] = dp;
                                        ChatMessageCell.radii[a * 2] = dp;
                                    } else if (a != 3 || !out) {
                                        if ((ChatMessageCell.this.mediaBackground || ChatMessageCell.this.pinnedBottom) && (a == 2 || a == 3)) {
                                            float[] fArr = ChatMessageCell.radii;
                                            int i = a * 2;
                                            float[] fArr2 = ChatMessageCell.radii;
                                            int i2 = (a * 2) + 1;
                                            float dp2 = AndroidUtilities.dp(ChatMessageCell.this.pinnedBottom ? Math.min(5, SharedConfig.bubbleRadius) : SharedConfig.bubbleRadius);
                                            fArr2[i2] = dp2;
                                            fArr[i] = dp2;
                                        }
                                    } else {
                                        float dp3 = AndroidUtilities.dp(SharedConfig.bubbleRadius);
                                        ChatMessageCell.radii[(a * 2) + 1] = dp3;
                                        ChatMessageCell.radii[a * 2] = dp3;
                                    }
                                }
                                ChatMessageCell.radii[(a * 2) + 1] = 0.0f;
                                ChatMessageCell.radii[a * 2] = 0.0f;
                            }
                            this.path.addRoundRect(this.rect, ChatMessageCell.radii, Path.Direction.CW);
                            this.path.close();
                            canvas.drawPath(this.path, maskPaint);
                            return;
                        }
                        RectF rectF = this.rect;
                        float dp4 = ChatMessageCell.this.selectorDrawableMaskType[num] == 0 ? AndroidUtilities.dp(6.0f) : 0.0f;
                        if (ChatMessageCell.this.selectorDrawableMaskType[num] == 0) {
                            f = AndroidUtilities.dp(6.0f);
                        }
                        canvas.drawRoundRect(rectF, dp4, f, maskPaint);
                        return;
                    }
                    canvas.drawCircle(this.rect.centerX(), this.rect.centerY(), AndroidUtilities.dp(ChatMessageCell.this.selectorDrawableMaskType[num] == 3 ? 16.0f : 20.0f), maskPaint);
                }

                @Override // android.graphics.drawable.Drawable
                public void setAlpha(int alpha) {
                }

                @Override // android.graphics.drawable.Drawable
                public void setColorFilter(ColorFilter colorFilter) {
                }

                @Override // android.graphics.drawable.Drawable
                public int getOpacity() {
                    return -2;
                }
            };
            int[][] iArr = {StateSet.WILD_CARD};
            int[] iArr2 = new int[1];
            if (!this.currentMessageObject.isOutOwner()) {
                str = Theme.key_chat_inPreviewInstantText;
            }
            iArr2[0] = getThemedColor(str) & 436207615;
            ColorStateList colorStateList = new ColorStateList(iArr, iArr2);
            this.selectorDrawable[num] = new RippleDrawable(colorStateList, null, maskDrawable);
            this.selectorDrawable[num].setCallback(this);
        } else {
            Theme.setSelectorDrawableColor(drawableArr[num], color & 436207615, true);
        }
        this.selectorDrawable[num].setVisible(true, false);
    }

    private void createInstantViewButton() {
        String str;
        int buttonWidth;
        if (Build.VERSION.SDK_INT >= 21 && this.drawInstantView) {
            createSelectorDrawable(0);
        }
        if (this.drawInstantView && this.instantViewLayout == null) {
            this.instantWidth = AndroidUtilities.dp(33.0f);
            int i = this.drawInstantViewType;
            if (i == 12) {
                str = LocaleController.getString("OpenChannelPost", R.string.OpenChannelPost);
            } else if (i == 1) {
                str = LocaleController.getString("OpenChannel", R.string.OpenChannel);
            } else if (i == 13) {
                str = LocaleController.getString("SendMessage", R.string.SendMessage).toUpperCase();
            } else if (i == 10) {
                str = LocaleController.getString("OpenBot", R.string.OpenBot);
            } else if (i == 2) {
                str = LocaleController.getString("OpenGroup", R.string.OpenGroup);
            } else if (i == 3) {
                str = LocaleController.getString("OpenMessage", R.string.OpenMessage);
            } else if (i == 5) {
                str = LocaleController.getString("ViewContact", R.string.ViewContact);
            } else if (i == 6) {
                str = LocaleController.getString("OpenBackground", R.string.OpenBackground);
            } else if (i == 7) {
                str = LocaleController.getString("OpenTheme", R.string.OpenTheme);
            } else if (i == 8) {
                if (this.pollVoted || this.pollClosed) {
                    str = LocaleController.getString("PollViewResults", R.string.PollViewResults);
                } else {
                    str = LocaleController.getString("PollSubmitVotes", R.string.PollSubmitVotes);
                }
            } else if (i == 9 || i == 11) {
                TLRPC.TL_webPage webPage = (TLRPC.TL_webPage) this.currentMessageObject.messageOwner.media.webpage;
                if (webPage != null && webPage.url.contains("voicechat=")) {
                    str = LocaleController.getString("VoipGroupJoinAsSpeaker", R.string.VoipGroupJoinAsSpeaker);
                } else {
                    str = LocaleController.getString("VoipGroupJoinAsLinstener", R.string.VoipGroupJoinAsLinstener);
                }
            } else {
                str = LocaleController.getString("InstantView", R.string.InstantView);
            }
            if (this.currentMessageObject.isSponsored() && this.backgroundWidth < (buttonWidth = (int) (Theme.chat_instantViewPaint.measureText(str) + AndroidUtilities.dp(75.0f)))) {
                this.backgroundWidth = buttonWidth;
            }
            int mWidth = this.backgroundWidth - AndroidUtilities.dp(75.0f);
            this.instantViewLayout = new StaticLayout(TextUtils.ellipsize(str, Theme.chat_instantViewPaint, mWidth, TextUtils.TruncateAt.END), Theme.chat_instantViewPaint, mWidth + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
            if (this.drawInstantViewType == 8) {
                this.instantWidth = this.backgroundWidth - AndroidUtilities.dp(13.0f);
            } else {
                this.instantWidth = this.backgroundWidth - AndroidUtilities.dp(34.0f);
            }
            this.totalHeight += AndroidUtilities.dp(46.0f);
            if (this.currentMessageObject.type == 12) {
                this.totalHeight += AndroidUtilities.dp(14.0f);
            }
            if (this.currentMessageObject.isSponsored() && this.hasNewLineForTime) {
                this.totalHeight += AndroidUtilities.dp(16.0f);
            }
            StaticLayout staticLayout = this.instantViewLayout;
            if (staticLayout != null && staticLayout.getLineCount() > 0) {
                double d = this.instantWidth;
                double ceil = Math.ceil(this.instantViewLayout.getLineWidth(0));
                Double.isNaN(d);
                this.instantTextX = (((int) (d - ceil)) / 2) + (this.drawInstantViewType == 0 ? AndroidUtilities.dp(8.0f) : 0);
                int lineLeft = (int) this.instantViewLayout.getLineLeft(0);
                this.instantTextLeftX = lineLeft;
                this.instantTextX += -lineLeft;
            }
        }
    }

    @Override // android.view.View, android.view.ViewParent
    public void requestLayout() {
        if (this.inLayout) {
            return;
        }
        super.requestLayout();
    }

    @Override // android.view.View
    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null && (messageObject.checkLayout() || this.lastHeight != AndroidUtilities.displaySize.y)) {
            this.inLayout = true;
            MessageObject messageObject2 = this.currentMessageObject;
            this.currentMessageObject = null;
            setMessageObject(messageObject2, this.currentMessagesGroup, this.pinnedBottom, this.pinnedTop);
            this.inLayout = false;
        }
        updateSelectionTextPosition();
        setMeasuredDimension(View.MeasureSpec.getSize(widthMeasureSpec), this.totalHeight + this.keyboardHeight);
    }

    public void forceResetMessageObject() {
        MessageObject messageObject = this.messageObjectToSet;
        if (messageObject == null) {
            messageObject = this.currentMessageObject;
        }
        this.currentMessageObject = null;
        setMessageObject(messageObject, this.currentMessagesGroup, this.pinnedBottom, this.pinnedTop);
    }

    private int getGroupPhotosWidth() {
        int width = getParentWidth();
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null && messageObject.preview) {
            width = this.parentWidth;
        }
        if (!AndroidUtilities.isInMultiwindow && AndroidUtilities.isTablet() && (!AndroidUtilities.isSmallTablet() || getResources().getConfiguration().orientation == 2)) {
            int leftWidth = (width / 100) * 35;
            if (leftWidth < AndroidUtilities.dp(320.0f)) {
                leftWidth = AndroidUtilities.dp(320.0f);
            }
            return width - leftWidth;
        }
        return width;
    }

    private int getExtraTextX() {
        if (SharedConfig.bubbleRadius >= 15) {
            return AndroidUtilities.dp(2.0f);
        }
        if (SharedConfig.bubbleRadius >= 11) {
            return AndroidUtilities.dp(1.0f);
        }
        return 0;
    }

    private int getExtraTimeX() {
        if (!this.currentMessageObject.isOutOwner() && ((!this.mediaBackground || this.captionLayout != null) && SharedConfig.bubbleRadius > 11)) {
            return AndroidUtilities.dp((SharedConfig.bubbleRadius - 11) / 1.5f);
        }
        if (!this.currentMessageObject.isOutOwner() && this.isPlayingRound && this.isAvatarVisible && this.currentMessageObject.type == 5) {
            return (int) ((AndroidUtilities.roundPlayingMessageSize - AndroidUtilities.roundMessageSize) * 0.7f);
        }
        return 0;
    }

    @Override // android.view.ViewGroup, android.view.View
    protected void onLayout(boolean changed, int left, int top, int right, int bottom) {
        int x;
        int linkX;
        int x2;
        int i;
        if (this.currentMessageObject == null) {
            return;
        }
        int currentSize = getMeasuredHeight() + (getMeasuredWidth() << 16);
        int i2 = 10;
        if (this.lastSize != currentSize || !this.wasLayout) {
            this.layoutWidth = getMeasuredWidth();
            this.layoutHeight = getMeasuredHeight() - this.substractBackgroundHeight;
            if (this.timeTextWidth < 0) {
                this.timeTextWidth = AndroidUtilities.dp(10.0f);
            }
            this.timeLayout = new StaticLayout(this.currentTimeString, Theme.chat_timePaint, AndroidUtilities.dp(100.0f) + this.timeTextWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
            if (this.mediaBackground) {
                if (this.currentMessageObject.isOutOwner()) {
                    this.timeX = (this.layoutWidth - this.timeWidth) - AndroidUtilities.dp(42.0f);
                } else {
                    this.timeX = (this.backgroundWidth - AndroidUtilities.dp(4.0f)) - this.timeWidth;
                    if (this.currentMessageObject.isAnyKindOfSticker()) {
                        this.timeX = Math.max(AndroidUtilities.dp(26.0f), this.timeX);
                    }
                    if (this.isAvatarVisible) {
                        this.timeX += AndroidUtilities.dp(48.0f);
                    }
                    MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
                    if (groupedMessagePosition != null && groupedMessagePosition.leftSpanOffset != 0) {
                        this.timeX += (int) Math.ceil((this.currentPosition.leftSpanOffset / 1000.0f) * getGroupPhotosWidth());
                    }
                    if (this.captionLayout != null && this.currentPosition != null) {
                        this.timeX += AndroidUtilities.dp(4.0f);
                    }
                }
                if (SharedConfig.bubbleRadius >= 10 && this.captionLayout == null && (i = this.documentAttachType) != 7 && i != 6) {
                    this.timeX -= AndroidUtilities.dp(2.0f);
                }
            } else if (this.currentMessageObject.isOutOwner()) {
                this.timeX = (this.layoutWidth - this.timeWidth) - AndroidUtilities.dp(38.5f);
            } else {
                this.timeX = (this.backgroundWidth - AndroidUtilities.dp(9.0f)) - this.timeWidth;
                if (this.currentMessageObject.isAnyKindOfSticker()) {
                    this.timeX = Math.max(0, this.timeX);
                }
                if (this.isAvatarVisible) {
                    this.timeX += AndroidUtilities.dp(48.0f);
                }
                if (shouldDrawTimeOnMedia()) {
                    this.timeX -= AndroidUtilities.dp(7.0f);
                }
            }
            this.timeX -= getExtraTimeX();
            if ((this.currentMessageObject.messageOwner.flags & 1024) != 0) {
                this.viewsLayout = new StaticLayout(this.currentViewsString, Theme.chat_timePaint, this.viewsTextWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
            } else {
                this.viewsLayout = null;
            }
            if (this.currentRepliesString != null && !this.currentMessageObject.scheduled) {
                this.repliesLayout = new StaticLayout(this.currentRepliesString, Theme.chat_timePaint, this.repliesTextWidth, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
            } else {
                this.repliesLayout = null;
            }
            if (this.isAvatarVisible) {
                this.avatarImage.setImageCoords(AndroidUtilities.dp(6.0f), this.avatarImage.getImageY(), AndroidUtilities.dp(42.0f), AndroidUtilities.dp(42.0f));
            }
            this.wasLayout = true;
        }
        this.lastSize = currentSize;
        if (this.currentMessageObject.type == 0) {
            this.textY = AndroidUtilities.dp(10.0f) + this.namesOffset;
        }
        if (this.isRoundVideo) {
            updatePlayingMessageProgress();
        }
        int i3 = this.documentAttachType;
        if (i3 == 3) {
            if (this.currentMessageObject.isOutOwner()) {
                this.seekBarX = (this.layoutWidth - this.backgroundWidth) + AndroidUtilities.dp(57.0f);
                this.buttonX = (this.layoutWidth - this.backgroundWidth) + AndroidUtilities.dp(14.0f);
                this.timeAudioX = (this.layoutWidth - this.backgroundWidth) + AndroidUtilities.dp(67.0f);
            } else if (!this.isChat || this.isThreadPost || !this.currentMessageObject.needDrawAvatar()) {
                this.seekBarX = AndroidUtilities.dp(66.0f);
                this.buttonX = AndroidUtilities.dp(23.0f);
                this.timeAudioX = AndroidUtilities.dp(76.0f);
            } else {
                this.seekBarX = AndroidUtilities.dp(114.0f);
                this.buttonX = AndroidUtilities.dp(71.0f);
                this.timeAudioX = AndroidUtilities.dp(124.0f);
            }
            if (this.hasLinkPreview) {
                this.seekBarX += AndroidUtilities.dp(10.0f);
                this.buttonX += AndroidUtilities.dp(10.0f);
                this.timeAudioX += AndroidUtilities.dp(10.0f);
            }
            updateSeekBarWaveformWidth();
            SeekBar seekBar = this.seekBar;
            int i4 = this.backgroundWidth;
            if (!this.hasLinkPreview) {
                i2 = 0;
            }
            seekBar.setSize(i4 - AndroidUtilities.dp(i2 + 72), AndroidUtilities.dp(30.0f));
            this.seekBarY = AndroidUtilities.dp(13.0f) + this.namesOffset + this.mediaOffsetY;
            int dp = AndroidUtilities.dp(13.0f) + this.namesOffset + this.mediaOffsetY;
            this.buttonY = dp;
            RadialProgress2 radialProgress2 = this.radialProgress;
            int i5 = this.buttonX;
            radialProgress2.setProgressRect(i5, dp, AndroidUtilities.dp(44.0f) + i5, this.buttonY + AndroidUtilities.dp(44.0f));
            updatePlayingMessageProgress();
        } else if (i3 == 5) {
            if (this.currentMessageObject.isOutOwner()) {
                this.seekBarX = (this.layoutWidth - this.backgroundWidth) + AndroidUtilities.dp(56.0f);
                this.buttonX = (this.layoutWidth - this.backgroundWidth) + AndroidUtilities.dp(14.0f);
                this.timeAudioX = (this.layoutWidth - this.backgroundWidth) + AndroidUtilities.dp(67.0f);
            } else if (!this.isChat || this.isThreadPost || !this.currentMessageObject.needDrawAvatar()) {
                this.seekBarX = AndroidUtilities.dp(65.0f);
                this.buttonX = AndroidUtilities.dp(23.0f);
                this.timeAudioX = AndroidUtilities.dp(76.0f);
            } else {
                this.seekBarX = AndroidUtilities.dp(113.0f);
                this.buttonX = AndroidUtilities.dp(71.0f);
                this.timeAudioX = AndroidUtilities.dp(124.0f);
            }
            if (this.hasLinkPreview) {
                this.seekBarX += AndroidUtilities.dp(10.0f);
                this.buttonX += AndroidUtilities.dp(10.0f);
                this.timeAudioX += AndroidUtilities.dp(10.0f);
            }
            SeekBar seekBar2 = this.seekBar;
            int i6 = this.backgroundWidth;
            if (!this.hasLinkPreview) {
                i2 = 0;
            }
            seekBar2.setSize(i6 - AndroidUtilities.dp(i2 + 65), AndroidUtilities.dp(30.0f));
            this.seekBarY = AndroidUtilities.dp(29.0f) + this.namesOffset + this.mediaOffsetY;
            int dp2 = AndroidUtilities.dp(13.0f) + this.namesOffset + this.mediaOffsetY;
            this.buttonY = dp2;
            RadialProgress2 radialProgress22 = this.radialProgress;
            int i7 = this.buttonX;
            radialProgress22.setProgressRect(i7, dp2, AndroidUtilities.dp(44.0f) + i7, this.buttonY + AndroidUtilities.dp(44.0f));
            updatePlayingMessageProgress();
        } else if (i3 == 1 && !this.drawPhotoImage) {
            if (this.currentMessageObject.isOutOwner()) {
                this.buttonX = (this.layoutWidth - this.backgroundWidth) + AndroidUtilities.dp(14.0f);
            } else if (!this.isChat || this.isThreadPost || !this.currentMessageObject.needDrawAvatar()) {
                this.buttonX = AndroidUtilities.dp(23.0f);
            } else {
                this.buttonX = AndroidUtilities.dp(71.0f);
            }
            if (this.hasLinkPreview) {
                this.buttonX += AndroidUtilities.dp(10.0f);
            }
            int dp3 = AndroidUtilities.dp(13.0f) + this.namesOffset + this.mediaOffsetY;
            this.buttonY = dp3;
            RadialProgress2 radialProgress23 = this.radialProgress;
            int i8 = this.buttonX;
            radialProgress23.setProgressRect(i8, dp3, AndroidUtilities.dp(44.0f) + i8, this.buttonY + AndroidUtilities.dp(44.0f));
            this.photoImage.setImageCoords(this.buttonX - AndroidUtilities.dp(10.0f), this.buttonY - AndroidUtilities.dp(10.0f), this.photoImage.getImageWidth(), this.photoImage.getImageHeight());
        } else if (this.currentMessageObject.type == 12) {
            if (this.currentMessageObject.isOutOwner()) {
                x2 = (this.layoutWidth - this.backgroundWidth) + AndroidUtilities.dp(14.0f);
            } else if (this.isChat && !this.isThreadPost && this.currentMessageObject.needDrawAvatar()) {
                x2 = AndroidUtilities.dp(72.0f);
            } else {
                x2 = AndroidUtilities.dp(23.0f);
            }
            this.photoImage.setImageCoords(x2, AndroidUtilities.dp(13.0f) + this.namesOffset, AndroidUtilities.dp(44.0f), AndroidUtilities.dp(44.0f));
        } else {
            if (this.currentMessageObject.type == 0 && (this.hasLinkPreview || this.hasGamePreview || this.hasInvoicePreview)) {
                if (this.hasGamePreview) {
                    linkX = this.unmovedTextX - AndroidUtilities.dp(10.0f);
                } else if (this.hasInvoicePreview) {
                    linkX = this.unmovedTextX + AndroidUtilities.dp(1.0f);
                } else {
                    linkX = this.unmovedTextX + AndroidUtilities.dp(1.0f);
                }
                if (this.isSmallImage) {
                    x = (this.backgroundWidth + linkX) - AndroidUtilities.dp(81.0f);
                } else {
                    x = (this.hasInvoicePreview ? -AndroidUtilities.dp(6.3f) : AndroidUtilities.dp(10.0f)) + linkX;
                }
            } else if (this.currentMessageObject.isOutOwner()) {
                x = this.mediaBackground ? (this.layoutWidth - this.backgroundWidth) - AndroidUtilities.dp(3.0f) : AndroidUtilities.dp(6.0f) + (this.layoutWidth - this.backgroundWidth);
            } else {
                if (this.isChat && this.isAvatarVisible && !this.isPlayingRound) {
                    x = AndroidUtilities.dp(63.0f);
                } else {
                    x = AndroidUtilities.dp(15.0f);
                }
                MessageObject.GroupedMessagePosition groupedMessagePosition2 = this.currentPosition;
                if (groupedMessagePosition2 != null && !groupedMessagePosition2.edge) {
                    x -= AndroidUtilities.dp(10.0f);
                }
            }
            MessageObject.GroupedMessagePosition groupedMessagePosition3 = this.currentPosition;
            if (groupedMessagePosition3 != null) {
                if ((groupedMessagePosition3.flags & 1) == 0) {
                    x -= AndroidUtilities.dp(2.0f);
                }
                if (this.currentPosition.leftSpanOffset != 0) {
                    x += (int) Math.ceil((this.currentPosition.leftSpanOffset / 1000.0f) * getGroupPhotosWidth());
                }
            }
            if (this.currentMessageObject.type != 0) {
                x -= AndroidUtilities.dp(2.0f);
            }
            if (!this.transitionParams.imageChangeBoundsTransition || this.transitionParams.updatePhotoImageX) {
                this.transitionParams.updatePhotoImageX = false;
                ImageReceiver imageReceiver = this.photoImage;
                imageReceiver.setImageCoords(x, imageReceiver.getImageY(), this.photoImage.getImageWidth(), this.photoImage.getImageHeight());
            }
            this.buttonX = (int) (x + ((this.photoImage.getImageWidth() - AndroidUtilities.dp(48.0f)) / 2.0f));
            int imageY = (int) (this.photoImage.getImageY() + ((this.photoImage.getImageHeight() - AndroidUtilities.dp(48.0f)) / 2.0f));
            this.buttonY = imageY;
            RadialProgress2 radialProgress24 = this.radialProgress;
            int i9 = this.buttonX;
            radialProgress24.setProgressRect(i9, imageY, AndroidUtilities.dp(48.0f) + i9, this.buttonY + AndroidUtilities.dp(48.0f));
            this.deleteProgressRect.set(this.buttonX + AndroidUtilities.dp(5.0f), this.buttonY + AndroidUtilities.dp(5.0f), this.buttonX + AndroidUtilities.dp(43.0f), this.buttonY + AndroidUtilities.dp(43.0f));
            int i10 = this.documentAttachType;
            if (i10 == 4 || i10 == 2) {
                this.videoButtonX = (int) (this.photoImage.getImageX() + AndroidUtilities.dp(8.0f));
                int imageY2 = (int) (this.photoImage.getImageY() + AndroidUtilities.dp(8.0f));
                this.videoButtonY = imageY2;
                RadialProgress2 radialProgress25 = this.videoRadialProgress;
                int i11 = this.videoButtonX;
                radialProgress25.setProgressRect(i11, imageY2, AndroidUtilities.dp(24.0f) + i11, this.videoButtonY + AndroidUtilities.dp(24.0f));
            }
        }
    }

    public boolean needDelayRoundProgressDraw() {
        int i = this.documentAttachType;
        return (i == 7 || i == 4) && this.currentMessageObject.type != 5 && MediaController.getInstance().isPlayingMessage(this.currentMessageObject);
    }

    /* JADX WARN: Removed duplicated region for block: B:33:0x006b  */
    /* JADX WARN: Removed duplicated region for block: B:40:0x0081  */
    /* JADX WARN: Removed duplicated region for block: B:47:0x0096  */
    /* JADX WARN: Removed duplicated region for block: B:48:0x009f  */
    /* JADX WARN: Removed duplicated region for block: B:51:0x00a8  */
    /* JADX WARN: Removed duplicated region for block: B:58:0x00d1  */
    /* JADX WARN: Removed duplicated region for block: B:61:0x0130  */
    /* JADX WARN: Removed duplicated region for block: B:62:0x0143  */
    /* JADX WARN: Removed duplicated region for block: B:65:0x0148  */
    /* JADX WARN: Removed duplicated region for block: B:70:0x0194  */
    /* JADX WARN: Removed duplicated region for block: B:71:0x0199  */
    /* JADX WARN: Removed duplicated region for block: B:74:0x01a1  */
    /* JADX WARN: Removed duplicated region for block: B:75:0x0262  */
    /* JADX WARN: Removed duplicated region for block: B:78:0x026b  */
    /* JADX WARN: Removed duplicated region for block: B:84:0x0283  */
    /* JADX WARN: Removed duplicated region for block: B:89:0x02cd  */
    /* JADX WARN: Removed duplicated region for block: B:92:0x02e1  */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    public void drawRoundProgress(Canvas canvas) {
        float pauseProgress;
        float inset;
        int oldAplha;
        VideoForwardDrawable videoForwardDrawable;
        float paintWidth;
        float f;
        int oldAplha2;
        int oldAplha3;
        float inset2 = this.isPlayingRound ? AndroidUtilities.dp(4.0f) : 0.0f;
        boolean z = false;
        boolean drawPause = MediaController.getInstance().isPlayingMessage(this.currentMessageObject) && MediaController.getInstance().isMessagePaused();
        if (drawPause && this.roundSeekbarTouched == 1) {
            z = true;
        }
        boolean drawTouchedSeekbar = z;
        if (drawPause) {
            float f2 = this.roundToPauseProgress;
            if (f2 != 1.0f) {
                float f3 = f2 + 0.07272727f;
                this.roundToPauseProgress = f3;
                if (f3 > 1.0f) {
                    this.roundToPauseProgress = 1.0f;
                } else {
                    invalidate();
                }
                if (drawTouchedSeekbar) {
                    float f4 = this.roundToPauseProgress2;
                    if (f4 != 1.0f) {
                        float f5 = f4 + 0.10666667f;
                        this.roundToPauseProgress2 = f5;
                        if (f5 > 1.0f) {
                            this.roundToPauseProgress2 = 1.0f;
                        } else {
                            invalidate();
                        }
                        pauseProgress = drawPause ? AndroidUtilities.overshootInterpolator.getInterpolation(this.roundToPauseProgress) : this.roundToPauseProgress;
                        if (this.transitionParams.animatePlayingRound) {
                            inset2 = (this.isPlayingRound ? this.transitionParams.animateChangeProgress : 1.0f - this.transitionParams.animateChangeProgress) * AndroidUtilities.dp(4.0f);
                        }
                        float inset3 = inset2 + (AndroidUtilities.dp(16.0f) * pauseProgress);
                        inset = this.roundToPauseProgress;
                        if (inset > 0.0f) {
                            float r = this.photoImage.getImageWidth() / 2.0f;
                            Theme.getRadialSeekbarShadowDrawable().draw(canvas, this.photoImage.getCenterX(), this.photoImage.getCenterY(), r, this.roundToPauseProgress);
                        }
                        this.rect.set(this.photoImage.getImageX() + AndroidUtilities.dpf2(1.5f) + inset3, this.photoImage.getImageY() + AndroidUtilities.dpf2(1.5f) + inset3, (this.photoImage.getImageX2() - AndroidUtilities.dpf2(1.5f)) - inset3, (this.photoImage.getImageY2() - AndroidUtilities.dpf2(1.5f)) - inset3);
                        if (this.roundProgressAlpha == 1.0f) {
                            oldAplha = -1;
                        } else {
                            int oldAplha4 = Theme.chat_radialProgressPaint.getAlpha();
                            Theme.chat_radialProgressPaint.setAlpha((int) (this.roundProgressAlpha * oldAplha4));
                            oldAplha = oldAplha4;
                        }
                        videoForwardDrawable = this.videoForwardDrawable;
                        if (videoForwardDrawable != null && videoForwardDrawable.isAnimating()) {
                            this.videoForwardDrawable.setBounds((int) this.photoImage.getImageX(), (int) this.photoImage.getImageY(), (int) (this.photoImage.getImageX() + this.photoImage.getImageWidth()), (int) (this.photoImage.getImageY() + this.photoImage.getImageHeight()));
                            this.videoForwardDrawable.draw(canvas);
                        }
                        int paintAlpha = Theme.chat_radialProgressPaint.getAlpha();
                        float paintWidth2 = Theme.chat_radialProgressPaint.getStrokeWidth();
                        float audioProgress = this.roundProgressAlpha == 1.0f ? this.currentMessageObject.audioProgress : this.lastDrawingAudioProgress;
                        if (pauseProgress <= 0.0f) {
                            paintWidth = paintWidth2;
                        } else {
                            float radius = this.rect.width() / 2.0f;
                            Theme.chat_radialProgressPaint.setStrokeWidth((0.5f * paintWidth2 * this.roundToPauseProgress) + paintWidth2);
                            Theme.chat_radialProgressPaint.setAlpha((int) (paintAlpha * this.roundToPauseProgress * 0.3f));
                            canvas.drawCircle(this.rect.centerX(), this.rect.centerY(), radius, Theme.chat_radialProgressPaint);
                            Theme.chat_radialProgressPaint.setAlpha(paintAlpha);
                            double centerX = this.rect.centerX();
                            double sin = Math.sin(Math.toRadians((audioProgress * (-360.0f)) + 180.0f));
                            paintWidth = paintWidth2;
                            double d = radius;
                            Double.isNaN(d);
                            Double.isNaN(centerX);
                            this.seekbarRoundX = (float) (centerX + (sin * d));
                            double centerY = this.rect.centerY();
                            double cos = Math.cos(Math.toRadians(((-360.0f) * audioProgress) + 180.0f));
                            double d2 = radius;
                            Double.isNaN(d2);
                            Double.isNaN(centerY);
                            this.seekbarRoundY = (float) (centerY + (cos * d2));
                            Theme.chat_radialProgressPausedSeekbarPaint.setColor(-1);
                            Theme.chat_radialProgressPausedSeekbarPaint.setAlpha((int) (Math.min(1.0f, pauseProgress) * 255.0f));
                            canvas.drawCircle(this.seekbarRoundX, this.seekbarRoundY, AndroidUtilities.dp(3.0f) + (AndroidUtilities.dp(5.0f) * pauseProgress) + (AndroidUtilities.dp(3.0f) * this.roundToPauseProgress2), Theme.chat_radialProgressPausedSeekbarPaint);
                        }
                        f = this.roundSeekbarOutAlpha;
                        if (f != 0.0f) {
                            float f6 = f - 0.10666667f;
                            this.roundSeekbarOutAlpha = f6;
                            if (f6 < 0.0f) {
                                this.roundSeekbarOutAlpha = 0.0f;
                            } else {
                                invalidate();
                            }
                        }
                        if (this.roundSeekbarOutAlpha != 0.0f) {
                            if (oldAplha != -1) {
                                oldAplha3 = oldAplha;
                            } else {
                                oldAplha3 = Theme.chat_radialProgressPaint.getAlpha();
                            }
                            Theme.chat_radialProgressPaint.setAlpha((int) (paintAlpha * (1.0f - this.roundSeekbarOutAlpha)));
                            canvas.drawArc(this.rect, -90.0f, audioProgress * 360.0f, false, Theme.chat_radialProgressPaint);
                            Theme.chat_radialProgressPaint.setAlpha((int) (paintAlpha * this.roundSeekbarOutAlpha));
                            canvas.drawArc(this.rect, -90.0f, this.roundSeekbarOutProgress * 360.0f, false, Theme.chat_radialProgressPaint);
                            oldAplha2 = oldAplha3;
                        } else {
                            canvas.drawArc(this.rect, -90.0f, audioProgress * 360.0f, false, Theme.chat_radialProgressPaint);
                            oldAplha2 = oldAplha;
                        }
                        if (oldAplha2 != -1) {
                            Theme.chat_radialProgressPaint.setAlpha(oldAplha2);
                        }
                        Theme.chat_radialProgressPaint.setStrokeWidth(paintWidth);
                    }
                }
                if (!drawTouchedSeekbar) {
                    float f7 = this.roundToPauseProgress2;
                    if (f7 != 0.0f) {
                        float f8 = f7 - 0.10666667f;
                        this.roundToPauseProgress2 = f8;
                        if (f8 < 0.0f) {
                            this.roundToPauseProgress2 = 0.0f;
                        } else {
                            invalidate();
                        }
                    }
                }
                pauseProgress = drawPause ? AndroidUtilities.overshootInterpolator.getInterpolation(this.roundToPauseProgress) : this.roundToPauseProgress;
                if (this.transitionParams.animatePlayingRound) {
                }
                float inset32 = inset2 + (AndroidUtilities.dp(16.0f) * pauseProgress);
                inset = this.roundToPauseProgress;
                if (inset > 0.0f) {
                }
                this.rect.set(this.photoImage.getImageX() + AndroidUtilities.dpf2(1.5f) + inset32, this.photoImage.getImageY() + AndroidUtilities.dpf2(1.5f) + inset32, (this.photoImage.getImageX2() - AndroidUtilities.dpf2(1.5f)) - inset32, (this.photoImage.getImageY2() - AndroidUtilities.dpf2(1.5f)) - inset32);
                if (this.roundProgressAlpha == 1.0f) {
                }
                videoForwardDrawable = this.videoForwardDrawable;
                if (videoForwardDrawable != null) {
                    this.videoForwardDrawable.setBounds((int) this.photoImage.getImageX(), (int) this.photoImage.getImageY(), (int) (this.photoImage.getImageX() + this.photoImage.getImageWidth()), (int) (this.photoImage.getImageY() + this.photoImage.getImageHeight()));
                    this.videoForwardDrawable.draw(canvas);
                }
                int paintAlpha2 = Theme.chat_radialProgressPaint.getAlpha();
                float paintWidth22 = Theme.chat_radialProgressPaint.getStrokeWidth();
                float audioProgress2 = this.roundProgressAlpha == 1.0f ? this.currentMessageObject.audioProgress : this.lastDrawingAudioProgress;
                if (pauseProgress <= 0.0f) {
                }
                f = this.roundSeekbarOutAlpha;
                if (f != 0.0f) {
                }
                if (this.roundSeekbarOutAlpha != 0.0f) {
                }
                if (oldAplha2 != -1) {
                }
                Theme.chat_radialProgressPaint.setStrokeWidth(paintWidth);
            }
        }
        if (!drawPause) {
            float f9 = this.roundToPauseProgress;
            if (f9 != 0.0f) {
                float f10 = f9 - 0.10666667f;
                this.roundToPauseProgress = f10;
                if (f10 < 0.0f) {
                    this.roundToPauseProgress = 0.0f;
                } else {
                    invalidate();
                }
            }
        }
        if (drawTouchedSeekbar) {
        }
        if (!drawTouchedSeekbar) {
        }
        pauseProgress = drawPause ? AndroidUtilities.overshootInterpolator.getInterpolation(this.roundToPauseProgress) : this.roundToPauseProgress;
        if (this.transitionParams.animatePlayingRound) {
        }
        float inset322 = inset2 + (AndroidUtilities.dp(16.0f) * pauseProgress);
        inset = this.roundToPauseProgress;
        if (inset > 0.0f) {
        }
        this.rect.set(this.photoImage.getImageX() + AndroidUtilities.dpf2(1.5f) + inset322, this.photoImage.getImageY() + AndroidUtilities.dpf2(1.5f) + inset322, (this.photoImage.getImageX2() - AndroidUtilities.dpf2(1.5f)) - inset322, (this.photoImage.getImageY2() - AndroidUtilities.dpf2(1.5f)) - inset322);
        if (this.roundProgressAlpha == 1.0f) {
        }
        videoForwardDrawable = this.videoForwardDrawable;
        if (videoForwardDrawable != null) {
        }
        int paintAlpha22 = Theme.chat_radialProgressPaint.getAlpha();
        float paintWidth222 = Theme.chat_radialProgressPaint.getStrokeWidth();
        float audioProgress22 = this.roundProgressAlpha == 1.0f ? this.currentMessageObject.audioProgress : this.lastDrawingAudioProgress;
        if (pauseProgress <= 0.0f) {
        }
        f = this.roundSeekbarOutAlpha;
        if (f != 0.0f) {
        }
        if (this.roundSeekbarOutAlpha != 0.0f) {
        }
        if (oldAplha2 != -1) {
        }
        Theme.chat_radialProgressPaint.setStrokeWidth(paintWidth);
    }

    /* JADX WARN: Removed duplicated region for block: B:42:0x00b8  */
    /* JADX WARN: Removed duplicated region for block: B:62:? A[RETURN, SYNTHETIC] */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    private void updatePollAnimations(long dt) {
        if (this.pollVoteInProgress) {
            float f = this.voteRadOffset + (((float) (360 * dt)) / 2000.0f);
            this.voteRadOffset = f;
            int count = (int) (f / 360.0f);
            this.voteRadOffset = f - (count * 360);
            float f2 = this.voteCurrentProgressTime + ((float) dt);
            this.voteCurrentProgressTime = f2;
            if (f2 >= 500.0f) {
                this.voteCurrentProgressTime = 500.0f;
            }
            if (!this.voteRisingCircleLength) {
                this.voteCurrentCircleLength = 4.0f - ((this.firstCircleLength ? 360 : 270) * (1.0f - AndroidUtilities.decelerateInterpolator.getInterpolation(this.voteCurrentProgressTime / 500.0f)));
            } else {
                this.voteCurrentCircleLength = (AndroidUtilities.accelerateInterpolator.getInterpolation(this.voteCurrentProgressTime / 500.0f) * 266.0f) + 4.0f;
            }
            if (this.voteCurrentProgressTime == 500.0f) {
                boolean z = this.voteRisingCircleLength;
                if (z) {
                    this.voteRadOffset += 270.0f;
                    this.voteCurrentCircleLength = -266.0f;
                }
                this.voteRisingCircleLength = !z;
                if (this.firstCircleLength) {
                    this.firstCircleLength = false;
                }
                this.voteCurrentProgressTime = 0.0f;
            }
            invalidate();
        }
        boolean z2 = this.hintButtonVisible;
        if (z2) {
            float f3 = this.hintButtonProgress;
            if (f3 < 1.0f) {
                float f4 = f3 + (((float) dt) / 180.0f);
                this.hintButtonProgress = f4;
                if (f4 > 1.0f) {
                    this.hintButtonProgress = 1.0f;
                }
                invalidate();
                if (!this.animatePollAnswer) {
                    float f5 = this.pollAnimationProgressTime + ((float) dt);
                    this.pollAnimationProgressTime = f5;
                    if (f5 >= 300.0f) {
                        this.pollAnimationProgressTime = 300.0f;
                    }
                    float interpolation = AndroidUtilities.decelerateInterpolator.getInterpolation(this.pollAnimationProgressTime / 300.0f);
                    this.pollAnimationProgress = interpolation;
                    if (interpolation >= 1.0f) {
                        this.pollAnimationProgress = 1.0f;
                        this.animatePollAnswer = false;
                        this.animatePollAnswerAlpha = false;
                        this.pollVoteInProgress = false;
                        if (this.pollUnvoteInProgress && this.animatePollAvatars) {
                            int a = 0;
                            while (true) {
                                ImageReceiver[] imageReceiverArr = this.pollAvatarImages;
                                if (a >= imageReceiverArr.length) {
                                    break;
                                }
                                imageReceiverArr[a].setImageBitmap((Drawable) null);
                                this.pollAvatarImagesVisible[a] = false;
                                a++;
                            }
                        }
                        this.pollUnvoteInProgress = false;
                        int N = this.pollButtons.size();
                        for (int a2 = 0; a2 < N; a2++) {
                            PollButton button = this.pollButtons.get(a2);
                            button.prevChosen = false;
                        }
                    }
                    invalidate();
                    return;
                }
                return;
            }
        }
        if (!z2) {
            float f6 = this.hintButtonProgress;
            if (f6 > 0.0f) {
                float f7 = f6 - (((float) dt) / 180.0f);
                this.hintButtonProgress = f7;
                if (f7 < 0.0f) {
                    this.hintButtonProgress = 0.0f;
                }
                invalidate();
            }
        }
        if (!this.animatePollAnswer) {
        }
    }

    /* JADX WARN: Removed duplicated region for block: B:368:0x0874  */
    /* JADX WARN: Removed duplicated region for block: B:375:0x08c2  */
    /* JADX WARN: Removed duplicated region for block: B:383:0x0940  */
    /* JADX WARN: Removed duplicated region for block: B:386:0x0966  */
    /* JADX WARN: Removed duplicated region for block: B:517:0x0c3f  */
    /* JADX WARN: Removed duplicated region for block: B:560:0x0d74  */
    /* JADX WARN: Removed duplicated region for block: B:563:0x0d79  */
    /* JADX WARN: Removed duplicated region for block: B:699:0x1126  */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    private void drawContent(Canvas canvas) {
        float buttonY;
        float buttonX;
        String str;
        int x;
        int i;
        Drawable menuDrawable;
        float x2;
        int titleY;
        int subtitleY;
        StaticLayout staticLayout;
        StaticLayout staticLayout2;
        int linkX;
        int x3;
        MessageObject.GroupedMessages groupedMessages;
        AudioVisualizerDrawable audioVisualizerDrawable;
        float f;
        Drawable menuDrawable2;
        float y;
        float x4;
        int i2;
        boolean playing;
        ViewGroup viewGroup;
        MessageObject messageObject;
        boolean newPart = this.needNewVisiblePart && this.currentMessageObject.type == 0;
        boolean hasSpoilers = hasSpoilers();
        if (newPart || hasSpoilers) {
            getLocalVisibleRect(this.scrollRect);
            if (hasSpoilers) {
                updateSpoilersVisiblePart(this.scrollRect.top, this.scrollRect.bottom);
            }
            if (newPart) {
                setVisiblePart(this.scrollRect.top, this.scrollRect.bottom - this.scrollRect.top, this.parentHeight, this.parentViewTopOffset, this.viewTop, this.parentWidth, this.backgroundHeight, this.blurredViewTopOffset, this.blurredViewBottomOffset);
                this.needNewVisiblePart = false;
            }
        }
        float buttonX2 = this.buttonX;
        float buttonY2 = this.buttonY;
        if (this.transitionParams.animateButton) {
            float buttonX3 = (this.transitionParams.animateFromButtonX * (1.0f - this.transitionParams.animateChangeProgress)) + (this.buttonX * this.transitionParams.animateChangeProgress);
            float buttonY3 = (this.transitionParams.animateFromButtonY * (1.0f - this.transitionParams.animateChangeProgress)) + (this.buttonY * this.transitionParams.animateChangeProgress);
            this.radialProgress.setProgressRect((int) buttonX3, (int) buttonY3, ((int) buttonX3) + AndroidUtilities.dp(44.0f), ((int) buttonY3) + AndroidUtilities.dp(44.0f));
            buttonX = buttonX3;
            buttonY = buttonY3;
        } else {
            buttonX = buttonX2;
            buttonY = buttonY2;
        }
        updateSeekBarWaveformWidth();
        this.forceNotDrawTime = this.currentMessagesGroup != null;
        this.photoImage.setPressed(((this.isHighlightedAnimated || this.isHighlighted) && this.currentPosition != null) ? 2 : 0);
        this.photoImage.setVisible(!PhotoViewer.isShowingImage(this.currentMessageObject) && !SecretMediaViewer.getInstance().isShowingImage(this.currentMessageObject), false);
        if (!this.photoImage.getVisible()) {
            this.mediaWasInvisible = true;
            this.timeWasInvisible = true;
            int i3 = this.animatingNoSound;
            if (i3 == 1) {
                this.animatingNoSoundProgress = 0.0f;
                this.animatingNoSound = 0;
            } else if (i3 == 2) {
                this.animatingNoSoundProgress = 1.0f;
                this.animatingNoSound = 0;
            }
        } else if (this.groupPhotoInvisible) {
            this.timeWasInvisible = true;
        } else {
            boolean z = this.mediaWasInvisible;
            if (z || this.timeWasInvisible) {
                if (z) {
                    this.controlsAlpha = 0.0f;
                    this.mediaWasInvisible = false;
                }
                if (this.timeWasInvisible) {
                    this.timeAlpha = 0.0f;
                    this.timeWasInvisible = false;
                }
                this.lastControlsAlphaChangeTime = System.currentTimeMillis();
                this.totalChangeTime = 0L;
            }
        }
        this.radialProgress.setProgressColor(getThemedColor(Theme.key_chat_mediaProgress));
        this.videoRadialProgress.setProgressColor(getThemedColor(Theme.key_chat_mediaProgress));
        this.imageDrawn = false;
        this.radialProgress.setCircleCrossfadeColor(null, 0.0f, 1.0f);
        float f2 = 11.0f;
        if (this.currentMessageObject.type == 0) {
            if (this.currentMessageObject.isOutOwner()) {
                this.textX = getCurrentBackgroundLeft() + AndroidUtilities.dp(11.0f) + getExtraTextX();
            } else {
                this.textX = getCurrentBackgroundLeft() + AndroidUtilities.dp((this.mediaBackground || !this.drawPinnedBottom) ? 17.0f : 11.0f) + getExtraTextX();
            }
            if (this.hasGamePreview) {
                this.textX += AndroidUtilities.dp(11.0f);
                int dp = AndroidUtilities.dp(14.0f) + this.namesOffset;
                this.textY = dp;
                StaticLayout staticLayout3 = this.siteNameLayout;
                if (staticLayout3 != null) {
                    this.textY = dp + staticLayout3.getLineBottom(staticLayout3.getLineCount() - 1);
                }
            } else if (this.hasInvoicePreview) {
                int dp2 = AndroidUtilities.dp(14.0f) + this.namesOffset;
                this.textY = dp2;
                StaticLayout staticLayout4 = this.siteNameLayout;
                if (staticLayout4 != null) {
                    this.textY = dp2 + staticLayout4.getLineBottom(staticLayout4.getLineCount() - 1);
                }
            } else {
                this.textY = AndroidUtilities.dp(10.0f) + this.namesOffset;
            }
            this.unmovedTextX = this.textX;
            if (this.currentMessageObject.textXOffset != 0.0f && this.replyNameLayout != null) {
                int diff = (this.backgroundWidth - AndroidUtilities.dp(31.0f)) - this.currentMessageObject.textWidth;
                if (!this.hasNewLineForTime) {
                    diff -= this.timeWidth + AndroidUtilities.dp((this.currentMessageObject.isOutOwner() ? 20 : 0) + 4);
                }
                if (diff > 0) {
                    this.textX += diff - getExtraTimeX();
                }
            }
            if (this.enterTransitionInProgress || (messageObject = this.currentMessageObject) == null || messageObject.preview) {
                str = Theme.key_chat_mediaProgress;
            } else if (this.transitionParams.animateChangeProgress == 1.0f || !this.transitionParams.animateMessageText) {
                str = Theme.key_chat_mediaProgress;
                drawMessageText(canvas, this.currentMessageObject.textLayoutBlocks, true, 1.0f, false);
            } else {
                canvas.save();
                Theme.MessageDrawable messageDrawable = this.currentBackgroundDrawable;
                if (messageDrawable != null) {
                    Rect r = messageDrawable.getBounds();
                    if (this.currentMessageObject.isOutOwner() && !this.mediaBackground && !this.pinnedBottom) {
                        canvas.clipRect(r.left + AndroidUtilities.dp(4.0f), r.top + AndroidUtilities.dp(4.0f), r.right - AndroidUtilities.dp(10.0f), r.bottom - AndroidUtilities.dp(4.0f));
                    } else {
                        canvas.clipRect(r.left + AndroidUtilities.dp(4.0f), r.top + AndroidUtilities.dp(4.0f), r.right - AndroidUtilities.dp(4.0f), r.bottom - AndroidUtilities.dp(4.0f));
                    }
                }
                str = Theme.key_chat_mediaProgress;
                drawMessageText(canvas, this.transitionParams.animateOutTextBlocks, false, 1.0f - this.transitionParams.animateChangeProgress, false);
                drawMessageText(canvas, this.currentMessageObject.textLayoutBlocks, true, this.transitionParams.animateChangeProgress, false);
                canvas.restore();
            }
            if (!this.enterTransitionInProgress || this.currentMessageObject.isVoice()) {
                drawLinkPreview(canvas, 1.0f);
            }
            this.drawTime = true;
        } else {
            str = Theme.key_chat_mediaProgress;
            if (this.drawPhotoImage) {
                if (this.isRoundVideo && MediaController.getInstance().isPlayingMessage(this.currentMessageObject) && MediaController.getInstance().isVideoDrawingReady() && canvas.isHardwareAccelerated()) {
                    this.imageDrawn = true;
                    this.drawTime = true;
                } else {
                    if (this.currentMessageObject.type != 5 || Theme.chat_roundVideoShadow == null) {
                        if (this.currentMessageObject.type == 4) {
                            this.rect.set(this.photoImage.getImageX(), this.photoImage.getImageY(), this.photoImage.getImageX2(), this.photoImage.getImageY2());
                            Theme.chat_docBackPaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outLocationBackground : Theme.key_chat_inLocationBackground));
                            int[] rad = this.photoImage.getRoundRadius();
                            this.rectPath.reset();
                            for (int a = 0; a < rad.length; a++) {
                                float[] fArr = radii;
                                float f3 = rad[a];
                                fArr[(a * 2) + 1] = f3;
                                fArr[a * 2] = f3;
                            }
                            this.rectPath.addRoundRect(this.rect, radii, Path.Direction.CW);
                            this.rectPath.close();
                            canvas.drawPath(this.rectPath, Theme.chat_docBackPaint);
                            Drawable iconDrawable = Theme.chat_locationDrawable[this.currentMessageObject.isOutOwner() ? 1 : 0];
                            setDrawableBounds(iconDrawable, this.rect.centerX() - (iconDrawable.getIntrinsicWidth() / 2), this.rect.centerY() - (iconDrawable.getIntrinsicHeight() / 2));
                            iconDrawable.draw(canvas);
                        }
                    } else {
                        float x5 = this.photoImage.getImageX() - AndroidUtilities.dp(3.0f);
                        float y2 = this.photoImage.getImageY() - AndroidUtilities.dp(2.0f);
                        Theme.chat_roundVideoShadow.setAlpha(255);
                        Theme.chat_roundVideoShadow.setBounds((int) x5, (int) y2, (int) (this.photoImage.getImageWidth() + x5 + AndroidUtilities.dp(6.0f)), (int) (this.photoImage.getImageHeight() + y2 + AndroidUtilities.dp(6.0f)));
                        Theme.chat_roundVideoShadow.draw(canvas);
                        if (!this.photoImage.hasBitmapImage() || this.photoImage.getCurrentAlpha() != 1.0f) {
                            Theme.chat_docBackPaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outBubble : Theme.key_chat_inBubble));
                            canvas.drawCircle(this.photoImage.getCenterX(), this.photoImage.getCenterY(), this.photoImage.getImageWidth() / 2.0f, Theme.chat_docBackPaint);
                        }
                    }
                    CheckBoxBase checkBoxBase = this.mediaCheckBox;
                    boolean z2 = checkBoxBase != null && (this.checkBoxVisible || checkBoxBase.getProgress() != 0.0f || this.checkBoxAnimationInProgress) && this.currentMessagesGroup != null;
                    this.drawMediaCheckBox = z2;
                    if (z2 && ((this.mediaCheckBox.isChecked() || this.mediaCheckBox.getProgress() != 0.0f || this.checkBoxAnimationInProgress) && !textIsSelectionMode())) {
                        if (!this.currentMessagesGroup.isDocuments) {
                            Theme.chat_replyLinePaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outBubbleSelected : Theme.key_chat_inBubbleSelected));
                            this.rect.set(this.photoImage.getImageX(), this.photoImage.getImageY(), this.photoImage.getImageX2(), this.photoImage.getImageY2());
                            int[] rad2 = this.photoImage.getRoundRadius();
                            this.rectPath.reset();
                            for (int a2 = 0; a2 < rad2.length; a2++) {
                                float[] fArr2 = radii;
                                float f4 = rad2[a2];
                                fArr2[(a2 * 2) + 1] = f4;
                                fArr2[a2 * 2] = f4;
                            }
                            this.rectPath.addRoundRect(this.rect, radii, Path.Direction.CW);
                            this.rectPath.close();
                            canvas.drawPath(this.rectPath, Theme.chat_replyLinePaint);
                        }
                        this.photoImage.setSideClip(AndroidUtilities.dp(14.0f) * this.mediaCheckBox.getProgress());
                        if (this.checkBoxAnimationInProgress) {
                            this.mediaCheckBox.setBackgroundAlpha(this.checkBoxAnimationProgress);
                        } else {
                            CheckBoxBase checkBoxBase2 = this.mediaCheckBox;
                            checkBoxBase2.setBackgroundAlpha(this.checkBoxVisible ? 1.0f : checkBoxBase2.getProgress());
                        }
                    } else {
                        this.photoImage.setSideClip(0.0f);
                    }
                    ChatMessageCellDelegate chatMessageCellDelegate = this.delegate;
                    if (chatMessageCellDelegate == null || chatMessageCellDelegate.getPinchToZoomHelper() == null || !this.delegate.getPinchToZoomHelper().isInOverlayModeFor(this)) {
                        if (!this.flipImage) {
                            this.imageDrawn = this.photoImage.draw(canvas);
                        } else {
                            canvas.save();
                            canvas.scale(-1.0f, 1.0f, this.photoImage.getCenterX(), this.photoImage.getCenterY());
                            this.photoImage.draw(canvas);
                            canvas.restore();
                        }
                    }
                    boolean drawTimeOld = this.drawTime;
                    boolean groupPhotoVisible = this.photoImage.getVisible();
                    boolean z3 = groupPhotoVisible || (this.currentMessageObject.shouldDrawReactionsInLayout() && this.currentMessageObject.hasReactions());
                    this.drawTime = z3;
                    if (this.currentPosition != null && drawTimeOld != z3 && (viewGroup = (ViewGroup) getParent()) != null) {
                        if (!this.currentPosition.last) {
                            int count = viewGroup.getChildCount();
                            for (int a3 = 0; a3 < count; a3++) {
                                View child = viewGroup.getChildAt(a3);
                                if (child != this && (child instanceof ChatMessageCell)) {
                                    ChatMessageCell cell = (ChatMessageCell) child;
                                    if (cell.getCurrentMessagesGroup() == this.currentMessagesGroup) {
                                        MessageObject.GroupedMessagePosition position = cell.getCurrentPosition();
                                        if (position.last && position.maxY == this.currentPosition.maxY && (cell.timeX - AndroidUtilities.dp(4.0f)) + cell.getLeft() < getRight()) {
                                            cell.groupPhotoInvisible = !groupPhotoVisible;
                                            cell.invalidate();
                                            viewGroup.invalidate();
                                        }
                                    }
                                }
                            }
                        } else {
                            viewGroup.invalidate();
                        }
                    }
                }
            } else {
                int i4 = this.documentAttachType;
                if (i4 == 5 || i4 == 1) {
                    CheckBoxBase checkBoxBase3 = this.mediaCheckBox;
                    boolean z4 = checkBoxBase3 != null && (this.checkBoxVisible || checkBoxBase3.getProgress() != 0.0f || this.checkBoxAnimationInProgress) && this.currentMessagesGroup != null;
                    this.drawMediaCheckBox = z4;
                    if (z4) {
                        this.radialProgress.setCircleCrossfadeColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outTimeText : Theme.key_chat_inTimeText, this.checkBoxAnimationProgress, 1.0f - this.mediaCheckBox.getProgress());
                    }
                    if (this.drawMediaCheckBox && !textIsSelectionMode() && (this.mediaCheckBox.isChecked() || this.mediaCheckBox.getProgress() != 0.0f || this.checkBoxAnimationInProgress)) {
                        if (this.checkBoxAnimationInProgress) {
                            this.mediaCheckBox.setBackgroundAlpha(this.checkBoxAnimationProgress);
                            if (this.radialProgress.getMiniIcon() == 4) {
                                this.radialProgress.setMiniIconScale(this.checkBoxAnimationProgress);
                            }
                        } else {
                            CheckBoxBase checkBoxBase4 = this.mediaCheckBox;
                            checkBoxBase4.setBackgroundAlpha(this.checkBoxVisible ? 1.0f : checkBoxBase4.getProgress());
                        }
                    } else {
                        CheckBoxBase checkBoxBase5 = this.mediaCheckBox;
                        if (checkBoxBase5 != null) {
                            checkBoxBase5.setBackgroundAlpha(1.0f);
                        }
                    }
                }
            }
        }
        int i5 = this.documentAttachType;
        String str2 = Theme.key_chat_outAudioProgress;
        String str3 = Theme.key_chat_inAudioProgress;
        if (i5 == 2) {
            if (this.photoImage.getVisible() && !this.hasGamePreview && !this.currentMessageObject.needDrawBluredPreview()) {
                int oldAlpha = ((BitmapDrawable) Theme.chat_msgMediaMenuDrawable).getPaint().getAlpha();
                Theme.chat_msgMediaMenuDrawable.setAlpha((int) (oldAlpha * this.controlsAlpha));
                Drawable drawable = Theme.chat_msgMediaMenuDrawable;
                int imageX = (int) ((this.photoImage.getImageX() + this.photoImage.getImageWidth()) - AndroidUtilities.dp(14.0f));
                this.otherX = imageX;
                int imageY = (int) (this.photoImage.getImageY() + AndroidUtilities.dp(8.1f));
                this.otherY = imageY;
                setDrawableBounds(drawable, imageX, imageY);
                Theme.chat_msgMediaMenuDrawable.draw(canvas);
                Theme.chat_msgMediaMenuDrawable.setAlpha(oldAlpha);
            }
        } else if (i5 == 7) {
            if (this.durationLayout != null && ((playing = MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) || this.roundProgressAlpha != 0.0f)) {
                if (playing) {
                    this.roundProgressAlpha = 1.0f;
                } else {
                    float f5 = this.roundProgressAlpha - 0.10666667f;
                    this.roundProgressAlpha = f5;
                    if (f5 < 0.0f) {
                        this.roundProgressAlpha = 0.0f;
                    } else {
                        invalidate();
                    }
                }
                drawRoundProgress(canvas);
            }
        } else if (i5 == 5) {
            if (this.currentMessageObject.isOutOwner()) {
                Theme.chat_audioTitlePaint.setColor(getThemedColor(Theme.key_chat_outAudioTitleText));
                Theme.chat_audioPerformerPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outAudioPerformerSelectedText : Theme.key_chat_outAudioPerformerText));
                Theme.chat_audioTimePaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outAudioDurationSelectedText : Theme.key_chat_outAudioDurationText));
                this.radialProgress.setProgressColor(getThemedColor((isDrawSelectionBackground() || this.buttonPressed != 0) ? Theme.key_chat_outAudioSelectedProgress : str2));
            } else {
                Theme.chat_audioTitlePaint.setColor(getThemedColor(Theme.key_chat_inAudioTitleText));
                Theme.chat_audioPerformerPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inAudioPerformerSelectedText : Theme.key_chat_inAudioPerformerText));
                Theme.chat_audioTimePaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inAudioDurationSelectedText : Theme.key_chat_inAudioDurationText));
                this.radialProgress.setProgressColor(getThemedColor((isDrawSelectionBackground() || this.buttonPressed != 0) ? Theme.key_chat_inAudioSelectedProgress : str3));
            }
            this.radialProgress.setBackgroundDrawable(isDrawSelectionBackground() ? this.currentBackgroundSelectedDrawable : this.currentBackgroundDrawable);
            this.radialProgress.draw(canvas);
            canvas.save();
            canvas.translate(this.timeAudioX + this.songX, AndroidUtilities.dp(13.0f) + this.namesOffset + this.mediaOffsetY);
            this.songLayout.draw(canvas);
            canvas.restore();
            boolean showSeekbar = MediaController.getInstance().isPlayingMessage(this.currentMessageObject);
            if (showSeekbar) {
                float f6 = this.toSeekBarProgress;
                if (f6 != 1.0f) {
                    float f7 = f6 + 0.16f;
                    this.toSeekBarProgress = f7;
                    if (f7 > 1.0f) {
                        this.toSeekBarProgress = 1.0f;
                    }
                    invalidate();
                    f = this.toSeekBarProgress;
                    if (f > 0.0f) {
                        if (f != 1.0f) {
                            canvas.saveLayerAlpha(this.seekBarX, this.seekBarY, i2 + this.seekBar.getWidth() + AndroidUtilities.dp(24.0f), this.seekBarY + AndroidUtilities.dp(24.0f), (int) (this.toSeekBarProgress * 255.0f), 31);
                        } else {
                            canvas.save();
                        }
                        canvas.translate(this.seekBarX, this.seekBarY);
                        this.seekBar.draw(canvas);
                        canvas.restore();
                    }
                    if (this.toSeekBarProgress >= 1.0f) {
                        float x6 = this.timeAudioX + this.performerX;
                        float y3 = AndroidUtilities.dp(35.0f) + this.namesOffset + this.mediaOffsetY;
                        if (this.toSeekBarProgress != 0.0f) {
                            y = y3;
                            x4 = x6;
                            canvas.saveLayerAlpha(x6, y3, x6 + this.performerLayout.getWidth(), y3 + this.performerLayout.getHeight(), (int) ((1.0f - this.toSeekBarProgress) * 255.0f), 31);
                        } else {
                            y = y3;
                            x4 = x6;
                            canvas.save();
                        }
                        float f8 = this.toSeekBarProgress;
                        if (f8 != 0.0f) {
                            float s = ((1.0f - f8) * 0.3f) + 0.7f;
                            canvas.scale(s, s, x4, y + (this.performerLayout.getHeight() / 2.0f));
                        }
                        canvas.translate(x4, y);
                        this.performerLayout.draw(canvas);
                        canvas.restore();
                    }
                    canvas.save();
                    canvas.translate(this.timeAudioX, AndroidUtilities.dp(57.0f) + this.namesOffset + this.mediaOffsetY);
                    this.durationLayout.draw(canvas);
                    canvas.restore();
                    if (shouldDrawMenuDrawable()) {
                        if (this.currentMessageObject.isOutOwner()) {
                            menuDrawable2 = getThemedDrawable(isDrawSelectionBackground() ? Theme.key_drawable_msgOutMenuSelected : Theme.key_drawable_msgOutMenu);
                        } else {
                            menuDrawable2 = isDrawSelectionBackground() ? Theme.chat_msgInMenuSelectedDrawable : Theme.chat_msgInMenuDrawable;
                        }
                        int dp3 = (((int) buttonX) + this.backgroundWidth) - AndroidUtilities.dp(this.currentMessageObject.type == 0 ? 58.0f : 48.0f);
                        this.otherX = dp3;
                        int dp4 = ((int) buttonY) - AndroidUtilities.dp(2.0f);
                        this.otherY = dp4;
                        setDrawableBounds(menuDrawable2, dp3, dp4);
                        if (this.transitionParams.animateChangeProgress != 1.0f && this.transitionParams.animateShouldDrawMenuDrawable) {
                            menuDrawable2.setAlpha((int) (this.transitionParams.animateChangeProgress * 255.0f));
                        }
                        menuDrawable2.draw(canvas);
                        if (this.transitionParams.animateChangeProgress != 1.0f && this.transitionParams.animateShouldDrawMenuDrawable) {
                            menuDrawable2.setAlpha(255);
                        }
                    }
                }
            }
            if (!showSeekbar) {
                float f9 = this.toSeekBarProgress;
                if (f9 != 0.0f) {
                    float f10 = f9 - 0.16f;
                    this.toSeekBarProgress = f10;
                    if (f10 < 0.0f) {
                        this.toSeekBarProgress = 0.0f;
                    }
                    invalidate();
                }
            }
            f = this.toSeekBarProgress;
            if (f > 0.0f) {
            }
            if (this.toSeekBarProgress >= 1.0f) {
            }
            canvas.save();
            canvas.translate(this.timeAudioX, AndroidUtilities.dp(57.0f) + this.namesOffset + this.mediaOffsetY);
            this.durationLayout.draw(canvas);
            canvas.restore();
            if (shouldDrawMenuDrawable()) {
            }
        } else if (i5 == 3) {
            if (this.currentMessageObject.isOutOwner()) {
                Theme.chat_audioTimePaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outAudioDurationSelectedText : Theme.key_chat_outAudioDurationText));
                this.radialProgress.setProgressColor(getThemedColor((isDrawSelectionBackground() || this.buttonPressed != 0) ? Theme.key_chat_outAudioSelectedProgress : str2));
            } else {
                Theme.chat_audioTimePaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inAudioDurationSelectedText : Theme.key_chat_inAudioDurationText));
                this.radialProgress.setProgressColor(getThemedColor((isDrawSelectionBackground() || this.buttonPressed != 0) ? Theme.key_chat_inAudioSelectedProgress : str3));
            }
            if (MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
                audioVisualizerDrawable = Theme.getCurrentAudiVisualizerDrawable();
            } else {
                audioVisualizerDrawable = Theme.getAnimatedOutAudioVisualizerDrawable(this.currentMessageObject);
            }
            if (audioVisualizerDrawable != null) {
                audioVisualizerDrawable.setParentView(this);
                audioVisualizerDrawable.draw(canvas, buttonX + AndroidUtilities.dp(22.0f), buttonY + AndroidUtilities.dp(22.0f), this.currentMessageObject.isOutOwner(), this.resourcesProvider);
            }
            if (!this.enterTransitionInProgress) {
                this.radialProgress.setBackgroundDrawable(isDrawSelectionBackground() ? this.currentBackgroundSelectedDrawable : this.currentBackgroundDrawable);
                this.radialProgress.draw(canvas);
            }
            int seekBarX = this.seekBarX;
            int timeAudioX = this.timeAudioX;
            if (this.transitionParams.animateButton) {
                int offset = this.buttonX - ((int) ((this.transitionParams.animateFromButtonX * (1.0f - this.transitionParams.animateChangeProgress)) + (this.buttonX * this.transitionParams.animateChangeProgress)));
                seekBarX -= offset;
                timeAudioX -= offset;
            }
            canvas.save();
            if (this.useSeekBarWaveform) {
                canvas.translate(AndroidUtilities.dp(13.0f) + seekBarX, this.seekBarY);
                this.seekBarWaveform.draw(canvas, this);
            } else {
                canvas.translate(seekBarX, this.seekBarY);
                this.seekBar.draw(canvas);
            }
            canvas.restore();
            if (this.useTranscribeButton) {
                canvas.save();
                int backgroundWidth = this.backgroundWidth;
                if (this.transitionParams.animateBackgroundBoundsInner && this.documentAttachType == 3) {
                    backgroundWidth = (int) ((this.backgroundWidth - this.transitionParams.deltaLeft) + this.transitionParams.deltaRight);
                }
                int seekBarWidth = backgroundWidth - AndroidUtilities.dp(((this.hasLinkPreview ? 10 : 0) + 92) + 36);
                float dp5 = AndroidUtilities.dp(21.0f) + seekBarX + seekBarWidth;
                this.transcribeX = dp5;
                float f11 = this.seekBarY;
                this.transcribeY = f11;
                canvas.translate(dp5, f11);
                if (this.transcribeButton == null) {
                    TranscribeButton transcribeButton = new TranscribeButton(this, this.seekBarWaveform);
                    this.transcribeButton = transcribeButton;
                    transcribeButton.setOpen(this.currentMessageObject.messageOwner != null && this.currentMessageObject.messageOwner.voiceTranscriptionOpen && this.currentMessageObject.messageOwner.voiceTranscriptionFinal, false);
                    this.transcribeButton.setLoading(TranscribeButton.isTranscribing(this.currentMessageObject), false);
                }
                this.transcribeButton.setColor(this.currentMessageObject.isOut(), getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outReactionButtonBackground : Theme.key_chat_inReactionButtonBackground), getThemedColor(Theme.key_windowBackgroundWhiteGrayText));
                this.transcribeButton.draw(canvas);
                canvas.restore();
            }
            canvas.save();
            canvas.translate(timeAudioX, AndroidUtilities.dp(44.0f) + this.namesOffset + this.mediaOffsetY);
            this.durationLayout.draw(canvas);
            canvas.restore();
            if (this.currentMessageObject.type != 0 && this.currentMessageObject.isContentUnread()) {
                Theme.chat_docBackPaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outVoiceSeekbarFill : Theme.key_chat_inVoiceSeekbarFill));
                canvas.drawCircle(this.timeWidthAudio + timeAudioX + AndroidUtilities.dp(6.0f), AndroidUtilities.dp(51.0f) + this.namesOffset + this.mediaOffsetY, AndroidUtilities.dp(3.0f), Theme.chat_docBackPaint);
            }
        }
        if (this.captionLayout != null) {
            updateCaptionLayout();
        }
        updateReactionLayoutPosition();
        if (!this.currentMessageObject.preview) {
            if (this.currentPosition == null || ((groupedMessages = this.currentMessagesGroup) != null && groupedMessages.isDocuments && (this.currentPosition.flags & 8) == 0)) {
                if (!this.transitionParams.animateBackgroundBoundsInner) {
                    if (!this.enterTransitionInProgress || !this.currentMessageObject.isVoice()) {
                        x = 0;
                        drawCaptionLayout(canvas, false, 1.0f);
                        if (!this.hasOldCaptionPreview) {
                            i = 1;
                        } else {
                            if (this.currentMessageObject.type == 1 || this.documentAttachType == 4 || this.currentMessageObject.type == 8) {
                                linkX = (int) (this.photoImage.getImageX() + AndroidUtilities.dp(5.0f));
                            } else {
                                int i6 = this.backgroundDrawableLeft;
                                if (!this.currentMessageObject.isOutOwner()) {
                                    f2 = 17.0f;
                                }
                                linkX = i6 + AndroidUtilities.dp(f2);
                            }
                            int startY = ((this.totalHeight - AndroidUtilities.dp(this.drawPinnedTop ? 9.0f : 10.0f)) - this.linkPreviewHeight) - AndroidUtilities.dp(8.0f);
                            Theme.chat_replyLinePaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outPreviewLine : Theme.key_chat_inPreviewLine));
                            canvas.drawRect(linkX, startY - AndroidUtilities.dp(3.0f), AndroidUtilities.dp(2.0f) + linkX, startY + this.linkPreviewHeight, Theme.chat_replyLinePaint);
                            if (this.siteNameLayout != null) {
                                Theme.chat_replyNamePaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outSiteNameText : Theme.key_chat_inSiteNameText));
                                canvas.save();
                                if (this.siteNameRtl) {
                                    x = (this.backgroundWidth - this.siteNameWidth) - AndroidUtilities.dp(32.0f);
                                } else if (!this.hasInvoicePreview) {
                                    x = AndroidUtilities.dp(10.0f);
                                }
                                canvas.translate(linkX + x, startY - AndroidUtilities.dp(3.0f));
                                this.siteNameLayout.draw(canvas);
                                canvas.restore();
                                StaticLayout staticLayout5 = this.siteNameLayout;
                                int linkPreviewY = startY + staticLayout5.getLineBottom(staticLayout5.getLineCount() - 1);
                                x3 = linkPreviewY;
                            } else {
                                x3 = startY;
                            }
                            if (this.currentMessageObject.isOutOwner()) {
                                Theme.chat_replyTextPaint.setColor(getThemedColor(Theme.key_chat_messageTextOut));
                            } else {
                                Theme.chat_replyTextPaint.setColor(getThemedColor(Theme.key_chat_messageTextIn));
                            }
                            if (this.descriptionLayout != null) {
                                if (x3 != startY) {
                                    x3 += AndroidUtilities.dp(2.0f);
                                }
                                this.descriptionY = x3 - AndroidUtilities.dp(3.0f);
                                canvas.save();
                                canvas.translate(AndroidUtilities.dp(10.0f) + linkX + this.descriptionX, this.descriptionY);
                                this.descriptionLayout.draw(canvas);
                                canvas.restore();
                            }
                            i = 1;
                            this.drawTime = true;
                        }
                        if (this.documentAttachType == i) {
                            if (this.currentMessageObject.isOutOwner()) {
                                Theme.chat_docNamePaint.setColor(getThemedColor(Theme.key_chat_outFileNameText));
                                Theme.chat_infoPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outFileInfoSelectedText : Theme.key_chat_outFileInfoText));
                                Theme.chat_docBackPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outFileBackgroundSelected : Theme.key_chat_outFileBackground));
                                menuDrawable = getThemedDrawable(isDrawSelectionBackground() ? Theme.key_drawable_msgOutMenuSelected : Theme.key_drawable_msgOutMenu);
                            } else {
                                Theme.chat_docNamePaint.setColor(getThemedColor(Theme.key_chat_inFileNameText));
                                Theme.chat_infoPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inFileInfoSelectedText : Theme.key_chat_inFileInfoText));
                                Theme.chat_docBackPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inFileBackgroundSelected : Theme.key_chat_inFileBackground));
                                menuDrawable = isDrawSelectionBackground() ? Theme.chat_msgInMenuSelectedDrawable : Theme.chat_msgInMenuDrawable;
                            }
                            if (!this.drawPhotoImage) {
                                int dp6 = (((int) buttonX) + this.backgroundWidth) - AndroidUtilities.dp(this.currentMessageObject.type == 0 ? 58.0f : 48.0f);
                                this.otherX = dp6;
                                int dp7 = ((int) buttonY) - AndroidUtilities.dp(2.0f);
                                this.otherY = dp7;
                                setDrawableBounds(menuDrawable, dp6, dp7);
                                x2 = AndroidUtilities.dp(53.0f) + buttonX;
                                titleY = ((int) buttonY) + AndroidUtilities.dp(4.0f);
                                subtitleY = ((int) buttonY) + AndroidUtilities.dp(27.0f);
                                StaticLayout staticLayout6 = this.docTitleLayout;
                                if (staticLayout6 != null && staticLayout6.getLineCount() > 1) {
                                    subtitleY += ((this.docTitleLayout.getLineCount() - 1) * AndroidUtilities.dp(16.0f)) + AndroidUtilities.dp(2.0f);
                                }
                                if (this.currentMessageObject.isOutOwner()) {
                                    this.radialProgress.setProgressColor(getThemedColor((isDrawSelectionBackground() || this.buttonPressed != 0) ? Theme.key_chat_outAudioSelectedProgress : str2));
                                    RadialProgress2 radialProgress2 = this.videoRadialProgress;
                                    if (isDrawSelectionBackground() || this.videoButtonPressed != 0) {
                                        str2 = Theme.key_chat_outAudioSelectedProgress;
                                    }
                                    radialProgress2.setProgressColor(getThemedColor(str2));
                                } else {
                                    this.radialProgress.setProgressColor(getThemedColor((isDrawSelectionBackground() || this.buttonPressed != 0) ? Theme.key_chat_inAudioSelectedProgress : str3));
                                    RadialProgress2 radialProgress22 = this.videoRadialProgress;
                                    if (isDrawSelectionBackground() || this.videoButtonPressed != 0) {
                                        str3 = Theme.key_chat_inAudioSelectedProgress;
                                    }
                                    radialProgress22.setProgressColor(getThemedColor(str3));
                                }
                            } else {
                                if (this.currentMessageObject.type == 0) {
                                    int imageX2 = (int) ((this.photoImage.getImageX() + this.backgroundWidth) - AndroidUtilities.dp(56.0f));
                                    this.otherX = imageX2;
                                    int imageY2 = (int) (this.photoImage.getImageY() + AndroidUtilities.dp(4.0f));
                                    this.otherY = imageY2;
                                    setDrawableBounds(menuDrawable, imageX2, imageY2);
                                } else {
                                    int imageX3 = (int) ((this.photoImage.getImageX() + this.backgroundWidth) - AndroidUtilities.dp(40.0f));
                                    this.otherX = imageX3;
                                    int imageY3 = (int) (this.photoImage.getImageY() + AndroidUtilities.dp(4.0f));
                                    this.otherY = imageY3;
                                    setDrawableBounds(menuDrawable, imageX3, imageY3);
                                }
                                x2 = (int) (this.photoImage.getImageX() + this.photoImage.getImageWidth() + AndroidUtilities.dp(10.0f));
                                titleY = (int) (this.photoImage.getImageY() + AndroidUtilities.dp(8.0f));
                                subtitleY = (int) (this.photoImage.getImageY() + (this.docTitleLayout != null ? staticLayout2.getLineBottom(staticLayout2.getLineCount() - 1) + AndroidUtilities.dp(13.0f) : AndroidUtilities.dp(8.0f)));
                                if (!this.imageDrawn) {
                                    if (this.currentMessageObject.isOutOwner()) {
                                        this.radialProgress.setColors(Theme.key_chat_outLoader, Theme.key_chat_outLoaderSelected, Theme.key_chat_outMediaIcon, Theme.key_chat_outMediaIconSelected);
                                        this.radialProgress.setProgressColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outFileProgressSelected : Theme.key_chat_outFileProgress));
                                        this.videoRadialProgress.setColors(Theme.key_chat_outLoader, Theme.key_chat_outLoaderSelected, Theme.key_chat_outMediaIcon, Theme.key_chat_outMediaIconSelected);
                                        this.videoRadialProgress.setProgressColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outFileProgressSelected : Theme.key_chat_outFileProgress));
                                    } else {
                                        this.radialProgress.setColors(Theme.key_chat_inLoader, Theme.key_chat_inLoaderSelected, Theme.key_chat_inMediaIcon, Theme.key_chat_inMediaIconSelected);
                                        this.radialProgress.setProgressColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inFileProgressSelected : Theme.key_chat_inFileProgress));
                                        this.videoRadialProgress.setColors(Theme.key_chat_inLoader, Theme.key_chat_inLoaderSelected, Theme.key_chat_inMediaIcon, Theme.key_chat_inMediaIconSelected);
                                        this.videoRadialProgress.setProgressColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inFileProgressSelected : Theme.key_chat_inFileProgress));
                                    }
                                    this.rect.set(this.photoImage.getImageX(), this.photoImage.getImageY(), this.photoImage.getImageX() + this.photoImage.getImageWidth(), this.photoImage.getImageY() + this.photoImage.getImageHeight());
                                    int[] rad3 = this.photoImage.getRoundRadius();
                                    this.rectPath.reset();
                                    for (int a4 = 0; a4 < rad3.length; a4++) {
                                        float[] fArr3 = radii;
                                        fArr3[a4 * 2] = rad3[a4];
                                        fArr3[(a4 * 2) + 1] = rad3[a4];
                                    }
                                    this.rectPath.addRoundRect(this.rect, radii, Path.Direction.CW);
                                    this.rectPath.close();
                                    canvas.drawPath(this.rectPath, Theme.chat_docBackPaint);
                                } else {
                                    this.radialProgress.setColors(Theme.key_chat_mediaLoaderPhoto, Theme.key_chat_mediaLoaderPhotoSelected, Theme.key_chat_mediaLoaderPhotoIcon, Theme.key_chat_mediaLoaderPhotoIconSelected);
                                    String str4 = str;
                                    this.radialProgress.setProgressColor(getThemedColor(str4));
                                    this.videoRadialProgress.setColors(Theme.key_chat_mediaLoaderPhoto, Theme.key_chat_mediaLoaderPhotoSelected, Theme.key_chat_mediaLoaderPhotoIcon, Theme.key_chat_mediaLoaderPhotoIconSelected);
                                    this.videoRadialProgress.setProgressColor(getThemedColor(str4));
                                    if (this.buttonState == -1 && this.radialProgress.getIcon() != 4) {
                                        this.radialProgress.setIcon(4, true, true);
                                    }
                                }
                            }
                            int subtitleY2 = subtitleY;
                            int subtitleY3 = titleY;
                            float x7 = x2;
                            if (shouldDrawMenuDrawable()) {
                                if (this.transitionParams.animateChangeProgress != 1.0f && this.transitionParams.animateShouldDrawMenuDrawable) {
                                    menuDrawable.setAlpha((int) (this.transitionParams.animateChangeProgress * 255.0f));
                                }
                                menuDrawable.draw(canvas);
                                if (this.transitionParams.animateChangeProgress != 1.0f && this.transitionParams.animateShouldDrawMenuDrawable) {
                                    menuDrawable.setAlpha(255);
                                }
                            }
                            try {
                                if (this.docTitleLayout != null) {
                                    canvas.save();
                                    canvas.translate(this.docTitleOffsetX + x7, subtitleY3);
                                    this.docTitleLayout.draw(canvas);
                                    canvas.restore();
                                }
                            } catch (Exception e) {
                                FileLog.e(e);
                            }
                            try {
                                if (this.infoLayout != null) {
                                    canvas.save();
                                    canvas.translate(x7, subtitleY2);
                                    if (this.buttonState == 1 && (staticLayout = this.loadingProgressLayout) != null) {
                                        staticLayout.draw(canvas);
                                    } else {
                                        this.infoLayout.draw(canvas);
                                    }
                                    canvas.restore();
                                }
                            } catch (Exception e2) {
                                FileLog.e(e2);
                            }
                        }
                        if (this.currentMessageObject.type == 4 && !(this.currentMessageObject.messageOwner.media instanceof TLRPC.TL_messageMediaGeoLive) && this.currentMapProvider == 2 && this.photoImage.hasNotThumb()) {
                            int w = (int) (Theme.chat_redLocationIcon.getIntrinsicWidth() * 0.8f);
                            int h = (int) (Theme.chat_redLocationIcon.getIntrinsicHeight() * 0.8f);
                            int x8 = (int) (this.photoImage.getImageX() + ((this.photoImage.getImageWidth() - w) / 2.0f));
                            int y4 = (int) (this.photoImage.getImageY() + ((this.photoImage.getImageHeight() / 2.0f) - h));
                            Theme.chat_redLocationIcon.setAlpha((int) (this.photoImage.getCurrentAlpha() * 255.0f));
                            Theme.chat_redLocationIcon.setBounds(x8, y4, x8 + w, y4 + h);
                            Theme.chat_redLocationIcon.draw(canvas);
                        }
                        this.transitionParams.recordDrawingState();
                    }
                }
            }
            x = 0;
            if (!this.hasOldCaptionPreview) {
            }
            if (this.documentAttachType == i) {
            }
            if (this.currentMessageObject.type == 4) {
                int w2 = (int) (Theme.chat_redLocationIcon.getIntrinsicWidth() * 0.8f);
                int h2 = (int) (Theme.chat_redLocationIcon.getIntrinsicHeight() * 0.8f);
                int x82 = (int) (this.photoImage.getImageX() + ((this.photoImage.getImageWidth() - w2) / 2.0f));
                int y42 = (int) (this.photoImage.getImageY() + ((this.photoImage.getImageHeight() / 2.0f) - h2));
                Theme.chat_redLocationIcon.setAlpha((int) (this.photoImage.getCurrentAlpha() * 255.0f));
                Theme.chat_redLocationIcon.setBounds(x82, y42, x82 + w2, y42 + h2);
                Theme.chat_redLocationIcon.draw(canvas);
            }
            this.transitionParams.recordDrawingState();
        }
        x = 0;
        if (!this.hasOldCaptionPreview) {
        }
        if (this.documentAttachType == i) {
        }
        if (this.currentMessageObject.type == 4) {
        }
        this.transitionParams.recordDrawingState();
    }

    public void updateReactionLayoutPosition() {
        int timeYOffset;
        float f;
        ReactionsLayoutInBubble reactionsLayoutInBubble;
        MessageObject.GroupedMessagePosition groupedMessagePosition;
        int i = 0;
        if (!this.reactionsLayoutInBubble.isEmpty && (((groupedMessagePosition = this.currentPosition) == null || ((groupedMessagePosition.flags & 8) != 0 && (this.currentPosition.flags & 1) != 0)) && !this.reactionsLayoutInBubble.isSmall)) {
            float f2 = 11.0f;
            if (this.currentMessageObject.isOutOwner()) {
                this.reactionsLayoutInBubble.x = getCurrentBackgroundLeft() + AndroidUtilities.dp(11.0f);
            } else {
                ReactionsLayoutInBubble reactionsLayoutInBubble2 = this.reactionsLayoutInBubble;
                int currentBackgroundLeft = getCurrentBackgroundLeft();
                if (this.mediaBackground || !this.drawPinnedBottom) {
                    f2 = 17.0f;
                }
                reactionsLayoutInBubble2.x = currentBackgroundLeft + AndroidUtilities.dp(f2);
                if (this.mediaBackground) {
                    this.reactionsLayoutInBubble.x -= AndroidUtilities.dp(9.0f);
                }
            }
            this.reactionsLayoutInBubble.y = (getBackgroundDrawableBottom() - AndroidUtilities.dp(10.0f)) - this.reactionsLayoutInBubble.height;
            this.reactionsLayoutInBubble.y -= this.drawCommentButton ? AndroidUtilities.dp(43.0f) : 0;
            if (this.hasNewLineForTime) {
                this.reactionsLayoutInBubble.y -= AndroidUtilities.dp(16.0f);
            }
            if (this.captionLayout != null && ((this.currentMessageObject.type != 2 && ((!this.currentMessageObject.isOut() || !this.drawForwardedName || this.drawPhotoImage) && (this.currentMessageObject.type != 9 || !this.drawPhotoImage))) || (this.currentPosition != null && this.currentMessagesGroup != null))) {
                this.reactionsLayoutInBubble.y -= AndroidUtilities.dp(14.0f);
            }
            this.reactionsLayoutInBubble.y += this.reactionsLayoutInBubble.positionOffsetY;
        }
        if (this.reactionsLayoutInBubble.isSmall && !this.reactionsLayoutInBubble.isEmpty) {
            if (shouldDrawTimeOnMedia()) {
                if (this.drawCommentButton) {
                    i = AndroidUtilities.dp(41.3f);
                }
                timeYOffset = -i;
            } else if (this.currentMessageObject.isSponsored()) {
                timeYOffset = -AndroidUtilities.dp(48.0f);
                if (this.hasNewLineForTime) {
                    timeYOffset -= AndroidUtilities.dp(16.0f);
                }
            } else {
                if (this.drawCommentButton) {
                    i = AndroidUtilities.dp(43.0f);
                }
                timeYOffset = -i;
            }
            ReactionsLayoutInBubble reactionsLayoutInBubble3 = this.reactionsLayoutInBubble;
            if (shouldDrawTimeOnMedia()) {
                f = ((this.photoImage.getImageY2() + this.additionalTimeOffsetY) - AndroidUtilities.dp(7.3f)) - this.timeLayout.getHeight();
            } else {
                f = ((this.layoutHeight - AndroidUtilities.dp((this.pinnedBottom || this.pinnedTop) ? 7.5f : 6.5f)) - this.timeLayout.getHeight()) + timeYOffset;
            }
            reactionsLayoutInBubble3.y = (int) f;
            this.reactionsLayoutInBubble.y = (int) (reactionsLayoutInBubble.y + ((this.timeLayout.getHeight() / 2.0f) - AndroidUtilities.dp(7.0f)));
            this.reactionsLayoutInBubble.x = this.timeX;
        }
    }

    /* JADX WARN: Removed duplicated region for block: B:255:0x087d  */
    /* JADX WARN: Type inference failed for: r11v1, types: [boolean, int] */
    /* JADX WARN: Type inference failed for: r11v43 */
    /* JADX WARN: Type inference failed for: r11v52 */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    public void drawLinkPreview(Canvas canvas, float alpha) {
        int linkX;
        int startY;
        int i;
        ?? r11;
        int smallImageStartY;
        Drawable instantDrawable;
        int y;
        int x;
        int i2;
        boolean z;
        boolean z2;
        int i3;
        int x2;
        if (!this.currentMessageObject.isSponsored() && !this.hasLinkPreview && !this.hasGamePreview && !this.hasInvoicePreview) {
            return;
        }
        if (this.hasGamePreview) {
            startY = AndroidUtilities.dp(14.0f) + this.namesOffset;
            linkX = this.unmovedTextX - AndroidUtilities.dp(10.0f);
        } else if (this.hasInvoicePreview) {
            startY = AndroidUtilities.dp(14.0f) + this.namesOffset;
            linkX = this.unmovedTextX + AndroidUtilities.dp(1.0f);
        } else if (this.currentMessageObject.isSponsored()) {
            int startY2 = (this.textY + this.currentMessageObject.textHeight) - AndroidUtilities.dp(2.0f);
            if (this.hasNewLineForTime) {
                startY2 += AndroidUtilities.dp(16.0f);
            }
            startY = startY2;
            linkX = this.unmovedTextX + AndroidUtilities.dp(1.0f);
        } else {
            startY = this.textY + this.currentMessageObject.textHeight + AndroidUtilities.dp(8.0f);
            linkX = this.unmovedTextX + AndroidUtilities.dp(1.0f);
        }
        int linkPreviewY = startY;
        int smallImageStartY2 = 0;
        if (!this.hasInvoicePreview && !this.currentMessageObject.isSponsored()) {
            Theme.chat_replyLinePaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outPreviewLine : Theme.key_chat_inPreviewLine));
            if (alpha != 1.0f) {
                Theme.chat_replyLinePaint.setAlpha((int) (Theme.chat_replyLinePaint.getAlpha() * alpha));
            }
            canvas.drawRect(linkX, linkPreviewY - AndroidUtilities.dp(3.0f), AndroidUtilities.dp(2.0f) + linkX, this.linkPreviewHeight + linkPreviewY + AndroidUtilities.dp(3.0f), Theme.chat_replyLinePaint);
        }
        if (this.siteNameLayout != null) {
            smallImageStartY2 = linkPreviewY - AndroidUtilities.dp(1.0f);
            Theme.chat_replyNamePaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outSiteNameText : Theme.key_chat_inSiteNameText));
            if (alpha != 1.0f) {
                Theme.chat_replyNamePaint.setAlpha((int) (Theme.chat_replyLinePaint.getAlpha() * alpha));
            }
            canvas.save();
            if (this.siteNameRtl) {
                x2 = (this.backgroundWidth - this.siteNameWidth) - AndroidUtilities.dp(32.0f);
                if (this.isSmallImage) {
                    x2 -= AndroidUtilities.dp(54.0f);
                }
            } else {
                x2 = this.hasInvoicePreview ? 0 : AndroidUtilities.dp(10.0f);
            }
            canvas.translate(linkX + x2, linkPreviewY - AndroidUtilities.dp(3.0f));
            this.siteNameLayout.draw(canvas);
            canvas.restore();
            StaticLayout staticLayout = this.siteNameLayout;
            linkPreviewY += staticLayout.getLineBottom(staticLayout.getLineCount() - 1);
        }
        if ((this.hasGamePreview || this.hasInvoicePreview) && this.currentMessageObject.textHeight != 0) {
            startY += this.currentMessageObject.textHeight + AndroidUtilities.dp(4.0f);
            linkPreviewY += this.currentMessageObject.textHeight + AndroidUtilities.dp(4.0f);
        }
        if ((!this.drawPhotoImage || !this.drawInstantView || (i3 = this.drawInstantViewType) == 9 || i3 == 13 || i3 == 11 || i3 == 1) && (this.drawInstantViewType != 6 || this.imageBackgroundColor == 0)) {
            r11 = 1;
            i = 11;
        } else {
            if (linkPreviewY != startY) {
                linkPreviewY += AndroidUtilities.dp(2.0f);
            }
            if (this.imageBackgroundSideColor == 0) {
                this.photoImage.setImageCoords(AndroidUtilities.dp(10.0f) + linkX, linkPreviewY, this.photoImage.getImageWidth(), this.photoImage.getImageHeight());
            } else {
                int x3 = AndroidUtilities.dp(10.0f) + linkX;
                ImageReceiver imageReceiver = this.photoImage;
                imageReceiver.setImageCoords(x3 + ((this.imageBackgroundSideWidth - imageReceiver.getImageWidth()) / 2.0f), linkPreviewY, this.photoImage.getImageWidth(), this.photoImage.getImageHeight());
                this.rect.set(x3, this.photoImage.getImageY(), this.imageBackgroundSideWidth + x3, this.photoImage.getImageY2());
                Theme.chat_instantViewPaint.setColor(ColorUtils.setAlphaComponent(this.imageBackgroundSideColor, (int) (alpha * 255.0f)));
                canvas.drawRoundRect(this.rect, AndroidUtilities.dp(4.0f), AndroidUtilities.dp(4.0f), Theme.chat_instantViewPaint);
            }
            if (this.imageBackgroundColor != 0) {
                this.rect.set(this.photoImage.getImageX(), this.photoImage.getImageY(), this.photoImage.getImageX2(), this.photoImage.getImageY2());
                if (this.imageBackgroundGradientColor1 != 0) {
                    if (this.imageBackgroundGradientColor2 != 0) {
                        if (this.motionBackgroundDrawable == null) {
                            MotionBackgroundDrawable motionBackgroundDrawable = new MotionBackgroundDrawable(this.imageBackgroundColor, this.imageBackgroundGradientColor1, this.imageBackgroundGradientColor2, this.imageBackgroundGradientColor3, true);
                            this.motionBackgroundDrawable = motionBackgroundDrawable;
                            if (this.imageBackgroundIntensity < 0.0f) {
                                this.photoImage.setGradientBitmap(motionBackgroundDrawable.getBitmap());
                            }
                            if (!this.photoImage.hasImageSet()) {
                                this.motionBackgroundDrawable.setRoundRadius(AndroidUtilities.dp(4.0f));
                            }
                        }
                    } else {
                        if (this.gradientShader == null) {
                            Rect r = BackgroundGradientDrawable.getGradientPoints(AndroidUtilities.getWallpaperRotation(this.imageBackgroundGradientRotation, false), (int) this.rect.width(), (int) this.rect.height());
                            this.gradientShader = new LinearGradient(r.left, r.top, r.right, r.bottom, new int[]{this.imageBackgroundColor, this.imageBackgroundGradientColor1}, (float[]) null, Shader.TileMode.CLAMP);
                        }
                        Theme.chat_instantViewPaint.setShader(this.gradientShader);
                        if (alpha != 1.0f) {
                            Theme.chat_instantViewPaint.setAlpha((int) (alpha * 255.0f));
                        }
                    }
                } else {
                    Theme.chat_instantViewPaint.setShader(null);
                    Theme.chat_instantViewPaint.setColor(this.imageBackgroundColor);
                    if (alpha != 1.0f) {
                        Theme.chat_instantViewPaint.setAlpha((int) (alpha * 255.0f));
                    }
                }
                MotionBackgroundDrawable motionBackgroundDrawable2 = this.motionBackgroundDrawable;
                if (motionBackgroundDrawable2 != null) {
                    motionBackgroundDrawable2.setBounds((int) this.rect.left, (int) this.rect.top, (int) this.rect.right, (int) this.rect.bottom);
                    this.motionBackgroundDrawable.draw(canvas);
                    z2 = true;
                    i = 11;
                } else if (this.imageBackgroundSideColor != 0) {
                    i = 11;
                    z2 = true;
                    canvas.drawRect(this.photoImage.getImageX(), this.photoImage.getImageY(), this.photoImage.getImageX2(), this.photoImage.getImageY2(), Theme.chat_instantViewPaint);
                } else {
                    z2 = true;
                    i = 11;
                    canvas.drawRoundRect(this.rect, AndroidUtilities.dp(4.0f), AndroidUtilities.dp(4.0f), Theme.chat_instantViewPaint);
                }
                Theme.chat_instantViewPaint.setShader(null);
                Theme.chat_instantViewPaint.setAlpha(255);
                z = z2;
            } else {
                z = true;
                i = 11;
            }
            if (this.drawPhotoImage && this.drawInstantView && this.drawInstantViewType != 9) {
                if (this.drawImageButton) {
                    int size = AndroidUtilities.dp(48.0f);
                    int imageX = (int) (this.photoImage.getImageX() + ((this.photoImage.getImageWidth() - size) / 2.0f));
                    this.buttonX = imageX;
                    this.buttonX = imageX;
                    int imageY = (int) (this.photoImage.getImageY() + ((this.photoImage.getImageHeight() - size) / 2.0f));
                    this.buttonY = imageY;
                    this.buttonY = imageY;
                    RadialProgress2 radialProgress2 = this.radialProgress;
                    int i4 = this.buttonX;
                    radialProgress2.setProgressRect(i4, imageY, i4 + size, imageY + size);
                }
                ChatMessageCellDelegate chatMessageCellDelegate = this.delegate;
                if (chatMessageCellDelegate == null || chatMessageCellDelegate.getPinchToZoomHelper() == null || !this.delegate.getPinchToZoomHelper().isInOverlayModeFor(this)) {
                    if (alpha == 1.0f) {
                        this.imageDrawn = this.photoImage.draw(canvas);
                    } else {
                        this.photoImage.setAlpha(alpha);
                        this.imageDrawn = this.photoImage.draw(canvas);
                        this.photoImage.setAlpha(1.0f);
                    }
                }
            }
            linkPreviewY = (int) (linkPreviewY + this.photoImage.getImageHeight() + AndroidUtilities.dp(6.0f));
            r11 = z;
        }
        if (this.currentMessageObject.isOutOwner()) {
            Theme.chat_replyNamePaint.setColor(ColorUtils.setAlphaComponent(getThemedColor(Theme.key_chat_messageTextOut), (int) (alpha * 255.0f)));
            Theme.chat_replyTextPaint.setColor(ColorUtils.setAlphaComponent(getThemedColor(Theme.key_chat_messageTextOut), (int) (alpha * 255.0f)));
        } else {
            Theme.chat_replyNamePaint.setColor(ColorUtils.setAlphaComponent(getThemedColor(Theme.key_chat_messageTextIn), (int) (alpha * 255.0f)));
            Theme.chat_replyTextPaint.setColor(ColorUtils.setAlphaComponent(getThemedColor(Theme.key_chat_messageTextIn), (int) (alpha * 255.0f)));
        }
        if (this.titleLayout != null) {
            if (linkPreviewY != startY) {
                linkPreviewY += AndroidUtilities.dp(2.0f);
            }
            if (smallImageStartY2 == 0) {
                smallImageStartY2 = linkPreviewY - AndroidUtilities.dp(1.0f);
            }
            canvas.save();
            canvas.translate(AndroidUtilities.dp(10.0f) + linkX + this.titleX, linkPreviewY - AndroidUtilities.dp(3.0f));
            this.titleLayout.draw(canvas);
            canvas.restore();
            StaticLayout staticLayout2 = this.titleLayout;
            linkPreviewY += staticLayout2.getLineBottom(staticLayout2.getLineCount() - r11);
        }
        if (this.authorLayout != null) {
            if (linkPreviewY != startY) {
                linkPreviewY += AndroidUtilities.dp(2.0f);
            }
            if (smallImageStartY2 == 0) {
                smallImageStartY2 = linkPreviewY - AndroidUtilities.dp(1.0f);
            }
            canvas.save();
            canvas.translate(AndroidUtilities.dp(10.0f) + linkX + this.authorX, linkPreviewY - AndroidUtilities.dp(3.0f));
            this.authorLayout.draw(canvas);
            canvas.restore();
            StaticLayout staticLayout3 = this.authorLayout;
            linkPreviewY += staticLayout3.getLineBottom(staticLayout3.getLineCount() - r11);
        }
        if (this.descriptionLayout == null) {
            smallImageStartY = smallImageStartY2;
        } else {
            if (linkPreviewY != startY) {
                linkPreviewY += AndroidUtilities.dp(2.0f);
            }
            if (smallImageStartY2 == 0) {
                smallImageStartY2 = linkPreviewY - AndroidUtilities.dp(1.0f);
            }
            this.descriptionY = linkPreviewY - AndroidUtilities.dp(3.0f);
            canvas.save();
            canvas.translate((this.hasInvoicePreview ? 0 : AndroidUtilities.dp(10.0f)) + linkX + this.descriptionX, this.descriptionY);
            if (this.linkBlockNum == -10 && this.links.draw(canvas)) {
                invalidate();
            }
            ChatMessageCellDelegate chatMessageCellDelegate2 = this.delegate;
            if (chatMessageCellDelegate2 != null && chatMessageCellDelegate2.getTextSelectionHelper() != null && getDelegate().getTextSelectionHelper().isSelected(this.currentMessageObject)) {
                this.delegate.getTextSelectionHelper().drawDescription(this.currentMessageObject.isOutOwner(), this.descriptionLayout, canvas);
            }
            this.descriptionLayout.draw(canvas);
            canvas.restore();
            StaticLayout staticLayout4 = this.descriptionLayout;
            int lineCount = staticLayout4.getLineCount();
            int i5 = r11 == true ? 1 : 0;
            int i6 = r11 == true ? 1 : 0;
            int i7 = r11 == true ? 1 : 0;
            int i8 = r11 == true ? 1 : 0;
            int i9 = r11 == true ? 1 : 0;
            int i10 = r11 == true ? 1 : 0;
            int i11 = r11 == true ? 1 : 0;
            linkPreviewY += staticLayout4.getLineBottom(lineCount - i5);
            smallImageStartY = smallImageStartY2;
        }
        if (this.drawPhotoImage && (!this.drawInstantView || (i2 = this.drawInstantViewType) == 9 || i2 == i || i2 == 13 || i2 == r11)) {
            if (linkPreviewY != startY) {
                linkPreviewY += AndroidUtilities.dp(2.0f);
            }
            if (this.isSmallImage) {
                this.photoImage.setImageCoords((this.backgroundWidth + linkX) - AndroidUtilities.dp(81.0f), smallImageStartY, this.photoImage.getImageWidth(), this.photoImage.getImageHeight());
            } else {
                this.photoImage.setImageCoords((this.hasInvoicePreview ? -AndroidUtilities.dp(6.3f) : AndroidUtilities.dp(10.0f)) + linkX, linkPreviewY, this.photoImage.getImageWidth(), this.photoImage.getImageHeight());
                if (this.drawImageButton) {
                    int size2 = AndroidUtilities.dp(48.0f);
                    int imageX2 = (int) (this.photoImage.getImageX() + ((this.photoImage.getImageWidth() - size2) / 2.0f));
                    this.buttonX = imageX2;
                    this.buttonX = imageX2;
                    int imageY2 = (int) (this.photoImage.getImageY() + ((this.photoImage.getImageHeight() - size2) / 2.0f));
                    this.buttonY = imageY2;
                    this.buttonY = imageY2;
                    RadialProgress2 radialProgress22 = this.radialProgress;
                    int i12 = this.buttonX;
                    radialProgress22.setProgressRect(i12, imageY2, i12 + size2, imageY2 + size2);
                }
            }
            if (this.isRoundVideo && MediaController.getInstance().isPlayingMessage(this.currentMessageObject) && MediaController.getInstance().isVideoDrawingReady() && canvas.isHardwareAccelerated()) {
                this.imageDrawn = r11;
                this.drawTime = r11;
            } else {
                ChatMessageCellDelegate chatMessageCellDelegate3 = this.delegate;
                if (chatMessageCellDelegate3 == null || chatMessageCellDelegate3.getPinchToZoomHelper() == null || !this.delegate.getPinchToZoomHelper().isInOverlayModeFor(this)) {
                    if (alpha == 1.0f) {
                        this.imageDrawn = this.photoImage.draw(canvas);
                    } else {
                        this.photoImage.setAlpha(alpha);
                        this.imageDrawn = this.photoImage.draw(canvas);
                        this.photoImage.setAlpha(1.0f);
                    }
                }
            }
        }
        int i13 = this.documentAttachType;
        if (i13 == 4 || i13 == 2) {
            this.videoButtonX = (int) (this.photoImage.getImageX() + AndroidUtilities.dp(8.0f));
            int imageY3 = (int) (this.photoImage.getImageY() + AndroidUtilities.dp(8.0f));
            this.videoButtonY = imageY3;
            RadialProgress2 radialProgress23 = this.videoRadialProgress;
            int i14 = this.videoButtonX;
            radialProgress23.setProgressRect(i14, imageY3, AndroidUtilities.dp(24.0f) + i14, this.videoButtonY + AndroidUtilities.dp(24.0f));
        }
        Paint timeBackgroundPaint = getThemedPaint(Theme.key_paint_chatTimeBackground);
        if (this.photosCountLayout != null && this.photoImage.getVisible()) {
            int x4 = (int) (((this.photoImage.getImageX() + this.photoImage.getImageWidth()) - AndroidUtilities.dp(8.0f)) - this.photosCountWidth);
            int y2 = (int) ((this.photoImage.getImageY() + this.photoImage.getImageHeight()) - AndroidUtilities.dp(19.0f));
            int smallImageStartY3 = this.photosCountWidth;
            this.rect.set(x4 - AndroidUtilities.dp(4.0f), y2 - AndroidUtilities.dp(1.5f), smallImageStartY3 + x4 + AndroidUtilities.dp(4.0f), y2 + AndroidUtilities.dp(14.5f));
            int oldAlpha = timeBackgroundPaint.getAlpha();
            timeBackgroundPaint.setAlpha((int) (oldAlpha * this.controlsAlpha));
            Theme.chat_durationPaint.setAlpha((int) (this.controlsAlpha * 255.0f));
            canvas.drawRoundRect(this.rect, AndroidUtilities.dp(4.0f), AndroidUtilities.dp(4.0f), timeBackgroundPaint);
            timeBackgroundPaint.setAlpha(oldAlpha);
            canvas.save();
            canvas.translate(x4, y2);
            this.photosCountLayout.draw(canvas);
            canvas.restore();
            Theme.chat_durationPaint.setAlpha(255);
        }
        if (this.videoInfoLayout != null && ((!this.drawPhotoImage || this.photoImage.getVisible()) && this.imageBackgroundSideColor == 0)) {
            if (!this.hasGamePreview && !this.hasInvoicePreview) {
                if (this.documentAttachType != 8) {
                    x = (int) (((this.photoImage.getImageX() + this.photoImage.getImageWidth()) - AndroidUtilities.dp(8.0f)) - this.durationWidth);
                    y = (int) ((this.photoImage.getImageY() + this.photoImage.getImageHeight()) - AndroidUtilities.dp(19.0f));
                    this.rect.set(x - AndroidUtilities.dp(4.0f), y - AndroidUtilities.dp(1.5f), this.durationWidth + x + AndroidUtilities.dp(4.0f), AndroidUtilities.dp(14.5f) + y);
                    canvas.drawRoundRect(this.rect, AndroidUtilities.dp(4.0f), AndroidUtilities.dp(4.0f), getThemedPaint(Theme.key_paint_chatTimeBackground));
                    canvas.save();
                    canvas.translate(x, y);
                    if (this.hasInvoicePreview) {
                        if (this.drawPhotoImage) {
                            Theme.chat_shipmentPaint.setColor(getThemedColor(Theme.key_chat_previewGameText));
                        } else if (this.currentMessageObject.isOutOwner()) {
                            Theme.chat_shipmentPaint.setColor(getThemedColor(Theme.key_chat_messageTextOut));
                        } else {
                            Theme.chat_shipmentPaint.setColor(getThemedColor(Theme.key_chat_messageTextIn));
                        }
                    }
                    this.videoInfoLayout.draw(canvas);
                    canvas.restore();
                }
            }
            if (this.drawPhotoImage) {
                x = (int) (this.photoImage.getImageX() + AndroidUtilities.dp(8.5f));
                y = (int) (this.photoImage.getImageY() + AndroidUtilities.dp(6.0f));
                int height = AndroidUtilities.dp(this.documentAttachType == 8 ? 14.5f : 16.5f);
                this.rect.set(x - AndroidUtilities.dp(4.0f), y - AndroidUtilities.dp(1.5f), this.durationWidth + x + AndroidUtilities.dp(4.0f), y + height);
                canvas.drawRoundRect(this.rect, AndroidUtilities.dp(4.0f), AndroidUtilities.dp(4.0f), timeBackgroundPaint);
            } else {
                x = linkX;
                y = linkPreviewY;
            }
            canvas.save();
            canvas.translate(x, y);
            if (this.hasInvoicePreview) {
            }
            this.videoInfoLayout.draw(canvas);
            canvas.restore();
        }
        if (this.drawInstantView) {
            int instantY = this.linkPreviewHeight + startY + AndroidUtilities.dp(10.0f);
            Paint backPaint = Theme.chat_instantViewRectPaint;
            if (this.currentMessageObject.isOutOwner()) {
                instantDrawable = getThemedDrawable(Theme.key_drawable_msgOutInstant);
                Theme.chat_instantViewPaint.setColor(getThemedColor(Theme.key_chat_outPreviewInstantText));
                backPaint.setColor(getThemedColor(Theme.key_chat_outPreviewInstantText));
            } else {
                instantDrawable = Theme.chat_msgInInstantDrawable;
                Theme.chat_instantViewPaint.setColor(getThemedColor(Theme.key_chat_inPreviewInstantText));
                backPaint.setColor(getThemedColor(Theme.key_chat_inPreviewInstantText));
            }
            this.instantButtonRect.set(linkX, instantY, this.instantWidth + linkX, AndroidUtilities.dp(36.0f) + instantY);
            if (Build.VERSION.SDK_INT >= 21) {
                this.selectorDrawableMaskType[0] = 0;
                this.selectorDrawable[0].setBounds(linkX, instantY, this.instantWidth + linkX, AndroidUtilities.dp(36.0f) + instantY);
                this.selectorDrawable[0].draw(canvas);
            }
            canvas.drawRoundRect(this.instantButtonRect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), backPaint);
            if (this.drawInstantViewType == 0) {
                setDrawableBounds(instantDrawable, ((this.instantTextLeftX + this.instantTextX) + linkX) - AndroidUtilities.dp(15.0f), AndroidUtilities.dp(11.5f) + instantY, AndroidUtilities.dp(9.0f), AndroidUtilities.dp(13.0f));
                instantDrawable.draw(canvas);
            }
            if (this.instantViewLayout != null) {
                canvas.save();
                canvas.translate(this.instantTextX + linkX, AndroidUtilities.dp(10.5f) + instantY);
                this.instantViewLayout.draw(canvas);
                canvas.restore();
            }
        }
    }

    public boolean shouldDrawMenuDrawable() {
        return this.currentMessagesGroup == null || (this.currentPosition.flags & 4) != 0;
    }

    private void drawBotButtons(Canvas canvas, ArrayList<BotButton> botButtons, float alpha) {
        int addX;
        int a;
        float y;
        BotButton button;
        Drawable drawable;
        ChatMessageCell chatMessageCell = this;
        if (chatMessageCell.currentMessageObject.isOutOwner()) {
            addX = (getMeasuredWidth() - chatMessageCell.widthForButtons) - AndroidUtilities.dp(10.0f);
        } else {
            addX = chatMessageCell.backgroundDrawableLeft + AndroidUtilities.dp((chatMessageCell.mediaBackground || chatMessageCell.drawPinnedBottom) ? 1.0f : 7.0f);
        }
        float f = 2.0f;
        float top = (chatMessageCell.layoutHeight - AndroidUtilities.dp(2.0f)) + chatMessageCell.transitionParams.deltaBottom;
        float height = 0.0f;
        for (int a2 = 0; a2 < botButtons.size(); a2++) {
            BotButton button2 = botButtons.get(a2);
            int bottom = button2.y + button2.height;
            if (bottom > height) {
                height = bottom;
            }
        }
        float f2 = 0.0f;
        chatMessageCell.rect.set(0.0f, top, getMeasuredWidth(), top + height);
        int a3 = 1132396544;
        if (alpha != 1.0f) {
            canvas.saveLayerAlpha(chatMessageCell.rect, (int) (alpha * 255.0f), 31);
        } else {
            canvas.save();
        }
        int a4 = 0;
        while (a4 < botButtons.size()) {
            BotButton button3 = botButtons.get(a4);
            float y2 = ((button3.y + chatMessageCell.layoutHeight) - AndroidUtilities.dp(f)) + chatMessageCell.transitionParams.deltaBottom;
            chatMessageCell.rect.set(button3.x + addX, y2, button3.x + addX + button3.width, button3.height + y2);
            applyServiceShaderMatrix();
            canvas.drawRoundRect(chatMessageCell.rect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), chatMessageCell.getThemedPaint(a4 == chatMessageCell.pressedBotButton ? Theme.key_paint_chatActionBackgroundSelected : Theme.key_paint_chatActionBackground));
            if (hasGradientService()) {
                canvas.drawRoundRect(chatMessageCell.rect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), Theme.chat_actionBackgroundGradientDarkenPaint);
            }
            canvas.save();
            boolean z = true;
            canvas.translate(button3.x + addX + AndroidUtilities.dp(5.0f), ((AndroidUtilities.dp(44.0f) - button3.title.getLineBottom(button3.title.getLineCount() - 1)) / 2) + y2);
            button3.title.draw(canvas);
            canvas.restore();
            if (!(button3.button instanceof TLRPC.TL_keyboardButtonWebView)) {
                if (button3.button instanceof TLRPC.TL_keyboardButtonUrl) {
                    if (button3.isInviteButton) {
                        drawable = chatMessageCell.getThemedDrawable(Theme.key_drawable_botInvite);
                    } else {
                        drawable = chatMessageCell.getThemedDrawable(Theme.key_drawable_botLink);
                    }
                    setDrawableBounds(drawable, (((button3.x + button3.width) - AndroidUtilities.dp(3.0f)) - drawable.getIntrinsicWidth()) + addX, AndroidUtilities.dp(3.0f) + y2);
                    drawable.draw(canvas);
                    a = a4;
                } else {
                    if (!(button3.button instanceof TLRPC.TL_keyboardButtonSwitchInline)) {
                        if ((button3.button instanceof TLRPC.TL_keyboardButtonCallback) || (button3.button instanceof TLRPC.TL_keyboardButtonRequestGeoLocation) || (button3.button instanceof TLRPC.TL_keyboardButtonGame) || (button3.button instanceof TLRPC.TL_keyboardButtonBuy) || (button3.button instanceof TLRPC.TL_keyboardButtonUrlAuth)) {
                            if (button3.button instanceof TLRPC.TL_keyboardButtonBuy) {
                                setDrawableBounds(Theme.chat_botCardDrawable, (((button3.x + button3.width) - AndroidUtilities.dp(5.0f)) - Theme.chat_botCardDrawable.getIntrinsicWidth()) + addX, AndroidUtilities.dp(4.0f) + y2);
                                Theme.chat_botCardDrawable.draw(canvas);
                            }
                            if (((!(button3.button instanceof TLRPC.TL_keyboardButtonCallback) && !(button3.button instanceof TLRPC.TL_keyboardButtonGame) && !(button3.button instanceof TLRPC.TL_keyboardButtonBuy) && !(button3.button instanceof TLRPC.TL_keyboardButtonUrlAuth)) || !SendMessagesHelper.getInstance(chatMessageCell.currentAccount).isSendingCallback(chatMessageCell.currentMessageObject, button3.button)) && (!(button3.button instanceof TLRPC.TL_keyboardButtonRequestGeoLocation) || !SendMessagesHelper.getInstance(chatMessageCell.currentAccount).isSendingCurrentLocation(chatMessageCell.currentMessageObject, button3.button))) {
                                z = false;
                            }
                            boolean drawProgress = z;
                            if (drawProgress || button3.progressAlpha != f2) {
                                Theme.chat_botProgressPaint.setAlpha(Math.min(255, (int) (button3.progressAlpha * a3)));
                                int x = ((button3.x + button3.width) - AndroidUtilities.dp(12.0f)) + addX;
                                if (!(button3.button instanceof TLRPC.TL_keyboardButtonBuy)) {
                                    y = y2;
                                } else {
                                    y = y2 + AndroidUtilities.dp(26.0f);
                                }
                                chatMessageCell.rect.set(x, y + AndroidUtilities.dp(4.0f), x + AndroidUtilities.dp(8.0f), y + AndroidUtilities.dp(12.0f));
                                a = a4;
                                canvas.drawArc(chatMessageCell.rect, button3.angle, 220.0f, false, Theme.chat_botProgressPaint);
                                invalidate();
                                long newTime = System.currentTimeMillis();
                                if (Math.abs(button3.lastUpdateTime - System.currentTimeMillis()) < 1000) {
                                    long delta = newTime - button3.lastUpdateTime;
                                    float dt = ((float) (360 * delta)) / 2000.0f;
                                    button = button3;
                                    BotButton.access$2816(button, dt);
                                    BotButton.access$2820(button, (button.angle / 360) * 360);
                                    if (drawProgress) {
                                        if (button.progressAlpha < 1.0f) {
                                            BotButton.access$2716(button, ((float) delta) / 200.0f);
                                            if (button.progressAlpha > 1.0f) {
                                                button.progressAlpha = 1.0f;
                                            }
                                        }
                                    } else if (button.progressAlpha > 0.0f) {
                                        BotButton.access$2724(button, ((float) delta) / 200.0f);
                                        if (button.progressAlpha < 0.0f) {
                                            button.progressAlpha = 0.0f;
                                        }
                                    }
                                } else {
                                    button = button3;
                                }
                                button.lastUpdateTime = newTime;
                            } else {
                                a = a4;
                            }
                        }
                    } else {
                        Drawable drawable2 = chatMessageCell.getThemedDrawable(Theme.key_drawable_botInline);
                        setDrawableBounds(drawable2, (((button3.x + button3.width) - AndroidUtilities.dp(3.0f)) - drawable2.getIntrinsicWidth()) + addX, AndroidUtilities.dp(3.0f) + y2);
                        drawable2.draw(canvas);
                    }
                    a = a4;
                }
            } else {
                Drawable drawable3 = chatMessageCell.getThemedDrawable(Theme.key_drawable_botWebView);
                setDrawableBounds(drawable3, (((button3.x + button3.width) - AndroidUtilities.dp(3.0f)) - drawable3.getIntrinsicWidth()) + addX, AndroidUtilities.dp(3.0f) + y2);
                drawable3.draw(canvas);
                a = a4;
            }
            a4 = a + 1;
            f = 2.0f;
            f2 = 0.0f;
            a3 = 1132396544;
            chatMessageCell = this;
        }
        canvas.restore();
    }

    public void drawMessageText(Canvas canvas, ArrayList<MessageObject.TextLayoutBlock> textLayoutBlocks, boolean origin, float alpha, boolean drawOnlyText) {
        int firstVisibleBlockNum;
        int lastVisibleBlockNum;
        float textY;
        boolean needRestoreColor;
        int oldAlpha;
        int restore;
        int oldLinkAlpha;
        int oldLinkAlpha2;
        int oldLinkAlpha3;
        int a;
        int lastVisibleBlockNum2;
        Exception e;
        if (textLayoutBlocks == null || textLayoutBlocks.isEmpty() || alpha == 0.0f) {
            return;
        }
        if (origin) {
            if (this.fullyDraw) {
                this.firstVisibleBlockNum = 0;
                this.lastVisibleBlockNum = textLayoutBlocks.size();
            }
            firstVisibleBlockNum = this.firstVisibleBlockNum;
            lastVisibleBlockNum = this.lastVisibleBlockNum;
        } else {
            firstVisibleBlockNum = 0;
            lastVisibleBlockNum = textLayoutBlocks.size();
        }
        float textY2 = this.textY;
        if (this.transitionParams.animateText) {
            float textY3 = (this.transitionParams.animateFromTextY * (1.0f - this.transitionParams.animateChangeProgress)) + (this.textY * this.transitionParams.animateChangeProgress);
            textY = textY3;
        } else {
            textY = textY2;
        }
        if (firstVisibleBlockNum >= 0) {
            if (alpha == 1.0f) {
                restore = Integer.MIN_VALUE;
                oldAlpha = 0;
                oldLinkAlpha = 0;
                needRestoreColor = false;
            } else if (drawOnlyText) {
                int oldAlpha2 = Theme.chat_msgTextPaint.getAlpha();
                int oldLinkAlpha4 = Color.alpha(Theme.chat_msgTextPaint.linkColor);
                Theme.chat_msgTextPaint.setAlpha((int) (oldAlpha2 * alpha));
                Theme.chat_msgTextPaint.linkColor = ColorUtils.setAlphaComponent(Theme.chat_msgTextPaint.linkColor, (int) (oldLinkAlpha4 * alpha));
                restore = Integer.MIN_VALUE;
                oldAlpha = oldAlpha2;
                oldLinkAlpha = oldLinkAlpha4;
                needRestoreColor = true;
            } else {
                Theme.MessageDrawable messageDrawable = this.currentBackgroundDrawable;
                if (messageDrawable != null) {
                    int top = messageDrawable.getBounds().top;
                    int bottom = this.currentBackgroundDrawable.getBounds().bottom;
                    if (getY() < 0.0f) {
                        top = (int) (-getY());
                    }
                    float y = getY() + getMeasuredHeight();
                    int i = this.parentHeight;
                    if (y > i) {
                        bottom = (int) (i - getY());
                    }
                    this.rect.set(getCurrentBackgroundLeft(), top, this.currentBackgroundDrawable.getBounds().right, bottom);
                } else {
                    this.rect.set(0.0f, 0.0f, getMeasuredWidth(), getMeasuredHeight());
                }
                restore = canvas.saveLayerAlpha(this.rect, (int) (255.0f * alpha), 31);
                oldAlpha = 0;
                oldLinkAlpha = 0;
                needRestoreColor = false;
            }
            int spoilersColor = (!this.currentMessageObject.isOut() || ChatObject.isChannelAndNotMegaGroup(this.currentMessageObject.getChatId(), this.currentAccount)) ? Theme.chat_msgTextPaint.getColor() : getThemedColor(Theme.key_chat_outTimeText);
            int a2 = firstVisibleBlockNum;
            while (true) {
                if (a2 > lastVisibleBlockNum) {
                    oldLinkAlpha2 = oldLinkAlpha;
                    break;
                } else if (a2 >= textLayoutBlocks.size()) {
                    oldLinkAlpha2 = oldLinkAlpha;
                    break;
                } else {
                    MessageObject.TextLayoutBlock block = textLayoutBlocks.get(a2);
                    canvas.save();
                    canvas.translate(this.textX - (block.isRtl() ? (int) Math.ceil(this.currentMessageObject.textXOffset) : 0), textY + block.textYOffset + this.transitionYOffsetForDrawables);
                    if (a2 == this.linkBlockNum && !drawOnlyText && this.links.draw(canvas)) {
                        invalidate();
                    }
                    if (a2 == this.linkSelectionBlockNum && !this.urlPathSelection.isEmpty() && !drawOnlyText) {
                        for (int b = 0; b < this.urlPathSelection.size(); b++) {
                            canvas.drawPath(this.urlPathSelection.get(b), Theme.chat_textSearchSelectionPaint);
                        }
                    }
                    if (this.delegate.getTextSelectionHelper() != null && this.transitionParams.animateChangeProgress == 1.0f && !drawOnlyText) {
                        this.delegate.getTextSelectionHelper().draw(this.currentMessageObject, block, canvas);
                    }
                    try {
                        Emoji.emojiDrawingYOffset = -this.transitionYOffsetForDrawables;
                        a = a2;
                        oldLinkAlpha3 = oldLinkAlpha;
                        lastVisibleBlockNum2 = lastVisibleBlockNum;
                        try {
                            SpoilerEffect.renderWithRipple(this, this.invalidateSpoilersParent, spoilersColor, 0, block.spoilersPatchedTextLayout, block.textLayout, block.spoilers, canvas, false);
                        } catch (Exception e2) {
                            e = e2;
                        }
                    } catch (Exception e3) {
                        e = e3;
                        a = a2;
                        oldLinkAlpha3 = oldLinkAlpha;
                        lastVisibleBlockNum2 = lastVisibleBlockNum;
                    }
                    try {
                        Emoji.emojiDrawingYOffset = 0.0f;
                    } catch (Exception e4) {
                        e = e4;
                        FileLog.e(e);
                        canvas.restore();
                        a2 = a + 1;
                        lastVisibleBlockNum = lastVisibleBlockNum2;
                        oldLinkAlpha = oldLinkAlpha3;
                    }
                    canvas.restore();
                    a2 = a + 1;
                    lastVisibleBlockNum = lastVisibleBlockNum2;
                    oldLinkAlpha = oldLinkAlpha3;
                }
            }
            if (needRestoreColor) {
                Theme.chat_msgTextPaint.setAlpha(oldAlpha);
                Theme.chat_msgTextPaint.linkColor = ColorUtils.setAlphaComponent(Theme.chat_msgTextPaint.linkColor, oldLinkAlpha2);
            }
            if (restore != Integer.MIN_VALUE) {
                canvas.restoreToCount(restore);
            }
        }
    }

    public void updateCaptionLayout() {
        float h;
        float y;
        float x;
        if (this.currentMessageObject.type == 1 || this.documentAttachType == 4 || this.currentMessageObject.type == 8) {
            if (this.transitionParams.imageChangeBoundsTransition) {
                x = this.transitionParams.animateToImageX;
                y = this.transitionParams.animateToImageY;
                h = this.transitionParams.animateToImageH;
            } else {
                x = this.photoImage.getImageX();
                y = this.photoImage.getImageY();
                h = this.photoImage.getImageHeight();
            }
            this.captionX = AndroidUtilities.dp(5.0f) + x + this.captionOffsetX;
            this.captionY = y + h + AndroidUtilities.dp(6.0f);
        } else {
            float f = 41.3f;
            float f2 = 9.0f;
            float f3 = 11.0f;
            if (this.hasOldCaptionPreview) {
                int i = this.backgroundDrawableLeft;
                if (!this.currentMessageObject.isOutOwner()) {
                    f3 = 17.0f;
                }
                this.captionX = i + AndroidUtilities.dp(f3) + this.captionOffsetX;
                int i2 = this.totalHeight - this.captionHeight;
                if (!this.drawPinnedTop) {
                    f2 = 10.0f;
                }
                float dp = ((i2 - AndroidUtilities.dp(f2)) - this.linkPreviewHeight) - AndroidUtilities.dp(17.0f);
                this.captionY = dp;
                if (this.drawCommentButton && this.drawSideButton != 3) {
                    if (!shouldDrawTimeOnMedia()) {
                        f = 43.0f;
                    }
                    this.captionY = dp - AndroidUtilities.dp(f);
                }
            } else {
                int i3 = this.backgroundDrawableLeft;
                if (!this.currentMessageObject.isOutOwner() && !this.mediaBackground && !this.drawPinnedBottom) {
                    f3 = 17.0f;
                }
                this.captionX = i3 + AndroidUtilities.dp(f3) + this.captionOffsetX;
                int i4 = this.totalHeight - this.captionHeight;
                if (!this.drawPinnedTop) {
                    f2 = 10.0f;
                }
                float dp2 = i4 - AndroidUtilities.dp(f2);
                this.captionY = dp2;
                if (this.drawCommentButton && this.drawSideButton != 3) {
                    if (!shouldDrawTimeOnMedia()) {
                        f = 43.0f;
                    }
                    this.captionY = dp2 - AndroidUtilities.dp(f);
                }
                if (!this.reactionsLayoutInBubble.isEmpty && !this.reactionsLayoutInBubble.isSmall) {
                    this.captionY -= this.reactionsLayoutInBubble.totalHeight;
                }
            }
        }
        this.captionX += getExtraTextX();
    }

    private boolean textIsSelectionMode() {
        return getCurrentMessagesGroup() == null && this.delegate.getTextSelectionHelper() != null && this.delegate.getTextSelectionHelper().isSelected(this.currentMessageObject);
    }

    public float getViewTop() {
        return this.viewTop;
    }

    public int getBackgroundHeight() {
        return this.backgroundHeight;
    }

    public int getMiniIconForCurrentState() {
        int i = this.miniButtonState;
        if (i < 0) {
            return 4;
        }
        if (i == 0) {
            return 2;
        }
        return 3;
    }

    public int getIconForCurrentState() {
        int i = this.documentAttachType;
        if (i != 3 && i != 5) {
            if (i == 1 && !this.drawPhotoImage) {
                if (this.currentMessageObject.isOutOwner()) {
                    this.radialProgress.setColors(Theme.key_chat_outLoader, Theme.key_chat_outLoaderSelected, Theme.key_chat_outMediaIcon, Theme.key_chat_outMediaIconSelected);
                } else {
                    this.radialProgress.setColors(Theme.key_chat_inLoader, Theme.key_chat_inLoaderSelected, Theme.key_chat_inMediaIcon, Theme.key_chat_inMediaIconSelected);
                }
                int i2 = this.buttonState;
                if (i2 == -1) {
                    return 5;
                }
                if (i2 == 0) {
                    return 2;
                }
                if (i2 == 1) {
                    return 3;
                }
            } else {
                this.radialProgress.setColors(Theme.key_chat_mediaLoaderPhoto, Theme.key_chat_mediaLoaderPhotoSelected, Theme.key_chat_mediaLoaderPhotoIcon, Theme.key_chat_mediaLoaderPhotoIconSelected);
                this.videoRadialProgress.setColors(Theme.key_chat_mediaLoaderPhoto, Theme.key_chat_mediaLoaderPhotoSelected, Theme.key_chat_mediaLoaderPhotoIcon, Theme.key_chat_mediaLoaderPhotoIconSelected);
                int i3 = this.buttonState;
                if (i3 >= 0 && i3 < 4) {
                    if (i3 == 0) {
                        return 2;
                    }
                    if (i3 == 1) {
                        return 3;
                    }
                    return (i3 != 2 && this.autoPlayingMedia) ? 4 : 0;
                } else if (i3 == -1) {
                    if (this.documentAttachType == 1) {
                        return (!this.drawPhotoImage || (this.currentPhotoObject == null && this.currentPhotoObjectThumb == null) || (!this.photoImage.hasBitmapImage() && !this.currentMessageObject.mediaExists && !this.currentMessageObject.attachPathExists)) ? 5 : 4;
                    } else if (this.currentMessageObject.needDrawBluredPreview()) {
                        if (this.currentMessageObject.messageOwner.destroyTime != 0) {
                            if (this.currentMessageObject.isOutOwner()) {
                                return 9;
                            }
                            return 11;
                        }
                        return 7;
                    } else if (this.hasEmbed) {
                        return 0;
                    }
                }
            }
            return 4;
        }
        if (this.currentMessageObject.isOutOwner()) {
            this.radialProgress.setColors(Theme.key_chat_outLoader, Theme.key_chat_outLoaderSelected, Theme.key_chat_outMediaIcon, Theme.key_chat_outMediaIconSelected);
        } else {
            this.radialProgress.setColors(Theme.key_chat_inLoader, Theme.key_chat_inLoaderSelected, Theme.key_chat_inMediaIcon, Theme.key_chat_inMediaIconSelected);
        }
        int i4 = this.buttonState;
        if (i4 == 1) {
            return 1;
        }
        if (i4 == 2) {
            return 2;
        }
        return i4 == 4 ? 3 : 0;
    }

    private int getMaxNameWidth() {
        int maxWidth;
        int dWidth;
        int i = this.documentAttachType;
        if (i == 6 || i == 8 || this.currentMessageObject.type == 5) {
            if (AndroidUtilities.isTablet()) {
                if (this.isChat && !this.isThreadPost && !this.currentMessageObject.isOutOwner() && this.currentMessageObject.needDrawAvatar()) {
                    maxWidth = AndroidUtilities.getMinTabletSide() - AndroidUtilities.dp(42.0f);
                } else {
                    maxWidth = AndroidUtilities.getMinTabletSide();
                }
            } else if (this.isChat && !this.isThreadPost && !this.currentMessageObject.isOutOwner() && this.currentMessageObject.needDrawAvatar()) {
                maxWidth = Math.min(getParentWidth(), AndroidUtilities.displaySize.y) - AndroidUtilities.dp(42.0f);
            } else {
                maxWidth = Math.min(getParentWidth(), AndroidUtilities.displaySize.y);
            }
            if (this.isPlayingRound) {
                int backgroundWidthLocal = this.backgroundWidth - (AndroidUtilities.roundPlayingMessageSize - AndroidUtilities.roundMessageSize);
                return (maxWidth - backgroundWidthLocal) - AndroidUtilities.dp(57.0f);
            }
            int backgroundWidthLocal2 = this.backgroundWidth;
            return (maxWidth - backgroundWidthLocal2) - AndroidUtilities.dp(57.0f);
        }
        MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
        if (groupedMessages != null && !groupedMessages.isDocuments) {
            if (AndroidUtilities.isTablet()) {
                dWidth = AndroidUtilities.getMinTabletSide();
            } else {
                dWidth = getParentWidth();
            }
            int firstLineWidth = 0;
            for (int a = 0; a < this.currentMessagesGroup.posArray.size(); a++) {
                MessageObject.GroupedMessagePosition position = this.currentMessagesGroup.posArray.get(a);
                if (position.minY != 0) {
                    break;
                }
                double d = firstLineWidth;
                double ceil = Math.ceil(((position.pw + position.leftSpanOffset) / 1000.0f) * dWidth);
                Double.isNaN(d);
                firstLineWidth = (int) (d + ceil);
            }
            return firstLineWidth - AndroidUtilities.dp((this.isAvatarVisible ? 48 : 0) + 31);
        }
        int dWidth2 = this.backgroundWidth;
        return dWidth2 - AndroidUtilities.dp(this.mediaBackground ? 22.0f : 31.0f);
    }

    /* JADX WARN: Removed duplicated region for block: B:510:0x08cf  */
    /* JADX WARN: Removed duplicated region for block: B:516:? A[RETURN, SYNTHETIC] */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    public void updateButtonState(boolean ifSame, boolean animated, boolean fromSet) {
        boolean animated2;
        boolean autoDownload;
        boolean z;
        int i;
        String fileName;
        String fileName2;
        String fileName3;
        int i2;
        int i3;
        int i4;
        MessageObject.GroupedMessagePosition groupedMessagePosition;
        int i5;
        int i6;
        int i7;
        int i8;
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject == null) {
            return;
        }
        if (animated && (PhotoViewer.isShowingImage(messageObject) || !this.attachedToWindow)) {
            animated2 = false;
        } else {
            animated2 = animated;
        }
        this.drawRadialCheckBackground = false;
        String fileName4 = null;
        boolean fileExists = false;
        boolean z2 = true;
        if (this.currentMessageObject.type == 1) {
            TLRPC.PhotoSize photoSize = this.currentPhotoObject;
            if (photoSize == null) {
                this.radialProgress.setIcon(4, ifSame, animated2);
                return;
            } else {
                fileName4 = FileLoader.getAttachFileName(photoSize);
                fileExists = this.currentMessageObject.mediaExists;
            }
        } else if (this.currentMessageObject.type == 8 || (i7 = this.documentAttachType) == 7 || i7 == 4 || i7 == 8 || this.currentMessageObject.type == 9 || (i8 = this.documentAttachType) == 3 || i8 == 5) {
            if (this.currentMessageObject.useCustomPhoto) {
                this.buttonState = 1;
                this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                return;
            } else if (this.currentMessageObject.attachPathExists && !TextUtils.isEmpty(this.currentMessageObject.messageOwner.attachPath)) {
                fileName4 = this.currentMessageObject.messageOwner.attachPath;
                fileExists = true;
            } else if (!this.currentMessageObject.isSendError() || (i6 = this.documentAttachType) == 3 || i6 == 5) {
                fileName4 = this.currentMessageObject.getFileName();
                fileExists = this.currentMessageObject.mediaExists;
            }
        } else if (i8 != 0) {
            fileName4 = FileLoader.getAttachFileName(this.documentAttach);
            fileExists = this.currentMessageObject.mediaExists;
        } else {
            TLRPC.PhotoSize photoSize2 = this.currentPhotoObject;
            if (photoSize2 != null) {
                fileName4 = FileLoader.getAttachFileName(photoSize2);
                fileExists = this.currentMessageObject.mediaExists;
            }
        }
        TLRPC.Document document = this.documentAttach;
        if (document == null || document.dc_id != Integer.MIN_VALUE) {
            autoDownload = DownloadController.getInstance(this.currentAccount).canDownloadMedia(this.currentMessageObject);
        } else {
            autoDownload = false;
        }
        this.canStreamVideo = (this.currentMessageObject.isSent() || this.currentMessageObject.isForwarded()) && ((i5 = this.documentAttachType) == 4 || i5 == 7 || (i5 == 2 && autoDownload)) && this.currentMessageObject.canStreamVideo() && !this.currentMessageObject.needDrawBluredPreview();
        if (SharedConfig.streamMedia && ((int) this.currentMessageObject.getDialogId()) != 0 && !this.currentMessageObject.isSecretMedia() && (this.documentAttachType == 5 || (this.canStreamVideo && (groupedMessagePosition = this.currentPosition) != null && ((groupedMessagePosition.flags & 1) == 0 || (this.currentPosition.flags & 2) == 0)))) {
            this.hasMiniProgress = fileExists ? 1 : 2;
            fileExists = true;
        }
        if (this.currentMessageObject.isSendError()) {
            i = 4;
            z = false;
        } else if (!TextUtils.isEmpty(fileName4) || (!this.currentMessageObject.isAnyKindOfSticker() && (this.currentMessageObject.isSending() || this.currentMessageObject.isEditing()))) {
            boolean fromBot = this.currentMessageObject.messageOwner.params != null && this.currentMessageObject.messageOwner.params.containsKey("query_id");
            int i9 = this.documentAttachType;
            float f = 0.0f;
            if (i9 == 3) {
                fileName = fileName4;
            } else if (i9 != 5) {
                if (this.currentMessageObject.type == 0 && (i3 = this.documentAttachType) != 1 && i3 != 2 && i3 != 7 && i3 != 4 && i3 != 8 && i3 != 9) {
                    if (this.currentPhotoObject == null || !this.drawImageButton) {
                        return;
                    }
                    if (!fileExists) {
                        DownloadController.getInstance(this.currentAccount).addLoadingFileObserver(fileName4, this.currentMessageObject, this);
                        float setProgress = 0.0f;
                        if (!FileLoader.getInstance(this.currentAccount).isLoadingFile(fileName4)) {
                            if (!this.currentMessageObject.loadingCancelled && (((i4 = this.documentAttachType) == 0 && autoDownload) || (i4 == 2 && MessageObject.isGifDocument(this.documentAttach, this.currentMessageObject.hasValidGroupId()) && autoDownload))) {
                                this.buttonState = 1;
                            } else {
                                this.buttonState = 0;
                            }
                        } else {
                            this.buttonState = 1;
                            long[] progress = ImageLoader.getInstance().getFileProgressSizes(fileName4);
                            if (progress != null) {
                                f = DownloadController.getProgress(progress);
                            }
                            setProgress = f;
                            if (progress != null && progress[0] == progress[1]) {
                                createLoadingProgressLayout(progress[0], progress[1]);
                            } else if (this.currentMessageObject.getDocument() != null) {
                                createLoadingProgressLayout(this.currentMessageObject.loadedFileSize, this.currentMessageObject.getSize());
                            }
                        }
                        this.radialProgress.setProgress(setProgress, false);
                    } else {
                        DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
                        if (this.documentAttachType != 2 || this.photoImage.isAllowStartAnimation()) {
                            this.buttonState = -1;
                        } else {
                            this.buttonState = 2;
                        }
                    }
                    this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                    invalidate();
                } else if (this.currentMessageObject.isOut() && ((this.currentMessageObject.isSending() && !this.currentMessageObject.isForwarded()) || (this.currentMessageObject.isEditing() && this.currentMessageObject.isEditingMedia()))) {
                    if (!TextUtils.isEmpty(this.currentMessageObject.messageOwner.attachPath)) {
                        DownloadController.getInstance(this.currentAccount).addLoadingFileObserver(this.currentMessageObject.messageOwner.attachPath, this.currentMessageObject, this);
                        this.wasSending = true;
                        boolean needProgress = this.currentMessageObject.messageOwner.attachPath == null || !this.currentMessageObject.messageOwner.attachPath.startsWith("http");
                        HashMap<String, String> params = this.currentMessageObject.messageOwner.params;
                        if (this.currentMessageObject.messageOwner.message != null && params != null && (params.containsKey(ImagesContract.URL) || params.containsKey("bot"))) {
                            needProgress = false;
                            this.buttonState = -1;
                        } else {
                            this.buttonState = 1;
                        }
                        boolean sending = SendMessagesHelper.getInstance(this.currentAccount).isSendingMessage(this.currentMessageObject.getId());
                        if (this.currentPosition != null && sending && this.buttonState == 1) {
                            this.drawRadialCheckBackground = true;
                            getIconForCurrentState();
                            this.radialProgress.setIcon(6, ifSame, animated2);
                        } else {
                            this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                        }
                        if (needProgress) {
                            long[] progress2 = ImageLoader.getInstance().getFileProgressSizes(this.currentMessageObject.messageOwner.attachPath);
                            float loadingProgress = 0.0f;
                            if (progress2 == null && sending) {
                                loadingProgress = 1.0f;
                            } else if (progress2 != null) {
                                loadingProgress = DownloadController.getProgress(progress2);
                                createLoadingProgressLayout(progress2[0], progress2[1]);
                            }
                            this.radialProgress.setProgress(loadingProgress, false);
                        } else {
                            this.radialProgress.setProgress(0.0f, false);
                        }
                        invalidate();
                        i2 = 4;
                    } else {
                        getIconForCurrentState();
                        if (this.currentMessageObject.isSticker() || this.currentMessageObject.isAnimatedSticker() || this.currentMessageObject.isLocation() || this.currentMessageObject.isGif()) {
                            this.buttonState = -1;
                            i2 = 4;
                            this.radialProgress.setIcon(4, ifSame, false);
                        } else {
                            this.buttonState = 1;
                            this.radialProgress.setIcon(12, ifSame, false);
                            i2 = 4;
                        }
                        this.radialProgress.setProgress(0.0f, false);
                    }
                    this.videoRadialProgress.setIcon(i2, ifSame, false);
                } else {
                    if (this.wasSending && !TextUtils.isEmpty(this.currentMessageObject.messageOwner.attachPath)) {
                        DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
                    }
                    boolean isLoadingVideo = false;
                    int i10 = this.documentAttachType;
                    if ((i10 == 4 || i10 == 2 || i10 == 7) && this.autoPlayingMedia) {
                        isLoadingVideo = FileLoader.getInstance(this.currentAccount).isLoadingVideo(this.documentAttach, MediaController.getInstance().isPlayingMessage(this.currentMessageObject));
                        AnimatedFileDrawable animation = this.photoImage.getAnimation();
                        if (animation != null) {
                            if (this.currentMessageObject.hadAnimationNotReadyLoading) {
                                if (animation.hasBitmap()) {
                                    this.currentMessageObject.hadAnimationNotReadyLoading = false;
                                }
                            } else {
                                this.currentMessageObject.hadAnimationNotReadyLoading = isLoadingVideo && !animation.hasBitmap();
                            }
                        } else if (this.documentAttachType == 2 && !fileExists) {
                            this.currentMessageObject.hadAnimationNotReadyLoading = true;
                        }
                    }
                    if (this.hasMiniProgress != 0) {
                        this.radialProgress.setMiniProgressBackgroundColor(getThemedColor(Theme.key_chat_inLoaderPhoto));
                        this.buttonState = 3;
                        this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                        if (this.hasMiniProgress == 1) {
                            DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
                            this.miniButtonState = -1;
                        } else {
                            DownloadController.getInstance(this.currentAccount).addLoadingFileObserver(fileName4, this.currentMessageObject, this);
                            if (!FileLoader.getInstance(this.currentAccount).isLoadingFile(fileName4)) {
                                this.miniButtonState = 0;
                            } else {
                                this.miniButtonState = 1;
                                long[] progress3 = ImageLoader.getInstance().getFileProgressSizes(fileName4);
                                if (progress3 != null) {
                                    createLoadingProgressLayout(progress3[0], progress3[1]);
                                    this.radialProgress.setProgress(DownloadController.getProgress(progress3), animated2);
                                } else {
                                    createLoadingProgressLayout(this.documentAttach);
                                    this.radialProgress.setProgress(0.0f, animated2);
                                }
                            }
                        }
                        this.radialProgress.setMiniIcon(getMiniIconForCurrentState(), ifSame, animated2);
                    } else {
                        if (!fileExists) {
                            int i11 = this.documentAttachType;
                            if ((i11 == 4 || i11 == 2 || i11 == 7) && this.autoPlayingMedia && !this.currentMessageObject.hadAnimationNotReadyLoading && !isLoadingVideo) {
                                fileName2 = fileName4;
                            } else {
                                int i12 = this.documentAttachType;
                                this.drawVideoSize = i12 == 4 || i12 == 2;
                                if ((i12 == 4 || i12 == 2 || i12 == 7) && this.canStreamVideo && !this.drawVideoImageButton && animated2) {
                                    int i13 = this.animatingDrawVideoImageButton;
                                    if (i13 != 2 && this.animatingDrawVideoImageButtonProgress < 1.0f) {
                                        if (i13 == 0) {
                                            this.animatingDrawVideoImageButtonProgress = 0.0f;
                                        }
                                        this.animatingDrawVideoImageButton = 2;
                                    }
                                } else if (this.animatingDrawVideoImageButton == 0) {
                                    this.animatingDrawVideoImageButtonProgress = 1.0f;
                                }
                                DownloadController.getInstance(this.currentAccount).addLoadingFileObserver(fileName4, this.currentMessageObject, this);
                                if (!FileLoader.getInstance(this.currentAccount).isLoadingFile(fileName4)) {
                                    if (!this.currentMessageObject.loadingCancelled && autoDownload) {
                                        this.buttonState = 1;
                                    } else if (this.currentMessageObject.type == 4) {
                                        this.buttonState = -1;
                                    } else {
                                        this.buttonState = 0;
                                    }
                                    boolean hasDocLayout = this.currentMessageObject.type == 3 || this.currentMessageObject.type == 8 || this.documentAttachType == 4;
                                    boolean fullWidth = true;
                                    MessageObject.GroupedMessagePosition groupedMessagePosition2 = this.currentPosition;
                                    if (groupedMessagePosition2 != null) {
                                        fullWidth = (groupedMessagePosition2.flags & 3) == 3;
                                    }
                                    int i14 = this.documentAttachType;
                                    if ((i14 == 4 || (i14 == 2 && autoDownload)) && this.canStreamVideo && hasDocLayout && fullWidth) {
                                        this.drawVideoImageButton = true;
                                        getIconForCurrentState();
                                        this.radialProgress.setIcon(this.autoPlayingMedia ? 4 : 0, ifSame, animated2);
                                        this.videoRadialProgress.setIcon(2, ifSame, animated2);
                                    } else {
                                        this.drawVideoImageButton = false;
                                        this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                                        this.videoRadialProgress.setIcon(4, ifSame, false);
                                        if (!this.drawVideoSize && this.animatingDrawVideoImageButton == 0) {
                                            this.animatingDrawVideoImageButtonProgress = 0.0f;
                                        }
                                    }
                                    fileName3 = fileName4;
                                } else {
                                    this.buttonState = 1;
                                    long[] progress4 = ImageLoader.getInstance().getFileProgressSizes(fileName4);
                                    if (progress4 != null) {
                                        fileName3 = fileName4;
                                        createLoadingProgressLayout(progress4[0], progress4[1]);
                                    } else {
                                        fileName3 = fileName4;
                                        createLoadingProgressLayout(this.documentAttach);
                                    }
                                    boolean hasDocLayout2 = this.currentMessageObject.type == 3 || this.currentMessageObject.type == 8 || this.documentAttachType == 4;
                                    boolean fullWidth2 = true;
                                    MessageObject.GroupedMessagePosition groupedMessagePosition3 = this.currentPosition;
                                    if (groupedMessagePosition3 != null) {
                                        fullWidth2 = (groupedMessagePosition3.flags & 3) == 3;
                                    }
                                    if ((this.documentAttachType != 4 && (!MessageObject.isGifDocument(this.documentAttach, this.currentMessageObject.hasValidGroupId()) || !autoDownload)) || !this.canStreamVideo || !hasDocLayout2 || !fullWidth2) {
                                        this.drawVideoImageButton = false;
                                        this.radialProgress.setProgress(progress4 != null ? DownloadController.getProgress(progress4) : 0.0f, animated2);
                                        this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                                        this.videoRadialProgress.setIcon(4, ifSame, false);
                                        if (!this.drawVideoSize && this.animatingDrawVideoImageButton == 0) {
                                            this.animatingDrawVideoImageButtonProgress = 0.0f;
                                        }
                                    } else {
                                        this.drawVideoImageButton = true;
                                        getIconForCurrentState();
                                        this.radialProgress.setIcon((this.autoPlayingMedia || this.documentAttachType == 2) ? 4 : 0, ifSame, animated2);
                                        this.videoRadialProgress.setProgress(progress4 != null ? DownloadController.getProgress(progress4) : 0.0f, animated2);
                                        this.videoRadialProgress.setIcon(14, ifSame, animated2);
                                    }
                                }
                                invalidate();
                            }
                        } else {
                            fileName2 = fileName4;
                        }
                        DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
                        if (this.drawVideoImageButton && animated2) {
                            int i15 = this.animatingDrawVideoImageButton;
                            if (i15 != 1 && this.animatingDrawVideoImageButtonProgress > 0.0f) {
                                if (i15 == 0) {
                                    this.animatingDrawVideoImageButtonProgress = 1.0f;
                                }
                                this.animatingDrawVideoImageButton = 1;
                            }
                        } else if (this.animatingDrawVideoImageButton == 0) {
                            this.animatingDrawVideoImageButton = 1;
                        }
                        this.drawVideoImageButton = false;
                        this.drawVideoSize = false;
                        if (this.currentMessageObject.needDrawBluredPreview()) {
                            this.buttonState = -1;
                        } else if (this.documentAttachType == 2 && this.currentMessageObject.gifState == 1.0f) {
                            if (this.photoImage.isAnimationRunning()) {
                                this.currentMessageObject.gifState = 0.0f;
                                this.buttonState = -1;
                            } else {
                                this.buttonState = 2;
                            }
                        } else if (this.documentAttachType != 4 || this.hasEmbed) {
                            this.buttonState = -1;
                        } else {
                            this.buttonState = 3;
                        }
                        RadialProgress2 radialProgress2 = this.videoRadialProgress;
                        if (this.animatingDrawVideoImageButton == 0) {
                            z2 = false;
                        }
                        radialProgress2.setIcon(4, ifSame, z2);
                        this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                        if (!fromSet && this.photoNotSet) {
                            setMessageObject(this.currentMessageObject, this.currentMessagesGroup, this.pinnedBottom, this.pinnedTop);
                        }
                        invalidate();
                    }
                }
                if (this.hasMiniProgress != 0) {
                    this.radialProgress.setMiniIcon(4, false, animated2);
                    return;
                }
                return;
            } else {
                fileName = fileName4;
            }
            if ((this.currentMessageObject.isOut() && ((this.currentMessageObject.isSending() && !this.currentMessageObject.isForwarded()) || (this.currentMessageObject.isEditing() && this.currentMessageObject.isEditingMedia()))) || (this.currentMessageObject.isSendError() && fromBot)) {
                if (!TextUtils.isEmpty(this.currentMessageObject.messageOwner.attachPath)) {
                    DownloadController.getInstance(this.currentAccount).addLoadingFileObserver(this.currentMessageObject.messageOwner.attachPath, this.currentMessageObject, this);
                    this.wasSending = true;
                    this.buttonState = 4;
                    boolean sending2 = SendMessagesHelper.getInstance(this.currentAccount).isSendingMessage(this.currentMessageObject.getId());
                    if (this.currentPosition != null && sending2 && this.buttonState == 4) {
                        this.drawRadialCheckBackground = true;
                        getIconForCurrentState();
                        this.radialProgress.setIcon(6, ifSame, animated2);
                    } else {
                        this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                    }
                    this.radialProgress.setMiniIcon(4, ifSame, animated2);
                    if (!fromBot) {
                        long[] progress5 = ImageLoader.getInstance().getFileProgressSizes(this.currentMessageObject.messageOwner.attachPath);
                        float loadingProgress2 = 0.0f;
                        if (progress5 == null && sending2) {
                            loadingProgress2 = 1.0f;
                        } else if (progress5 != null) {
                            loadingProgress2 = DownloadController.getProgress(progress5);
                        }
                        this.radialProgress.setProgress(loadingProgress2, false);
                    } else {
                        this.radialProgress.setProgress(0.0f, false);
                    }
                } else {
                    this.buttonState = -1;
                    getIconForCurrentState();
                    this.radialProgress.setIcon(12, ifSame, false);
                    this.radialProgress.setProgress(0.0f, false);
                    this.radialProgress.setMiniIcon(4, ifSame, false);
                }
            } else if (this.hasMiniProgress != 0) {
                this.radialProgress.setMiniProgressBackgroundColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outLoader : Theme.key_chat_inLoader));
                boolean playing = MediaController.getInstance().isPlayingMessage(this.currentMessageObject);
                if (!playing || MediaController.getInstance().isMessagePaused()) {
                    this.buttonState = 0;
                } else {
                    this.buttonState = 1;
                }
                this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                if (this.hasMiniProgress == 1) {
                    DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
                    this.miniButtonState = -1;
                } else {
                    String fileName5 = fileName;
                    DownloadController.getInstance(this.currentAccount).addLoadingFileObserver(fileName5, this.currentMessageObject, this);
                    if (!FileLoader.getInstance(this.currentAccount).isLoadingFile(fileName5)) {
                        createLoadingProgressLayout(this.documentAttach);
                        this.miniButtonState = 0;
                    } else {
                        this.miniButtonState = 1;
                        long[] progress6 = ImageLoader.getInstance().getFileProgressSizes(fileName5);
                        if (progress6 != null) {
                            this.radialProgress.setProgress(DownloadController.getProgress(progress6), animated2);
                            createLoadingProgressLayout(progress6[0], progress6[1]);
                        } else {
                            this.radialProgress.setProgress(0.0f, animated2);
                            createLoadingProgressLayout(0L, this.currentMessageObject.getSize());
                        }
                    }
                }
                this.radialProgress.setMiniIcon(getMiniIconForCurrentState(), ifSame, animated2);
            } else {
                String fileName6 = fileName;
                if (fileExists) {
                    DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
                    boolean playing2 = MediaController.getInstance().isPlayingMessage(this.currentMessageObject);
                    if (!playing2 || MediaController.getInstance().isMessagePaused()) {
                        this.buttonState = 0;
                    } else {
                        this.buttonState = 1;
                    }
                    this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                } else {
                    DownloadController.getInstance(this.currentAccount).addLoadingFileObserver(fileName6, this.currentMessageObject, this);
                    if (FileLoader.getInstance(this.currentAccount).isLoadingFile(fileName6)) {
                        this.buttonState = 4;
                        long[] progress7 = ImageLoader.getInstance().getFileProgressSizes(fileName6);
                        if (progress7 == null) {
                            createLoadingProgressLayout(this.documentAttach);
                            this.radialProgress.setProgress(0.0f, animated2);
                        } else {
                            this.radialProgress.setProgress(DownloadController.getProgress(progress7), animated2);
                            createLoadingProgressLayout(progress7[0], progress7[1]);
                        }
                    } else {
                        this.buttonState = 2;
                    }
                    this.radialProgress.setIcon(getIconForCurrentState(), ifSame, animated2);
                }
            }
            updatePlayingMessageProgress();
            if (this.hasMiniProgress != 0) {
            }
        } else {
            i = 4;
            z = false;
        }
        this.radialProgress.setIcon(i, ifSame, z);
        this.radialProgress.setMiniIcon(i, ifSame, z);
        this.videoRadialProgress.setIcon(i, ifSame, z);
        this.videoRadialProgress.setMiniIcon(i, ifSame, z);
    }

    private void didPressMiniButton(boolean animated) {
        int i = this.miniButtonState;
        if (i == 0) {
            this.miniButtonState = 1;
            this.radialProgress.setProgress(0.0f, false);
            MessageObject messageObject = this.currentMessageObject;
            if (messageObject != null && !messageObject.isAnyKindOfSticker()) {
                this.currentMessageObject.putInDownloadsStore = true;
            }
            int i2 = this.documentAttachType;
            if (i2 == 3 || i2 == 5) {
                FileLoader.getInstance(this.currentAccount).loadFile(this.documentAttach, this.currentMessageObject, 1, 0);
                this.currentMessageObject.loadingCancelled = false;
            } else if (i2 == 4) {
                createLoadingProgressLayout(this.documentAttach);
                FileLoader fileLoader = FileLoader.getInstance(this.currentAccount);
                TLRPC.Document document = this.documentAttach;
                MessageObject messageObject2 = this.currentMessageObject;
                fileLoader.loadFile(document, messageObject2, 1, messageObject2.shouldEncryptPhotoOrVideo() ? 2 : 0);
                this.currentMessageObject.loadingCancelled = false;
            }
            this.radialProgress.setMiniIcon(getMiniIconForCurrentState(), false, true);
            invalidate();
        } else if (i == 1) {
            int i3 = this.documentAttachType;
            if ((i3 == 3 || i3 == 5) && MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
                MediaController.getInstance().cleanupPlayer(true, true);
            }
            this.miniButtonState = 0;
            this.currentMessageObject.loadingCancelled = true;
            FileLoader.getInstance(this.currentAccount).cancelLoadFile(this.documentAttach);
            this.radialProgress.setMiniIcon(getMiniIconForCurrentState(), false, true);
            invalidate();
        }
    }

    private void didPressButton(boolean animated, boolean video) {
        String thumbFilter;
        TLRPC.PhotoSize thumb;
        int i;
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null && !messageObject.isAnyKindOfSticker()) {
            this.currentMessageObject.putInDownloadsStore = true;
        }
        int i2 = this.buttonState;
        int i3 = 2;
        if (i2 != 0 || (this.drawVideoImageButton && !video)) {
            if (i2 == 1 && (!this.drawVideoImageButton || video)) {
                this.photoImage.setForceLoading(false);
                int i4 = this.documentAttachType;
                if (i4 == 3 || i4 == 5) {
                    boolean result = MediaController.getInstance().m383lambda$startAudioAgain$7$orgtelegrammessengerMediaController(this.currentMessageObject);
                    if (result) {
                        this.buttonState = 0;
                        this.radialProgress.setIcon(getIconForCurrentState(), false, animated);
                        invalidate();
                        return;
                    }
                    return;
                } else if (this.currentMessageObject.isOut() && !this.drawVideoImageButton && (this.currentMessageObject.isSending() || this.currentMessageObject.isEditing())) {
                    if (this.radialProgress.getIcon() != 6) {
                        this.delegate.didPressCancelSendButton(this);
                        return;
                    }
                    return;
                } else {
                    this.currentMessageObject.loadingCancelled = true;
                    int i5 = this.documentAttachType;
                    if (i5 == 2 || i5 == 4 || i5 == 1 || i5 == 8) {
                        FileLoader.getInstance(this.currentAccount).cancelLoadFile(this.documentAttach);
                    } else if (this.currentMessageObject.type == 0 || this.currentMessageObject.type == 1 || this.currentMessageObject.type == 8 || this.currentMessageObject.type == 5) {
                        ImageLoader.getInstance().cancelForceLoadingForImageReceiver(this.photoImage);
                        this.photoImage.cancelLoadImage();
                    } else if (this.currentMessageObject.type == 9) {
                        FileLoader.getInstance(this.currentAccount).cancelLoadFile(this.currentMessageObject.getDocument());
                    }
                    this.buttonState = 0;
                    if (video) {
                        this.videoRadialProgress.setIcon(2, false, animated);
                    } else {
                        this.radialProgress.setIcon(getIconForCurrentState(), false, animated);
                    }
                    invalidate();
                    return;
                }
            } else if (i2 == 2) {
                int i6 = this.documentAttachType;
                if (i6 == 3 || i6 == 5) {
                    this.radialProgress.setProgress(0.0f, false);
                    FileLoader.getInstance(this.currentAccount).loadFile(this.documentAttach, this.currentMessageObject, 1, 0);
                    this.currentMessageObject.loadingCancelled = false;
                    this.buttonState = 4;
                    this.radialProgress.setIcon(getIconForCurrentState(), true, animated);
                    invalidate();
                    return;
                }
                if (this.isRoundVideo) {
                    MessageObject playingMessage = MediaController.getInstance().getPlayingMessageObject();
                    if (playingMessage == null || !playingMessage.isRoundVideo()) {
                        this.photoImage.setAllowStartAnimation(true);
                        this.photoImage.startAnimation();
                    }
                } else {
                    this.photoImage.setAllowStartAnimation(true);
                    this.photoImage.startAnimation();
                }
                this.currentMessageObject.gifState = 0.0f;
                this.buttonState = -1;
                this.radialProgress.setIcon(getIconForCurrentState(), false, animated);
                return;
            } else if (i2 == 3 || i2 == 0) {
                if (this.hasMiniProgress == 2 && this.miniButtonState != 1) {
                    this.miniButtonState = 1;
                    this.radialProgress.setProgress(0.0f, false);
                    this.radialProgress.setMiniIcon(getMiniIconForCurrentState(), false, animated);
                }
                this.delegate.didPressImage(this, 0.0f, 0.0f);
                return;
            } else if (i2 == 4) {
                int i7 = this.documentAttachType;
                if (i7 == 3 || i7 == 5) {
                    if ((this.currentMessageObject.isOut() && (this.currentMessageObject.isSending() || this.currentMessageObject.isEditing())) || this.currentMessageObject.isSendError()) {
                        if (this.delegate != null && this.radialProgress.getIcon() != 6) {
                            this.delegate.didPressCancelSendButton(this);
                            return;
                        }
                        return;
                    }
                    this.currentMessageObject.loadingCancelled = true;
                    FileLoader.getInstance(this.currentAccount).cancelLoadFile(this.documentAttach);
                    this.buttonState = 2;
                    this.radialProgress.setIcon(getIconForCurrentState(), false, animated);
                    invalidate();
                    return;
                }
                return;
            } else {
                return;
            }
        }
        int i8 = this.documentAttachType;
        if (i8 == 3 || i8 == 5) {
            if (this.miniButtonState == 0) {
                FileLoader.getInstance(this.currentAccount).loadFile(this.documentAttach, this.currentMessageObject, 1, 0);
                this.currentMessageObject.loadingCancelled = false;
            }
            if (this.delegate.needPlayMessage(this.currentMessageObject)) {
                if (this.hasMiniProgress == 2 && this.miniButtonState != 1) {
                    this.miniButtonState = 1;
                    this.radialProgress.setProgress(0.0f, false);
                    this.radialProgress.setMiniIcon(getMiniIconForCurrentState(), false, true);
                }
                updatePlayingMessageProgress();
                this.buttonState = 1;
                this.radialProgress.setIcon(getIconForCurrentState(), false, true);
                invalidate();
                return;
            }
            return;
        }
        if (video) {
            this.videoRadialProgress.setProgress(0.0f, false);
        } else {
            this.radialProgress.setProgress(0.0f, false);
        }
        if (this.currentPhotoObject != null && (this.photoImage.hasNotThumb() || this.currentPhotoObjectThumb == null)) {
            thumb = this.currentPhotoObject;
            thumbFilter = ((thumb instanceof TLRPC.TL_photoStrippedSize) || "s".equals(thumb.type)) ? this.currentPhotoFilterThumb : this.currentPhotoFilter;
        } else {
            thumb = this.currentPhotoObjectThumb;
            thumbFilter = this.currentPhotoFilterThumb;
        }
        if (this.currentMessageObject.type == 1) {
            this.photoImage.setForceLoading(true);
            ImageReceiver imageReceiver = this.photoImage;
            ImageLocation forObject = ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject);
            String str = this.currentPhotoFilter;
            ImageLocation forObject2 = ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject);
            String str2 = this.currentPhotoFilterThumb;
            BitmapDrawable bitmapDrawable = this.currentPhotoObjectThumbStripped;
            long j = this.currentPhotoObject.size;
            MessageObject messageObject2 = this.currentMessageObject;
            imageReceiver.setImage(forObject, str, forObject2, str2, bitmapDrawable, j, null, messageObject2, messageObject2.shouldEncryptPhotoOrVideo() ? 2 : 0);
        } else if (this.currentMessageObject.type == 8) {
            FileLoader.getInstance(this.currentAccount).loadFile(this.documentAttach, this.currentMessageObject, 1, 0);
            if (this.currentMessageObject.loadedFileSize > 0) {
                createLoadingProgressLayout(this.documentAttach);
            }
        } else if (this.isRoundVideo) {
            if (this.currentMessageObject.isSecretMedia()) {
                FileLoader.getInstance(this.currentAccount).loadFile(this.currentMessageObject.getDocument(), this.currentMessageObject, 1, 1);
            } else {
                this.currentMessageObject.gifState = 2.0f;
                TLRPC.Document document = this.currentMessageObject.getDocument();
                this.photoImage.setForceLoading(true);
                this.photoImage.setImage(ImageLocation.getForDocument(document), null, ImageLocation.getForObject(thumb, document), thumbFilter, document.size, null, this.currentMessageObject, 0);
            }
        } else if (this.currentMessageObject.type == 9) {
            FileLoader.getInstance(this.currentAccount).loadFile(this.documentAttach, this.currentMessageObject, 1, 0);
            if (this.currentMessageObject.loadedFileSize > 0) {
                createLoadingProgressLayout(this.documentAttach);
            }
        } else if (this.documentAttachType == 4) {
            FileLoader fileLoader = FileLoader.getInstance(this.currentAccount);
            TLRPC.Document document2 = this.documentAttach;
            MessageObject messageObject3 = this.currentMessageObject;
            if (!messageObject3.shouldEncryptPhotoOrVideo()) {
                i3 = 0;
            }
            fileLoader.loadFile(document2, messageObject3, 1, i3);
            if (this.currentMessageObject.loadedFileSize > 0) {
                createLoadingProgressLayout(this.currentMessageObject.getDocument());
            }
        } else if (this.currentMessageObject.type == 0 && (i = this.documentAttachType) != 0) {
            if (i == 2) {
                this.photoImage.setForceLoading(true);
                this.photoImage.setImage(ImageLocation.getForDocument(this.documentAttach), null, ImageLocation.getForDocument(this.currentPhotoObject, this.documentAttach), this.currentPhotoFilterThumb, this.documentAttach.size, null, this.currentMessageObject, 0);
                this.currentMessageObject.gifState = 2.0f;
                if (this.currentMessageObject.loadedFileSize > 0) {
                    createLoadingProgressLayout(this.currentMessageObject.getDocument());
                }
            } else if (i == 1) {
                FileLoader.getInstance(this.currentAccount).loadFile(this.documentAttach, this.currentMessageObject, 0, 0);
            } else if (i == 8) {
                this.photoImage.setImage(ImageLocation.getForDocument(this.documentAttach), this.currentPhotoFilter, ImageLocation.getForDocument(this.currentPhotoObject, this.documentAttach), "b1", 0L, "jpg", this.currentMessageObject, 1);
            }
        } else {
            this.photoImage.setForceLoading(true);
            this.photoImage.setImage(ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject), this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, 0L, null, this.currentMessageObject, 0);
        }
        this.currentMessageObject.loadingCancelled = false;
        this.buttonState = 1;
        if (video) {
            this.videoRadialProgress.setIcon(14, false, animated);
        } else {
            this.radialProgress.setIcon(getIconForCurrentState(), false, animated);
        }
        invalidate();
    }

    @Override // org.telegram.messenger.DownloadController.FileDownloadProgressListener
    public void onFailedDownload(String fileName, boolean canceled) {
        int i = this.documentAttachType;
        updateButtonState(true, i == 3 || i == 5, false);
    }

    @Override // org.telegram.messenger.DownloadController.FileDownloadProgressListener
    public void onSuccessDownload(String fileName) {
        TLRPC.Document document;
        MessageObject.GroupedMessagePosition groupedMessagePosition;
        if (this.documentAttachType == 6 && this.currentMessageObject.isDice()) {
            DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
            setCurrentDiceValue(true);
            return;
        }
        int i = this.documentAttachType;
        if (i == 3 || i == 5) {
            updateButtonState(false, true, false);
            updateWaveform();
            return;
        }
        if (this.drawVideoImageButton) {
            this.videoRadialProgress.setProgress(1.0f, true);
        } else {
            this.radialProgress.setProgress(1.0f, true);
        }
        if (!this.currentMessageObject.needDrawBluredPreview() && !this.autoPlayingMedia && (document = this.documentAttach) != null) {
            if (this.documentAttachType == 7) {
                ImageReceiver imageReceiver = this.photoImage;
                ImageLocation forDocument = ImageLocation.getForDocument(document);
                ImageLocation forObject = ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject);
                TLRPC.PhotoSize photoSize = this.currentPhotoObject;
                imageReceiver.setImage(forDocument, ImageLoader.AUTOPLAY_FILTER, forObject, ((photoSize instanceof TLRPC.TL_photoStrippedSize) || (photoSize != null && "s".equals(photoSize.type))) ? this.currentPhotoFilterThumb : this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, this.documentAttach.size, null, this.currentMessageObject, 0);
                this.photoImage.setAllowStartAnimation(true);
                this.photoImage.startAnimation();
                this.autoPlayingMedia = true;
            } else if (SharedConfig.autoplayVideo && this.documentAttachType == 4 && ((groupedMessagePosition = this.currentPosition) == null || ((groupedMessagePosition.flags & 1) != 0 && (this.currentPosition.flags & 2) != 0))) {
                this.animatingNoSound = 2;
                ImageReceiver imageReceiver2 = this.photoImage;
                ImageLocation forDocument2 = ImageLocation.getForDocument(this.documentAttach);
                ImageLocation forObject2 = ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject);
                TLRPC.PhotoSize photoSize2 = this.currentPhotoObject;
                imageReceiver2.setImage(forDocument2, ImageLoader.AUTOPLAY_FILTER, forObject2, ((photoSize2 instanceof TLRPC.TL_photoStrippedSize) || (photoSize2 != null && "s".equals(photoSize2.type))) ? this.currentPhotoFilterThumb : this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, this.documentAttach.size, null, this.currentMessageObject, 0);
                if (!PhotoViewer.isPlayingMessage(this.currentMessageObject)) {
                    this.photoImage.setAllowStartAnimation(true);
                    this.photoImage.startAnimation();
                } else {
                    this.photoImage.setAllowStartAnimation(false);
                }
                this.autoPlayingMedia = true;
            } else if (this.documentAttachType == 2) {
                ImageReceiver imageReceiver3 = this.photoImage;
                ImageLocation forDocument3 = ImageLocation.getForDocument(this.documentAttach);
                ImageLocation forObject3 = ImageLocation.getForObject(this.currentPhotoObject, this.photoParentObject);
                TLRPC.PhotoSize photoSize3 = this.currentPhotoObject;
                imageReceiver3.setImage(forDocument3, ImageLoader.AUTOPLAY_FILTER, forObject3, ((photoSize3 instanceof TLRPC.TL_photoStrippedSize) || (photoSize3 != null && "s".equals(photoSize3.type))) ? this.currentPhotoFilterThumb : this.currentPhotoFilter, ImageLocation.getForObject(this.currentPhotoObjectThumb, this.photoParentObject), this.currentPhotoFilterThumb, this.currentPhotoObjectThumbStripped, this.documentAttach.size, null, this.currentMessageObject, 0);
                if (SharedConfig.autoplayGifs) {
                    this.photoImage.setAllowStartAnimation(true);
                    this.photoImage.startAnimation();
                } else {
                    this.photoImage.setAllowStartAnimation(false);
                    this.photoImage.stopAnimation();
                }
                this.autoPlayingMedia = true;
            }
        }
        if (this.currentMessageObject.type == 0) {
            if (!this.autoPlayingMedia && this.documentAttachType == 2 && this.currentMessageObject.gifState != 1.0f) {
                this.buttonState = 2;
                didPressButton(true, false);
                return;
            } else if (this.photoNotSet) {
                setMessageObject(this.currentMessageObject, this.currentMessagesGroup, this.pinnedBottom, this.pinnedTop);
                return;
            } else {
                updateButtonState(false, true, false);
                return;
            }
        }
        if (!this.photoNotSet) {
            updateButtonState(false, true, false);
        }
        if (this.photoNotSet) {
            setMessageObject(this.currentMessageObject, this.currentMessagesGroup, this.pinnedBottom, this.pinnedTop);
        }
    }

    @Override // org.telegram.messenger.ImageReceiver.ImageReceiverDelegate
    public void didSetImage(ImageReceiver imageReceiver, boolean set, boolean thumb, boolean memCache) {
        int i;
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null && set) {
            if (setCurrentDiceValue(!memCache && !messageObject.wasUnread) || thumb || this.currentMessageObject.mediaExists || this.currentMessageObject.attachPathExists) {
                return;
            }
            if ((this.currentMessageObject.type == 0 && ((i = this.documentAttachType) == 8 || i == 0 || i == 6)) || this.currentMessageObject.type == 1) {
                this.currentMessageObject.mediaExists = true;
                updateButtonState(false, true, false);
            }
        }
    }

    public boolean setCurrentDiceValue(boolean instant) {
        MessagesController.DiceFrameSuccess frameSuccess;
        if (this.currentMessageObject.isDice()) {
            Drawable drawable = this.photoImage.getDrawable();
            if (drawable instanceof RLottieDrawable) {
                RLottieDrawable lottieDrawable = (RLottieDrawable) drawable;
                String emoji = this.currentMessageObject.getDiceEmoji();
                TLRPC.TL_messages_stickerSet stickerSet = MediaDataController.getInstance(this.currentAccount).getStickerSetByEmojiOrName(emoji);
                if (stickerSet != null) {
                    int value = this.currentMessageObject.getDiceValue();
                    if ("".equals(this.currentMessageObject.getDiceEmoji())) {
                        if (value >= 0 && value <= 64) {
                            ((SlotsDrawable) lottieDrawable).setDiceNumber(this, value, stickerSet, instant);
                            if (this.currentMessageObject.isOut()) {
                                lottieDrawable.setOnFinishCallback(this.diceFinishCallback, Integer.MAX_VALUE);
                            }
                            this.currentMessageObject.wasUnread = false;
                        }
                        if (!lottieDrawable.hasBaseDice() && stickerSet.documents.size() > 0) {
                            ((SlotsDrawable) lottieDrawable).setBaseDice(this, stickerSet);
                        }
                    } else {
                        if (!lottieDrawable.hasBaseDice() && stickerSet.documents.size() > 0) {
                            TLRPC.Document document = stickerSet.documents.get(0);
                            File path = FileLoader.getInstance(this.currentAccount).getPathToAttach(document, true);
                            if (lottieDrawable.setBaseDice(path)) {
                                DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
                            } else {
                                String fileName = FileLoader.getAttachFileName(document);
                                DownloadController.getInstance(this.currentAccount).addLoadingFileObserver(fileName, this.currentMessageObject, this);
                                FileLoader.getInstance(this.currentAccount).loadFile(document, stickerSet, 1, 1);
                            }
                        }
                        if (value >= 0 && value < stickerSet.documents.size()) {
                            if (!instant && this.currentMessageObject.isOut() && (frameSuccess = MessagesController.getInstance(this.currentAccount).diceSuccess.get(emoji)) != null && frameSuccess.num == value) {
                                lottieDrawable.setOnFinishCallback(this.diceFinishCallback, frameSuccess.frame);
                            }
                            TLRPC.Document document2 = stickerSet.documents.get(Math.max(value, 0));
                            File path2 = FileLoader.getInstance(this.currentAccount).getPathToAttach(document2, true);
                            if (lottieDrawable.setDiceNumber(path2, instant)) {
                                DownloadController.getInstance(this.currentAccount).removeLoadingFileObserver(this);
                            } else {
                                String fileName2 = FileLoader.getAttachFileName(document2);
                                DownloadController.getInstance(this.currentAccount).addLoadingFileObserver(fileName2, this.currentMessageObject, this);
                                FileLoader.getInstance(this.currentAccount).loadFile(document2, stickerSet, 1, 1);
                            }
                            this.currentMessageObject.wasUnread = false;
                        }
                    }
                } else {
                    MediaDataController.getInstance(this.currentAccount).loadStickersByEmojiOrName(emoji, true, true);
                }
            }
            return true;
        }
        return false;
    }

    @Override // org.telegram.messenger.ImageReceiver.ImageReceiverDelegate
    public void onAnimationReady(ImageReceiver imageReceiver) {
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null && imageReceiver == this.photoImage && messageObject.isAnimatedSticker()) {
            this.delegate.setShouldNotRepeatSticker(this.currentMessageObject);
        }
    }

    @Override // org.telegram.messenger.DownloadController.FileDownloadProgressListener
    public void onProgressDownload(String fileName, long downloadedSize, long totalSize) {
        float progress = totalSize == 0 ? 0.0f : Math.min(1.0f, ((float) downloadedSize) / ((float) totalSize));
        this.currentMessageObject.loadedFileSize = downloadedSize;
        createLoadingProgressLayout(downloadedSize, totalSize);
        if (this.drawVideoImageButton) {
            this.videoRadialProgress.setProgress(progress, true);
        } else {
            this.radialProgress.setProgress(progress, true);
        }
        int i = this.documentAttachType;
        if (i == 3 || i == 5) {
            if (this.hasMiniProgress != 0) {
                if (this.miniButtonState != 1) {
                    updateButtonState(false, false, false);
                }
            } else if (this.buttonState != 4) {
                updateButtonState(false, false, false);
            }
        } else if (this.hasMiniProgress != 0) {
            if (this.miniButtonState != 1) {
                updateButtonState(false, false, false);
            }
        } else if (this.buttonState != 1) {
            updateButtonState(false, false, false);
        }
    }

    @Override // org.telegram.messenger.DownloadController.FileDownloadProgressListener
    public void onProgressUpload(String fileName, long uploadedSize, long totalSize, boolean isEncrypted) {
        int i;
        float progress = totalSize == 0 ? 0.0f : Math.min(1.0f, ((float) uploadedSize) / ((float) totalSize));
        this.currentMessageObject.loadedFileSize = uploadedSize;
        this.radialProgress.setProgress(progress, true);
        if (uploadedSize == totalSize && this.currentPosition != null) {
            boolean sending = SendMessagesHelper.getInstance(this.currentAccount).isSendingMessage(this.currentMessageObject.getId());
            if (sending && ((i = this.buttonState) == 1 || (i == 4 && this.documentAttachType == 5))) {
                this.drawRadialCheckBackground = true;
                getIconForCurrentState();
                this.radialProgress.setIcon(6, false, true);
            }
        }
        createLoadingProgressLayout(uploadedSize, totalSize);
    }

    private void createLoadingProgressLayout(TLRPC.Document document) {
        if (document == null) {
            return;
        }
        long[] progresses = ImageLoader.getInstance().getFileProgressSizes(FileLoader.getDocumentFileName(document));
        if (progresses != null) {
            createLoadingProgressLayout(progresses[0], progresses[1]);
        } else {
            createLoadingProgressLayout(this.currentMessageObject.loadedFileSize, document.size);
        }
    }

    private void createLoadingProgressLayout(long loadedSize, long totalSize) {
        long loadedSize2;
        String str;
        long totalSize2 = totalSize;
        if (totalSize2 <= 0 || this.documentAttach == null) {
            this.loadingProgressLayout = null;
            return;
        }
        long j = this.lastLoadingSizeTotal;
        if (j == 0) {
            this.lastLoadingSizeTotal = totalSize2;
            loadedSize2 = loadedSize;
        } else {
            totalSize2 = this.lastLoadingSizeTotal;
            if (loadedSize <= j) {
                loadedSize2 = loadedSize;
            } else {
                loadedSize2 = this.lastLoadingSizeTotal;
            }
        }
        String totalStr = AndroidUtilities.formatFileSize(totalSize2);
        String maxAvailableString = String.format("000.0 mm / %s", totalStr);
        int w = (int) Math.ceil(Theme.chat_infoPaint.measureText(maxAvailableString));
        boolean fullWidth = true;
        if (this.documentAttachType == 1) {
            int max = Math.max(this.infoWidth, this.docTitleWidth);
            str = w <= max ? String.format("%s / %s", AndroidUtilities.formatFileSize(loadedSize2), totalStr) : AndroidUtilities.formatFileSize(loadedSize2);
        } else {
            MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
            if (groupedMessagePosition != null) {
                fullWidth = (groupedMessagePosition.flags & 3) == 3;
            }
            if (!fullWidth) {
                int percent = (int) (Math.min(1.0f, ((float) loadedSize2) / ((float) totalSize2)) * 100.0f);
                if (percent >= 100) {
                    str = "100%";
                } else {
                    str = String.format(Locale.US, "%2d%%", Integer.valueOf(percent));
                }
            } else {
                str = String.format("%s / %s", AndroidUtilities.formatFileSize(loadedSize2), totalStr);
            }
        }
        int w2 = (int) Math.ceil(Theme.chat_infoPaint.measureText(str));
        if (fullWidth && w2 > this.backgroundWidth - AndroidUtilities.dp(48.0f)) {
            int percent2 = (int) (Math.min(1.0f, ((float) loadedSize2) / ((float) totalSize2)) * 100.0f);
            if (percent2 >= 100) {
                str = "100%";
            } else {
                str = String.format(Locale.US, "%2d%%", Integer.valueOf(percent2));
            }
            w2 = (int) Math.ceil(Theme.chat_infoPaint.measureText(str));
        }
        this.loadingProgressLayout = new StaticLayout(str, Theme.chat_infoPaint, w2, Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
    }

    @Override // android.view.View
    public void onProvideStructure(ViewStructure structure) {
        super.onProvideStructure(structure);
        if (this.allowAssistant && Build.VERSION.SDK_INT >= 23) {
            if (this.currentMessageObject.messageText != null && this.currentMessageObject.messageText.length() > 0) {
                structure.setText(this.currentMessageObject.messageText);
            } else if (this.currentMessageObject.caption != null && this.currentMessageObject.caption.length() > 0) {
                structure.setText(this.currentMessageObject.caption);
            }
        }
    }

    public void setDelegate(ChatMessageCellDelegate chatMessageCellDelegate) {
        this.delegate = chatMessageCellDelegate;
    }

    public ChatMessageCellDelegate getDelegate() {
        return this.delegate;
    }

    public void setAllowAssistant(boolean value) {
        this.allowAssistant = value;
    }

    private void measureTime(MessageObject messageObject) {
        CharSequence signString;
        String timeString;
        MessageObject.GroupedMessages groupedMessages;
        long fromId = messageObject.getFromChatId();
        if (messageObject.scheduled) {
            signString = null;
        } else if (messageObject.messageOwner.post_author != null) {
            if (this.isMegagroup && messageObject.getFromChatId() == messageObject.getDialogId()) {
                signString = null;
            } else {
                signString = messageObject.messageOwner.post_author.replace("\n", "");
            }
        } else if (messageObject.messageOwner.fwd_from != null && messageObject.messageOwner.fwd_from.post_author != null) {
            signString = messageObject.messageOwner.fwd_from.post_author.replace("\n", "");
        } else if (messageObject.messageOwner.fwd_from != null && messageObject.messageOwner.fwd_from.imported) {
            signString = messageObject.messageOwner.fwd_from.date == messageObject.messageOwner.date ? LocaleController.getString("ImportedMessage", R.string.ImportedMessage) : LocaleController.formatImportedDate(messageObject.messageOwner.fwd_from.date) + " " + LocaleController.getString("ImportedMessage", R.string.ImportedMessage);
        } else if (!messageObject.isOutOwner() && fromId > 0 && messageObject.messageOwner.post) {
            TLRPC.User signUser = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(fromId));
            if (signUser != null) {
                signString = ContactsController.formatName(signUser.first_name, signUser.last_name).replace('\n', ' ');
            } else {
                signString = null;
            }
        } else {
            signString = null;
        }
        TLRPC.User author = null;
        if (this.currentMessageObject.isFromUser()) {
            author = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(fromId));
        }
        boolean hasReplies = messageObject.hasReplies();
        if (messageObject.scheduled || messageObject.isLiveLocation() || messageObject.messageOwner.edit_hide || messageObject.getDialogId() == 777000 || messageObject.messageOwner.via_bot_id != 0 || messageObject.messageOwner.via_bot_name != null || (author != null && author.bot)) {
            this.edited = false;
        } else if (this.currentPosition == null || (groupedMessages = this.currentMessagesGroup) == null || groupedMessages.messages.isEmpty()) {
            this.edited = (messageObject.messageOwner.flags & 32768) != 0 || messageObject.isEditing();
        } else {
            this.edited = false;
            hasReplies = this.currentMessagesGroup.messages.get(0).hasReplies();
            if (!this.currentMessagesGroup.messages.get(0).messageOwner.edit_hide) {
                int size = this.currentMessagesGroup.messages.size();
                for (int a = 0; a < size; a++) {
                    MessageObject object = this.currentMessagesGroup.messages.get(a);
                    if ((object.messageOwner.flags & 32768) != 0 || object.isEditing()) {
                        this.edited = true;
                        break;
                    }
                }
            }
        }
        if (this.currentMessageObject.isSponsored()) {
            timeString = LocaleController.getString("SponsoredMessage", R.string.SponsoredMessage);
        } else if (this.currentMessageObject.scheduled && this.currentMessageObject.messageOwner.date == 2147483646) {
            timeString = "";
        } else if (this.edited) {
            timeString = LocaleController.getString("EditedMessage", R.string.EditedMessage) + " " + LocaleController.getInstance().formatterDay.format(messageObject.messageOwner.date * 1000);
        } else {
            timeString = LocaleController.getInstance().formatterDay.format(messageObject.messageOwner.date * 1000);
        }
        if (signString != null) {
            if (messageObject.messageOwner.fwd_from != null && messageObject.messageOwner.fwd_from.imported) {
                this.currentTimeString = " " + timeString;
            } else {
                this.currentTimeString = ", " + timeString;
            }
        } else {
            this.currentTimeString = timeString;
        }
        int ceil = (int) Math.ceil(Theme.chat_timePaint.measureText(this.currentTimeString));
        this.timeWidth = ceil;
        this.timeTextWidth = ceil;
        if (this.currentMessageObject.scheduled && this.currentMessageObject.messageOwner.date == 2147483646) {
            this.timeWidth -= AndroidUtilities.dp(8.0f);
        }
        if ((messageObject.messageOwner.flags & 1024) != 0) {
            this.currentViewsString = String.format("%s", LocaleController.formatShortNumber(Math.max(1, messageObject.messageOwner.views), null));
            int ceil2 = (int) Math.ceil(Theme.chat_timePaint.measureText(this.currentViewsString));
            this.viewsTextWidth = ceil2;
            this.timeWidth += ceil2 + Theme.chat_msgInViewsDrawable.getIntrinsicWidth() + AndroidUtilities.dp(10.0f);
        }
        if (this.isChat && this.isMegagroup && !this.isThreadChat && hasReplies) {
            this.currentRepliesString = String.format("%s", LocaleController.formatShortNumber(getRepliesCount(), null));
            int ceil3 = (int) Math.ceil(Theme.chat_timePaint.measureText(this.currentRepliesString));
            this.repliesTextWidth = ceil3;
            this.timeWidth += ceil3 + Theme.chat_msgInRepliesDrawable.getIntrinsicWidth() + AndroidUtilities.dp(10.0f);
        } else {
            this.currentRepliesString = null;
        }
        if (this.isPinned) {
            this.timeWidth += Theme.chat_msgInPinnedDrawable.getIntrinsicWidth() + AndroidUtilities.dp(3.0f);
        }
        if (messageObject.scheduled) {
            if (messageObject.isSendError()) {
                this.timeWidth += AndroidUtilities.dp(18.0f);
            } else if (messageObject.isSending() && messageObject.messageOwner.peer_id.channel_id != 0 && !messageObject.isSupergroup()) {
                this.timeWidth += AndroidUtilities.dp(18.0f);
            }
        }
        if (this.reactionsLayoutInBubble.isSmall) {
            this.reactionsLayoutInBubble.measure(Integer.MAX_VALUE, 3);
            this.timeWidth += this.reactionsLayoutInBubble.width;
        }
        if (signString != null) {
            if (this.availableTimeWidth == 0) {
                this.availableTimeWidth = AndroidUtilities.dp(1000.0f);
            }
            int widthForSign = this.availableTimeWidth - this.timeWidth;
            if (messageObject.isOutOwner()) {
                if (messageObject.type == 5) {
                    widthForSign -= AndroidUtilities.dp(20.0f);
                } else {
                    widthForSign -= AndroidUtilities.dp(96.0f);
                }
            }
            int width = (int) Math.ceil(Theme.chat_timePaint.measureText(signString, 0, signString.length()));
            if (width > widthForSign) {
                if (widthForSign <= 0) {
                    signString = "";
                    width = 0;
                } else {
                    signString = TextUtils.ellipsize(signString, Theme.chat_timePaint, widthForSign, TextUtils.TruncateAt.END);
                    width = widthForSign;
                }
            }
            this.currentTimeString = ((Object) signString) + this.currentTimeString;
            this.timeTextWidth = this.timeTextWidth + width;
            this.timeWidth = this.timeWidth + width;
        }
    }

    private boolean shouldDrawSelectionOverlay() {
        return hasSelectionOverlay() && ((isPressed() && this.isCheckPressed) || ((!this.isCheckPressed && this.isPressed) || this.isHighlighted || this.isHighlightedAnimated)) && !textIsSelectionMode() && ((this.currentMessagesGroup == null || this.drawSelectionBackground) && this.currentBackgroundDrawable != null);
    }

    private Integer getSelectionOverlayColor() {
        Theme.ResourcesProvider resourcesProvider = this.resourcesProvider;
        if (resourcesProvider == null) {
            return null;
        }
        MessageObject messageObject = this.currentMessageObject;
        return resourcesProvider.getColor((messageObject == null || !messageObject.isOut()) ? Theme.key_chat_inBubbleSelectedOverlay : Theme.key_chat_outBubbleSelectedOverlay);
    }

    private boolean hasSelectionOverlay() {
        Integer selectionOverlayColor = getSelectionOverlayColor();
        return (selectionOverlayColor == null || selectionOverlayColor.intValue() == -65536) ? false : true;
    }

    private boolean isDrawSelectionBackground() {
        return ((isPressed() && this.isCheckPressed) || ((!this.isCheckPressed && this.isPressed) || this.isHighlighted)) && !textIsSelectionMode() && !hasSelectionOverlay();
    }

    public boolean isOpenChatByShare(MessageObject messageObject) {
        return (messageObject.messageOwner.fwd_from == null || messageObject.messageOwner.fwd_from.saved_from_peer == null) ? false : true;
    }

    private boolean checkNeedDrawShareButton(MessageObject messageObject) {
        if (this.currentMessageObject.deleted || this.currentMessageObject.isSponsored()) {
            return false;
        }
        if (this.currentPosition != null && !this.currentMessagesGroup.isDocuments && !this.currentPosition.last) {
            return false;
        }
        return messageObject.needDrawShareButton();
    }

    public boolean isInsideBackground(float x, float y) {
        if (this.currentBackgroundDrawable != null) {
            int i = this.backgroundDrawableLeft;
            if (x >= i && x <= i + this.backgroundDrawableRight) {
                return true;
            }
        }
        return false;
    }

    private void updateCurrentUserAndChat() {
        MessagesController messagesController = MessagesController.getInstance(this.currentAccount);
        TLRPC.MessageFwdHeader fwd_from = this.currentMessageObject.messageOwner.fwd_from;
        long currentUserId = UserConfig.getInstance(this.currentAccount).getClientUserId();
        if (fwd_from != null && (fwd_from.from_id instanceof TLRPC.TL_peerChannel) && this.currentMessageObject.getDialogId() == currentUserId) {
            this.currentChat = MessagesController.getInstance(this.currentAccount).getChat(Long.valueOf(fwd_from.from_id.channel_id));
        } else if (fwd_from != null && fwd_from.saved_from_peer != null) {
            if (fwd_from.saved_from_peer.user_id != 0) {
                if (fwd_from.from_id instanceof TLRPC.TL_peerUser) {
                    this.currentUser = messagesController.getUser(Long.valueOf(fwd_from.from_id.user_id));
                } else {
                    this.currentUser = messagesController.getUser(Long.valueOf(fwd_from.saved_from_peer.user_id));
                }
            } else if (fwd_from.saved_from_peer.channel_id != 0) {
                if (this.currentMessageObject.isSavedFromMegagroup() && (fwd_from.from_id instanceof TLRPC.TL_peerUser)) {
                    this.currentUser = messagesController.getUser(Long.valueOf(fwd_from.from_id.user_id));
                } else {
                    this.currentChat = messagesController.getChat(Long.valueOf(fwd_from.saved_from_peer.channel_id));
                }
            } else if (fwd_from.saved_from_peer.chat_id != 0) {
                if (fwd_from.from_id instanceof TLRPC.TL_peerUser) {
                    this.currentUser = messagesController.getUser(Long.valueOf(fwd_from.from_id.user_id));
                } else {
                    this.currentChat = messagesController.getChat(Long.valueOf(fwd_from.saved_from_peer.chat_id));
                }
            }
        } else if (fwd_from != null && (fwd_from.from_id instanceof TLRPC.TL_peerUser) && (fwd_from.imported || this.currentMessageObject.getDialogId() == currentUserId)) {
            this.currentUser = messagesController.getUser(Long.valueOf(fwd_from.from_id.user_id));
        } else if (fwd_from != null && !TextUtils.isEmpty(fwd_from.from_name) && (fwd_from.imported || this.currentMessageObject.getDialogId() == currentUserId)) {
            TLRPC.TL_user tL_user = new TLRPC.TL_user();
            this.currentUser = tL_user;
            tL_user.first_name = fwd_from.from_name;
        } else {
            long fromId = this.currentMessageObject.getFromChatId();
            if (DialogObject.isUserDialog(fromId) && !this.currentMessageObject.messageOwner.post) {
                this.currentUser = messagesController.getUser(Long.valueOf(fromId));
            } else if (DialogObject.isChatDialog(fromId)) {
                this.currentChat = messagesController.getChat(Long.valueOf(-fromId));
            } else if (this.currentMessageObject.messageOwner.post) {
                this.currentChat = messagesController.getChat(Long.valueOf(this.currentMessageObject.messageOwner.peer_id.channel_id));
            }
        }
    }

    /* JADX WARN: Can't wrap try/catch for region: R(23:242|(2:246|(1:248))|249|(1:251)(2:252|(1:254))|255|(6:(2:260|(26:262|(3:264|(3:266|(1:268)|269)(1:270)|271)|(1:273)|(1:290)(3:285|(1:287)(1:288)|289)|291|(2:293|(2:295|(3:297|(1:299)|300)(1:301))(1:302))(2:303|(1:305)(2:306|(2:308|(3:310|(1:312)|313)(2:314|(3:316|(1:318)|319)(2:320|(1:322))))(1:323)))|(1:325)|326|(1:328)(2:329|(1:331)(2:332|(4:334|(1:336)(1:337)|338|(1:340))(2:341|(1:352)(4:345|(1:347)(1:348)|349|(1:351)))))|353|(1:395)(1:396)|397|445|398|399|401|455|402|(1:404)(1:405)|406|(2:408|(1:410))|451|413|(1:415)(1:416)|417|(8:419|(3:421|(2:423|460)(1:461)|424)|459|(1:426)(1:427)|428|(1:430)|431|(1:435)))(1:354))(1:259)|451|413|(0)(0)|417|(0))|355|(1:357)(2:358|(1:360)(2:361|(1:363)))|364|(1:366)|367|(7:374|(1:(1:377)(1:378))(1:(1:380)(1:381))|382|(1:384)(1:385)|386|(1:392)|393)(1:373)|(0)(0)|397|445|398|399|401|455|402|(0)(0)|406|(0)) */
    /* JADX WARN: Can't wrap try/catch for region: R(28:242|(2:246|(1:248))|249|(1:251)(2:252|(1:254))|255|(2:260|(26:262|(3:264|(3:266|(1:268)|269)(1:270)|271)|(1:273)|(1:290)(3:285|(1:287)(1:288)|289)|291|(2:293|(2:295|(3:297|(1:299)|300)(1:301))(1:302))(2:303|(1:305)(2:306|(2:308|(3:310|(1:312)|313)(2:314|(3:316|(1:318)|319)(2:320|(1:322))))(1:323)))|(1:325)|326|(1:328)(2:329|(1:331)(2:332|(4:334|(1:336)(1:337)|338|(1:340))(2:341|(1:352)(4:345|(1:347)(1:348)|349|(1:351)))))|353|(1:395)(1:396)|397|445|398|399|401|455|402|(1:404)(1:405)|406|(2:408|(1:410))|451|413|(1:415)(1:416)|417|(8:419|(3:421|(2:423|460)(1:461)|424)|459|(1:426)(1:427)|428|(1:430)|431|(1:435)))(1:354))(1:259)|355|(1:357)(2:358|(1:360)(2:361|(1:363)))|364|(1:366)|367|(7:374|(1:(1:377)(1:378))(1:(1:380)(1:381))|382|(1:384)(1:385)|386|(1:392)|393)(1:373)|(0)(0)|397|445|398|399|401|455|402|(0)(0)|406|(0)|451|413|(0)(0)|417|(0)) */
    /* JADX WARN: Can't wrap try/catch for region: R(39:36|(1:38)|39|(1:48)(2:45|(24:47|73|(1:75)(1:(1:77)(1:78))|79|(1:81)(1:82)|83|(7:85|(1:87)|88|(1:90)(3:91|(1:93)(1:94)|95)|96|(1:98)(1:99)|100)(1:101)|449|102|103|440|105|(3:107|(1:109)|110)(1:111)|(1:113)(1:114)|117|(1:119)(1:120)|123|(2:125|(1:127)(2:128|(1:130)(2:131|(1:133))))|134|(1:203)(2:138|(4:143|(1:145)|146|(25:153|(1:(1:156)(2:157|(1:159)(1:160)))(1:(1:162)(1:163))|164|(1:166)|167|441|168|169|(1:173)(1:174)|175|(1:181)|182|457|183|184|443|186|187|447|188|453|189|(1:191)|192|(1:196))(1:152))(1:142))|204|(2:238|(28:242|(2:246|(1:248))|249|(1:251)(2:252|(1:254))|255|(2:260|(26:262|(3:264|(3:266|(1:268)|269)(1:270)|271)|(1:273)|(1:290)(3:285|(1:287)(1:288)|289)|291|(2:293|(2:295|(3:297|(1:299)|300)(1:301))(1:302))(2:303|(1:305)(2:306|(2:308|(3:310|(1:312)|313)(2:314|(3:316|(1:318)|319)(2:320|(1:322))))(1:323)))|(1:325)|326|(1:328)(2:329|(1:331)(2:332|(4:334|(1:336)(1:337)|338|(1:340))(2:341|(1:352)(4:345|(1:347)(1:348)|349|(1:351)))))|353|(1:395)(1:396)|397|445|398|399|401|455|402|(1:404)(1:405)|406|(2:408|(1:410))|451|413|(1:415)(1:416)|417|(8:419|(3:421|(2:423|460)(1:461)|424)|459|(1:426)(1:427)|428|(1:430)|431|(1:435)))(1:354))(1:259)|355|(1:357)(2:358|(1:360)(2:361|(1:363)))|364|(1:366)|367|(7:374|(1:(1:377)(1:378))(1:(1:380)(1:381))|382|(1:384)(1:385)|386|(1:392)|393)(1:373)|(0)(0)|397|445|398|399|401|455|402|(0)(0)|406|(0)|451|413|(0)(0)|417|(0)))(2:214|(6:222|(2:226|(1:228))|229|(1:231)(2:232|(1:234))|235|(1:237)))|438|439))|49|(3:56|(2:66|(3:68|(1:70)|71))|72)(1:55)|73|(0)(0)|79|(0)(0)|83|(0)(0)|449|102|103|440|105|(0)(0)|(0)(0)|117|(0)(0)|123|(0)|134|(1:136)|203|204|(1:206)|208|238|(1:240)|242|(3:244|246|(0))|249|(0)(0)|255|(1:257)|260|(0)(0)) */
    /* JADX WARN: Code restructure failed: missing block: B:115:0x03c0, code lost:
        r0 = move-exception;
     */
    /* JADX WARN: Code restructure failed: missing block: B:116:0x03c1, code lost:
        org.telegram.messenger.FileLog.e(r0);
     */
    /* JADX WARN: Code restructure failed: missing block: B:411:0x0cc1, code lost:
        r0 = move-exception;
     */
    /* JADX WARN: Code restructure failed: missing block: B:412:0x0cc2, code lost:
        org.telegram.messenger.FileLog.e(r0);
     */
    /* JADX WARN: Multi-variable type inference failed */
    /* JADX WARN: Removed duplicated region for block: B:101:0x0322  */
    /* JADX WARN: Removed duplicated region for block: B:107:0x035d A[Catch: Exception -> 0x03c0, TryCatch #0 {Exception -> 0x03c0, blocks: (B:105:0x033a, B:107:0x035d, B:109:0x0372, B:110:0x037d, B:111:0x0387, B:113:0x038c, B:114:0x03bc), top: B:440:0x033a }] */
    /* JADX WARN: Removed duplicated region for block: B:111:0x0387 A[Catch: Exception -> 0x03c0, TryCatch #0 {Exception -> 0x03c0, blocks: (B:105:0x033a, B:107:0x035d, B:109:0x0372, B:110:0x037d, B:111:0x0387, B:113:0x038c, B:114:0x03bc), top: B:440:0x033a }] */
    /* JADX WARN: Removed duplicated region for block: B:113:0x038c A[Catch: Exception -> 0x03c0, TryCatch #0 {Exception -> 0x03c0, blocks: (B:105:0x033a, B:107:0x035d, B:109:0x0372, B:110:0x037d, B:111:0x0387, B:113:0x038c, B:114:0x03bc), top: B:440:0x033a }] */
    /* JADX WARN: Removed duplicated region for block: B:114:0x03bc A[Catch: Exception -> 0x03c0, TRY_LEAVE, TryCatch #0 {Exception -> 0x03c0, blocks: (B:105:0x033a, B:107:0x035d, B:109:0x0372, B:110:0x037d, B:111:0x0387, B:113:0x038c, B:114:0x03bc), top: B:440:0x033a }] */
    /* JADX WARN: Removed duplicated region for block: B:119:0x03cc  */
    /* JADX WARN: Removed duplicated region for block: B:120:0x03d0  */
    /* JADX WARN: Removed duplicated region for block: B:121:0x03d2  */
    /* JADX WARN: Removed duplicated region for block: B:125:0x03f7  */
    /* JADX WARN: Removed duplicated region for block: B:136:0x0465  */
    /* JADX WARN: Removed duplicated region for block: B:206:0x06fe  */
    /* JADX WARN: Removed duplicated region for block: B:240:0x07c1  */
    /* JADX WARN: Removed duplicated region for block: B:244:0x07cb  */
    /* JADX WARN: Removed duplicated region for block: B:248:0x07df  */
    /* JADX WARN: Removed duplicated region for block: B:251:0x07f4  */
    /* JADX WARN: Removed duplicated region for block: B:252:0x07fa  */
    /* JADX WARN: Removed duplicated region for block: B:257:0x080c  */
    /* JADX WARN: Removed duplicated region for block: B:262:0x081e  */
    /* JADX WARN: Removed duplicated region for block: B:33:0x011b  */
    /* JADX WARN: Removed duplicated region for block: B:354:0x0ad4  */
    /* JADX WARN: Removed duplicated region for block: B:395:0x0c44  */
    /* JADX WARN: Removed duplicated region for block: B:396:0x0c46  */
    /* JADX WARN: Removed duplicated region for block: B:404:0x0c70  */
    /* JADX WARN: Removed duplicated region for block: B:405:0x0c73  */
    /* JADX WARN: Removed duplicated region for block: B:408:0x0c7e A[Catch: Exception -> 0x0cc1, TryCatch #8 {Exception -> 0x0cc1, blocks: (B:402:0x0c6c, B:406:0x0c74, B:408:0x0c7e, B:410:0x0c9d), top: B:455:0x0c6c }] */
    /* JADX WARN: Removed duplicated region for block: B:415:0x0cc9  */
    /* JADX WARN: Removed duplicated region for block: B:416:0x0ccc  */
    /* JADX WARN: Removed duplicated region for block: B:419:0x0cd7 A[Catch: Exception -> 0x0d77, TryCatch #6 {Exception -> 0x0d77, blocks: (B:413:0x0cc5, B:417:0x0ccd, B:419:0x0cd7, B:421:0x0cee, B:423:0x0cf9, B:424:0x0cfd, B:426:0x0d02, B:428:0x0d0e, B:430:0x0d33, B:431:0x0d56, B:433:0x0d63, B:435:0x0d6d), top: B:451:0x0cc5 }] */
    /* JADX WARN: Removed duplicated region for block: B:75:0x01f8  */
    /* JADX WARN: Removed duplicated region for block: B:76:0x01fd  */
    /* JADX WARN: Removed duplicated region for block: B:81:0x021a  */
    /* JADX WARN: Removed duplicated region for block: B:82:0x021d  */
    /* JADX WARN: Removed duplicated region for block: B:85:0x0228  */
    /* JADX WARN: Type inference failed for: r9v1, types: [org.telegram.tgnet.TLRPC$Chat, org.telegram.tgnet.TLRPC$User, java.lang.String] */
    /* JADX WARN: Type inference failed for: r9v37, types: [android.text.StaticLayout, java.lang.String] */
    /* JADX WARN: Type inference failed for: r9v38 */
    /* JADX WARN: Type inference failed for: r9v41 */
    /* JADX WARN: Type inference failed for: r9v42 */
    /* JADX WARN: Type inference failed for: r9v79 */
    /* JADX WARN: Type inference failed for: r9v80 */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    private void setMessageObjectInternal(MessageObject messageObject) {
        SpannableStringBuilder spannableStringBuilder;
        String viaUsername;
        String str;
        ?? r9;
        MessageObject.GroupedMessagePosition groupedMessagePosition;
        String str2;
        CharSequence stringFinalText;
        int maxWidth;
        CharSequence stringFinalName;
        TextStyleSpan[] textStyleSpanArr;
        CharSequence stringFinalText2;
        CharSequence stringFinalText3;
        CharSequence stringFinalText4;
        boolean z;
        boolean z2;
        String fromString;
        SpannableStringBuilder stringBuilder;
        int i;
        Exception e;
        ?? r92;
        String str3;
        int adminWidth;
        String adminLabel;
        String adminString;
        CharSequence nameStringFinal;
        StaticLayout staticLayout;
        CharSequence nameStringFinal2;
        ChatMessageCellDelegate chatMessageCellDelegate;
        if (((messageObject.messageOwner.flags & 1024) != 0 || messageObject.messageOwner.replies != null) && !this.currentMessageObject.scheduled && !this.currentMessageObject.isSponsored() && !this.currentMessageObject.viewsReloaded) {
            MessagesController.getInstance(this.currentAccount).addToViewsQueue(this.currentMessageObject);
            this.currentMessageObject.viewsReloaded = true;
        }
        updateCurrentUserAndChat();
        setAvatar(messageObject);
        measureTime(messageObject);
        this.namesOffset = 0;
        String viaUsername2 = null;
        SpannableStringBuilder spannableStringBuilder2 = null;
        if (messageObject.messageOwner.via_bot_id != 0) {
            TLRPC.User botUser = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(messageObject.messageOwner.via_bot_id));
            if (botUser != null && !TextUtils.isEmpty(botUser.username)) {
                viaUsername2 = "@" + botUser.username;
                spannableStringBuilder2 = AndroidUtilities.replaceTags(String.format(" %s <b>%s</b>", LocaleController.getString("ViaBot", R.string.ViaBot), viaUsername2));
                this.viaWidth = (int) Math.ceil(Theme.chat_replyNamePaint.measureText(spannableStringBuilder2, 0, spannableStringBuilder2.length()));
                this.currentViaBotUser = botUser;
            }
        } else if (!TextUtils.isEmpty(messageObject.messageOwner.via_bot_name)) {
            String viaUsername3 = "@" + messageObject.messageOwner.via_bot_name;
            SpannableStringBuilder replaceTags = AndroidUtilities.replaceTags(String.format(" %s <b>%s</b>", LocaleController.getString("ViaBot", R.string.ViaBot), viaUsername3));
            this.viaWidth = (int) Math.ceil(Theme.chat_replyNamePaint.measureText(replaceTags, 0, replaceTags.length()));
            spannableStringBuilder = replaceTags;
            viaUsername = viaUsername3;
            boolean needAuthorName = isNeedAuthorName();
            boolean viaBot = (messageObject.messageOwner.fwd_from != null || messageObject.type == 14) && viaUsername != null;
            if (!this.hasPsaHint) {
                str = "ViaBot";
                r92 = 0;
            } else if (needAuthorName || viaBot) {
                this.drawNameLayout = true;
                int maxNameWidth = getMaxNameWidth();
                this.nameWidth = maxNameWidth;
                if (maxNameWidth < 0) {
                    this.nameWidth = AndroidUtilities.dp(100.0f);
                }
                if (this.isMegagroup && this.currentChat != null && messageObject.messageOwner.post_author != null) {
                    str3 = "ViaBot";
                    if (this.currentChat.id == (-this.currentMessageObject.getFromChatId())) {
                        String adminString2 = messageObject.messageOwner.post_author.replace("\n", "");
                        int adminWidth2 = (int) Math.ceil(Theme.chat_adminPaint.measureText(adminString2));
                        this.nameWidth -= adminWidth2;
                        adminWidth = adminWidth2;
                        adminLabel = adminString2;
                        adminString = messageObject.customName;
                        if (adminString == null) {
                            this.currentNameString = messageObject.customName;
                        } else if (needAuthorName) {
                            this.currentNameString = getAuthorName();
                        } else {
                            this.currentNameString = "";
                        }
                        CharSequence nameStringFinal3 = TextUtils.ellipsize(this.currentNameString.replace('\n', ' ').replace((char) 8207, ' '), Theme.chat_namePaint, this.nameWidth - (!viaBot ? this.viaWidth : 0), TextUtils.TruncateAt.END);
                        if (!viaBot) {
                            int ceil = (int) Math.ceil(Theme.chat_namePaint.measureText(nameStringFinal3, 0, nameStringFinal3.length()));
                            this.viaNameWidth = ceil;
                            if (ceil != 0) {
                                this.viaNameWidth = ceil + AndroidUtilities.dp(4.0f);
                            }
                            int color = this.currentMessageObject.shouldDrawWithoutBackground() ? getThemedColor(Theme.key_chat_stickerViaBotNameText) : getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outViaBotNameText : Theme.key_chat_inViaBotNameText);
                            str = str3;
                            String viaBotString = LocaleController.getString(str, R.string.ViaBot);
                            if (this.currentNameString.length() > 0) {
                                SpannableStringBuilder stringBuilder2 = new SpannableStringBuilder(String.format("%s %s %s", nameStringFinal3, viaBotString, viaUsername));
                                TypefaceSpan typefaceSpan = new TypefaceSpan(Typeface.DEFAULT, 0, color);
                                this.viaSpan1 = typefaceSpan;
                                stringBuilder2.setSpan(typefaceSpan, nameStringFinal3.length() + 1, nameStringFinal3.length() + 1 + viaBotString.length(), 33);
                                TypefaceSpan typefaceSpan2 = new TypefaceSpan(AndroidUtilities.getTypeface(AndroidUtilities.TYPEFACE_ROBOTO_MEDIUM), 0, color);
                                this.viaSpan2 = typefaceSpan2;
                                stringBuilder2.setSpan(typefaceSpan2, nameStringFinal3.length() + 2 + viaBotString.length(), stringBuilder2.length(), 33);
                                nameStringFinal2 = stringBuilder2;
                            } else {
                                SpannableStringBuilder stringBuilder3 = new SpannableStringBuilder(String.format("%s %s", viaBotString, viaUsername));
                                TypefaceSpan typefaceSpan3 = new TypefaceSpan(Typeface.DEFAULT, 0, color);
                                this.viaSpan1 = typefaceSpan3;
                                stringBuilder3.setSpan(typefaceSpan3, 0, viaBotString.length() + 1, 33);
                                TypefaceSpan typefaceSpan4 = new TypefaceSpan(AndroidUtilities.getTypeface(AndroidUtilities.TYPEFACE_ROBOTO_MEDIUM), 0, color);
                                this.viaSpan2 = typefaceSpan4;
                                stringBuilder3.setSpan(typefaceSpan4, viaBotString.length() + 1, stringBuilder3.length(), 33);
                                nameStringFinal2 = stringBuilder3;
                            }
                            nameStringFinal = TextUtils.ellipsize(nameStringFinal2, Theme.chat_namePaint, this.nameWidth, TextUtils.TruncateAt.END);
                        } else {
                            str = str3;
                            nameStringFinal = nameStringFinal3;
                        }
                        nameStringFinal = Emoji.replaceEmoji(nameStringFinal, Theme.chat_namePaint.getFontMetricsInt(), AndroidUtilities.dp(14.0f), false);
                        staticLayout = new StaticLayout(nameStringFinal, Theme.chat_namePaint, this.nameWidth + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                        this.nameLayout = staticLayout;
                        if (staticLayout.getLineCount() <= 0) {
                            this.nameWidth = (int) Math.ceil(this.nameLayout.getLineWidth(0));
                            if (!messageObject.isAnyKindOfSticker()) {
                                this.namesOffset += AndroidUtilities.dp(19.0f);
                            }
                            this.nameOffsetX = this.nameLayout.getLineLeft(0);
                        } else {
                            this.nameWidth = 0;
                        }
                        if (adminLabel != null) {
                            this.adminLayout = null;
                        } else {
                            StaticLayout staticLayout2 = new StaticLayout(adminLabel, Theme.chat_adminPaint, adminWidth + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                            this.adminLayout = staticLayout2;
                            this.nameWidth = (int) (this.nameWidth + staticLayout2.getLineWidth(0) + AndroidUtilities.dp(8.0f));
                        }
                        if (this.currentNameString.length() == 0) {
                            r9 = 0;
                        } else {
                            r9 = 0;
                            this.currentNameString = null;
                        }
                        this.currentForwardUser = r9;
                        this.currentForwardNameString = r9;
                        this.currentForwardChannel = r9;
                        this.currentForwardName = r9;
                        StaticLayout[] staticLayoutArr = this.forwardedNameLayout;
                        staticLayoutArr[0] = r9;
                        staticLayoutArr[1] = r9;
                        this.replyPanelIsForward = false;
                        this.forwardedNameWidth = 0;
                        if (messageObject.isForwarded()) {
                            if (messageObject.messageOwner.fwd_from.from_id instanceof TLRPC.TL_peerChannel) {
                                this.currentForwardChannel = MessagesController.getInstance(this.currentAccount).getChat(Long.valueOf(messageObject.messageOwner.fwd_from.from_id.channel_id));
                            } else if (messageObject.messageOwner.fwd_from.from_id instanceof TLRPC.TL_peerChat) {
                                this.currentForwardChannel = MessagesController.getInstance(this.currentAccount).getChat(Long.valueOf(messageObject.messageOwner.fwd_from.from_id.chat_id));
                            } else if (messageObject.messageOwner.fwd_from.from_id instanceof TLRPC.TL_peerUser) {
                                this.currentForwardUser = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(messageObject.messageOwner.fwd_from.from_id.user_id));
                            }
                        }
                        if (!this.drawForwardedName && messageObject.needDrawForwarded()) {
                            MessageObject.GroupedMessagePosition groupedMessagePosition2 = this.currentPosition;
                            if (groupedMessagePosition2 == null || groupedMessagePosition2.minY == 0) {
                                if (messageObject.messageOwner.fwd_from.from_name != null) {
                                    this.currentForwardName = messageObject.messageOwner.fwd_from.from_name;
                                }
                                TLRPC.User user = this.currentForwardUser;
                                if (user != null || this.currentForwardChannel != null || this.currentForwardName != null) {
                                    TLRPC.Chat chat = this.currentForwardChannel;
                                    if (chat != null) {
                                        if (user != null) {
                                            this.currentForwardNameString = String.format("%s (%s)", chat.title, UserObject.getUserName(this.currentForwardUser));
                                        } else if (!TextUtils.isEmpty(messageObject.messageOwner.fwd_from.post_author)) {
                                            this.currentForwardNameString = String.format("%s (%s)", this.currentForwardChannel.title, messageObject.messageOwner.fwd_from.post_author);
                                        } else {
                                            this.currentForwardNameString = this.currentForwardChannel.title;
                                        }
                                    } else if (user != null) {
                                        this.currentForwardNameString = UserObject.getUserName(user);
                                    } else {
                                        this.currentForwardNameString = this.currentForwardName;
                                    }
                                    this.forwardedNameWidth = getMaxNameWidth();
                                    String forwardedString = getForwardedMessageText(messageObject);
                                    if (this.hasPsaHint) {
                                        this.forwardedNameWidth -= AndroidUtilities.dp(36.0f);
                                    }
                                    String from = LocaleController.getString("From", R.string.From);
                                    String fromFormattedString = LocaleController.getString("FromFormatted", R.string.FromFormatted);
                                    int idx = fromFormattedString.indexOf("%1$s");
                                    TextPaint textPaint = Theme.chat_forwardNamePaint;
                                    int fromWidth = (int) Math.ceil(textPaint.measureText(from + " "));
                                    CharSequence name = TextUtils.ellipsize(this.currentForwardNameString.replace('\n', ' '), Theme.chat_replyNamePaint, (float) ((this.forwardedNameWidth - fromWidth) - this.viaWidth), TextUtils.TruncateAt.END);
                                    try {
                                        fromString = String.format(fromFormattedString, name);
                                    } catch (Exception e2) {
                                        fromString = name.toString();
                                    }
                                    if (spannableStringBuilder != null) {
                                        CharSequence viaString = LocaleController.getString(str, R.string.ViaBot);
                                        SpannableStringBuilder stringBuilder4 = new SpannableStringBuilder(String.format("%s %s %s", fromString, viaString, viaUsername));
                                        this.viaNameWidth = (int) Math.ceil(Theme.chat_forwardNamePaint.measureText(fromString));
                                        stringBuilder4.setSpan(new TypefaceSpan(AndroidUtilities.getTypeface(AndroidUtilities.TYPEFACE_ROBOTO_MEDIUM)), (stringBuilder4.length() - viaUsername.length()) - 1, stringBuilder4.length(), 33);
                                        stringBuilder = stringBuilder4;
                                        i = 0;
                                    } else {
                                        i = 0;
                                        stringBuilder = new SpannableStringBuilder(String.format(fromFormattedString, name));
                                    }
                                    this.forwardNameCenterX = (((int) Math.ceil(Theme.chat_forwardNamePaint.measureText(name, i, name.length()))) / 2) + fromWidth;
                                    if (idx >= 0 && (this.currentForwardName == null || messageObject.messageOwner.fwd_from.from_id != null)) {
                                        stringBuilder.setSpan(new TypefaceSpan(AndroidUtilities.getTypeface(AndroidUtilities.TYPEFACE_ROBOTO_MEDIUM)), idx, name.length() + idx, 33);
                                    }
                                    CharSequence lastLine = TextUtils.ellipsize(stringBuilder, Theme.chat_forwardNamePaint, this.forwardedNameWidth, TextUtils.TruncateAt.END);
                                    try {
                                        lastLine = Emoji.replaceEmoji(lastLine, Theme.chat_forwardNamePaint.getFontMetricsInt(), AndroidUtilities.dp(14.0f), false);
                                    } catch (Exception e3) {
                                    }
                                    try {
                                        this.forwardedNameLayout[1] = new StaticLayout(lastLine, Theme.chat_forwardNamePaint, this.forwardedNameWidth + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                        try {
                                        } catch (Exception e4) {
                                            e = e4;
                                        }
                                    } catch (Exception e5) {
                                        e = e5;
                                    }
                                    try {
                                        this.forwardedNameLayout[0] = new StaticLayout(TextUtils.ellipsize(AndroidUtilities.replaceTags(forwardedString), Theme.chat_forwardNamePaint, this.forwardedNameWidth, TextUtils.TruncateAt.END), Theme.chat_forwardNamePaint, this.forwardedNameWidth + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                        int max = Math.max((int) Math.ceil(this.forwardedNameLayout[0].getLineWidth(0)), (int) Math.ceil(this.forwardedNameLayout[1].getLineWidth(0)));
                                        this.forwardedNameWidth = max;
                                        if (this.hasPsaHint) {
                                            this.forwardedNameWidth = max + AndroidUtilities.dp(36.0f);
                                        }
                                        this.forwardNameOffsetX[0] = this.forwardedNameLayout[0].getLineLeft(0);
                                        this.forwardNameOffsetX[1] = this.forwardedNameLayout[1].getLineLeft(0);
                                        if (messageObject.type != 5 && !messageObject.isAnyKindOfSticker()) {
                                            this.namesOffset += AndroidUtilities.dp(36.0f);
                                        }
                                    } catch (Exception e6) {
                                        e = e6;
                                        FileLog.e(e);
                                        if (this.isThreadChat) {
                                        }
                                        groupedMessagePosition = this.currentPosition;
                                        if (groupedMessagePosition != null) {
                                        }
                                        if (!messageObject.isAnyKindOfSticker()) {
                                        }
                                        int maxWidth2 = getMaxNameWidth();
                                        if (!messageObject.shouldDrawWithoutBackground()) {
                                        }
                                        String name2 = null;
                                        if (!this.isThreadChat) {
                                        }
                                        if (messageObject.hasValidReplyMessageObject()) {
                                        }
                                    }
                                }
                            }
                        }
                        if (((this.isThreadChat || messageObject.getReplyTopMsgId() != 0) && messageObject.hasValidReplyMessageObject()) || (messageObject.messageOwner.fwd_from != null && messageObject.isDice())) {
                            groupedMessagePosition = this.currentPosition;
                            if (groupedMessagePosition != null || groupedMessagePosition.minY == 0) {
                                if (!messageObject.isAnyKindOfSticker() && messageObject.type != 5) {
                                    this.namesOffset += AndroidUtilities.dp(42.0f);
                                    if (messageObject.type != 0) {
                                        this.namesOffset += AndroidUtilities.dp(5.0f);
                                    }
                                }
                                int maxWidth22 = getMaxNameWidth();
                                if (!messageObject.shouldDrawWithoutBackground()) {
                                    maxWidth22 -= AndroidUtilities.dp(10.0f);
                                } else if (messageObject.type == 5) {
                                    maxWidth22 += AndroidUtilities.dp(13.0f);
                                }
                                String name22 = null;
                                try {
                                    if (!this.isThreadChat && messageObject.getReplyTopMsgId() == 0) {
                                        stringFinalText3 = null;
                                        str2 = "";
                                    } else if (messageObject.hasValidReplyMessageObject()) {
                                        this.lastReplyMessage = messageObject.replyMessageObject.messageOwner;
                                        int cacheType = 1;
                                        int size = 0;
                                        TLRPC.PhotoSize photoSize = FileLoader.getClosestPhotoSizeWithSize(messageObject.replyMessageObject.photoThumbs2, GroupCallActivity.TABLET_LIST_SIZE);
                                        TLRPC.PhotoSize thumbPhotoSize = FileLoader.getClosestPhotoSizeWithSize(messageObject.replyMessageObject.photoThumbs2, 40);
                                        TLObject photoObject = messageObject.replyMessageObject.photoThumbsObject2;
                                        if (photoSize == null) {
                                            if (messageObject.replyMessageObject.mediaExists) {
                                                photoSize = FileLoader.getClosestPhotoSizeWithSize(messageObject.replyMessageObject.photoThumbs, AndroidUtilities.getPhotoSize());
                                                if (photoSize != null) {
                                                    size = photoSize.size;
                                                }
                                                cacheType = 0;
                                            } else {
                                                photoSize = FileLoader.getClosestPhotoSizeWithSize(messageObject.replyMessageObject.photoThumbs, GroupCallActivity.TABLET_LIST_SIZE);
                                            }
                                            thumbPhotoSize = FileLoader.getClosestPhotoSizeWithSize(messageObject.replyMessageObject.photoThumbs, 40);
                                            photoObject = messageObject.replyMessageObject.photoThumbsObject;
                                        }
                                        if (thumbPhotoSize == photoSize) {
                                            thumbPhotoSize = null;
                                        }
                                        if (photoSize == null || messageObject.replyMessageObject.isAnyKindOfSticker() || ((messageObject.isAnyKindOfSticker() && !AndroidUtilities.isTablet()) || messageObject.replyMessageObject.isSecretMedia() || messageObject.replyMessageObject.isWebpageDocument())) {
                                            this.replyImageReceiver.setImageBitmap((Drawable) null);
                                            this.needReplyImage = false;
                                        } else {
                                            if (messageObject.replyMessageObject.isRoundVideo()) {
                                                this.replyImageReceiver.setRoundRadius(AndroidUtilities.dp(22.0f));
                                            } else {
                                                this.replyImageReceiver.setRoundRadius(AndroidUtilities.dp(2.0f));
                                            }
                                            this.currentReplyPhoto = photoSize;
                                            this.replyImageReceiver.setImage(ImageLocation.getForObject(photoSize, photoObject), "50_50", ImageLocation.getForObject(thumbPhotoSize, photoObject), "50_50_b", size, null, messageObject.replyMessageObject, cacheType);
                                            this.needReplyImage = true;
                                            maxWidth22 -= AndroidUtilities.dp(44.0f);
                                        }
                                        if (messageObject.hideSendersName) {
                                            if (messageObject.sendAsPeer != null) {
                                                if (messageObject.sendAsPeer.channel_id != 0) {
                                                    TLRPC.Chat chat2 = MessagesController.getInstance(this.currentAccount).getChat(Long.valueOf(messageObject.sendAsPeer.channel_id));
                                                    if (chat2 != null) {
                                                        name22 = chat2.title;
                                                    }
                                                    stringFinalText4 = null;
                                                    str2 = "";
                                                } else {
                                                    name22 = UserObject.getUserName(MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(messageObject.sendAsPeer.user_id)));
                                                    stringFinalText4 = null;
                                                    str2 = "";
                                                }
                                            } else {
                                                name22 = UserObject.getUserName(AccountInstance.getInstance(this.currentAccount).getUserConfig().getCurrentUser());
                                                stringFinalText4 = null;
                                                str2 = "";
                                            }
                                        } else if (messageObject.customReplyName != null) {
                                            name22 = messageObject.customReplyName;
                                            stringFinalText4 = null;
                                            str2 = "";
                                        } else {
                                            name22 = messageObject.replyMessageObject.getForwardedName();
                                            if (name22 != null) {
                                                stringFinalText4 = null;
                                                str2 = "";
                                            } else {
                                                long fromId = messageObject.replyMessageObject.getFromChatId();
                                                if (fromId > 0) {
                                                    TLRPC.User user2 = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(fromId));
                                                    if (user2 != null) {
                                                        name22 = UserObject.getUserName(user2);
                                                    }
                                                    stringFinalText4 = null;
                                                    str2 = "";
                                                } else if (fromId < 0) {
                                                    stringFinalText4 = null;
                                                    TLRPC.Chat chat3 = MessagesController.getInstance(this.currentAccount).getChat(Long.valueOf(-fromId));
                                                    if (chat3 != null) {
                                                        name22 = chat3.title;
                                                    }
                                                    str2 = "";
                                                } else {
                                                    stringFinalText4 = null;
                                                    str2 = "";
                                                    TLRPC.Chat chat4 = MessagesController.getInstance(this.currentAccount).getChat(Long.valueOf(messageObject.replyMessageObject.messageOwner.peer_id.channel_id));
                                                    if (chat4 != null) {
                                                        name22 = chat4.title;
                                                    }
                                                }
                                            }
                                        }
                                        if (name22 == null) {
                                            name22 = LocaleController.getString("Loading", R.string.Loading);
                                        }
                                        if (messageObject.replyMessageObject.messageOwner.media instanceof TLRPC.TL_messageMediaGame) {
                                            stringFinalText = TextUtils.ellipsize(Emoji.replaceEmoji(messageObject.replyMessageObject.messageOwner.media.game.title, Theme.chat_replyTextPaint.getFontMetricsInt(), AndroidUtilities.dp(14.0f), false), Theme.chat_replyTextPaint, maxWidth22, TextUtils.TruncateAt.END);
                                        } else if (messageObject.replyMessageObject.messageOwner.media instanceof TLRPC.TL_messageMediaInvoice) {
                                            stringFinalText = TextUtils.ellipsize(Emoji.replaceEmoji(messageObject.replyMessageObject.messageOwner.media.title, Theme.chat_replyTextPaint.getFontMetricsInt(), AndroidUtilities.dp(14.0f), false), Theme.chat_replyTextPaint, maxWidth22, TextUtils.TruncateAt.END);
                                        } else if (!TextUtils.isEmpty(messageObject.replyMessageObject.caption)) {
                                            String mess = messageObject.replyMessageObject.caption.toString();
                                            if (mess.length() <= 150) {
                                                z2 = false;
                                            } else {
                                                z2 = false;
                                                mess = mess.substring(0, 150);
                                            }
                                            stringFinalText = TextUtils.ellipsize(Emoji.replaceEmoji(mess.replace('\n', ' '), Theme.chat_replyTextPaint.getFontMetricsInt(), AndroidUtilities.dp(14.0f), z2), Theme.chat_replyTextPaint, maxWidth22, TextUtils.TruncateAt.END);
                                            if (stringFinalText instanceof Spannable) {
                                                MediaDataController.addTextStyleRuns(messageObject.replyMessageObject.messageOwner.entities, messageObject.replyMessageObject.caption, (Spannable) stringFinalText);
                                            }
                                        } else if (messageObject.replyMessageObject.messageText != null && messageObject.replyMessageObject.messageText.length() > 0) {
                                            String mess2 = messageObject.replyMessageObject.messageText.toString();
                                            if (mess2.length() <= 150) {
                                                z = false;
                                            } else {
                                                z = false;
                                                mess2 = mess2.substring(0, 150);
                                            }
                                            stringFinalText = TextUtils.ellipsize(Emoji.replaceEmoji(mess2.replace('\n', ' '), Theme.chat_replyTextPaint.getFontMetricsInt(), AndroidUtilities.dp(14.0f), z), Theme.chat_replyTextPaint, maxWidth22, TextUtils.TruncateAt.END);
                                            if (stringFinalText instanceof Spannable) {
                                                MediaDataController.addTextStyleRuns(messageObject.replyMessageObject, (Spannable) stringFinalText);
                                            }
                                        } else {
                                            stringFinalText = stringFinalText4;
                                        }
                                        maxWidth = maxWidth22;
                                        stringFinalName = name22 != null ? str2 : TextUtils.ellipsize(name22.replace('\n', ' '), Theme.chat_replyNamePaint, maxWidth, TextUtils.TruncateAt.END);
                                        stringFinalName = Emoji.replaceEmoji(stringFinalName, Theme.chat_replyNamePaint.getFontMetricsInt(), AndroidUtilities.dp(14.0f), false);
                                        this.replyNameWidth = AndroidUtilities.dp((!this.needReplyImage ? 44 : 0) + 4);
                                        if (stringFinalName != null) {
                                            StaticLayout staticLayout3 = new StaticLayout(stringFinalName, Theme.chat_replyNamePaint, maxWidth + AndroidUtilities.dp(6.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                            this.replyNameLayout = staticLayout3;
                                            if (staticLayout3.getLineCount() > 0) {
                                                this.replyNameWidth += ((int) Math.ceil(this.replyNameLayout.getLineWidth(0))) + AndroidUtilities.dp(8.0f);
                                                this.replyNameOffset = (int) this.replyNameLayout.getLineLeft(0);
                                            }
                                        }
                                        this.replyTextWidth = AndroidUtilities.dp((!this.needReplyImage ? 44 : 0) + 4);
                                        if (stringFinalText != null) {
                                            SpannableStringBuilder sb = new SpannableStringBuilder(stringFinalText);
                                            boolean changed = false;
                                            for (TextStyleSpan span : (TextStyleSpan[]) sb.getSpans(0, sb.length(), TextStyleSpan.class)) {
                                                if ((span.getTextStyleRun().flags & 4) != 0) {
                                                    changed = true;
                                                    sb.removeSpan(span);
                                                }
                                            }
                                            if (changed) {
                                                stringFinalText2 = TextUtils.ellipsize(sb, Theme.chat_replyTextPaint, maxWidth, TextUtils.TruncateAt.END);
                                            } else {
                                                stringFinalText2 = sb;
                                            }
                                            StaticLayout staticLayout4 = new StaticLayout(stringFinalText2, Theme.chat_replyTextPaint, maxWidth + AndroidUtilities.dp(10.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                                            this.replyTextLayout = staticLayout4;
                                            if (staticLayout4.getLineCount() > 0) {
                                                this.replyTextWidth += ((int) Math.ceil(this.replyTextLayout.getLineWidth(0))) + AndroidUtilities.dp(8.0f);
                                                this.replyTextOffset = (int) this.replyTextLayout.getLineLeft(0);
                                            }
                                            this.replySpoilers.clear();
                                            if (getMessageObject().replyMessageObject != null && !getMessageObject().replyMessageObject.isSpoilersRevealed) {
                                                SpoilerEffect.addSpoilers(this, this.replyTextLayout, this.replySpoilersPool, this.replySpoilers);
                                            }
                                        }
                                    } else {
                                        stringFinalText3 = null;
                                        str2 = "";
                                    }
                                    this.replyTextWidth = AndroidUtilities.dp((!this.needReplyImage ? 44 : 0) + 4);
                                    if (stringFinalText != null) {
                                    }
                                } catch (Exception e7) {
                                    FileLog.e(e7);
                                }
                                this.replyImageReceiver.setImageBitmap((Drawable) null);
                                this.needReplyImage = false;
                                this.replyPanelIsForward = true;
                                if (messageObject.messageOwner.fwd_from.from_id instanceof TLRPC.TL_peerChannel) {
                                    this.currentForwardChannel = MessagesController.getInstance(this.currentAccount).getChat(Long.valueOf(messageObject.messageOwner.fwd_from.from_id.channel_id));
                                } else if (messageObject.messageOwner.fwd_from.from_id instanceof TLRPC.TL_peerChat) {
                                    this.currentForwardChannel = MessagesController.getInstance(this.currentAccount).getChat(Long.valueOf(messageObject.messageOwner.fwd_from.from_id.chat_id));
                                } else if (messageObject.messageOwner.fwd_from.from_id instanceof TLRPC.TL_peerUser) {
                                    this.currentForwardUser = MessagesController.getInstance(this.currentAccount).getUser(Long.valueOf(messageObject.messageOwner.fwd_from.from_id.user_id));
                                }
                                if (messageObject.messageOwner.fwd_from.from_name != null) {
                                    this.currentForwardName = messageObject.messageOwner.fwd_from.from_name;
                                }
                                TLRPC.User user3 = this.currentForwardUser;
                                if (user3 == null && this.currentForwardChannel == null && this.currentForwardName == null) {
                                    maxWidth = maxWidth22;
                                    stringFinalText = stringFinalText3;
                                } else {
                                    TLRPC.Chat chat5 = this.currentForwardChannel;
                                    if (chat5 != null) {
                                        if (user3 != null) {
                                            this.currentForwardNameString = String.format("%s (%s)", chat5.title, UserObject.getUserName(this.currentForwardUser));
                                        } else {
                                            this.currentForwardNameString = chat5.title;
                                        }
                                    } else if (user3 != null) {
                                        this.currentForwardNameString = UserObject.getUserName(user3);
                                    } else {
                                        this.currentForwardNameString = this.currentForwardName;
                                    }
                                    name22 = getForwardedMessageText(messageObject);
                                    String from2 = LocaleController.getString("From", R.string.From);
                                    String fromFormattedString2 = LocaleController.getString("FromFormatted", R.string.FromFormatted);
                                    int idx2 = fromFormattedString2.indexOf("%1$s");
                                    TextPaint textPaint2 = Theme.chat_replyNamePaint;
                                    int fromWidth2 = (int) Math.ceil(textPaint2.measureText(from2 + " "));
                                    String str4 = this.currentForwardNameString;
                                    CharSequence n = TextUtils.ellipsize(str4 == null ? str2 : str4.replace('\n', ' '), Theme.chat_replyNamePaint, maxWidth22 - fromWidth2, TextUtils.TruncateAt.END);
                                    SpannableStringBuilder stringBuilder5 = new SpannableStringBuilder(String.format(fromFormattedString2, n));
                                    if (idx2 >= 0 && (this.currentForwardName == null || messageObject.messageOwner.fwd_from.from_id != null)) {
                                        stringBuilder5.setSpan(new TypefaceSpan(AndroidUtilities.getTypeface(AndroidUtilities.TYPEFACE_ROBOTO_MEDIUM)), idx2, n.length() + idx2, 33);
                                    }
                                    CharSequence stringFinalText5 = TextUtils.ellipsize(stringBuilder5, Theme.chat_replyTextPaint, maxWidth22, TextUtils.TruncateAt.END);
                                    this.forwardNameCenterX = (((int) Math.ceil(Theme.chat_replyNamePaint.measureText(n, 0, n.length()))) / 2) + fromWidth2;
                                    maxWidth = maxWidth22;
                                    stringFinalText = stringFinalText5;
                                }
                                stringFinalName = name22 != null ? str2 : TextUtils.ellipsize(name22.replace('\n', ' '), Theme.chat_replyNamePaint, maxWidth, TextUtils.TruncateAt.END);
                                stringFinalName = Emoji.replaceEmoji(stringFinalName, Theme.chat_replyNamePaint.getFontMetricsInt(), AndroidUtilities.dp(14.0f), false);
                                this.replyNameWidth = AndroidUtilities.dp((!this.needReplyImage ? 44 : 0) + 4);
                                if (stringFinalName != null) {
                                }
                            }
                        } else if (!this.isThreadChat && messageObject.getReplyMsgId() != 0 && (messageObject.replyMessageObject == null || !(messageObject.replyMessageObject.messageOwner instanceof TLRPC.TL_messageEmpty))) {
                            if (!messageObject.isAnyKindOfSticker() && messageObject.type != 5) {
                                this.namesOffset += AndroidUtilities.dp(42.0f);
                                if (messageObject.type != 0) {
                                    this.namesOffset += AndroidUtilities.dp(5.0f);
                                }
                            }
                            this.needReplyImage = false;
                            int maxWidth3 = getMaxNameWidth();
                            if (!messageObject.shouldDrawWithoutBackground()) {
                                maxWidth3 -= AndroidUtilities.dp(10.0f);
                            } else if (messageObject.type == 5) {
                                maxWidth3 += AndroidUtilities.dp(13.0f);
                            }
                            StaticLayout staticLayout5 = new StaticLayout(LocaleController.getString("Loading", R.string.Loading), Theme.chat_replyNamePaint, maxWidth3 + AndroidUtilities.dp(6.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                            this.replyNameLayout = staticLayout5;
                            if (staticLayout5.getLineCount() > 0) {
                                this.replyNameWidth += ((int) Math.ceil(this.replyNameLayout.getLineWidth(0))) + AndroidUtilities.dp(8.0f);
                                this.replyNameOffset = (int) this.replyNameLayout.getLineLeft(0);
                            }
                        }
                        requestLayout();
                        return;
                    }
                } else {
                    str3 = "ViaBot";
                }
                if (this.isMegagroup && this.currentChat != null && this.currentMessageObject.isForwardedChannelPost()) {
                    String adminString3 = LocaleController.getString("DiscussChannel", R.string.DiscussChannel);
                    int adminWidth3 = (int) Math.ceil(Theme.chat_adminPaint.measureText(adminString3));
                    this.nameWidth -= adminWidth3;
                    adminWidth = adminWidth3;
                    adminLabel = adminString3;
                } else {
                    if (this.currentUser != null && !this.currentMessageObject.isOutOwner() && !this.currentMessageObject.isAnyKindOfSticker() && this.currentMessageObject.type != 5 && (chatMessageCellDelegate = this.delegate) != null) {
                        String adminRank = chatMessageCellDelegate.getAdminRank(this.currentUser.id);
                        adminLabel = adminRank;
                        if (adminRank != null) {
                            if (adminLabel.length() == 0) {
                                adminLabel = LocaleController.getString("ChatAdmin", R.string.ChatAdmin);
                            }
                            String adminString4 = adminLabel;
                            adminWidth = (int) Math.ceil(Theme.chat_adminPaint.measureText(adminString4));
                            this.nameWidth -= adminWidth;
                        }
                    }
                    adminWidth = 0;
                    adminLabel = null;
                }
                adminString = messageObject.customName;
                if (adminString == null) {
                }
                CharSequence nameStringFinal32 = TextUtils.ellipsize(this.currentNameString.replace('\n', ' ').replace((char) 8207, ' '), Theme.chat_namePaint, this.nameWidth - (!viaBot ? this.viaWidth : 0), TextUtils.TruncateAt.END);
                if (!viaBot) {
                }
                nameStringFinal = Emoji.replaceEmoji(nameStringFinal, Theme.chat_namePaint.getFontMetricsInt(), AndroidUtilities.dp(14.0f), false);
                staticLayout = new StaticLayout(nameStringFinal, Theme.chat_namePaint, this.nameWidth + AndroidUtilities.dp(2.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                this.nameLayout = staticLayout;
                if (staticLayout.getLineCount() <= 0) {
                }
                if (adminLabel != null) {
                }
                if (this.currentNameString.length() == 0) {
                }
                this.currentForwardUser = r9;
                this.currentForwardNameString = r9;
                this.currentForwardChannel = r9;
                this.currentForwardName = r9;
                StaticLayout[] staticLayoutArr2 = this.forwardedNameLayout;
                staticLayoutArr2[0] = r9;
                staticLayoutArr2[1] = r9;
                this.replyPanelIsForward = false;
                this.forwardedNameWidth = 0;
                if (messageObject.isForwarded()) {
                }
                if (!this.drawForwardedName) {
                }
                if (this.isThreadChat) {
                }
                groupedMessagePosition = this.currentPosition;
                if (groupedMessagePosition != null) {
                }
                if (!messageObject.isAnyKindOfSticker()) {
                    this.namesOffset += AndroidUtilities.dp(42.0f);
                    if (messageObject.type != 0) {
                    }
                }
                int maxWidth222 = getMaxNameWidth();
                if (!messageObject.shouldDrawWithoutBackground()) {
                }
                String name222 = null;
                if (!this.isThreadChat) {
                }
                if (messageObject.hasValidReplyMessageObject()) {
                }
            } else {
                str = "ViaBot";
                r92 = 0;
            }
            this.currentNameString = r92;
            this.nameLayout = r92;
            this.nameWidth = 0;
            r9 = r92;
            this.currentForwardUser = r9;
            this.currentForwardNameString = r9;
            this.currentForwardChannel = r9;
            this.currentForwardName = r9;
            StaticLayout[] staticLayoutArr22 = this.forwardedNameLayout;
            staticLayoutArr22[0] = r9;
            staticLayoutArr22[1] = r9;
            this.replyPanelIsForward = false;
            this.forwardedNameWidth = 0;
            if (messageObject.isForwarded()) {
            }
            if (!this.drawForwardedName) {
            }
            if (this.isThreadChat) {
            }
            groupedMessagePosition = this.currentPosition;
            if (groupedMessagePosition != null) {
            }
            if (!messageObject.isAnyKindOfSticker()) {
            }
            int maxWidth2222 = getMaxNameWidth();
            if (!messageObject.shouldDrawWithoutBackground()) {
            }
            String name2222 = null;
            if (!this.isThreadChat) {
            }
            if (messageObject.hasValidReplyMessageObject()) {
            }
        }
        spannableStringBuilder = spannableStringBuilder2;
        viaUsername = viaUsername2;
        boolean needAuthorName2 = isNeedAuthorName();
        boolean viaBot2 = (messageObject.messageOwner.fwd_from != null || messageObject.type == 14) && viaUsername != null;
        if (!this.hasPsaHint) {
        }
        this.currentNameString = r92;
        this.nameLayout = r92;
        this.nameWidth = 0;
        r9 = r92;
        this.currentForwardUser = r9;
        this.currentForwardNameString = r9;
        this.currentForwardChannel = r9;
        this.currentForwardName = r9;
        StaticLayout[] staticLayoutArr222 = this.forwardedNameLayout;
        staticLayoutArr222[0] = r9;
        staticLayoutArr222[1] = r9;
        this.replyPanelIsForward = false;
        this.forwardedNameWidth = 0;
        if (messageObject.isForwarded()) {
        }
        if (!this.drawForwardedName) {
        }
        if (this.isThreadChat) {
        }
        groupedMessagePosition = this.currentPosition;
        if (groupedMessagePosition != null) {
        }
        if (!messageObject.isAnyKindOfSticker()) {
        }
        int maxWidth22222 = getMaxNameWidth();
        if (!messageObject.shouldDrawWithoutBackground()) {
        }
        String name22222 = null;
        if (!this.isThreadChat) {
        }
        if (messageObject.hasValidReplyMessageObject()) {
        }
    }

    private boolean isNeedAuthorName() {
        return (this.isPinnedChat && this.currentMessageObject.type == 0) || ((!this.pinnedTop || (ChatObject.isChannel(this.currentChat) && !this.currentChat.megagroup)) && this.drawName && this.isChat && (!this.currentMessageObject.isOutOwner() || (this.currentMessageObject.isSupergroup() && this.currentMessageObject.isFromGroup()))) || (this.currentMessageObject.isImportedForward() && this.currentMessageObject.messageOwner.fwd_from.from_id == null);
    }

    private String getAuthorName() {
        TLRPC.User user = this.currentUser;
        if (user != null) {
            return UserObject.getUserName(user);
        }
        TLRPC.Chat chat = this.currentChat;
        if (chat != null) {
            return chat.title;
        }
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null && messageObject.isSponsored()) {
            if (this.currentMessageObject.sponsoredChatInvite != null && this.currentMessageObject.sponsoredChatInvite.title != null) {
                return this.currentMessageObject.sponsoredChatInvite.title;
            }
            if (this.currentMessageObject.sponsoredChatInvite != null && this.currentMessageObject.sponsoredChatInvite.chat != null && this.currentMessageObject.sponsoredChatInvite.chat.title != null) {
                return this.currentMessageObject.sponsoredChatInvite.chat.title;
            }
            return "";
        }
        return "DELETED";
    }

    private String getForwardedMessageText(MessageObject messageObject) {
        if (this.hasPsaHint) {
            String forwardedString = LocaleController.getString("PsaMessage_" + messageObject.messageOwner.fwd_from.psa_type);
            if (forwardedString == null) {
                return LocaleController.getString("PsaMessageDefault", R.string.PsaMessageDefault);
            }
            return forwardedString;
        }
        return LocaleController.getString("ForwardedMessage", R.string.ForwardedMessage);
    }

    public int getExtraInsetHeight() {
        int h = this.addedCaptionHeight;
        if (this.drawCommentButton) {
            h += AndroidUtilities.dp(shouldDrawTimeOnMedia() ? 41.3f : 43.0f);
        }
        if (!this.reactionsLayoutInBubble.isEmpty && this.currentMessageObject.shouldDrawReactionsInLayout()) {
            return h + this.reactionsLayoutInBubble.totalHeight;
        }
        return h;
    }

    public ImageReceiver getAvatarImage() {
        if (this.isAvatarVisible) {
            return this.avatarImage;
        }
        return null;
    }

    public float getCheckBoxTranslation() {
        return this.checkBoxTranslation;
    }

    public boolean shouldDrawAlphaLayer() {
        MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
        return (groupedMessages == null || !groupedMessages.transitionParams.backgroundChangeBounds) && getAlpha() != 1.0f;
    }

    public float getCaptionX() {
        return this.captionX;
    }

    public boolean isDrawPinnedBottom() {
        MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
        boolean forceMediaByGroup = groupedMessagePosition != null && (groupedMessagePosition.flags & 8) == 0 && this.currentMessagesGroup.isDocuments;
        return this.mediaBackground || this.drawPinnedBottom || forceMediaByGroup;
    }

    public void drawCheckBox(Canvas canvas) {
        float y;
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject == null || messageObject.isSending() || this.currentMessageObject.isSendError() || this.checkBox == null) {
            return;
        }
        if (!this.checkBoxVisible && !this.checkBoxAnimationInProgress) {
            return;
        }
        MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
        if (groupedMessagePosition == null || ((groupedMessagePosition.flags & 8) != 0 && (this.currentPosition.flags & 1) != 0)) {
            canvas.save();
            float y2 = getY();
            MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
            if (groupedMessages != null && groupedMessages.messages.size() > 1) {
                y = (getTop() + this.currentMessagesGroup.transitionParams.offsetTop) - getTranslationY();
            } else {
                y = this.transitionParams.deltaTop + y2;
            }
            canvas.translate(0.0f, this.transitionYOffsetForDrawables + y);
            this.checkBox.draw(canvas);
            canvas.restore();
        }
    }

    public void setBackgroundTopY(boolean fromParent) {
        int h;
        int w;
        int a = 0;
        while (a < 2) {
            if (a == 1 && !fromParent) {
                return;
            }
            Theme.MessageDrawable drawable = a == 0 ? this.currentBackgroundDrawable : this.currentBackgroundSelectedDrawable;
            if (drawable != null) {
                int w2 = this.parentWidth;
                int h2 = this.parentHeight;
                if (h2 != 0) {
                    w = w2;
                    h = h2;
                } else {
                    int w3 = getParentWidth();
                    int h3 = AndroidUtilities.displaySize.y;
                    if (!(getParent() instanceof View)) {
                        w = w3;
                        h = h3;
                    } else {
                        View view = (View) getParent();
                        int w4 = view.getMeasuredWidth();
                        w = w4;
                        h = view.getMeasuredHeight();
                    }
                }
                float y = fromParent ? getY() : getTop();
                float f = this.parentViewTopOffset;
                drawable.setTop((int) (y + f), w, h, (int) f, this.blurredViewTopOffset, this.blurredViewBottomOffset, this.pinnedTop, this.pinnedBottom || this.transitionParams.changePinnedBottomProgress != 1.0f);
            }
            a++;
        }
    }

    public void setBackgroundTopY(int offset) {
        int h;
        int w;
        Theme.MessageDrawable drawable = this.currentBackgroundDrawable;
        int w2 = this.parentWidth;
        int h2 = this.parentHeight;
        if (h2 != 0) {
            w = w2;
            h = h2;
        } else {
            int w3 = getParentWidth();
            int h3 = AndroidUtilities.displaySize.y;
            if (!(getParent() instanceof View)) {
                w = w3;
                h = h3;
            } else {
                View view = (View) getParent();
                int w4 = view.getMeasuredWidth();
                w = w4;
                h = view.getMeasuredHeight();
            }
        }
        float f = this.parentViewTopOffset;
        drawable.setTop((int) (offset + f), w, h, (int) f, this.blurredViewTopOffset, this.blurredViewBottomOffset, this.pinnedTop, this.pinnedBottom || this.transitionParams.changePinnedBottomProgress != 1.0f);
    }

    public void setDrawableBoundsInner(Drawable drawable, int x, int y, int w, int h) {
        if (drawable != null) {
            this.transitionYOffsetForDrawables = ((y + h) + this.transitionParams.deltaBottom) - ((int) ((y + h) + this.transitionParams.deltaBottom));
            drawable.setBounds((int) (x + this.transitionParams.deltaLeft), (int) (y + this.transitionParams.deltaTop), (int) (x + w + this.transitionParams.deltaRight), (int) (y + h + this.transitionParams.deltaBottom));
        }
    }

    @Override // android.view.View
    protected void onDraw(Canvas canvas) {
        MessageObject.GroupedMessagePosition groupedMessagePosition;
        Theme.MessageDrawable messageDrawable;
        if (this.currentMessageObject == null) {
            return;
        }
        boolean z = this.wasLayout;
        if (!z && !this.animationRunning) {
            forceLayout();
            return;
        }
        if (!z) {
            onLayout(false, getLeft(), getTop(), getRight(), getBottom());
        }
        if (this.currentMessageObject.isOutOwner()) {
            Theme.chat_msgTextPaint.setColor(getThemedColor(Theme.key_chat_messageTextOut));
            Theme.chat_msgGameTextPaint.setColor(getThemedColor(Theme.key_chat_messageTextOut));
            Theme.chat_msgGameTextPaint.linkColor = getThemedColor(Theme.key_chat_messageLinkOut);
            Theme.chat_replyTextPaint.linkColor = getThemedColor(Theme.key_chat_messageLinkOut);
            Theme.chat_msgTextPaint.linkColor = getThemedColor(Theme.key_chat_messageLinkOut);
        } else {
            Theme.chat_msgTextPaint.setColor(getThemedColor(Theme.key_chat_messageTextIn));
            Theme.chat_msgGameTextPaint.setColor(getThemedColor(Theme.key_chat_messageTextIn));
            Theme.chat_msgGameTextPaint.linkColor = getThemedColor(Theme.key_chat_messageLinkIn);
            Theme.chat_replyTextPaint.linkColor = getThemedColor(Theme.key_chat_messageLinkIn);
            Theme.chat_msgTextPaint.linkColor = getThemedColor(Theme.key_chat_messageLinkIn);
        }
        if (this.documentAttach != null) {
            int i = this.documentAttachType;
            if (i == 3) {
                if (this.currentMessageObject.isOutOwner()) {
                    this.seekBarWaveform.setColors(getThemedColor(Theme.key_chat_outVoiceSeekbar), getThemedColor(Theme.key_chat_outVoiceSeekbarFill), getThemedColor(Theme.key_chat_outVoiceSeekbarSelected));
                    this.seekBar.setColors(getThemedColor(Theme.key_chat_outAudioSeekbar), getThemedColor(Theme.key_chat_outAudioCacheSeekbar), getThemedColor(Theme.key_chat_outAudioSeekbarFill), getThemedColor(Theme.key_chat_outAudioSeekbarFill), getThemedColor(Theme.key_chat_outAudioSeekbarSelected));
                } else {
                    this.seekBarWaveform.setColors(getThemedColor(Theme.key_chat_inVoiceSeekbar), getThemedColor(Theme.key_chat_inVoiceSeekbarFill), getThemedColor(Theme.key_chat_inVoiceSeekbarSelected));
                    this.seekBar.setColors(getThemedColor(Theme.key_chat_inAudioSeekbar), getThemedColor(Theme.key_chat_inAudioCacheSeekbar), getThemedColor(Theme.key_chat_inAudioSeekbarFill), getThemedColor(Theme.key_chat_inAudioSeekbarFill), getThemedColor(Theme.key_chat_inAudioSeekbarSelected));
                }
            } else if (i == 5) {
                if (this.currentMessageObject.isOutOwner()) {
                    this.seekBar.setColors(getThemedColor(Theme.key_chat_outAudioSeekbar), getThemedColor(Theme.key_chat_outAudioCacheSeekbar), getThemedColor(Theme.key_chat_outAudioSeekbarFill), getThemedColor(Theme.key_chat_outAudioSeekbarFill), getThemedColor(Theme.key_chat_outAudioSeekbarSelected));
                } else {
                    this.seekBar.setColors(getThemedColor(Theme.key_chat_inAudioSeekbar), getThemedColor(Theme.key_chat_inAudioCacheSeekbar), getThemedColor(Theme.key_chat_inAudioSeekbarFill), getThemedColor(Theme.key_chat_inAudioSeekbarFill), getThemedColor(Theme.key_chat_inAudioSeekbarSelected));
                }
            }
        }
        if (this.currentMessageObject.type == 5) {
            Theme.chat_timePaint.setColor(getThemedColor(Theme.key_chat_serviceText));
        } else if (this.mediaBackground) {
            if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                Theme.chat_timePaint.setColor(getThemedColor(Theme.key_chat_serviceText));
            } else {
                Theme.chat_timePaint.setColor(getThemedColor(Theme.key_chat_mediaTimeText));
            }
        } else if (this.currentMessageObject.isOutOwner()) {
            Theme.chat_timePaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outTimeSelectedText : Theme.key_chat_outTimeText));
        } else {
            Theme.chat_timePaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inTimeSelectedText : Theme.key_chat_inTimeText));
        }
        drawBackgroundInternal(canvas, false);
        if (this.isHighlightedAnimated) {
            long newTime = System.currentTimeMillis();
            long dt = Math.abs(newTime - this.lastHighlightProgressTime);
            if (dt > 17) {
                dt = 17;
            }
            int i2 = (int) (this.highlightProgress - dt);
            this.highlightProgress = i2;
            this.lastHighlightProgressTime = newTime;
            if (i2 <= 0) {
                this.highlightProgress = 0;
                this.isHighlightedAnimated = false;
            }
            invalidate();
            if (getParent() != null) {
                ((View) getParent()).invalidate();
            }
        }
        int restore = Integer.MIN_VALUE;
        if (this.alphaInternal != 1.0f) {
            int top = 0;
            int left = 0;
            int bottom = getMeasuredHeight();
            int right = getMeasuredWidth();
            Theme.MessageDrawable messageDrawable2 = this.currentBackgroundDrawable;
            if (messageDrawable2 != null) {
                top = messageDrawable2.getBounds().top;
                bottom = this.currentBackgroundDrawable.getBounds().bottom;
                left = this.currentBackgroundDrawable.getBounds().left;
                right = this.currentBackgroundDrawable.getBounds().right;
            }
            if (this.drawSideButton != 0) {
                if (this.currentMessageObject.isOutOwner()) {
                    left -= AndroidUtilities.dp(40.0f);
                } else {
                    right += AndroidUtilities.dp(40.0f);
                }
            }
            if (getY() < 0.0f) {
                top = (int) (-getY());
            }
            float y = getY() + getMeasuredHeight();
            int i3 = this.parentHeight;
            if (y > i3) {
                bottom = (int) (i3 - getY());
            }
            this.rect.set(left, top, right, bottom);
            restore = canvas.saveLayerAlpha(this.rect, (int) (this.alphaInternal * 255.0f), 31);
        }
        boolean clipContent = false;
        if (this.transitionParams.animateBackgroundBoundsInner && (messageDrawable = this.currentBackgroundDrawable) != null && !this.isRoundVideo) {
            Rect r = messageDrawable.getBounds();
            canvas.save();
            canvas.clipRect(r.left + AndroidUtilities.dp(4.0f), r.top + AndroidUtilities.dp(4.0f), r.right - AndroidUtilities.dp(4.0f), r.bottom - AndroidUtilities.dp(4.0f));
            clipContent = true;
        }
        drawContent(canvas);
        if (clipContent) {
            canvas.restore();
        }
        ChatMessageCellDelegate chatMessageCellDelegate = this.delegate;
        if (chatMessageCellDelegate == null || chatMessageCellDelegate.canDrawOutboundsContent() || getAlpha() != 1.0f) {
            drawOutboundsContent(canvas);
        }
        if (this.replyNameLayout != null) {
            float f = 12.0f;
            if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                if (this.currentMessageObject.isOutOwner()) {
                    int dp = AndroidUtilities.dp(23.0f);
                    this.replyStartX = dp;
                    if (this.isPlayingRound) {
                        this.replyStartX = dp - (AndroidUtilities.roundPlayingMessageSize - AndroidUtilities.roundMessageSize);
                    }
                } else if (this.currentMessageObject.type == 5) {
                    this.replyStartX = this.backgroundDrawableLeft + this.backgroundDrawableRight + AndroidUtilities.dp(4.0f);
                } else {
                    this.replyStartX = this.backgroundDrawableLeft + this.backgroundDrawableRight + AndroidUtilities.dp(17.0f);
                }
                if (this.drawForwardedName) {
                    this.replyStartY = this.forwardNameY + AndroidUtilities.dp(38.0f);
                } else {
                    this.replyStartY = AndroidUtilities.dp(12.0f);
                }
            } else {
                if (this.currentMessageObject.isOutOwner()) {
                    this.replyStartX = this.backgroundDrawableLeft + AndroidUtilities.dp(12.0f) + getExtraTextX();
                } else if (this.mediaBackground) {
                    this.replyStartX = this.backgroundDrawableLeft + AndroidUtilities.dp(12.0f) + getExtraTextX();
                } else {
                    int i4 = this.backgroundDrawableLeft;
                    if (!this.drawPinnedBottom) {
                        f = 18.0f;
                    }
                    this.replyStartX = i4 + AndroidUtilities.dp(f) + getExtraTextX();
                }
                this.replyStartY = AndroidUtilities.dp(12 + ((!this.drawForwardedName || this.forwardedNameLayout[0] == null) ? 0 : 36) + ((!this.drawNameLayout || this.nameLayout == null) ? 0 : 20));
            }
        }
        if (this.currentPosition == null && !this.transitionParams.animateBackgroundBoundsInner && (!this.enterTransitionInProgress || this.currentMessageObject.isVoice())) {
            drawNamesLayout(canvas, 1.0f);
        }
        if ((!this.autoPlayingMedia || !MediaController.getInstance().isPlayingMessageAndReadyToDraw(this.currentMessageObject) || this.isRoundVideo) && !this.transitionParams.animateBackgroundBoundsInner) {
            drawOverlays(canvas);
        }
        if ((this.drawTime || !this.mediaBackground) && !this.forceNotDrawTime && !this.transitionParams.animateBackgroundBoundsInner && (!this.enterTransitionInProgress || this.currentMessageObject.isVoice())) {
            drawTime(canvas, 1.0f, false);
        }
        if ((this.controlsAlpha != 1.0f || this.timeAlpha != 1.0f) && this.currentMessageObject.type != 5) {
            long newTime2 = System.currentTimeMillis();
            long dt2 = Math.abs(this.lastControlsAlphaChangeTime - newTime2);
            if (dt2 > 17) {
                dt2 = 17;
            }
            long j = this.totalChangeTime + dt2;
            this.totalChangeTime = j;
            if (j > 100) {
                this.totalChangeTime = 100L;
            }
            this.lastControlsAlphaChangeTime = newTime2;
            if (this.controlsAlpha != 1.0f) {
                this.controlsAlpha = AndroidUtilities.decelerateInterpolator.getInterpolation(((float) this.totalChangeTime) / 100.0f);
            }
            if (this.timeAlpha != 1.0f) {
                this.timeAlpha = AndroidUtilities.decelerateInterpolator.getInterpolation(((float) this.totalChangeTime) / 100.0f);
            }
            invalidate();
            if (this.forceNotDrawTime && (groupedMessagePosition = this.currentPosition) != null && groupedMessagePosition.last && getParent() != null) {
                View parent = (View) getParent();
                parent.invalidate();
            }
        }
        if (this.drawBackground && shouldDrawSelectionOverlay() && this.currentMessagesGroup == null) {
            if (this.selectionOverlayPaint == null) {
                this.selectionOverlayPaint = new Paint(1);
            }
            this.selectionOverlayPaint.setColor(getSelectionOverlayColor().intValue());
            int wasAlpha = this.selectionOverlayPaint.getAlpha();
            this.selectionOverlayPaint.setAlpha((int) (wasAlpha * getHighlightAlpha() * getAlpha()));
            if (this.selectionOverlayPaint.getAlpha() > 0) {
                canvas.save();
                canvas.clipRect(0, 0, getMeasuredWidth(), getMeasuredHeight());
                this.currentBackgroundDrawable.drawCached(canvas, this.backgroundCacheParams, this.selectionOverlayPaint);
                canvas.restore();
            }
            this.selectionOverlayPaint.setAlpha(wasAlpha);
        }
        if (restore != Integer.MIN_VALUE) {
            canvas.restoreToCount(restore);
        }
        updateSelectionTextPosition();
    }

    /* JADX WARN: Removed duplicated region for block: B:220:0x04a1  */
    /* JADX WARN: Removed duplicated region for block: B:221:0x04a8  */
    /* JADX WARN: Removed duplicated region for block: B:228:0x04c5  */
    /* JADX WARN: Removed duplicated region for block: B:229:0x04c8  */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    public void drawBackgroundInternal(Canvas canvas, boolean fromParent) {
        Drawable currentBackgroundShadowDrawable;
        String str;
        Drawable currentBackgroundShadowDrawable2;
        Theme.MessageDrawable drawable;
        MessageObject.GroupedMessages groupedMessages;
        int x;
        int y;
        int x2;
        Drawable currentBackgroundShadowDrawable3;
        int additionalBottom;
        int additionalTop;
        int offsetBottom;
        Drawable currentBackgroundShadowDrawable4;
        int backgroundLeft;
        int additionalBottom2;
        int additionalTop2;
        int offsetBottom2;
        if (this.currentMessageObject == null) {
            return;
        }
        boolean z = this.wasLayout;
        if (!z && !this.animationRunning) {
            forceLayout();
            return;
        }
        if (!z) {
            onLayout(false, getLeft(), getTop(), getRight(), getBottom());
        }
        int additionalTop3 = 0;
        int additionalBottom3 = 0;
        MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
        boolean forceMediaByGroup = groupedMessagePosition != null && (groupedMessagePosition.flags & 8) == 0 && this.currentMessagesGroup.isDocuments && !this.drawPinnedBottom;
        boolean isOutOwner = this.currentMessageObject.isOutOwner();
        String str2 = Theme.key_drawable_msgOut;
        if (isOutOwner) {
            if (this.transitionParams.changePinnedBottomProgress < 1.0f || this.mediaBackground || this.drawPinnedBottom || forceMediaByGroup) {
                this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgOutMedia);
                this.currentBackgroundSelectedDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgOutMediaSelected);
                this.transitionParams.drawPinnedBottomBackground = true;
            } else {
                this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(str2);
                this.currentBackgroundSelectedDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgOutSelected);
                this.transitionParams.drawPinnedBottomBackground = false;
            }
            setBackgroundTopY(true);
            if (isDrawSelectionBackground() && (this.currentPosition == null || getBackground() != null)) {
                currentBackgroundShadowDrawable4 = this.currentBackgroundSelectedDrawable.getShadowDrawable();
            } else {
                currentBackgroundShadowDrawable4 = this.currentBackgroundDrawable.getShadowDrawable();
            }
            this.backgroundDrawableLeft = (this.layoutWidth - this.backgroundWidth) - (!this.mediaBackground ? 0 : AndroidUtilities.dp(9.0f));
            this.backgroundDrawableRight = this.backgroundWidth - (this.mediaBackground ? 0 : AndroidUtilities.dp(3.0f));
            MessageObject.GroupedMessages groupedMessages2 = this.currentMessagesGroup;
            if (groupedMessages2 != null && !groupedMessages2.isDocuments && !this.currentPosition.edge) {
                this.backgroundDrawableRight += AndroidUtilities.dp(10.0f);
            }
            int backgroundLeft2 = this.backgroundDrawableLeft;
            if (!forceMediaByGroup && this.transitionParams.changePinnedBottomProgress != 1.0f) {
                if (!this.mediaBackground) {
                    this.backgroundDrawableRight -= AndroidUtilities.dp(6.0f);
                }
            } else if (!this.mediaBackground && this.drawPinnedBottom) {
                this.backgroundDrawableRight -= AndroidUtilities.dp(6.0f);
            }
            MessageObject.GroupedMessagePosition groupedMessagePosition2 = this.currentPosition;
            if (groupedMessagePosition2 == null) {
                additionalTop2 = 0;
                additionalBottom2 = 0;
                backgroundLeft = backgroundLeft2;
            } else {
                if ((groupedMessagePosition2.flags & 2) == 0) {
                    this.backgroundDrawableRight += AndroidUtilities.dp(SharedConfig.bubbleRadius + 2);
                }
                if ((1 & this.currentPosition.flags) == 0) {
                    backgroundLeft2 -= AndroidUtilities.dp(SharedConfig.bubbleRadius + 2);
                    this.backgroundDrawableRight += AndroidUtilities.dp(SharedConfig.bubbleRadius + 2);
                }
                if ((this.currentPosition.flags & 4) == 0) {
                    additionalTop3 = 0 - AndroidUtilities.dp(SharedConfig.bubbleRadius + 3);
                    additionalBottom3 = 0 + AndroidUtilities.dp(SharedConfig.bubbleRadius + 3);
                }
                if ((this.currentPosition.flags & 8) != 0) {
                    additionalTop2 = additionalTop3;
                    additionalBottom2 = additionalBottom3;
                    backgroundLeft = backgroundLeft2;
                } else {
                    additionalTop2 = additionalTop3;
                    additionalBottom2 = additionalBottom3 + AndroidUtilities.dp(SharedConfig.bubbleRadius + 3);
                    backgroundLeft = backgroundLeft2;
                }
            }
            boolean z2 = this.drawPinnedBottom;
            if (z2 && this.drawPinnedTop) {
                offsetBottom2 = 0;
            } else if (z2) {
                offsetBottom2 = AndroidUtilities.dp(1.0f);
            } else {
                int offsetBottom3 = AndroidUtilities.dp(2.0f);
                offsetBottom2 = offsetBottom3;
            }
            int dp = additionalTop2 + (this.drawPinnedTop ? 0 : AndroidUtilities.dp(1.0f));
            this.backgroundDrawableTop = dp;
            int backgroundHeight = (this.layoutHeight - offsetBottom2) + additionalBottom2;
            this.backgroundDrawableBottom = dp + backgroundHeight;
            if (forceMediaByGroup) {
                setDrawableBoundsInner(this.currentBackgroundDrawable, backgroundLeft, dp - additionalTop2, this.backgroundDrawableRight, (backgroundHeight - additionalBottom2) + 10);
                setDrawableBoundsInner(this.currentBackgroundSelectedDrawable, this.backgroundDrawableLeft, this.backgroundDrawableTop, this.backgroundDrawableRight - AndroidUtilities.dp(6.0f), backgroundHeight);
            } else {
                int i = backgroundLeft;
                setDrawableBoundsInner(this.currentBackgroundDrawable, i, dp, this.backgroundDrawableRight, backgroundHeight);
                setDrawableBoundsInner(this.currentBackgroundSelectedDrawable, i, this.backgroundDrawableTop, this.backgroundDrawableRight, backgroundHeight);
            }
            setDrawableBoundsInner(currentBackgroundShadowDrawable4, backgroundLeft, this.backgroundDrawableTop, this.backgroundDrawableRight, backgroundHeight);
            currentBackgroundShadowDrawable = currentBackgroundShadowDrawable4;
        } else {
            if (this.transitionParams.changePinnedBottomProgress < 1.0f || this.mediaBackground || this.drawPinnedBottom || forceMediaByGroup) {
                this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgInMedia);
                this.currentBackgroundSelectedDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgInMediaSelected);
                this.transitionParams.drawPinnedBottomBackground = true;
            } else {
                this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgIn);
                this.currentBackgroundSelectedDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgInSelected);
                this.transitionParams.drawPinnedBottomBackground = false;
            }
            setBackgroundTopY(true);
            if (isDrawSelectionBackground() && (this.currentPosition == null || getBackground() != null)) {
                currentBackgroundShadowDrawable3 = this.currentBackgroundSelectedDrawable.getShadowDrawable();
            } else {
                currentBackgroundShadowDrawable3 = this.currentBackgroundDrawable.getShadowDrawable();
            }
            this.backgroundDrawableLeft = AndroidUtilities.dp(((!this.isChat || !this.isAvatarVisible) ? 0 : 48) + (!this.mediaBackground ? 3 : 9));
            this.backgroundDrawableRight = this.backgroundWidth - (this.mediaBackground ? 0 : AndroidUtilities.dp(3.0f));
            MessageObject.GroupedMessages groupedMessages3 = this.currentMessagesGroup;
            if (groupedMessages3 != null && !groupedMessages3.isDocuments) {
                if (!this.currentPosition.edge) {
                    this.backgroundDrawableLeft -= AndroidUtilities.dp(10.0f);
                    this.backgroundDrawableRight += AndroidUtilities.dp(10.0f);
                }
                if (this.currentPosition.leftSpanOffset != 0) {
                    this.backgroundDrawableLeft += (int) Math.ceil((this.currentPosition.leftSpanOffset / 1000.0f) * getGroupPhotosWidth());
                }
            }
            if ((!this.mediaBackground && this.drawPinnedBottom) || (!forceMediaByGroup && this.transitionParams.changePinnedBottomProgress != 1.0f)) {
                if (this.drawPinnedBottom || !this.mediaBackground) {
                    this.backgroundDrawableRight -= AndroidUtilities.dp(6.0f);
                }
                if (!this.mediaBackground) {
                    this.backgroundDrawableLeft += AndroidUtilities.dp(6.0f);
                }
            }
            MessageObject.GroupedMessagePosition groupedMessagePosition3 = this.currentPosition;
            if (groupedMessagePosition3 == null) {
                additionalTop = 0;
                additionalBottom = 0;
            } else {
                if ((groupedMessagePosition3.flags & 2) == 0) {
                    this.backgroundDrawableRight += AndroidUtilities.dp(SharedConfig.bubbleRadius + 2);
                }
                if ((this.currentPosition.flags & 1) == 0) {
                    this.backgroundDrawableLeft -= AndroidUtilities.dp(SharedConfig.bubbleRadius + 2);
                    this.backgroundDrawableRight += AndroidUtilities.dp(SharedConfig.bubbleRadius + 2);
                }
                if ((this.currentPosition.flags & 4) == 0) {
                    additionalTop3 = 0 - AndroidUtilities.dp(SharedConfig.bubbleRadius + 3);
                    additionalBottom3 = 0 + AndroidUtilities.dp(SharedConfig.bubbleRadius + 3);
                }
                if ((this.currentPosition.flags & 8) != 0) {
                    additionalTop = additionalTop3;
                    additionalBottom = additionalBottom3;
                } else {
                    additionalTop = additionalTop3;
                    additionalBottom = additionalBottom3 + AndroidUtilities.dp(SharedConfig.bubbleRadius + 4);
                }
            }
            boolean z3 = this.drawPinnedBottom;
            if (z3 && this.drawPinnedTop) {
                offsetBottom = 0;
            } else if (z3) {
                offsetBottom = AndroidUtilities.dp(1.0f);
            } else {
                offsetBottom = AndroidUtilities.dp(2.0f);
            }
            int dp2 = additionalTop + (this.drawPinnedTop ? 0 : AndroidUtilities.dp(1.0f));
            this.backgroundDrawableTop = dp2;
            int backgroundHeight2 = (this.layoutHeight - offsetBottom) + additionalBottom;
            this.backgroundDrawableBottom = dp2 + backgroundHeight2;
            setDrawableBoundsInner(this.currentBackgroundDrawable, this.backgroundDrawableLeft, dp2, this.backgroundDrawableRight, backgroundHeight2);
            if (forceMediaByGroup) {
                setDrawableBoundsInner(this.currentBackgroundSelectedDrawable, AndroidUtilities.dp(6.0f) + this.backgroundDrawableLeft, this.backgroundDrawableTop, this.backgroundDrawableRight - AndroidUtilities.dp(6.0f), backgroundHeight2);
            } else {
                setDrawableBoundsInner(this.currentBackgroundSelectedDrawable, this.backgroundDrawableLeft, this.backgroundDrawableTop, this.backgroundDrawableRight, backgroundHeight2);
            }
            setDrawableBoundsInner(currentBackgroundShadowDrawable3, this.backgroundDrawableLeft, this.backgroundDrawableTop, this.backgroundDrawableRight, backgroundHeight2);
            currentBackgroundShadowDrawable = currentBackgroundShadowDrawable3;
        }
        if (!this.currentMessageObject.isOutOwner() && this.transitionParams.changePinnedBottomProgress != 1.0f && !this.mediaBackground && !this.drawPinnedBottom) {
            this.backgroundDrawableLeft -= AndroidUtilities.dp(6.0f);
            this.backgroundDrawableRight += AndroidUtilities.dp(6.0f);
        }
        if (!this.hasPsaHint) {
            str = str2;
        } else {
            MessageObject.GroupedMessagePosition groupedMessagePosition4 = this.currentPosition;
            if (groupedMessagePosition4 == null) {
                str = str2;
            } else if ((groupedMessagePosition4.flags & 2) != 0) {
                str = str2;
            } else {
                int x3 = 0;
                int dWidth = getGroupPhotosWidth();
                int a = 0;
                while (true) {
                    if (a >= this.currentMessagesGroup.posArray.size()) {
                        x2 = x3;
                        str = str2;
                        break;
                    }
                    MessageObject.GroupedMessagePosition position = this.currentMessagesGroup.posArray.get(a);
                    if (position.minY == 0) {
                        double d = x3;
                        int i2 = position.pw;
                        int x4 = position.leftSpanOffset;
                        double ceil = Math.ceil(((i2 + x4) / 1000.0f) * dWidth);
                        Double.isNaN(d);
                        x3 = (int) (d + ceil);
                        a++;
                        str2 = str2;
                    } else {
                        x2 = x3;
                        str = str2;
                        break;
                    }
                }
                x = x2;
                Drawable drawable2 = Theme.chat_psaHelpDrawable[this.currentMessageObject.isOutOwner() ? 1 : 0];
                if (this.currentMessageObject.type != 5) {
                    y = AndroidUtilities.dp(12.0f);
                } else {
                    y = AndroidUtilities.dp((this.drawNameLayout ? 19 : 0) + 10);
                }
                this.psaHelpX = (x - drawable2.getIntrinsicWidth()) - AndroidUtilities.dp(!this.currentMessageObject.isOutOwner() ? 20.0f : 14.0f);
                this.psaHelpY = AndroidUtilities.dp(4.0f) + y;
            }
            x = this.currentBackgroundDrawable.getBounds().right;
            Drawable drawable22 = Theme.chat_psaHelpDrawable[this.currentMessageObject.isOutOwner() ? 1 : 0];
            if (this.currentMessageObject.type != 5) {
            }
            this.psaHelpX = (x - drawable22.getIntrinsicWidth()) - AndroidUtilities.dp(!this.currentMessageObject.isOutOwner() ? 20.0f : 14.0f);
            this.psaHelpY = AndroidUtilities.dp(4.0f) + y;
        }
        boolean z4 = this.checkBoxVisible;
        if (z4 || this.checkBoxAnimationInProgress) {
            if ((z4 && this.checkBoxAnimationProgress == 1.0f) || (!z4 && this.checkBoxAnimationProgress == 0.0f)) {
                this.checkBoxAnimationInProgress = false;
            }
            Interpolator interpolator = z4 ? CubicBezierInterpolator.EASE_OUT : CubicBezierInterpolator.EASE_IN;
            this.checkBoxTranslation = (int) Math.ceil(interpolator.getInterpolation(this.checkBoxAnimationProgress) * AndroidUtilities.dp(35.0f));
            if (!this.currentMessageObject.isOutOwner()) {
                updateTranslation();
            }
            int size = AndroidUtilities.dp(21.0f);
            this.checkBox.setBounds(AndroidUtilities.dp(-27.0f) + this.checkBoxTranslation, (this.currentBackgroundDrawable.getBounds().bottom - AndroidUtilities.dp(8.0f)) - size, size, size);
            if (this.checkBoxAnimationInProgress) {
                long newTime = SystemClock.elapsedRealtime();
                long dt = newTime - this.lastCheckBoxAnimationTime;
                this.lastCheckBoxAnimationTime = newTime;
                if (!this.checkBoxVisible) {
                    float f = this.checkBoxAnimationProgress - (((float) dt) / 200.0f);
                    this.checkBoxAnimationProgress = f;
                    if (f <= 0.0f) {
                        this.checkBoxAnimationProgress = 0.0f;
                    }
                } else {
                    float f2 = this.checkBoxAnimationProgress + (((float) dt) / 200.0f);
                    this.checkBoxAnimationProgress = f2;
                    if (f2 > 1.0f) {
                        this.checkBoxAnimationProgress = 1.0f;
                    }
                }
                invalidate();
                ((View) getParent()).invalidate();
            }
        }
        if (!fromParent && drawBackgroundInParent()) {
            return;
        }
        boolean needRestore = false;
        if (this.transitionYOffsetForDrawables != 0.0f) {
            needRestore = true;
            canvas.save();
            canvas.translate(0.0f, this.transitionYOffsetForDrawables);
        }
        if (this.drawBackground && this.currentBackgroundDrawable != null && ((this.currentPosition == null || (isDrawSelectionBackground() && (this.currentMessageObject.isMusic() || this.currentMessageObject.isDocument()))) && (!this.enterTransitionInProgress || this.currentMessageObject.isVoice()))) {
            float alphaInternal = this.alphaInternal;
            if (fromParent) {
                alphaInternal *= getAlpha();
            }
            if (hasSelectionOverlay()) {
                this.currentSelectedBackgroundAlpha = 0.0f;
                this.currentBackgroundDrawable.setAlpha((int) (alphaInternal * 255.0f));
                this.currentBackgroundDrawable.drawCached(canvas, this.backgroundCacheParams);
                if (currentBackgroundShadowDrawable != null && this.currentPosition == null) {
                    currentBackgroundShadowDrawable.setAlpha((int) (255.0f * alphaInternal));
                    currentBackgroundShadowDrawable.draw(canvas);
                }
            } else {
                if (this.isHighlightedAnimated) {
                    this.currentBackgroundDrawable.setAlpha((int) (alphaInternal * 255.0f));
                    this.currentBackgroundDrawable.drawCached(canvas, this.backgroundCacheParams);
                    float highlightAlpha = getHighlightAlpha();
                    this.currentSelectedBackgroundAlpha = highlightAlpha;
                    if (this.currentPosition == null) {
                        this.currentBackgroundSelectedDrawable.setAlpha((int) (highlightAlpha * alphaInternal * 255.0f));
                        this.currentBackgroundSelectedDrawable.drawCached(canvas, this.backgroundCacheParams);
                    }
                } else if (this.selectedBackgroundProgress != 0.0f && ((groupedMessages = this.currentMessagesGroup) == null || !groupedMessages.isDocuments)) {
                    this.currentBackgroundDrawable.setAlpha((int) (alphaInternal * 255.0f));
                    this.currentBackgroundDrawable.drawCached(canvas, this.backgroundCacheParams);
                    float f3 = this.selectedBackgroundProgress;
                    this.currentSelectedBackgroundAlpha = f3;
                    this.currentBackgroundSelectedDrawable.setAlpha((int) (f3 * alphaInternal * 255.0f));
                    this.currentBackgroundSelectedDrawable.drawCached(canvas, this.backgroundCacheParams);
                    if (this.currentBackgroundDrawable.getGradientShader() == null) {
                        currentBackgroundShadowDrawable = null;
                    }
                } else if (!isDrawSelectionBackground() || (this.currentPosition != null && !this.currentMessageObject.isMusic() && !this.currentMessageObject.isDocument() && getBackground() == null)) {
                    this.currentSelectedBackgroundAlpha = 0.0f;
                    this.currentBackgroundDrawable.setAlpha((int) (alphaInternal * 255.0f));
                    this.currentBackgroundDrawable.drawCached(canvas, this.backgroundCacheParams);
                } else {
                    if (this.currentPosition != null) {
                        canvas.save();
                        canvas.clipRect(0, 0, getMeasuredWidth(), getMeasuredHeight());
                    }
                    this.currentSelectedBackgroundAlpha = 1.0f;
                    this.currentBackgroundSelectedDrawable.setAlpha((int) (alphaInternal * 255.0f));
                    this.currentBackgroundSelectedDrawable.drawCached(canvas, this.backgroundCacheParams);
                    if (this.currentPosition != null) {
                        canvas.restore();
                    }
                }
                if (currentBackgroundShadowDrawable != null && this.currentPosition == null) {
                    currentBackgroundShadowDrawable.setAlpha((int) (alphaInternal * 255.0f));
                    currentBackgroundShadowDrawable.draw(canvas);
                }
                if (this.transitionParams.changePinnedBottomProgress == 1.0f || this.currentPosition != null) {
                    currentBackgroundShadowDrawable2 = currentBackgroundShadowDrawable;
                } else if (this.currentMessageObject.isOutOwner()) {
                    Theme.MessageDrawable drawable3 = (Theme.MessageDrawable) getThemedDrawable(str);
                    Rect rect = this.currentBackgroundDrawable.getBounds();
                    drawable3.setBounds(rect.left, rect.top, rect.right + AndroidUtilities.dp(6.0f), rect.bottom);
                    canvas.save();
                    canvas.clipRect(rect.right - AndroidUtilities.dp(12.0f), rect.bottom - AndroidUtilities.dp(16.0f), rect.right + AndroidUtilities.dp(12.0f), rect.bottom);
                    int w = this.parentWidth;
                    int h = this.parentHeight;
                    if (h == 0) {
                        w = getParentWidth();
                        h = AndroidUtilities.displaySize.y;
                        if (getParent() instanceof View) {
                            View view = (View) getParent();
                            w = view.getMeasuredWidth();
                            h = view.getMeasuredHeight();
                        }
                    }
                    float y2 = getY();
                    float f4 = this.parentViewTopOffset;
                    currentBackgroundShadowDrawable2 = currentBackgroundShadowDrawable;
                    drawable3.setTop((int) (y2 + f4), w, h, (int) f4, this.blurredViewTopOffset, this.blurredViewBottomOffset, this.pinnedTop, this.pinnedBottom);
                    float alpha = (this.mediaBackground || this.pinnedBottom) ? 1.0f - this.transitionParams.changePinnedBottomProgress : this.transitionParams.changePinnedBottomProgress;
                    drawable3.setAlpha((int) (alpha * 255.0f));
                    drawable3.draw(canvas);
                    drawable3.setAlpha(255);
                    canvas.restore();
                } else {
                    currentBackgroundShadowDrawable2 = currentBackgroundShadowDrawable;
                    if (this.transitionParams.drawPinnedBottomBackground) {
                        drawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgIn);
                    } else {
                        drawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgInMedia);
                    }
                    float alpha2 = (this.mediaBackground || this.pinnedBottom) ? 1.0f - this.transitionParams.changePinnedBottomProgress : this.transitionParams.changePinnedBottomProgress;
                    drawable.setAlpha((int) (alpha2 * 255.0f));
                    Rect rect2 = this.currentBackgroundDrawable.getBounds();
                    drawable.setBounds(rect2.left - AndroidUtilities.dp(6.0f), rect2.top, rect2.right, rect2.bottom);
                    canvas.save();
                    canvas.clipRect(rect2.left - AndroidUtilities.dp(6.0f), rect2.bottom - AndroidUtilities.dp(16.0f), rect2.left + AndroidUtilities.dp(6.0f), rect2.bottom);
                    drawable.draw(canvas);
                    drawable.setAlpha(255);
                    canvas.restore();
                }
            }
        }
        if (needRestore) {
            canvas.restore();
        }
    }

    public boolean drawBackgroundInParent() {
        MessageObject messageObject;
        if (!this.canDrawBackgroundInParent || (messageObject = this.currentMessageObject) == null || !messageObject.isOutOwner()) {
            return false;
        }
        Theme.ResourcesProvider resourcesProvider = this.resourcesProvider;
        return resourcesProvider != null ? resourcesProvider.getCurrentColor(Theme.key_chat_outBubbleGradient1) != null : Theme.getColorOrNull(Theme.key_chat_outBubbleGradient1) != null;
    }

    public void drawCommentButton(Canvas canvas, float alpha) {
        if (this.drawSideButton != 3) {
            return;
        }
        int height = AndroidUtilities.dp(32.0f);
        if (this.commentLayout != null) {
            this.sideStartY -= AndroidUtilities.dp(18.0f);
            height += AndroidUtilities.dp(18.0f);
        }
        RectF rectF = this.rect;
        float f = this.sideStartX;
        rectF.set(f, this.sideStartY, AndroidUtilities.dp(32.0f) + f, this.sideStartY + height);
        applyServiceShaderMatrix();
        String str = Theme.key_paint_chatActionBackground;
        if (alpha != 1.0f) {
            int oldAlpha = getThemedPaint(str).getAlpha();
            getThemedPaint(str).setAlpha((int) (oldAlpha * alpha));
            canvas.drawRoundRect(this.rect, AndroidUtilities.dp(16.0f), AndroidUtilities.dp(16.0f), getThemedPaint(str));
            getThemedPaint(str).setAlpha(oldAlpha);
        } else {
            RectF rectF2 = this.rect;
            float dp = AndroidUtilities.dp(16.0f);
            float dp2 = AndroidUtilities.dp(16.0f);
            if (this.sideButtonPressed) {
                str = Theme.key_paint_chatActionBackgroundSelected;
            }
            canvas.drawRoundRect(rectF2, dp, dp2, getThemedPaint(str));
        }
        if (hasGradientService()) {
            if (alpha != 1.0f) {
                int oldAlpha2 = Theme.chat_actionBackgroundGradientDarkenPaint.getAlpha();
                Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha((int) (oldAlpha2 * alpha));
                canvas.drawRoundRect(this.rect, AndroidUtilities.dp(16.0f), AndroidUtilities.dp(16.0f), Theme.chat_actionBackgroundGradientDarkenPaint);
                Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha(oldAlpha2);
            } else {
                canvas.drawRoundRect(this.rect, AndroidUtilities.dp(16.0f), AndroidUtilities.dp(16.0f), Theme.chat_actionBackgroundGradientDarkenPaint);
            }
        }
        Drawable commentStickerDrawable = Theme.getThemeDrawable(Theme.key_drawable_commentSticker);
        setDrawableBounds(commentStickerDrawable, this.sideStartX + AndroidUtilities.dp(4.0f), this.sideStartY + AndroidUtilities.dp(4.0f));
        if (alpha != 1.0f) {
            commentStickerDrawable.setAlpha((int) (alpha * 255.0f));
            commentStickerDrawable.draw(canvas);
            commentStickerDrawable.setAlpha(255);
        } else {
            commentStickerDrawable.draw(canvas);
        }
        if (this.commentLayout != null) {
            Theme.chat_stickerCommentCountPaint.setColor(getThemedColor(Theme.key_chat_stickerReplyNameText));
            Theme.chat_stickerCommentCountPaint.setAlpha((int) (alpha * 255.0f));
            if (this.transitionParams.animateComments) {
                if (this.transitionParams.animateCommentsLayout != null) {
                    canvas.save();
                    TextPaint textPaint = Theme.chat_stickerCommentCountPaint;
                    double d = this.transitionParams.animateChangeProgress;
                    Double.isNaN(d);
                    double d2 = alpha;
                    Double.isNaN(d2);
                    textPaint.setAlpha((int) ((1.0d - d) * 255.0d * d2));
                    canvas.translate(this.sideStartX + ((AndroidUtilities.dp(32.0f) - this.transitionParams.animateTotalCommentWidth) / 2), this.sideStartY + AndroidUtilities.dp(30.0f));
                    this.transitionParams.animateCommentsLayout.draw(canvas);
                    canvas.restore();
                }
                Theme.chat_stickerCommentCountPaint.setAlpha((int) (this.transitionParams.animateChangeProgress * 255.0f));
            }
            canvas.save();
            canvas.translate(this.sideStartX + ((AndroidUtilities.dp(32.0f) - this.totalCommentWidth) / 2), this.sideStartY + AndroidUtilities.dp(30.0f));
            this.commentLayout.draw(canvas);
            canvas.restore();
        }
    }

    public void applyServiceShaderMatrix() {
        applyServiceShaderMatrix(getMeasuredWidth(), this.backgroundHeight, getX(), this.viewTop);
    }

    private void applyServiceShaderMatrix(int measuredWidth, int backgroundHeight, float x, float viewTop) {
        Theme.ResourcesProvider resourcesProvider = this.resourcesProvider;
        if (resourcesProvider != null) {
            resourcesProvider.applyServiceShaderMatrix(measuredWidth, backgroundHeight, x, viewTop);
        } else {
            Theme.applyServiceShaderMatrix(measuredWidth, backgroundHeight, x, viewTop);
        }
    }

    public boolean hasOutboundsContent() {
        if (getAlpha() != 1.0f) {
            return false;
        }
        return (!this.transitionParams.transitionBotButtons.isEmpty() && this.transitionParams.animateBotButtonsChanged) || !this.botButtons.isEmpty() || this.drawSideButton != 0;
    }

    public void drawOutboundsContent(Canvas canvas) {
        float f = 1.0f;
        if (!this.transitionParams.transitionBotButtons.isEmpty() && this.transitionParams.animateBotButtonsChanged) {
            drawBotButtons(canvas, this.transitionParams.transitionBotButtons, 1.0f - this.transitionParams.animateChangeProgress);
        }
        if (!this.botButtons.isEmpty()) {
            ArrayList<BotButton> arrayList = this.botButtons;
            if (this.transitionParams.animateBotButtonsChanged) {
                f = this.transitionParams.animateChangeProgress;
            }
            drawBotButtons(canvas, arrayList, f);
        }
        drawSideButton(canvas);
    }

    private void drawSideButton(Canvas canvas) {
        if (this.drawSideButton != 0) {
            if (this.currentMessageObject.isOutOwner()) {
                float dp = this.transitionParams.lastBackgroundLeft - AndroidUtilities.dp(40.0f);
                this.sideStartX = dp;
                MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
                if (groupedMessages != null) {
                    this.sideStartX = dp + (groupedMessages.transitionParams.offsetLeft - this.animationOffsetX);
                }
            } else {
                float dp2 = this.transitionParams.lastBackgroundRight + AndroidUtilities.dp(8.0f);
                this.sideStartX = dp2;
                MessageObject.GroupedMessages groupedMessages2 = this.currentMessagesGroup;
                if (groupedMessages2 != null) {
                    this.sideStartX = dp2 + (groupedMessages2.transitionParams.offsetRight - this.animationOffsetX);
                }
            }
            float dp3 = (this.layoutHeight - AndroidUtilities.dp(41.0f)) + this.transitionParams.deltaBottom;
            this.sideStartY = dp3;
            MessageObject.GroupedMessages groupedMessages3 = this.currentMessagesGroup;
            if (groupedMessages3 != null) {
                this.sideStartY = dp3 + groupedMessages3.transitionParams.offsetBottom;
                if (this.currentMessagesGroup.transitionParams.backgroundChangeBounds) {
                    this.sideStartY -= getTranslationY();
                }
            }
            if (!this.reactionsLayoutInBubble.isSmall && this.reactionsLayoutInBubble.drawServiceShaderBackground) {
                this.sideStartY -= this.reactionsLayoutInBubble.getCurrentTotalHeight(this.transitionParams.animateChangeProgress);
            }
            if (!this.currentMessageObject.isOutOwner() && this.isRoundVideo && this.isAvatarVisible) {
                float offsetSize = (AndroidUtilities.roundPlayingMessageSize - AndroidUtilities.roundMessageSize) * 0.7f;
                float offsetX = this.isPlayingRound ? offsetSize : 0.0f;
                if (this.transitionParams.animatePlayingRound) {
                    offsetX = (this.isPlayingRound ? this.transitionParams.animateChangeProgress : 1.0f - this.transitionParams.animateChangeProgress) * offsetSize;
                }
                this.sideStartX -= offsetX;
            }
            if (this.drawSideButton == 3) {
                if (!this.enterTransitionInProgress || this.currentMessageObject.isVoice()) {
                    drawCommentButton(canvas, 1.0f);
                    return;
                }
                return;
            }
            RectF rectF = this.rect;
            float f = this.sideStartX;
            rectF.set(f, this.sideStartY, AndroidUtilities.dp(32.0f) + f, this.sideStartY + AndroidUtilities.dp(32.0f));
            applyServiceShaderMatrix();
            canvas.drawRoundRect(this.rect, AndroidUtilities.dp(16.0f), AndroidUtilities.dp(16.0f), getThemedPaint(this.sideButtonPressed ? Theme.key_paint_chatActionBackgroundSelected : Theme.key_paint_chatActionBackground));
            if (hasGradientService()) {
                canvas.drawRoundRect(this.rect, AndroidUtilities.dp(16.0f), AndroidUtilities.dp(16.0f), Theme.chat_actionBackgroundGradientDarkenPaint);
            }
            if (this.drawSideButton == 2) {
                Drawable goIconDrawable = getThemedDrawable(Theme.key_drawable_goIcon);
                if (this.currentMessageObject.isOutOwner()) {
                    setDrawableBounds(goIconDrawable, this.sideStartX + AndroidUtilities.dp(10.0f), this.sideStartY + AndroidUtilities.dp(9.0f));
                    canvas.save();
                    canvas.scale(-1.0f, 1.0f, goIconDrawable.getBounds().centerX(), goIconDrawable.getBounds().centerY());
                } else {
                    setDrawableBounds(goIconDrawable, this.sideStartX + AndroidUtilities.dp(12.0f), this.sideStartY + AndroidUtilities.dp(9.0f));
                }
                goIconDrawable.draw(canvas);
                if (this.currentMessageObject.isOutOwner()) {
                    canvas.restore();
                    return;
                }
                return;
            }
            Drawable drawable = getThemedDrawable(Theme.key_drawable_shareIcon);
            setDrawableBounds(drawable, this.sideStartX + AndroidUtilities.dp(8.0f), this.sideStartY + AndroidUtilities.dp(9.0f));
            drawable.draw(canvas);
        }
    }

    public void setTimeAlpha(float value) {
        this.timeAlpha = value;
    }

    public float getTimeAlpha() {
        return this.timeAlpha;
    }

    public int getBackgroundDrawableLeft() {
        int i = 0;
        if (this.currentMessageObject.isOutOwner()) {
            int i2 = this.layoutWidth - this.backgroundWidth;
            if (this.mediaBackground) {
                i = AndroidUtilities.dp(9.0f);
            }
            return i2 - i;
        }
        if (this.isChat && this.isAvatarVisible) {
            i = 48;
        }
        int r = AndroidUtilities.dp(i + (!this.mediaBackground ? 3 : 9));
        MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
        if (groupedMessages != null && !groupedMessages.isDocuments && this.currentPosition.leftSpanOffset != 0) {
            r += (int) Math.ceil((this.currentPosition.leftSpanOffset / 1000.0f) * getGroupPhotosWidth());
        }
        if (!this.mediaBackground && this.drawPinnedBottom) {
            return r + AndroidUtilities.dp(6.0f);
        }
        return r;
    }

    public int getBackgroundDrawableRight() {
        int right = this.backgroundWidth - (this.mediaBackground ? 0 : AndroidUtilities.dp(3.0f));
        if (!this.mediaBackground && this.drawPinnedBottom && this.currentMessageObject.isOutOwner()) {
            right -= AndroidUtilities.dp(6.0f);
        }
        if (!this.mediaBackground && this.drawPinnedBottom && !this.currentMessageObject.isOutOwner()) {
            right -= AndroidUtilities.dp(6.0f);
        }
        return getBackgroundDrawableLeft() + right;
    }

    public int getBackgroundDrawableTop() {
        int additionalTop = 0;
        MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
        if (groupedMessagePosition != null && (groupedMessagePosition.flags & 4) == 0) {
            additionalTop = 0 - AndroidUtilities.dp(3.0f);
        }
        return (this.drawPinnedTop ? 0 : AndroidUtilities.dp(1.0f)) + additionalTop;
    }

    public int getBackgroundDrawableBottom() {
        int offsetBottom;
        int additionalBottom = 0;
        MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
        if (groupedMessagePosition != null) {
            int i = 4;
            if ((groupedMessagePosition.flags & 4) == 0) {
                additionalBottom = 0 + AndroidUtilities.dp(3.0f);
            }
            if ((this.currentPosition.flags & 8) == 0) {
                if (this.currentMessageObject.isOutOwner()) {
                    i = 3;
                }
                additionalBottom += AndroidUtilities.dp(i);
            }
        }
        boolean z = this.drawPinnedBottom;
        if (z && this.drawPinnedTop) {
            offsetBottom = 0;
        } else if (z) {
            offsetBottom = AndroidUtilities.dp(1.0f);
        } else {
            offsetBottom = AndroidUtilities.dp(2.0f);
        }
        return ((getBackgroundDrawableTop() + this.layoutHeight) - offsetBottom) + additionalBottom;
    }

    public void drawBackground(Canvas canvas, int left, int top, int right, int bottom, boolean pinnedTop, boolean pinnedBottom, boolean selected, int keyboardHeight) {
        int h;
        int w;
        if (this.currentMessageObject.isOutOwner()) {
            if (this.mediaBackground || pinnedBottom) {
                this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(selected ? Theme.key_drawable_msgOutMediaSelected : Theme.key_drawable_msgOutMedia);
            } else {
                this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(selected ? Theme.key_drawable_msgOutSelected : Theme.key_drawable_msgOut);
            }
        } else if (this.mediaBackground || pinnedBottom) {
            this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(selected ? Theme.key_drawable_msgInMediaSelected : Theme.key_drawable_msgInMedia);
        } else {
            this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(selected ? Theme.key_drawable_msgInSelected : Theme.key_drawable_msgIn);
        }
        int w2 = this.parentWidth;
        int h2 = this.parentHeight;
        if (h2 != 0) {
            w = w2;
            h = h2;
        } else {
            int w3 = getParentWidth();
            int h3 = AndroidUtilities.displaySize.y;
            if (!(getParent() instanceof View)) {
                w = w3;
                h = h3;
            } else {
                View view = (View) getParent();
                int w4 = view.getMeasuredWidth();
                w = w4;
                h = view.getMeasuredHeight();
            }
        }
        Theme.MessageDrawable messageDrawable = this.currentBackgroundDrawable;
        if (messageDrawable != null) {
            messageDrawable.setTop(keyboardHeight, w, h, (int) this.parentViewTopOffset, this.blurredViewTopOffset, this.blurredViewBottomOffset, pinnedTop, pinnedBottom);
            Drawable currentBackgroundShadowDrawable = this.currentBackgroundDrawable.getShadowDrawable();
            if (currentBackgroundShadowDrawable != null) {
                currentBackgroundShadowDrawable.setAlpha((int) (getAlpha() * 255.0f));
                currentBackgroundShadowDrawable.setBounds(left, top, right, bottom);
                currentBackgroundShadowDrawable.draw(canvas);
                currentBackgroundShadowDrawable.setAlpha(255);
            }
            this.currentBackgroundDrawable.setAlpha((int) (getAlpha() * 255.0f));
            this.currentBackgroundDrawable.setBounds(left, top, right, bottom);
            this.currentBackgroundDrawable.drawCached(canvas, this.backgroundCacheParams);
            this.currentBackgroundDrawable.setAlpha(255);
        }
    }

    public boolean hasNameLayout() {
        if (!this.drawNameLayout || this.nameLayout == null) {
            if (this.drawForwardedName) {
                StaticLayout[] staticLayoutArr = this.forwardedNameLayout;
                if (staticLayoutArr[0] != null && staticLayoutArr[1] != null) {
                    MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
                    if (groupedMessagePosition == null) {
                        return true;
                    }
                    if (groupedMessagePosition.minY == 0 && this.currentPosition.minX == 0) {
                        return true;
                    }
                }
            }
            return this.replyNameLayout != null;
        }
        return true;
    }

    public boolean isDrawNameLayout() {
        return this.drawNameLayout && this.nameLayout != null;
    }

    public boolean isAdminLayoutChanged() {
        return !TextUtils.equals(this.lastPostAuthor, this.currentMessageObject.messageOwner.post_author);
    }

    /* JADX WARN: Removed duplicated region for block: B:303:0x0844  */
    /* JADX WARN: Removed duplicated region for block: B:311:0x089d  */
    /* JADX WARN: Removed duplicated region for block: B:314:0x08a4  */
    /* JADX WARN: Removed duplicated region for block: B:349:0x09a7  */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    public void drawNamesLayout(Canvas canvas, float alpha) {
        long dt;
        int restore;
        float f;
        int restore2;
        long dt2;
        int forwardedNameWidthLocal;
        float animatingAlpha;
        StaticLayout[] forwardedNameLayoutLocal;
        boolean drawForwardedNameLocal;
        boolean needDrawReplyBackground;
        long dt3;
        float replyStartX;
        float replyStartY;
        long dt4;
        float replyStartX2;
        float forwardNameXLocal;
        boolean clipContent;
        int a;
        boolean clipContent2;
        boolean needDrawReplyBackground2;
        int oldAlpha2;
        int oldAlpha22;
        float nx;
        int color;
        float ax;
        MessageObject.GroupedMessages groupedMessages;
        long newAnimationTime = SystemClock.elapsedRealtime();
        long dt5 = newAnimationTime - this.lastNamesAnimationTime;
        if (dt5 <= 17) {
            dt = dt5;
        } else {
            dt = 17;
        }
        this.lastNamesAnimationTime = newAnimationTime;
        if (this.currentMessageObject.deleted && (groupedMessages = this.currentMessagesGroup) != null && groupedMessages.messages.size() >= 1) {
            return;
        }
        if (alpha != 1.0f) {
            this.rect.set(0.0f, 0.0f, getMaxNameWidth(), getMeasuredHeight());
            restore = canvas.saveLayerAlpha(this.rect, (int) (255.0f * alpha), 31);
        } else {
            restore = Integer.MIN_VALUE;
        }
        if (this.currentMessageObject.type == 5) {
            f = 1.0f - ((this.photoImage.getImageWidth() - AndroidUtilities.roundMessageSize) / (AndroidUtilities.roundPlayingMessageSize - AndroidUtilities.roundMessageSize));
        } else {
            f = 1.0f;
        }
        float replyForwardAlpha = Math.max(0.0f, Math.min(1.0f, f));
        float f2 = 17.0f;
        if (!this.drawNameLayout || this.nameLayout == null) {
            dt2 = dt;
            restore2 = restore;
        } else {
            canvas.save();
            if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                Theme.chat_namePaint.setColor(getThemedColor(Theme.key_chat_stickerNameText));
                if (this.currentMessageObject.isOutOwner()) {
                    this.nameX = AndroidUtilities.dp(28.0f);
                } else {
                    this.nameX = this.backgroundDrawableLeft + this.transitionParams.deltaLeft + this.backgroundDrawableRight + AndroidUtilities.dp(22.0f);
                }
                this.nameY = this.layoutHeight - AndroidUtilities.dp(38.0f);
                float alphaProgress = (!this.currentMessageObject.isOut() || (!this.checkBoxVisible && !this.checkBoxAnimationInProgress)) ? 1.0f : 1.0f - this.checkBoxAnimationProgress;
                this.rect.set(((int) this.nameX) - AndroidUtilities.dp(12.0f), ((int) this.nameY) - AndroidUtilities.dp(5.0f), ((int) this.nameX) + AndroidUtilities.dp(12.0f) + this.nameWidth, ((int) this.nameY) + AndroidUtilities.dp(22.0f));
                int oldAlpha = getThemedPaint(Theme.key_paint_chatActionBackground).getAlpha();
                getThemedPaint(Theme.key_paint_chatActionBackground).setAlpha((int) (oldAlpha * alphaProgress * replyForwardAlpha));
                applyServiceShaderMatrix();
                canvas.drawRoundRect(this.rect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), getThemedPaint(Theme.key_paint_chatActionBackground));
                if (hasGradientService()) {
                    int oldAlpha23 = Theme.chat_actionBackgroundGradientDarkenPaint.getAlpha();
                    Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha((int) (oldAlpha23 * this.timeAlpha * replyForwardAlpha));
                    canvas.drawRoundRect(this.rect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), Theme.chat_actionBackgroundGradientDarkenPaint);
                    Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha(oldAlpha23);
                }
                if (this.viaSpan1 != null || this.viaSpan2 != null) {
                    int color2 = (getThemedColor(Theme.key_chat_stickerViaBotNameText) & ViewCompat.MEASURED_SIZE_MASK) | (((int) (Color.alpha(getThemedColor(Theme.key_chat_stickerViaBotNameText)) * alphaProgress)) << 24);
                    TypefaceSpan typefaceSpan = this.viaSpan1;
                    if (typefaceSpan != null) {
                        typefaceSpan.setColor(color2);
                    }
                    TypefaceSpan typefaceSpan2 = this.viaSpan2;
                    if (typefaceSpan2 != null) {
                        typefaceSpan2.setColor(color2);
                    }
                }
                this.nameX -= this.nameOffsetX;
                getThemedPaint(Theme.key_paint_chatActionBackground).setAlpha(oldAlpha);
            } else {
                if (this.mediaBackground || this.currentMessageObject.isOutOwner()) {
                    this.nameX = (((this.backgroundDrawableLeft + this.transitionParams.deltaLeft) + AndroidUtilities.dp(11.0f)) - this.nameOffsetX) + getExtraTextX();
                } else {
                    this.nameX = (((this.backgroundDrawableLeft + this.transitionParams.deltaLeft) + AndroidUtilities.dp((this.mediaBackground || !this.drawPinnedBottom) ? 17.0f : 11.0f)) - this.nameOffsetX) + getExtraTextX();
                }
                if (this.currentUser != null) {
                    Theme.MessageDrawable messageDrawable = this.currentBackgroundDrawable;
                    if (messageDrawable == null || !messageDrawable.hasGradient()) {
                        Theme.chat_namePaint.setColor(getThemedColor(AvatarDrawable.getNameColorNameForId(this.currentUser.id)));
                    } else {
                        Theme.chat_namePaint.setColor(getThemedColor(Theme.key_chat_messageTextOut));
                    }
                } else if (this.currentChat == null) {
                    Theme.chat_namePaint.setColor(getThemedColor(AvatarDrawable.getNameColorNameForId(0L)));
                } else if (this.currentMessageObject.isOutOwner() && ChatObject.isChannel(this.currentChat)) {
                    Theme.MessageDrawable messageDrawable2 = this.currentBackgroundDrawable;
                    if (messageDrawable2 == null || !messageDrawable2.hasGradient()) {
                        Theme.chat_namePaint.setColor(getThemedColor(Theme.key_chat_outForwardedNameText));
                    } else {
                        Theme.chat_namePaint.setColor(getThemedColor(Theme.key_chat_messageTextOut));
                    }
                } else if (ChatObject.isChannel(this.currentChat) && !this.currentChat.megagroup) {
                    Theme.chat_namePaint.setColor(Theme.changeColorAccent(getThemedColor(AvatarDrawable.getNameColorNameForId(5L))));
                } else if (this.currentMessageObject.isOutOwner()) {
                    Theme.chat_namePaint.setColor(getThemedColor(Theme.key_chat_outForwardedNameText));
                } else {
                    Theme.chat_namePaint.setColor(getThemedColor(AvatarDrawable.getNameColorNameForId(this.currentChat.id)));
                }
                this.nameY = AndroidUtilities.dp(this.drawPinnedTop ? 9.0f : 10.0f);
                if (this.viaSpan1 != null || this.viaSpan2 != null) {
                    int color3 = getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outViaBotNameText : Theme.key_chat_inViaBotNameText);
                    TypefaceSpan typefaceSpan3 = this.viaSpan1;
                    if (typefaceSpan3 != null) {
                        typefaceSpan3.setColor(color3);
                    }
                    TypefaceSpan typefaceSpan4 = this.viaSpan2;
                    if (typefaceSpan4 != null) {
                        typefaceSpan4.setColor(color3);
                    }
                }
            }
            MessageObject.GroupedMessages groupedMessages2 = this.currentMessagesGroup;
            if (groupedMessages2 != null && groupedMessages2.transitionParams.backgroundChangeBounds) {
                this.nameX += this.currentMessagesGroup.transitionParams.offsetLeft;
                this.nameY += this.currentMessagesGroup.transitionParams.offsetTop - getTranslationY();
            }
            this.nameX += this.animationOffsetX;
            this.nameY += this.transitionParams.deltaTop;
            if (this.transitionParams.animateSign) {
                nx = this.transitionParams.animateNameX + ((this.nameX - this.transitionParams.animateNameX) * this.transitionParams.animateChangeProgress);
            } else {
                nx = this.nameX;
            }
            canvas.translate(nx, this.nameY);
            this.nameLayout.draw(canvas);
            canvas.restore();
            if (this.adminLayout != null) {
                if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                    color = getThemedColor(Theme.key_chat_stickerReplyNameText);
                } else if (this.currentMessageObject.isOutOwner()) {
                    color = getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outAdminSelectedText : Theme.key_chat_outAdminText);
                } else {
                    color = getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inAdminSelectedText : Theme.key_chat_inAdminText);
                }
                Theme.chat_adminPaint.setColor(color);
                canvas.save();
                MessageObject.GroupedMessages groupedMessages3 = this.currentMessagesGroup;
                if (groupedMessages3 != null && !groupedMessages3.isDocuments) {
                    int dWidth = getGroupPhotosWidth();
                    int firstLineWidth = 0;
                    int a2 = 0;
                    while (true) {
                        if (a2 >= this.currentMessagesGroup.posArray.size()) {
                            dt2 = dt;
                            restore2 = restore;
                            break;
                        }
                        MessageObject.GroupedMessagePosition position = this.currentMessagesGroup.posArray.get(a2);
                        if (position.minY != 0) {
                            dt2 = dt;
                            restore2 = restore;
                            break;
                        }
                        double d = firstLineWidth;
                        double ceil = Math.ceil(((position.pw + position.leftSpanOffset) / 1000.0f) * dWidth);
                        Double.isNaN(d);
                        firstLineWidth = (int) (d + ceil);
                        a2++;
                        dt = dt;
                        nx = nx;
                        restore = restore;
                    }
                    float ax2 = (this.mediaBackground || !this.currentMessageObject.isOutOwner()) ? ((this.backgroundDrawableLeft + firstLineWidth) - AndroidUtilities.dp(11.0f)) - this.adminLayout.getLineWidth(0) : ((this.backgroundDrawableLeft + firstLineWidth) - AndroidUtilities.dp(17.0f)) - this.adminLayout.getLineWidth(0);
                    ax = ax2 - (getExtraTextX() + AndroidUtilities.dp(8.0f));
                    if (!this.currentMessageObject.isOutOwner()) {
                        ax -= AndroidUtilities.dp(48.0f);
                    }
                } else {
                    dt2 = dt;
                    restore2 = restore;
                    if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                        ax = this.currentMessageObject.isOutOwner() ? (AndroidUtilities.dp(28.0f) + this.nameWidth) - this.adminLayout.getLineWidth(0) : ((((this.backgroundDrawableLeft + this.transitionParams.deltaLeft) + this.backgroundDrawableRight) + AndroidUtilities.dp(22.0f)) + this.nameWidth) - this.adminLayout.getLineWidth(0);
                    } else {
                        ax = (this.mediaBackground || !this.currentMessageObject.isOutOwner()) ? ((this.backgroundDrawableLeft + this.backgroundDrawableRight) - AndroidUtilities.dp(11.0f)) - this.adminLayout.getLineWidth(0) : ((this.backgroundDrawableLeft + this.backgroundDrawableRight) - AndroidUtilities.dp(17.0f)) - this.adminLayout.getLineWidth(0);
                    }
                }
                canvas.translate(ax, this.nameY + AndroidUtilities.dp(0.5f));
                if (this.transitionParams.animateSign) {
                    Theme.chat_adminPaint.setAlpha((int) (Color.alpha(color) * this.transitionParams.animateChangeProgress));
                }
                this.adminLayout.draw(canvas);
                canvas.restore();
            } else {
                dt2 = dt;
                restore2 = restore;
            }
        }
        boolean drawForwardedNameLocal2 = this.drawForwardedName;
        boolean hasReply = this.replyNameLayout != null;
        StaticLayout[] forwardedNameLayoutLocal2 = this.forwardedNameLayout;
        int forwardedNameWidthLocal2 = this.forwardedNameWidth;
        if (!this.transitionParams.animateForwardedLayout) {
            drawForwardedNameLocal = drawForwardedNameLocal2;
            forwardedNameLayoutLocal = forwardedNameLayoutLocal2;
            animatingAlpha = 1.0f;
            forwardedNameWidthLocal = forwardedNameWidthLocal2;
        } else if (!this.currentMessageObject.needDrawForwarded()) {
            drawForwardedNameLocal = true;
            forwardedNameLayoutLocal = this.transitionParams.animatingForwardedNameLayout;
            animatingAlpha = 1.0f - this.transitionParams.animateChangeProgress;
            forwardedNameWidthLocal = this.transitionParams.animateForwardNameWidth;
        } else {
            drawForwardedNameLocal = drawForwardedNameLocal2;
            forwardedNameLayoutLocal = forwardedNameLayoutLocal2;
            animatingAlpha = this.transitionParams.animateChangeProgress;
            forwardedNameWidthLocal = forwardedNameWidthLocal2;
        }
        boolean needDrawReplyBackground3 = true;
        if (drawForwardedNameLocal && forwardedNameLayoutLocal[0] != null && forwardedNameLayoutLocal[1] != null) {
            MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
            if (groupedMessagePosition != null && (groupedMessagePosition.minY != 0 || this.currentPosition.minX != 0)) {
                needDrawReplyBackground = true;
                dt3 = dt2;
            } else {
                if (this.currentMessageObject.type == 5 || this.currentMessageObject.isAnyKindOfSticker()) {
                    Theme.chat_forwardNamePaint.setColor(getThemedColor(Theme.key_chat_stickerReplyNameText));
                    if (this.currentMessageObject.needDrawForwarded()) {
                        if (!this.currentMessageObject.isOutOwner()) {
                            forwardNameXLocal = this.backgroundDrawableLeft + this.backgroundDrawableRight + AndroidUtilities.dp(17.0f);
                            this.forwardNameX = forwardNameXLocal;
                        } else {
                            forwardNameXLocal = AndroidUtilities.dp(23.0f);
                            this.forwardNameX = forwardNameXLocal;
                        }
                    } else {
                        forwardNameXLocal = this.transitionParams.animateForwardNameX;
                    }
                    if ((this.currentMessageObject.isOutOwner() && this.currentMessageObject.type == 5 && this.transitionParams.animatePlayingRound) || this.isPlayingRound) {
                        forwardNameXLocal -= AndroidUtilities.dp(78.0f) * (this.isPlayingRound ? this.transitionParams.animateChangeProgress : 1.0f - this.transitionParams.animateChangeProgress);
                    }
                    this.forwardNameY = AndroidUtilities.dp(12.0f);
                    int backWidth = AndroidUtilities.dp(14.0f) + forwardedNameWidthLocal;
                    if (!hasReply) {
                        this.rect.set(((int) forwardNameXLocal) - AndroidUtilities.dp(7.0f), this.forwardNameY - AndroidUtilities.dp(6.0f), (((int) forwardNameXLocal) - AndroidUtilities.dp(7.0f)) + backWidth, this.forwardNameY + AndroidUtilities.dp(38.0f));
                        needDrawReplyBackground2 = true;
                    } else {
                        int replyBackWidth = Math.max(this.replyNameWidth, this.replyTextWidth) + AndroidUtilities.dp(14.0f);
                        int replyBackWidth2 = this.forwardNameY;
                        this.rect.set(((int) forwardNameXLocal) - AndroidUtilities.dp(7.0f), this.forwardNameY - AndroidUtilities.dp(6.0f), (((int) forwardNameXLocal) - AndroidUtilities.dp(7.0f)) + Math.max(backWidth, replyBackWidth), replyBackWidth2 + AndroidUtilities.dp(38.0f) + AndroidUtilities.dp(41.0f));
                        needDrawReplyBackground2 = false;
                    }
                    applyServiceShaderMatrix();
                    int oldAlpha1 = -1;
                    if (animatingAlpha != 1.0f || replyForwardAlpha != 1.0f) {
                        oldAlpha1 = getThemedPaint(Theme.key_paint_chatActionBackground).getAlpha();
                        getThemedPaint(Theme.key_paint_chatActionBackground).setAlpha((int) (oldAlpha1 * animatingAlpha * replyForwardAlpha));
                    }
                    boolean needDrawReplyBackground4 = needDrawReplyBackground2;
                    canvas.drawRoundRect(this.rect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), getThemedPaint(Theme.key_paint_chatActionBackground));
                    if (!hasGradientService()) {
                        oldAlpha2 = -1;
                    } else {
                        if (animatingAlpha == 1.0f && replyForwardAlpha == 1.0f) {
                            oldAlpha22 = -1;
                        } else {
                            int oldAlpha24 = Theme.chat_actionBackgroundGradientDarkenPaint.getAlpha();
                            Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha((int) (oldAlpha24 * animatingAlpha * replyForwardAlpha));
                            oldAlpha22 = oldAlpha24;
                        }
                        canvas.drawRoundRect(this.rect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), Theme.chat_actionBackgroundGradientDarkenPaint);
                        oldAlpha2 = oldAlpha22;
                    }
                    if (oldAlpha1 >= 0) {
                        getThemedPaint(Theme.key_paint_chatActionBackground).setAlpha(oldAlpha1);
                    }
                    if (oldAlpha2 >= 0) {
                        Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha(oldAlpha2);
                    }
                    needDrawReplyBackground3 = needDrawReplyBackground4;
                } else {
                    this.forwardNameY = AndroidUtilities.dp((this.drawNameLayout ? 19 : 0) + 10);
                    if (this.currentMessageObject.isOutOwner()) {
                        if (this.hasPsaHint) {
                            Theme.chat_forwardNamePaint.setColor(getThemedColor(Theme.key_chat_outPsaNameText));
                        } else {
                            Theme.chat_forwardNamePaint.setColor(getThemedColor(Theme.key_chat_outForwardedNameText));
                        }
                        if (this.currentMessageObject.needDrawForwarded()) {
                            float forwardNameXLocal2 = this.backgroundDrawableLeft + AndroidUtilities.dp(11.0f) + getExtraTextX();
                            this.forwardNameX = forwardNameXLocal2;
                            forwardNameXLocal = forwardNameXLocal2 + this.transitionParams.deltaLeft;
                        } else {
                            forwardNameXLocal = this.transitionParams.animateForwardNameX;
                        }
                    } else {
                        if (this.hasPsaHint) {
                            Theme.chat_forwardNamePaint.setColor(getThemedColor(Theme.key_chat_inPsaNameText));
                        } else {
                            Theme.chat_forwardNamePaint.setColor(getThemedColor(Theme.key_chat_inForwardedNameText));
                        }
                        if (this.currentMessageObject.needDrawForwarded()) {
                            if (this.mediaBackground) {
                                forwardNameXLocal = this.backgroundDrawableLeft + AndroidUtilities.dp(11.0f) + getExtraTextX();
                                this.forwardNameX = forwardNameXLocal;
                            } else {
                                int i = this.backgroundDrawableLeft;
                                if (this.drawPinnedBottom) {
                                    f2 = 11.0f;
                                }
                                forwardNameXLocal = i + AndroidUtilities.dp(f2) + getExtraTextX();
                                this.forwardNameX = forwardNameXLocal;
                            }
                        } else {
                            forwardNameXLocal = this.transitionParams.animateForwardNameX;
                        }
                    }
                }
                if (!this.transitionParams.animateForwardedLayout) {
                    needDrawReplyBackground = needDrawReplyBackground3;
                    clipContent2 = false;
                } else if (this.currentBackgroundDrawable == null || this.currentMessagesGroup != null || this.currentMessageObject.type == 5 || this.currentMessageObject.isAnyKindOfSticker()) {
                    needDrawReplyBackground = needDrawReplyBackground3;
                    clipContent2 = false;
                } else {
                    Rect r = this.currentBackgroundDrawable.getBounds();
                    canvas.save();
                    if (!this.currentMessageObject.isOutOwner() || this.mediaBackground || this.pinnedBottom) {
                        needDrawReplyBackground = needDrawReplyBackground3;
                        canvas.clipRect(r.left + AndroidUtilities.dp(4.0f), r.top + AndroidUtilities.dp(4.0f), r.right - AndroidUtilities.dp(4.0f), r.bottom - AndroidUtilities.dp(4.0f));
                    } else {
                        needDrawReplyBackground = needDrawReplyBackground3;
                        canvas.clipRect(r.left + AndroidUtilities.dp(4.0f), r.top + AndroidUtilities.dp(4.0f), r.right - AndroidUtilities.dp(10.0f), r.bottom - AndroidUtilities.dp(4.0f));
                    }
                    clipContent = true;
                    for (a = 0; a < 2; a++) {
                        canvas.save();
                        canvas.translate(forwardNameXLocal - this.forwardNameOffsetX[a], this.forwardNameY + (AndroidUtilities.dp(16.0f) * a));
                        if (animatingAlpha != 1.0f || replyForwardAlpha != 1.0f) {
                            int oldAlpha3 = forwardedNameLayoutLocal[a].getPaint().getAlpha();
                            forwardedNameLayoutLocal[a].getPaint().setAlpha((int) (oldAlpha3 * animatingAlpha * replyForwardAlpha));
                            forwardedNameLayoutLocal[a].draw(canvas);
                            forwardedNameLayoutLocal[a].getPaint().setAlpha(oldAlpha3);
                        } else {
                            forwardedNameLayoutLocal[a].draw(canvas);
                        }
                        canvas.restore();
                    }
                    if (clipContent) {
                        canvas.restore();
                    }
                    if (!this.hasPsaHint) {
                        if (this.psaButtonVisible || this.psaButtonProgress > 0.0f) {
                            Drawable drawable = Theme.chat_psaHelpDrawable[this.currentMessageObject.isOutOwner() ? 1 : 0];
                            int cx = this.psaHelpX + (drawable.getIntrinsicWidth() / 2);
                            int cy = this.psaHelpY + (drawable.getIntrinsicHeight() / 2);
                            float scale = (!this.psaButtonVisible || this.psaButtonProgress >= 1.0f) ? this.psaButtonProgress : AnimationProperties.overshootInterpolator.getInterpolation(this.psaButtonProgress);
                            int w = (int) (drawable.getIntrinsicWidth() * scale);
                            int h = (int) (drawable.getIntrinsicHeight() * scale);
                            drawable.setBounds(cx - (w / 2), cy - (h / 2), cx + (w / 2), cy + (h / 2));
                            drawable.draw(canvas);
                            if (Build.VERSION.SDK_INT >= 21 && this.selectorDrawable[0] != null && this.selectorDrawableMaskType[0] == 3) {
                                canvas.save();
                                float f3 = this.psaButtonProgress;
                                canvas.scale(f3, f3, this.selectorDrawable[0].getBounds().centerX(), this.selectorDrawable[0].getBounds().centerY());
                                this.selectorDrawable[0].draw(canvas);
                                canvas.restore();
                            }
                        }
                        boolean z = this.psaButtonVisible;
                        if (z) {
                            float f4 = this.psaButtonProgress;
                            if (f4 < 1.0f) {
                                dt3 = dt2;
                                this.psaButtonProgress = f4 + (((float) dt3) / 180.0f);
                                invalidate();
                                if (this.psaButtonProgress > 1.0f) {
                                    this.psaButtonProgress = 1.0f;
                                    setInvalidatesParent(false);
                                }
                            }
                        }
                        dt3 = dt2;
                        if (!z) {
                            float f5 = this.psaButtonProgress;
                            if (f5 > 0.0f) {
                                this.psaButtonProgress = f5 - (((float) dt3) / 180.0f);
                                invalidate();
                                if (this.psaButtonProgress < 0.0f) {
                                    this.psaButtonProgress = 0.0f;
                                    setInvalidatesParent(false);
                                }
                            }
                        }
                    } else {
                        dt3 = dt2;
                    }
                }
                clipContent = clipContent2;
                while (a < 2) {
                }
                if (clipContent) {
                }
                if (!this.hasPsaHint) {
                }
            }
        } else {
            needDrawReplyBackground = true;
            dt3 = dt2;
        }
        if (hasReply) {
            float replyStartX3 = this.replyStartX;
            float replyStartY2 = this.replyStartY;
            MessageObject.GroupedMessages groupedMessages4 = this.currentMessagesGroup;
            if (groupedMessages4 != null && groupedMessages4.transitionParams.backgroundChangeBounds) {
                replyStartX3 += this.currentMessagesGroup.transitionParams.offsetLeft;
            }
            if (!this.transitionParams.animateBackgroundBoundsInner) {
                replyStartX = replyStartX3;
                replyStartY = replyStartY2;
            } else {
                if (this.isRoundVideo) {
                    replyStartX2 = replyStartX3 + this.transitionParams.deltaLeft + this.transitionParams.deltaRight;
                } else {
                    replyStartX2 = replyStartX3 + this.transitionParams.deltaLeft;
                }
                float replyStartY3 = (this.replyStartY * this.transitionParams.animateChangeProgress) + (this.transitionParams.animateFromReplyY * (1.0f - this.transitionParams.animateChangeProgress));
                replyStartX = replyStartX2;
                replyStartY = replyStartY3;
            }
            if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                Theme.chat_replyLinePaint.setColor(getThemedColor(Theme.key_chat_stickerReplyLine));
                int oldAlpha4 = Theme.chat_replyLinePaint.getAlpha();
                Theme.chat_replyLinePaint.setAlpha((int) (oldAlpha4 * this.timeAlpha * replyForwardAlpha));
                Theme.chat_replyNamePaint.setColor(getThemedColor(Theme.key_chat_stickerReplyNameText));
                int oldAlpha5 = Theme.chat_replyNamePaint.getAlpha();
                Theme.chat_replyNamePaint.setAlpha((int) (oldAlpha5 * this.timeAlpha * replyForwardAlpha));
                Theme.chat_replyTextPaint.setColor(getThemedColor(Theme.key_chat_stickerReplyMessageText));
                int oldAlpha6 = Theme.chat_replyTextPaint.getAlpha();
                Theme.chat_replyTextPaint.setAlpha((int) (oldAlpha6 * this.timeAlpha * replyForwardAlpha));
                if (needDrawReplyBackground) {
                    int backWidth2 = Math.max(this.replyNameWidth, this.replyTextWidth) + AndroidUtilities.dp(14.0f);
                    int oldAlpha7 = AndroidUtilities.dp(6.0f);
                    dt4 = dt3;
                    this.rect.set(((int) replyStartX) - AndroidUtilities.dp(7.0f), replyStartY - oldAlpha7, (((int) replyStartX) - AndroidUtilities.dp(7.0f)) + backWidth2, AndroidUtilities.dp(41.0f) + replyStartY);
                    applyServiceShaderMatrix();
                    int oldAlpha8 = getThemedPaint(Theme.key_paint_chatActionBackground).getAlpha();
                    getThemedPaint(Theme.key_paint_chatActionBackground).setAlpha((int) (oldAlpha8 * this.timeAlpha * replyForwardAlpha));
                    canvas.drawRoundRect(this.rect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), getThemedPaint(Theme.key_paint_chatActionBackground));
                    getThemedPaint(Theme.key_paint_chatActionBackground).setAlpha(oldAlpha8);
                    if (hasGradientService()) {
                        int oldAlpha9 = Theme.chat_actionBackgroundGradientDarkenPaint.getAlpha();
                        Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha((int) (oldAlpha9 * this.timeAlpha * replyForwardAlpha));
                        canvas.drawRoundRect(this.rect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), Theme.chat_actionBackgroundGradientDarkenPaint);
                        Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha(oldAlpha9);
                    }
                } else {
                    dt4 = dt3;
                }
            } else {
                dt4 = dt3;
                if (this.currentMessageObject.isOutOwner()) {
                    Theme.chat_replyLinePaint.setColor(getThemedColor(Theme.key_chat_outReplyLine));
                    Theme.chat_replyNamePaint.setColor(getThemedColor(Theme.key_chat_outReplyNameText));
                    if (!this.currentMessageObject.hasValidReplyMessageObject() || ((this.currentMessageObject.replyMessageObject.type != 0 && TextUtils.isEmpty(this.currentMessageObject.replyMessageObject.caption)) || (this.currentMessageObject.replyMessageObject.messageOwner.media instanceof TLRPC.TL_messageMediaGame) || (this.currentMessageObject.replyMessageObject.messageOwner.media instanceof TLRPC.TL_messageMediaInvoice))) {
                        Theme.chat_replyTextPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outReplyMediaMessageSelectedText : Theme.key_chat_outReplyMediaMessageText));
                    } else {
                        Theme.chat_replyTextPaint.setColor(getThemedColor(Theme.key_chat_outReplyMessageText));
                    }
                } else {
                    Theme.chat_replyLinePaint.setColor(getThemedColor(Theme.key_chat_inReplyLine));
                    Theme.chat_replyNamePaint.setColor(getThemedColor(Theme.key_chat_inReplyNameText));
                    if (!this.currentMessageObject.hasValidReplyMessageObject() || ((this.currentMessageObject.replyMessageObject.type != 0 && TextUtils.isEmpty(this.currentMessageObject.replyMessageObject.caption)) || (this.currentMessageObject.replyMessageObject.messageOwner.media instanceof TLRPC.TL_messageMediaGame) || (this.currentMessageObject.replyMessageObject.messageOwner.media instanceof TLRPC.TL_messageMediaInvoice))) {
                        Theme.chat_replyTextPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inReplyMediaMessageSelectedText : Theme.key_chat_inReplyMediaMessageText));
                    } else {
                        Theme.chat_replyTextPaint.setColor(getThemedColor(Theme.key_chat_inReplyMessageText));
                    }
                }
            }
            this.forwardNameX = (replyStartX - this.replyTextOffset) + AndroidUtilities.dp((this.needReplyImage ? 44 : 0) + 10);
            MessageObject.GroupedMessagePosition groupedMessagePosition2 = this.currentPosition;
            if ((groupedMessagePosition2 == null || (groupedMessagePosition2.minY == 0 && this.currentPosition.minX == 0)) && (!this.enterTransitionInProgress || this.currentMessageObject.isVoice())) {
                AndroidUtilities.rectTmp.set(replyStartX, replyStartY, AndroidUtilities.dp(2.0f) + replyStartX, AndroidUtilities.dp(35.0f) + replyStartY);
                canvas.drawRoundRect(AndroidUtilities.rectTmp, AndroidUtilities.dp(1.0f), AndroidUtilities.dp(1.0f), Theme.chat_replyLinePaint);
                if (this.needReplyImage) {
                    this.replyImageReceiver.setAlpha(replyForwardAlpha);
                    this.replyImageReceiver.setImageCoords(AndroidUtilities.dp(10.0f) + replyStartX, replyStartY, AndroidUtilities.dp(35.0f), AndroidUtilities.dp(35.0f));
                    this.replyImageReceiver.draw(canvas);
                }
                if (this.replyNameLayout != null) {
                    canvas.save();
                    canvas.translate((replyStartX - this.replyNameOffset) + AndroidUtilities.dp((this.needReplyImage ? 44 : 0) + 10), replyStartY);
                    this.replyNameLayout.draw(canvas);
                    canvas.restore();
                }
                if (this.replyTextLayout != null) {
                    canvas.save();
                    canvas.translate(this.forwardNameX, AndroidUtilities.dp(19.0f) + replyStartY);
                    int spoilersColor = (!this.currentMessageObject.isOut() || ChatObject.isChannelAndNotMegaGroup(this.currentMessageObject.getChatId(), this.currentAccount)) ? this.replyTextLayout.getPaint().getColor() : getThemedColor(Theme.key_chat_outTimeText);
                    SpoilerEffect.renderWithRipple(this, this.invalidateSpoilersParent, spoilersColor, -AndroidUtilities.dp(2.0f), this.spoilersPatchedReplyTextLayout, this.replyTextLayout, this.replySpoilers, canvas, false);
                    canvas.restore();
                }
            }
        }
        int restore3 = restore2;
        if (restore3 != Integer.MIN_VALUE) {
            canvas.restoreToCount(restore3);
        }
    }

    public boolean hasCaptionLayout() {
        return this.captionLayout != null;
    }

    public boolean hasCommentLayout() {
        return this.drawCommentButton;
    }

    public StaticLayout getCaptionLayout() {
        return this.captionLayout;
    }

    public void setDrawSelectionBackground(boolean value) {
        if (this.drawSelectionBackground != value) {
            this.drawSelectionBackground = value;
            invalidate();
        }
    }

    public boolean isDrawingSelectionBackground() {
        return this.drawSelectionBackground || this.isHighlightedAnimated || this.isHighlighted;
    }

    public float getHighlightAlpha() {
        int i;
        if (this.drawSelectionBackground || !this.isHighlightedAnimated || (i = this.highlightProgress) >= 300) {
            return 1.0f;
        }
        return i / 300.0f;
    }

    public void setCheckBoxVisible(boolean visible, boolean animated) {
        MessageObject.GroupedMessages groupedMessages;
        MessageObject.GroupedMessages groupedMessages2;
        if (visible && this.checkBox == null) {
            CheckBoxBase checkBoxBase = new CheckBoxBase(this, 21, this.resourcesProvider);
            this.checkBox = checkBoxBase;
            if (this.attachedToWindow) {
                checkBoxBase.onAttachedToWindow();
            }
        }
        if (visible && this.mediaCheckBox == null && (((groupedMessages = this.currentMessagesGroup) != null && groupedMessages.messages.size() > 1) || ((groupedMessages2 = this.groupedMessagesToSet) != null && groupedMessages2.messages.size() > 1))) {
            CheckBoxBase checkBoxBase2 = new CheckBoxBase(this, 21, this.resourcesProvider);
            this.mediaCheckBox = checkBoxBase2;
            checkBoxBase2.setUseDefaultCheck(true);
            if (this.attachedToWindow) {
                this.mediaCheckBox.onAttachedToWindow();
            }
        }
        float f = 1.0f;
        if (this.checkBoxVisible == visible) {
            if (animated != this.checkBoxAnimationInProgress && !animated) {
                if (!visible) {
                    f = 0.0f;
                }
                this.checkBoxAnimationProgress = f;
                invalidate();
                return;
            }
            return;
        }
        this.checkBoxAnimationInProgress = animated;
        this.checkBoxVisible = visible;
        if (animated) {
            this.lastCheckBoxAnimationTime = SystemClock.elapsedRealtime();
        } else {
            if (!visible) {
                f = 0.0f;
            }
            this.checkBoxAnimationProgress = f;
        }
        invalidate();
    }

    public void setChecked(boolean checked, boolean allChecked, boolean animated) {
        CheckBoxBase checkBoxBase = this.checkBox;
        if (checkBoxBase != null) {
            checkBoxBase.setChecked(allChecked, animated);
        }
        CheckBoxBase checkBoxBase2 = this.mediaCheckBox;
        if (checkBoxBase2 != null) {
            checkBoxBase2.setChecked(checked, animated);
        }
        this.backgroundDrawable.setSelected(allChecked, animated);
    }

    public void setLastTouchCoords(float x, float y) {
        this.lastTouchX = x;
        this.lastTouchY = y;
        this.backgroundDrawable.setTouchCoords(getTranslationX() + x, this.lastTouchY);
    }

    public MessageBackgroundDrawable getBackgroundDrawable() {
        return this.backgroundDrawable;
    }

    public Theme.MessageDrawable getCurrentBackgroundDrawable(boolean update) {
        if (update) {
            MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
            boolean forceMediaByGroup = groupedMessagePosition != null && (groupedMessagePosition.flags & 8) == 0 && this.currentMessagesGroup.isDocuments && !this.drawPinnedBottom;
            if (this.currentMessageObject.isOutOwner()) {
                if (!this.mediaBackground && !this.drawPinnedBottom && !forceMediaByGroup) {
                    this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgOut);
                } else {
                    this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgOutMedia);
                }
            } else if (!this.mediaBackground && !this.drawPinnedBottom && !forceMediaByGroup) {
                this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgIn);
            } else {
                this.currentBackgroundDrawable = (Theme.MessageDrawable) getThemedDrawable(Theme.key_drawable_msgInMedia);
            }
        }
        this.currentBackgroundDrawable.getBackgroundDrawable();
        return this.currentBackgroundDrawable;
    }

    public void drawCaptionLayout(Canvas canvas, boolean selectionOnly, float alpha) {
        float f = 1.0f;
        if (!this.transitionParams.animateReplaceCaptionLayout || this.transitionParams.animateChangeProgress == 1.0f) {
            drawCaptionLayout(canvas, this.captionLayout, selectionOnly, alpha);
        } else {
            drawCaptionLayout(canvas, this.transitionParams.animateOutCaptionLayout, selectionOnly, (1.0f - this.transitionParams.animateChangeProgress) * alpha);
            drawCaptionLayout(canvas, this.captionLayout, selectionOnly, this.transitionParams.animateChangeProgress * alpha);
        }
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null && messageObject.messageOwner != null && this.currentMessageObject.isVoiceTranscriptionOpen() && !this.currentMessageObject.messageOwner.voiceTranscriptionFinal && TranscribeButton.isTranscribing(this.currentMessageObject)) {
            invalidate();
        }
        if (!selectionOnly) {
            MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
            if ((groupedMessagePosition == null || ((groupedMessagePosition.flags & 8) != 0 && (this.currentPosition.flags & 1) != 0)) && !this.reactionsLayoutInBubble.isSmall) {
                if (this.reactionsLayoutInBubble.drawServiceShaderBackground) {
                    applyServiceShaderMatrix();
                }
                if (this.reactionsLayoutInBubble.drawServiceShaderBackground || !this.transitionParams.animateBackgroundBoundsInner || this.currentPosition != null) {
                    ReactionsLayoutInBubble reactionsLayoutInBubble = this.reactionsLayoutInBubble;
                    if (this.transitionParams.animateChange) {
                        f = this.transitionParams.animateChangeProgress;
                    }
                    reactionsLayoutInBubble.draw(canvas, f, null);
                    return;
                }
                canvas.save();
                canvas.clipRect(0.0f, 0.0f, getMeasuredWidth(), getBackgroundDrawableBottom() + this.transitionParams.deltaBottom);
                ReactionsLayoutInBubble reactionsLayoutInBubble2 = this.reactionsLayoutInBubble;
                if (this.transitionParams.animateChange) {
                    f = this.transitionParams.animateChangeProgress;
                }
                reactionsLayoutInBubble2.draw(canvas, f, null);
                canvas.restore();
            }
        }
    }

    /* JADX WARN: Removed duplicated region for block: B:301:0x07d1  */
    /* JADX WARN: Removed duplicated region for block: B:302:0x07f1  */
    /* JADX WARN: Removed duplicated region for block: B:331:0x08cd  */
    /* JADX WARN: Removed duplicated region for block: B:334:0x08d8  */
    /* JADX WARN: Removed duplicated region for block: B:364:0x097a  */
    /* JADX WARN: Removed duplicated region for block: B:367:0x0982  */
    /* JADX WARN: Removed duplicated region for block: B:373:0x08f3 A[EXC_TOP_SPLITTER, SYNTHETIC] */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    private void drawCaptionLayout(Canvas canvas, StaticLayout captionLayout, boolean selectionOnly, float alpha) {
        float renderingAlpha;
        float captionX;
        float captionY;
        int restore;
        int restore2;
        Exception e;
        int spoilersColor;
        int restore3;
        int bottomoffset;
        Rect rect;
        int x;
        int endX;
        int h2;
        int h;
        int buttonX;
        int buttonX2;
        int endX2;
        boolean drawnAvatars;
        int a;
        int h3;
        int endX3;
        int commentX;
        float f;
        InfiniteProgress infiniteProgress;
        int avatarsOffset;
        int unreadX;
        float ly;
        int buttonX3;
        int endX4;
        int a2;
        boolean drawnAvatars2;
        if (this.currentBackgroundDrawable != null && this.drawCommentButton && this.timeLayout != null) {
            float f2 = 18.0f;
            float y = ((this.layoutHeight + this.transitionParams.deltaBottom) - AndroidUtilities.dp(18.0f)) - this.timeLayout.getHeight();
            MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
            if (groupedMessages != null) {
                y += groupedMessages.transitionParams.offsetBottom;
                if (this.currentMessagesGroup.transitionParams.backgroundChangeBounds) {
                    y -= getTranslationY();
                }
            }
            if (this.mediaBackground) {
                x = this.backgroundDrawableLeft + AndroidUtilities.dp(12.0f) + getExtraTextX();
            } else {
                int i = this.backgroundDrawableLeft;
                if (this.drawPinnedBottom) {
                    f2 = 12.0f;
                }
                x = getExtraTextX() + i + AndroidUtilities.dp(f2);
            }
            int endX5 = x - getExtraTextX();
            if (this.currentMessagesGroup == null || this.currentMessageObject.isMusic() || this.currentMessageObject.isDocument()) {
                endX = endX5 + (this.backgroundWidth - (this.mediaBackground ? 0 : AndroidUtilities.dp(9.0f)));
            } else {
                int dWidth = getGroupPhotosWidth();
                if ((this.currentPosition.flags & 1) == 0) {
                    double d = endX5;
                    double ceil = Math.ceil((this.currentPosition.pw / 1000.0f) * dWidth);
                    Double.isNaN(d);
                    endX = (int) (d + ceil);
                } else {
                    int firstLineWidth = 0;
                    for (int a3 = 0; a3 < this.currentMessagesGroup.posArray.size(); a3++) {
                        MessageObject.GroupedMessagePosition position = this.currentMessagesGroup.posArray.get(a3);
                        if (position.minY != 0) {
                            break;
                        }
                        double d2 = firstLineWidth;
                        double ceil2 = Math.ceil(((position.pw + position.leftSpanOffset) / 1000.0f) * dWidth);
                        Double.isNaN(d2);
                        firstLineWidth = (int) (d2 + ceil2);
                    }
                    endX = endX5 + (firstLineWidth - AndroidUtilities.dp(9.0f));
                }
            }
            if (this.pinnedBottom) {
                h = 2;
                h2 = 3;
            } else if (this.pinnedTop) {
                h = 4;
                h2 = 1;
            } else {
                h = 3;
                h2 = 0;
            }
            int h4 = getCurrentBackgroundLeft();
            int buttonX4 = h4 + AndroidUtilities.dp((this.currentMessageObject.isOutOwner() || this.mediaBackground || this.drawPinnedBottom) ? 2.0f : 8.0f);
            float buttonY = this.layoutHeight - AndroidUtilities.dp(45.1f - h2);
            MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
            if (groupedMessagePosition != null && (groupedMessagePosition.flags & 1) == 0 && !this.currentMessagesGroup.hasSibling) {
                endX += AndroidUtilities.dp(14.0f);
                buttonX = buttonX4 - AndroidUtilities.dp(10.0f);
            } else {
                buttonX = buttonX4;
            }
            this.commentButtonRect.set(buttonX, (int) buttonY, endX - AndroidUtilities.dp(14.0f), this.layoutHeight - AndroidUtilities.dp(h));
            Drawable[] drawableArr = this.selectorDrawable;
            if (drawableArr[1] != null && this.selectorDrawableMaskType[1] == 2) {
                drawableArr[1].setBounds(this.commentButtonRect);
                this.selectorDrawable[1].draw(canvas);
            }
            MessageObject.GroupedMessagePosition groupedMessagePosition2 = this.currentPosition;
            if (groupedMessagePosition2 == null || ((groupedMessagePosition2.flags & 1) != 0 && this.currentPosition.minX == 0 && this.currentPosition.maxX == 0)) {
                TextPaint textPaint = Theme.chat_instantViewPaint;
                String str = Theme.key_chat_inPreviewInstantText;
                textPaint.setColor(getThemedColor(str));
                boolean drawnAvatars3 = false;
                int avatarsOffset2 = 2;
                if (this.commentAvatarImages == null) {
                    endX2 = endX;
                    buttonX2 = buttonX;
                    drawnAvatars = false;
                    a = 2;
                } else {
                    int toAdd = AndroidUtilities.dp(17.0f);
                    int ax = x + getExtraTextX();
                    int a4 = this.commentAvatarImages.length - 1;
                    while (a4 >= 0) {
                        if (this.commentAvatarImagesVisible[a4]) {
                            if (!this.commentAvatarImages[a4].hasImageSet()) {
                                endX4 = endX;
                                drawnAvatars2 = drawnAvatars3;
                                buttonX3 = buttonX;
                                a2 = a4;
                            } else {
                                endX4 = endX;
                                this.commentAvatarImages[a4].setImageX(ax + (toAdd * a4));
                                a2 = a4;
                                this.commentAvatarImages[a4].setImageY((y - AndroidUtilities.dp(4.0f)) + (this.pinnedBottom ? AndroidUtilities.dp(2.0f) : 0));
                                ImageReceiver[] imageReceiverArr = this.commentAvatarImages;
                                if (a2 != imageReceiverArr.length - 1) {
                                    buttonX3 = buttonX;
                                    canvas.drawCircle(imageReceiverArr[a2].getCenterX(), this.commentAvatarImages[a2].getCenterY(), AndroidUtilities.dp(13.0f), this.currentBackgroundDrawable.getPaint());
                                } else {
                                    buttonX3 = buttonX;
                                }
                                this.commentAvatarImages[a2].draw(canvas);
                                if (a2 == 0) {
                                    drawnAvatars3 = true;
                                } else {
                                    avatarsOffset2 += 17;
                                    drawnAvatars3 = true;
                                }
                                a4 = a2 - 1;
                                endX = endX4;
                                buttonX = buttonX3;
                            }
                        } else {
                            endX4 = endX;
                            drawnAvatars2 = drawnAvatars3;
                            buttonX3 = buttonX;
                            a2 = a4;
                        }
                        drawnAvatars3 = drawnAvatars2;
                        a4 = a2 - 1;
                        endX = endX4;
                        buttonX = buttonX3;
                    }
                    endX2 = endX;
                    drawnAvatars = drawnAvatars3;
                    buttonX2 = buttonX;
                    a = avatarsOffset2;
                }
                if (!this.mediaBackground || captionLayout != null || (!this.reactionsLayoutInBubble.isEmpty && !this.reactionsLayoutInBubble.isSmall)) {
                    if (isDrawSelectionBackground()) {
                        Theme.chat_replyLinePaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outVoiceSeekbarSelected : Theme.key_chat_inVoiceSeekbarSelected));
                    } else {
                        Theme.chat_replyLinePaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outVoiceSeekbar : Theme.key_chat_inVoiceSeekbar));
                    }
                    float ly2 = (this.layoutHeight - AndroidUtilities.dp(45.1f - h2)) + this.transitionParams.deltaBottom;
                    MessageObject.GroupedMessages groupedMessages2 = this.currentMessagesGroup;
                    if (groupedMessages2 == null) {
                        int backgroundWidth = (int) ((this.backgroundWidth - this.transitionParams.deltaLeft) + this.transitionParams.deltaRight);
                        ly = ly2;
                        endX2 = (x + backgroundWidth) - AndroidUtilities.dp(12.0f);
                    } else {
                        float ly3 = ly2 + groupedMessages2.transitionParams.offsetBottom;
                        if (!this.currentMessagesGroup.transitionParams.backgroundChangeBounds) {
                            ly = ly3;
                        } else {
                            ly = ly3 - getTranslationY();
                        }
                    }
                    h3 = x;
                    canvas.drawLine(x, ly, endX2 - AndroidUtilities.dp(14.0f), ly, Theme.chat_replyLinePaint);
                    endX3 = endX2;
                } else {
                    endX3 = endX2;
                    h3 = x;
                }
                if (this.commentLayout != null && this.drawSideButton != 3) {
                    TextPaint textPaint2 = Theme.chat_replyNamePaint;
                    if (this.currentMessageObject.isOutOwner()) {
                        str = Theme.key_chat_outPreviewInstantText;
                    }
                    textPaint2.setColor(getThemedColor(str));
                    int dp = h3 + AndroidUtilities.dp(a + 33);
                    this.commentX = dp;
                    if (this.drawCommentNumber) {
                        this.commentX = dp + this.commentNumberWidth + AndroidUtilities.dp(4.0f);
                    }
                    int prevAlpha = Theme.chat_replyNamePaint.getAlpha();
                    if (!this.transitionParams.animateComments) {
                        avatarsOffset = a;
                    } else if (this.transitionParams.animateCommentsLayout == null) {
                        avatarsOffset = a;
                    } else {
                        canvas.save();
                        TextPaint textPaint3 = Theme.chat_replyNamePaint;
                        double d3 = prevAlpha;
                        avatarsOffset = a;
                        double d4 = this.transitionParams.animateChangeProgress;
                        Double.isNaN(d4);
                        Double.isNaN(d3);
                        textPaint3.setAlpha((int) (d3 * (1.0d - d4)));
                        float cx = this.transitionParams.animateCommentX + ((this.commentX - this.transitionParams.animateCommentX) * this.transitionParams.animateChangeProgress);
                        canvas.translate(cx, (y - AndroidUtilities.dp(0.1f)) + (this.pinnedBottom ? AndroidUtilities.dp(2.0f) : 0));
                        this.transitionParams.animateCommentsLayout.draw(canvas);
                        canvas.restore();
                    }
                    canvas.save();
                    canvas.translate(h3 + AndroidUtilities.dp(avatarsOffset + 33), (y - AndroidUtilities.dp(0.1f)) + (this.pinnedBottom ? AndroidUtilities.dp(2.0f) : 0));
                    if (!this.currentMessageObject.isSent()) {
                        Theme.chat_replyNamePaint.setAlpha(127);
                        Theme.chat_commentArrowDrawable.setAlpha(127);
                        Theme.chat_commentDrawable.setAlpha(127);
                    } else {
                        Theme.chat_commentArrowDrawable.setAlpha(255);
                        Theme.chat_commentDrawable.setAlpha(255);
                    }
                    if (this.drawCommentNumber || (this.transitionParams.animateComments && this.transitionParams.animateDrawCommentNumber)) {
                        if (this.drawCommentNumber && this.transitionParams.animateComments) {
                            if (!this.transitionParams.animateDrawCommentNumber) {
                                Theme.chat_replyNamePaint.setAlpha((int) (prevAlpha * this.transitionParams.animateChangeProgress));
                            } else {
                                Theme.chat_replyNamePaint.setAlpha(prevAlpha);
                            }
                        }
                        this.commentNumberLayout.draw(canvas);
                        if (this.drawCommentNumber) {
                            canvas.translate(this.commentNumberWidth + AndroidUtilities.dp(4.0f), 0.0f);
                        }
                    }
                    if (this.transitionParams.animateComments && this.transitionParams.animateCommentsLayout != null) {
                        Theme.chat_replyNamePaint.setAlpha((int) (prevAlpha * this.transitionParams.animateChangeProgress));
                    } else {
                        Theme.chat_replyNamePaint.setAlpha((int) (prevAlpha * alpha));
                    }
                    this.commentLayout.draw(canvas);
                    canvas.restore();
                    int dp2 = h3 + this.commentWidth + AndroidUtilities.dp(avatarsOffset + 33) + AndroidUtilities.dp(9.0f);
                    this.commentUnreadX = dp2;
                    if (this.drawCommentNumber) {
                        this.commentUnreadX = dp2 + this.commentNumberWidth + AndroidUtilities.dp(4.0f);
                    }
                    TLRPC.MessageReplies replies = null;
                    MessageObject.GroupedMessages groupedMessages3 = this.currentMessagesGroup;
                    if (groupedMessages3 != null && !groupedMessages3.messages.isEmpty()) {
                        MessageObject messageObject = this.currentMessagesGroup.messages.get(0);
                        if (messageObject.hasReplies()) {
                            replies = messageObject.messageOwner.replies;
                        }
                    } else if (this.currentMessageObject.hasReplies()) {
                        replies = this.currentMessageObject.messageOwner.replies;
                    }
                    boolean z = (replies == null || replies.read_max_id == 0 || replies.read_max_id >= replies.max_id) ? false : true;
                    this.commentDrawUnread = z;
                    if (z) {
                        int color = getThemedColor(Theme.key_chat_inInstant);
                        Theme.chat_docBackPaint.setColor(color);
                        if (!this.transitionParams.animateComments) {
                            unreadX = this.commentUnreadX;
                        } else {
                            if (!this.transitionParams.animateCommentDrawUnread) {
                                Theme.chat_docBackPaint.setAlpha((int) (Color.alpha(color) * this.transitionParams.animateChangeProgress));
                            }
                            unreadX = (int) (this.transitionParams.animateCommentUnreadX + ((this.commentUnreadX - this.transitionParams.animateCommentUnreadX) * this.transitionParams.animateChangeProgress));
                        }
                        canvas.drawCircle(unreadX, AndroidUtilities.dp(8.0f) + y + (this.pinnedBottom ? AndroidUtilities.dp(2.0f) : 0), AndroidUtilities.dp(2.5f), Theme.chat_docBackPaint);
                    }
                }
                if (!drawnAvatars) {
                    setDrawableBounds(Theme.chat_commentDrawable, h3, (y - AndroidUtilities.dp(4.0f)) + (this.pinnedBottom ? AndroidUtilities.dp(2.0f) : 0));
                    if (alpha != 1.0f) {
                        Theme.chat_commentDrawable.setAlpha((int) (alpha * 255.0f));
                        Theme.chat_commentDrawable.draw(canvas);
                        Theme.chat_commentDrawable.setAlpha(255);
                    } else {
                        Theme.chat_commentDrawable.draw(canvas);
                    }
                }
                this.commentArrowX = endX3 - AndroidUtilities.dp(44.0f);
                if (this.transitionParams.animateComments) {
                    commentX = (int) (this.transitionParams.animateCommentArrowX + ((this.commentArrowX - this.transitionParams.animateCommentArrowX) * this.transitionParams.animateChangeProgress));
                } else {
                    commentX = this.commentArrowX;
                }
                float commentY = (y - AndroidUtilities.dp(4.0f)) + (this.pinnedBottom ? AndroidUtilities.dp(2.0f) : 0);
                boolean drawProgress = this.delegate.shouldDrawThreadProgress(this);
                long newTime = SystemClock.elapsedRealtime();
                long dt = newTime - this.commentProgressLastUpadteTime;
                this.commentProgressLastUpadteTime = newTime;
                if (dt > 17) {
                    dt = 17;
                }
                if (drawProgress) {
                    float f3 = this.commentProgressAlpha;
                    if (f3 >= 1.0f) {
                        f = 0.0f;
                    } else {
                        float f4 = f3 + (((float) dt) / 180.0f);
                        this.commentProgressAlpha = f4;
                        if (f4 <= 1.0f) {
                            f = 0.0f;
                        } else {
                            this.commentProgressAlpha = 1.0f;
                            f = 0.0f;
                        }
                    }
                } else {
                    float f5 = this.commentProgressAlpha;
                    f = 0.0f;
                    if (f5 > 0.0f) {
                        float f6 = f5 - (((float) dt) / 180.0f);
                        this.commentProgressAlpha = f6;
                        f = 0.0f;
                        if (f6 < 0.0f) {
                            this.commentProgressAlpha = 0.0f;
                        }
                    }
                }
                if ((drawProgress || this.commentProgressAlpha > f) && (infiniteProgress = this.commentProgress) != null) {
                    infiniteProgress.setColor(getThemedColor(Theme.key_chat_inInstant));
                    this.commentProgress.setAlpha(this.commentProgressAlpha);
                    this.commentProgress.draw(canvas, AndroidUtilities.dp(11.0f) + commentX, AndroidUtilities.dp(12.0f) + commentY, this.commentProgressAlpha);
                    invalidate();
                }
                if (!drawProgress || this.commentProgressAlpha < 1.0f) {
                    int aw = Theme.chat_commentArrowDrawable.getIntrinsicWidth();
                    int ah = Theme.chat_commentArrowDrawable.getIntrinsicHeight();
                    float acx = (aw / 2) + commentX;
                    float acy = (ah / 2) + commentY;
                    Drawable drawable = Theme.chat_commentArrowDrawable;
                    float f7 = this.commentProgressAlpha;
                    drawable.setBounds((int) (acx - ((aw / 2) * (1.0f - f7))), (int) (acy - ((ah / 2) * (1.0f - f7))), (int) (((aw / 2) * (1.0f - f7)) + acx), (int) (((ah / 2) * (1.0f - f7)) + acy));
                    Theme.chat_commentArrowDrawable.setAlpha((int) ((1.0f - this.commentProgressAlpha) * 255.0f * alpha));
                    Theme.chat_commentArrowDrawable.draw(canvas);
                }
            }
        }
        if (captionLayout != null) {
            if (!selectionOnly || !this.links.isEmpty()) {
                if ((this.currentMessageObject.deleted && this.currentPosition != null) || alpha == 0.0f) {
                    return;
                }
                if (this.currentMessageObject.isOutOwner()) {
                    Theme.chat_msgTextPaint.setColor(getThemedColor(Theme.key_chat_messageTextOut));
                    Theme.chat_msgTextPaint.linkColor = getThemedColor(Theme.key_chat_messageLinkOut);
                } else {
                    Theme.chat_msgTextPaint.setColor(getThemedColor(Theme.key_chat_messageTextIn));
                    Theme.chat_msgTextPaint.linkColor = getThemedColor(Theme.key_chat_messageLinkIn);
                }
                canvas.save();
                MessageObject.GroupedMessages groupedMessages4 = this.currentMessagesGroup;
                if (groupedMessages4 == null) {
                    renderingAlpha = alpha;
                } else {
                    renderingAlpha = groupedMessages4.transitionParams.captionEnterProgress * alpha;
                }
                if (renderingAlpha == 0.0f) {
                    return;
                }
                float captionY2 = this.captionY;
                float captionX2 = this.captionX;
                if (this.transitionParams.animateBackgroundBoundsInner) {
                    if (this.transitionParams.transformGroupToSingleMessage) {
                        captionY = captionY2 - getTranslationY();
                        captionX = captionX2 + this.transitionParams.deltaLeft;
                    } else if (this.transitionParams.moveCaption) {
                        float captionX3 = (this.captionX * this.transitionParams.animateChangeProgress) + (this.transitionParams.captionFromX * (1.0f - this.transitionParams.animateChangeProgress));
                        captionY = (this.captionY * this.transitionParams.animateChangeProgress) + (this.transitionParams.captionFromY * (1.0f - this.transitionParams.animateChangeProgress));
                        captionX = captionX3;
                    } else if (!this.currentMessageObject.isVoice() || !TextUtils.isEmpty(this.currentMessageObject.caption)) {
                        captionY = captionY2;
                        captionX = captionX2 + this.transitionParams.deltaLeft;
                    }
                    if (renderingAlpha != 1.0f) {
                        restore = Integer.MIN_VALUE;
                    } else {
                        this.rect.set(captionX, captionY, captionLayout.getWidth() + captionX, captionLayout.getHeight() + captionY);
                        restore = canvas.saveLayerAlpha(this.rect, (int) (renderingAlpha * 255.0f), 31);
                    }
                    if (this.transitionParams.animateBackgroundBoundsInner && this.currentBackgroundDrawable != null && this.currentMessagesGroup == null) {
                        int height = (this.drawCommentButton || (rect = this.commentButtonRect) == null) ? 0 : rect.height();
                        ReactionsLayoutInBubble reactionsLayoutInBubble = this.reactionsLayoutInBubble;
                        bottomoffset = height + ((reactionsLayoutInBubble != null || reactionsLayoutInBubble.isSmall) ? 0 : this.reactionsLayoutInBubble.height);
                        if (!this.currentMessageObject.isOutOwner() && !this.mediaBackground && !this.pinnedBottom) {
                            canvas.clipRect(getBackgroundDrawableLeft() + this.transitionParams.deltaLeft + AndroidUtilities.dp(4.0f), getBackgroundDrawableTop() + this.transitionParams.deltaTop + AndroidUtilities.dp(4.0f), (getBackgroundDrawableRight() + this.transitionParams.deltaRight) - AndroidUtilities.dp(10.0f), ((getBackgroundDrawableBottom() + this.transitionParams.deltaBottom) - AndroidUtilities.dp(4.0f)) - bottomoffset);
                        } else {
                            canvas.clipRect(getBackgroundDrawableLeft() + this.transitionParams.deltaLeft + AndroidUtilities.dp(4.0f), getBackgroundDrawableTop() + this.transitionParams.deltaTop + AndroidUtilities.dp(4.0f), (getBackgroundDrawableRight() + this.transitionParams.deltaRight) - AndroidUtilities.dp(4.0f), ((getBackgroundDrawableBottom() + this.transitionParams.deltaBottom) - AndroidUtilities.dp(4.0f)) - bottomoffset);
                        }
                    }
                    canvas.translate(captionX, captionY);
                    if (this.links.draw(canvas)) {
                        invalidate();
                    }
                    if (!this.urlPathSelection.isEmpty()) {
                        for (int b = 0; b < this.urlPathSelection.size(); b++) {
                            canvas.drawPath(this.urlPathSelection.get(b), Theme.chat_textSearchSelectionPaint);
                        }
                    }
                    if (!selectionOnly) {
                        restore2 = restore;
                    } else {
                        try {
                            if (getDelegate() != null) {
                                try {
                                    if (getDelegate().getTextSelectionHelper() != null && getDelegate().getTextSelectionHelper().isSelected(this.currentMessageObject)) {
                                        getDelegate().getTextSelectionHelper().drawCaption(this.currentMessageObject.isOutOwner(), captionLayout, canvas);
                                    }
                                } catch (Exception e2) {
                                    e = e2;
                                    restore2 = restore;
                                    FileLog.e(e);
                                    restore3 = restore2;
                                    if (restore3 != Integer.MIN_VALUE) {
                                    }
                                    canvas.restore();
                                }
                            }
                            Emoji.emojiDrawingYOffset = -this.transitionYOffsetForDrawables;
                            spoilersColor = (!this.currentMessageObject.isOut() || ChatObject.isChannelAndNotMegaGroup(this.currentMessageObject.getChatId(), this.currentAccount)) ? captionLayout.getPaint().getColor() : getThemedColor(Theme.key_chat_outTimeText);
                            restore2 = restore;
                        } catch (Exception e3) {
                            e = e3;
                            restore2 = restore;
                        }
                        try {
                            SpoilerEffect.renderWithRipple(this, this.invalidateSpoilersParent, spoilersColor, 0, this.captionPatchedSpoilersLayout, captionLayout, this.captionSpoilers, canvas, this.currentMessagesGroup != null);
                            Emoji.emojiDrawingYOffset = 0.0f;
                        } catch (Exception e4) {
                            e = e4;
                            FileLog.e(e);
                            restore3 = restore2;
                            if (restore3 != Integer.MIN_VALUE) {
                            }
                            canvas.restore();
                        }
                    }
                    restore3 = restore2;
                    if (restore3 != Integer.MIN_VALUE) {
                        canvas.restoreToCount(restore3);
                    }
                    canvas.restore();
                }
                captionY = captionY2;
                captionX = captionX2;
                if (renderingAlpha != 1.0f) {
                }
                if (this.transitionParams.animateBackgroundBoundsInner) {
                    if (this.drawCommentButton) {
                    }
                    ReactionsLayoutInBubble reactionsLayoutInBubble2 = this.reactionsLayoutInBubble;
                    bottomoffset = height + ((reactionsLayoutInBubble2 != null || reactionsLayoutInBubble2.isSmall) ? 0 : this.reactionsLayoutInBubble.height);
                    if (!this.currentMessageObject.isOutOwner()) {
                    }
                    canvas.clipRect(getBackgroundDrawableLeft() + this.transitionParams.deltaLeft + AndroidUtilities.dp(4.0f), getBackgroundDrawableTop() + this.transitionParams.deltaTop + AndroidUtilities.dp(4.0f), (getBackgroundDrawableRight() + this.transitionParams.deltaRight) - AndroidUtilities.dp(4.0f), ((getBackgroundDrawableBottom() + this.transitionParams.deltaBottom) - AndroidUtilities.dp(4.0f)) - bottomoffset);
                }
                canvas.translate(captionX, captionY);
                if (this.links.draw(canvas)) {
                }
                if (!this.urlPathSelection.isEmpty()) {
                }
                if (!selectionOnly) {
                }
                restore3 = restore2;
                if (restore3 != Integer.MIN_VALUE) {
                }
                canvas.restore();
            }
        }
    }

    public boolean needDrawTime() {
        return !this.forceNotDrawTime;
    }

    public boolean shouldDrawTimeOnMedia() {
        int i = this.overideShouldDrawTimeOnMedia;
        if (i != 0) {
            return i == 1;
        } else if (!this.mediaBackground || this.captionLayout != null) {
            return false;
        } else {
            return this.reactionsLayoutInBubble.isEmpty || this.reactionsLayoutInBubble.isSmall || this.currentMessageObject.isAnyKindOfSticker() || this.currentMessageObject.isRoundVideo();
        }
    }

    public void drawTime(Canvas canvas, float alpha, boolean fromParent) {
        ChatMessageCell chatMessageCell;
        ChatMessageCell chatMessageCell2;
        int i;
        float currentAlpha;
        float timeWidth;
        float timeX;
        int i2;
        ChatMessageCellDelegate chatMessageCellDelegate;
        ChatMessageCell chatMessageCell3 = this;
        if (!chatMessageCell3.drawFromPinchToZoom && (chatMessageCellDelegate = chatMessageCell3.delegate) != null && chatMessageCellDelegate.getPinchToZoomHelper() != null && chatMessageCell3.delegate.getPinchToZoomHelper().isInOverlayModeFor(chatMessageCell3) && shouldDrawTimeOnMedia()) {
            return;
        }
        int i3 = 0;
        while (true) {
            if (i3 >= 2) {
                chatMessageCell = chatMessageCell3;
                break;
            }
            if (i3 == 0 && isDrawSelectionBackground() && chatMessageCell3.currentSelectedBackgroundAlpha == 1.0f && !shouldDrawTimeOnMedia()) {
                i = i3;
                chatMessageCell2 = chatMessageCell3;
            } else {
                if (i3 == 1) {
                    if (!isDrawSelectionBackground() && chatMessageCell3.currentSelectedBackgroundAlpha == 0.0f) {
                        chatMessageCell = chatMessageCell3;
                        break;
                    } else if (shouldDrawTimeOnMedia()) {
                        chatMessageCell = chatMessageCell3;
                        break;
                    }
                }
                boolean drawSelectionBackground = i3 == 1;
                if (i3 == 1) {
                    currentAlpha = alpha * chatMessageCell3.currentSelectedBackgroundAlpha;
                } else {
                    currentAlpha = !shouldDrawTimeOnMedia() ? alpha * (1.0f - chatMessageCell3.currentSelectedBackgroundAlpha) : alpha;
                }
                if (!chatMessageCell3.transitionParams.animateShouldDrawTimeOnMedia || chatMessageCell3.transitionParams.animateChangeProgress == 1.0f) {
                    i = i3;
                    chatMessageCell2 = chatMessageCell3;
                    if (chatMessageCell2.transitionParams.shouldAnimateTimeX) {
                        timeX = (chatMessageCell2.timeX * chatMessageCell2.transitionParams.animateChangeProgress) + (chatMessageCell2.transitionParams.animateFromTimeX * (1.0f - chatMessageCell2.transitionParams.animateChangeProgress));
                        timeWidth = (chatMessageCell2.timeWidth * chatMessageCell2.transitionParams.animateChangeProgress) + (chatMessageCell2.transitionParams.animateTimeWidth * (1.0f - chatMessageCell2.transitionParams.animateChangeProgress));
                    } else {
                        timeX = chatMessageCell2.timeX + chatMessageCell2.transitionParams.deltaRight;
                        timeWidth = chatMessageCell2.timeWidth;
                    }
                    drawTimeInternal(canvas, currentAlpha, fromParent, timeX, chatMessageCell2.timeLayout, timeWidth, drawSelectionBackground);
                } else {
                    if (shouldDrawTimeOnMedia()) {
                        chatMessageCell3.overideShouldDrawTimeOnMedia = 1;
                        drawTimeInternal(canvas, currentAlpha * chatMessageCell3.transitionParams.animateChangeProgress, fromParent, chatMessageCell3.timeX, chatMessageCell3.timeLayout, chatMessageCell3.timeWidth, drawSelectionBackground);
                        chatMessageCell3.overideShouldDrawTimeOnMedia = 2;
                        i2 = 0;
                        i = i3;
                        chatMessageCell2 = chatMessageCell3;
                        drawTimeInternal(canvas, currentAlpha * (1.0f - chatMessageCell3.transitionParams.animateChangeProgress), fromParent, chatMessageCell3.transitionParams.animateFromTimeX, chatMessageCell3.transitionParams.animateTimeLayout, chatMessageCell3.transitionParams.animateTimeWidth, drawSelectionBackground);
                    } else {
                        i = i3;
                        chatMessageCell2 = chatMessageCell3;
                        i2 = 0;
                        chatMessageCell2.overideShouldDrawTimeOnMedia = 2;
                        boolean z = drawSelectionBackground;
                        drawTimeInternal(canvas, currentAlpha * chatMessageCell2.transitionParams.animateChangeProgress, fromParent, chatMessageCell2.timeX, chatMessageCell2.timeLayout, chatMessageCell2.timeWidth, z);
                        chatMessageCell2.overideShouldDrawTimeOnMedia = 1;
                        drawTimeInternal(canvas, currentAlpha * (1.0f - chatMessageCell2.transitionParams.animateChangeProgress), fromParent, chatMessageCell2.transitionParams.animateFromTimeX, chatMessageCell2.transitionParams.animateTimeLayout, chatMessageCell2.transitionParams.animateTimeWidth, z);
                    }
                    chatMessageCell2.overideShouldDrawTimeOnMedia = i2;
                }
            }
            i3 = i + 1;
            chatMessageCell3 = chatMessageCell2;
        }
        if (chatMessageCell.transitionParams.animateBackgroundBoundsInner) {
            drawOverlays(canvas);
        }
    }

    private void drawTimeInternal(Canvas canvas, float alpha, boolean fromParent, float timeX, StaticLayout timeLayout, float timeWidth, boolean drawSelectionBackground) {
        float alpha2;
        float timeX2;
        float layoutHeight;
        float timeX3;
        float timeTitleTimeX;
        boolean bigRadius;
        int timeYOffset;
        int currentStatus;
        boolean needRestore;
        ChatMessageCell chatMessageCell;
        float additionalX;
        int currentStatus2;
        Paint paint;
        int r;
        float additionalX2;
        int currentStatus3;
        float additionalX3;
        if (((this.drawTime && !this.groupPhotoInvisible) || !shouldDrawTimeOnMedia()) && timeLayout != null) {
            if ((this.currentMessageObject.deleted && this.currentPosition != null) || this.currentMessageObject.type == 16) {
                return;
            }
            if (this.currentMessageObject.type == 5) {
                Theme.chat_timePaint.setColor(getThemedColor(Theme.key_chat_serviceText));
            } else if (shouldDrawTimeOnMedia()) {
                if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                    Theme.chat_timePaint.setColor(getThemedColor(Theme.key_chat_serviceText));
                } else {
                    Theme.chat_timePaint.setColor(getThemedColor(Theme.key_chat_mediaTimeText));
                }
            } else if (this.currentMessageObject.isOutOwner()) {
                Theme.chat_timePaint.setColor(getThemedColor(drawSelectionBackground ? Theme.key_chat_outTimeSelectedText : Theme.key_chat_outTimeText));
            } else {
                Theme.chat_timePaint.setColor(getThemedColor(drawSelectionBackground ? Theme.key_chat_inTimeSelectedText : Theme.key_chat_inTimeText));
            }
            if (!getTransitionParams().animateDrawingTimeAlpha) {
                alpha2 = alpha;
            } else {
                alpha2 = getTransitionParams().animateChangeProgress * alpha;
            }
            if (alpha2 != 1.0f) {
                Theme.chat_timePaint.setAlpha((int) (Theme.chat_timePaint.getAlpha() * alpha2));
            }
            canvas.save();
            if (this.drawPinnedBottom && !shouldDrawTimeOnMedia()) {
                canvas.translate(0.0f, AndroidUtilities.dp(2.0f));
            }
            boolean bigRadius2 = false;
            float layoutHeight2 = this.layoutHeight + this.transitionParams.deltaBottom;
            float timeTitleTimeX2 = timeX;
            if (this.transitionParams.shouldAnimateTimeX) {
                timeTitleTimeX2 = (this.transitionParams.animateFromTimeX * (1.0f - this.transitionParams.animateChangeProgress)) + (this.timeX * this.transitionParams.animateChangeProgress);
            }
            MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
            if (groupedMessages != null && groupedMessages.transitionParams.backgroundChangeBounds) {
                layoutHeight2 -= getTranslationY();
                timeX2 = timeX + this.currentMessagesGroup.transitionParams.offsetRight;
                timeTitleTimeX2 += this.currentMessagesGroup.transitionParams.offsetRight;
            } else {
                timeX2 = timeX;
            }
            if (this.drawPinnedBottom && shouldDrawTimeOnMedia()) {
                layoutHeight = layoutHeight2 + AndroidUtilities.dp(1.0f);
            } else {
                layoutHeight = layoutHeight2;
            }
            if (!this.transitionParams.animateBackgroundBoundsInner) {
                timeX3 = timeX2;
            } else {
                float f = this.animationOffsetX;
                timeTitleTimeX2 += f;
                timeX3 = timeX2 + f;
            }
            if (this.reactionsLayoutInBubble.isSmall) {
                if (!this.transitionParams.animateBackgroundBoundsInner || this.transitionParams.deltaRight == 0.0f) {
                    timeTitleTimeX2 += this.reactionsLayoutInBubble.getCurrentWidth(this.transitionParams.animateChangeProgress);
                } else {
                    timeTitleTimeX2 += this.reactionsLayoutInBubble.getCurrentWidth(1.0f);
                }
            }
            if (this.transitionParams.animateEditedEnter) {
                timeTitleTimeX = timeTitleTimeX2 - (this.transitionParams.animateEditedWidthDiff * (1.0f - this.transitionParams.animateChangeProgress));
            } else {
                timeTitleTimeX = timeTitleTimeX2;
            }
            boolean outDrawError = true;
            if (!shouldDrawTimeOnMedia()) {
                if (this.currentMessageObject.isSponsored()) {
                    int timeYOffset2 = -AndroidUtilities.dp(48.0f);
                    if (!this.hasNewLineForTime) {
                        timeYOffset = timeYOffset2;
                    } else {
                        timeYOffset = timeYOffset2 - AndroidUtilities.dp(16.0f);
                    }
                } else {
                    timeYOffset = -(this.drawCommentButton ? AndroidUtilities.dp(43.0f) : 0);
                }
                float additionalX4 = -timeLayout.getLineLeft(0);
                if (this.reactionsLayoutInBubble.isSmall) {
                    updateReactionLayoutPosition();
                    this.reactionsLayoutInBubble.draw(canvas, this.transitionParams.animateChangeProgress, null);
                }
                if ((ChatObject.isChannel(this.currentChat) && !this.currentChat.megagroup) || (this.currentMessageObject.messageOwner.flags & 1024) != 0 || this.repliesLayout != null || this.transitionParams.animateReplies || this.isPinned || this.transitionParams.animatePinned) {
                    float additionalX5 = additionalX4 + (this.timeWidth - timeLayout.getLineWidth(0));
                    if (this.reactionsLayoutInBubble.isSmall && !this.reactionsLayoutInBubble.isEmpty) {
                        additionalX = additionalX5 - this.reactionsLayoutInBubble.width;
                    } else {
                        additionalX = additionalX5;
                    }
                    int currentStatus4 = this.transitionParams.createStatusDrawableParams();
                    if (this.transitionParams.lastStatusDrawableParams >= 0 && this.transitionParams.lastStatusDrawableParams != currentStatus4 && !this.statusDrawableAnimationInProgress) {
                        createStatusDrawableAnimator(this.transitionParams.lastStatusDrawableParams, currentStatus4, fromParent);
                    }
                    boolean z = this.statusDrawableAnimationInProgress;
                    if (!z) {
                        currentStatus2 = currentStatus4;
                    } else {
                        currentStatus2 = this.animateToStatusDrawableParams;
                    }
                    boolean drawClock = (currentStatus2 & 4) != 0;
                    boolean drawError = (currentStatus2 & 8) != 0;
                    if (z) {
                        int i = this.animateFromStatusDrawableParams;
                        boolean outDrawClock = (i & 4) != 0;
                        boolean outDrawError2 = (i & 8) != 0;
                        float f2 = layoutHeight;
                        float f3 = alpha2;
                        float f4 = timeX3;
                        drawClockOrErrorLayout(canvas, outDrawClock, outDrawError2, f2, f3, timeYOffset, f4, 1.0f - this.statusDrawableProgress, drawSelectionBackground);
                        drawClockOrErrorLayout(canvas, drawClock, drawError, f2, f3, timeYOffset, f4, this.statusDrawableProgress, drawSelectionBackground);
                        if (!this.currentMessageObject.isOutOwner()) {
                            if (!outDrawClock && !outDrawError2) {
                                drawViewsAndRepliesLayout(canvas, layoutHeight, alpha2, timeYOffset, timeX3, 1.0f - this.statusDrawableProgress, drawSelectionBackground);
                            }
                            if (!drawClock && !drawError) {
                                drawViewsAndRepliesLayout(canvas, layoutHeight, alpha2, timeYOffset, timeX3, this.statusDrawableProgress, drawSelectionBackground);
                            }
                        }
                    } else {
                        if (!this.currentMessageObject.isOutOwner() && !drawClock && !drawError) {
                            drawViewsAndRepliesLayout(canvas, layoutHeight, alpha2, timeYOffset, timeX3, 1.0f, drawSelectionBackground);
                        }
                        drawClockOrErrorLayout(canvas, drawClock, drawError, layoutHeight, alpha2, timeYOffset, timeX3, 1.0f, drawSelectionBackground);
                    }
                    if (this.currentMessageObject.isOutOwner()) {
                        drawViewsAndRepliesLayout(canvas, layoutHeight, alpha2, timeYOffset, timeX3, 1.0f, drawSelectionBackground);
                    }
                    TransitionParams transitionParams = this.transitionParams;
                    transitionParams.lastStatusDrawableParams = transitionParams.createStatusDrawableParams();
                    if (drawClock && fromParent && getParent() != null) {
                        ((View) getParent()).invalidate();
                    }
                    additionalX4 = additionalX;
                }
                canvas.save();
                float f5 = 6.5f;
                if (!this.transitionParams.animateEditedEnter || this.transitionParams.animateChangeProgress == 1.0f) {
                    float f6 = timeTitleTimeX + additionalX4;
                    this.drawTimeX = f6;
                    if (this.pinnedBottom || this.pinnedTop) {
                        f5 = 7.5f;
                    }
                    float dp = ((layoutHeight - AndroidUtilities.dp(f5)) - timeLayout.getHeight()) + timeYOffset;
                    this.drawTimeY = dp;
                    canvas.translate(f6, dp);
                    timeLayout.draw(canvas);
                } else if (this.transitionParams.animateEditedLayout != null) {
                    float f7 = timeTitleTimeX + additionalX4;
                    if (this.pinnedBottom || this.pinnedTop) {
                        f5 = 7.5f;
                    }
                    canvas.translate(f7, ((layoutHeight - AndroidUtilities.dp(f5)) - timeLayout.getHeight()) + timeYOffset);
                    int oldAlpha = Theme.chat_timePaint.getAlpha();
                    Theme.chat_timePaint.setAlpha((int) (oldAlpha * this.transitionParams.animateChangeProgress));
                    this.transitionParams.animateEditedLayout.draw(canvas);
                    Theme.chat_timePaint.setAlpha(oldAlpha);
                    this.transitionParams.animateTimeLayout.draw(canvas);
                } else {
                    int oldAlpha2 = Theme.chat_timePaint.getAlpha();
                    canvas.save();
                    canvas.translate(this.transitionParams.animateFromTimeX + additionalX4, ((layoutHeight - AndroidUtilities.dp((this.pinnedBottom || this.pinnedTop) ? 7.5f : 6.5f)) - timeLayout.getHeight()) + timeYOffset);
                    Theme.chat_timePaint.setAlpha((int) (oldAlpha2 * (1.0f - this.transitionParams.animateChangeProgress)));
                    this.transitionParams.animateTimeLayout.draw(canvas);
                    canvas.restore();
                    float f8 = timeTitleTimeX + additionalX4;
                    if (this.pinnedBottom || this.pinnedTop) {
                        f5 = 7.5f;
                    }
                    canvas.translate(f8, ((layoutHeight - AndroidUtilities.dp(f5)) - timeLayout.getHeight()) + timeYOffset);
                    Theme.chat_timePaint.setAlpha((int) (oldAlpha2 * this.transitionParams.animateChangeProgress));
                    timeLayout.draw(canvas);
                    Theme.chat_timePaint.setAlpha(oldAlpha2);
                }
                canvas.restore();
                bigRadius = false;
            } else {
                int timeYOffset3 = -(this.drawCommentButton ? AndroidUtilities.dp(41.3f) : 0);
                if (!this.currentMessageObject.shouldDrawWithoutBackground()) {
                    paint = getThemedPaint(Theme.key_paint_chatTimeBackground);
                } else {
                    paint = getThemedPaint(Theme.key_paint_chatActionBackground);
                }
                int oldAlpha3 = paint.getAlpha();
                paint.setAlpha((int) (oldAlpha3 * this.timeAlpha * alpha2));
                Theme.chat_timePaint.setAlpha((int) (this.timeAlpha * 255.0f * alpha2));
                int i2 = this.documentAttachType;
                float f9 = 4.0f;
                if (i2 != 7 && i2 != 6) {
                    int[] rad = this.photoImage.getRoundRadius();
                    int r2 = Math.min(AndroidUtilities.dp(8.0f), Math.max(rad[2], rad[3]));
                    bigRadius2 = SharedConfig.bubbleRadius >= 10;
                    r = r2;
                } else {
                    r = AndroidUtilities.dp(4.0f);
                }
                if (bigRadius2) {
                    f9 = 6.0f;
                }
                float x1 = timeX3 - AndroidUtilities.dp(f9);
                float timeY = this.photoImage.getImageY2() + this.additionalTimeOffsetY;
                float y1 = timeY - AndroidUtilities.dp(23.0f);
                this.rect.set(x1, y1, x1 + timeWidth + AndroidUtilities.dp((bigRadius2 ? 12 : 8) + (this.currentMessageObject.isOutOwner() ? 20 : 0)), AndroidUtilities.dp(17.0f) + y1);
                applyServiceShaderMatrix();
                canvas.drawRoundRect(this.rect, r, r, paint);
                if (paint == getThemedPaint(Theme.key_paint_chatActionBackground) && hasGradientService()) {
                    int oldAlpha22 = Theme.chat_actionBackgroundGradientDarkenPaint.getAlpha();
                    Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha((int) (oldAlpha22 * this.timeAlpha * alpha2));
                    canvas.drawRoundRect(this.rect, r, r, Theme.chat_actionBackgroundGradientDarkenPaint);
                    Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha(oldAlpha22);
                }
                paint.setAlpha(oldAlpha3);
                float additionalX6 = -timeLayout.getLineLeft(0);
                if (this.reactionsLayoutInBubble.isSmall) {
                    updateReactionLayoutPosition();
                    this.reactionsLayoutInBubble.draw(canvas, this.transitionParams.animateChangeProgress, null);
                }
                if ((!ChatObject.isChannel(this.currentChat) || this.currentChat.megagroup) && (this.currentMessageObject.messageOwner.flags & 1024) == 0 && this.repliesLayout == null && !this.isPinned) {
                    timeYOffset = timeYOffset3;
                } else {
                    float additionalX7 = additionalX6 + (this.timeWidth - timeLayout.getLineWidth(0));
                    if (this.reactionsLayoutInBubble.isSmall && !this.reactionsLayoutInBubble.isEmpty) {
                        additionalX2 = additionalX7 - this.reactionsLayoutInBubble.width;
                    } else {
                        additionalX2 = additionalX7;
                    }
                    int currentStatus5 = this.transitionParams.createStatusDrawableParams();
                    if (this.transitionParams.lastStatusDrawableParams >= 0 && this.transitionParams.lastStatusDrawableParams != currentStatus5 && !this.statusDrawableAnimationInProgress) {
                        createStatusDrawableAnimator(this.transitionParams.lastStatusDrawableParams, currentStatus5, fromParent);
                    }
                    boolean z2 = this.statusDrawableAnimationInProgress;
                    if (!z2) {
                        currentStatus3 = currentStatus5;
                    } else {
                        currentStatus3 = this.animateToStatusDrawableParams;
                    }
                    boolean drawClock2 = (currentStatus3 & 4) != 0;
                    boolean drawError2 = (currentStatus3 & 8) != 0;
                    if (!z2) {
                        additionalX3 = additionalX2;
                        timeYOffset = timeYOffset3;
                        if (!this.currentMessageObject.isOutOwner() && !drawClock2 && !drawError2) {
                            drawViewsAndRepliesLayout(canvas, layoutHeight, alpha2, timeYOffset, timeX3, 1.0f, drawSelectionBackground);
                        }
                        drawClockOrErrorLayout(canvas, drawClock2, drawError2, layoutHeight, alpha2, timeYOffset, timeX3, 1.0f, drawSelectionBackground);
                    } else {
                        int i3 = this.animateFromStatusDrawableParams;
                        boolean outDrawClock2 = (i3 & 4) != 0;
                        boolean outDrawError3 = (i3 & 8) != 0;
                        float y12 = layoutHeight;
                        float x12 = alpha2;
                        float f10 = timeX3;
                        additionalX3 = additionalX2;
                        timeYOffset = timeYOffset3;
                        drawClockOrErrorLayout(canvas, outDrawClock2, outDrawError3, y12, x12, timeYOffset3, f10, 1.0f - this.statusDrawableProgress, drawSelectionBackground);
                        drawClockOrErrorLayout(canvas, drawClock2, drawError2, y12, x12, timeYOffset, f10, this.statusDrawableProgress, drawSelectionBackground);
                        if (!this.currentMessageObject.isOutOwner()) {
                            if (!outDrawClock2 && !outDrawError3) {
                                drawViewsAndRepliesLayout(canvas, layoutHeight, alpha2, timeYOffset, timeX3, 1.0f - this.statusDrawableProgress, drawSelectionBackground);
                            }
                            if (!drawClock2 && !drawError2) {
                                drawViewsAndRepliesLayout(canvas, layoutHeight, alpha2, timeYOffset, timeX3, this.statusDrawableProgress, drawSelectionBackground);
                            }
                        }
                    }
                    if (this.currentMessageObject.isOutOwner()) {
                        drawViewsAndRepliesLayout(canvas, layoutHeight, alpha2, timeYOffset, timeX3, 1.0f, drawSelectionBackground);
                    }
                    TransitionParams transitionParams2 = this.transitionParams;
                    transitionParams2.lastStatusDrawableParams = transitionParams2.createStatusDrawableParams();
                    if (drawClock2 && fromParent && getParent() != null) {
                        ((View) getParent()).invalidate();
                    }
                    additionalX6 = additionalX3;
                }
                canvas.save();
                float f11 = timeTitleTimeX + additionalX6;
                this.drawTimeX = f11;
                float dp2 = (timeY - AndroidUtilities.dp(7.3f)) - timeLayout.getHeight();
                this.drawTimeY = dp2;
                canvas.translate(f11, dp2);
                timeLayout.draw(canvas);
                canvas.restore();
                Theme.chat_timePaint.setAlpha(255);
                bigRadius = bigRadius2;
            }
            if (this.currentMessageObject.isOutOwner()) {
                int currentStatus6 = this.transitionParams.createStatusDrawableParams();
                if (this.transitionParams.lastStatusDrawableParams >= 0 && this.transitionParams.lastStatusDrawableParams != currentStatus6 && !this.statusDrawableAnimationInProgress) {
                    createStatusDrawableAnimator(this.transitionParams.lastStatusDrawableParams, currentStatus6, fromParent);
                }
                if (!this.statusDrawableAnimationInProgress) {
                    currentStatus = currentStatus6;
                } else {
                    currentStatus = this.animateToStatusDrawableParams;
                }
                boolean drawCheck1 = (currentStatus & 1) != 0;
                boolean drawCheck2 = (currentStatus & 2) != 0;
                boolean drawClock3 = (currentStatus & 4) != 0;
                boolean drawError3 = (currentStatus & 8) != 0;
                if (this.transitionYOffsetForDrawables == 0.0f) {
                    needRestore = false;
                } else {
                    canvas.save();
                    canvas.translate(0.0f, this.transitionYOffsetForDrawables);
                    needRestore = true;
                }
                boolean needRestore2 = this.statusDrawableAnimationInProgress;
                if (!needRestore2) {
                    chatMessageCell = this;
                    drawStatusDrawable(canvas, drawCheck1, drawCheck2, drawClock3, drawError3, alpha2, bigRadius, timeYOffset, layoutHeight, 1.0f, false, drawSelectionBackground);
                } else {
                    int i4 = this.animateFromStatusDrawableParams;
                    boolean outDrawCheck1 = (i4 & 1) != 0;
                    boolean outDrawCheck2 = (i4 & 2) != 0;
                    boolean outDrawClock3 = (i4 & 4) != 0;
                    if ((i4 & 8) == 0) {
                        outDrawError = false;
                    }
                    if (!outDrawClock3 && outDrawCheck2 && drawCheck2 && !outDrawCheck1 && drawCheck1) {
                        drawStatusDrawable(canvas, drawCheck1, drawCheck2, drawClock3, drawError3, alpha2, bigRadius, timeYOffset, layoutHeight, this.statusDrawableProgress, true, drawSelectionBackground);
                        chatMessageCell = this;
                    } else {
                        int timeYOffset4 = timeYOffset;
                        chatMessageCell = this;
                        drawStatusDrawable(canvas, outDrawCheck1, outDrawCheck2, outDrawClock3, outDrawError, alpha2, bigRadius, timeYOffset4, layoutHeight, 1.0f - this.statusDrawableProgress, false, drawSelectionBackground);
                        drawStatusDrawable(canvas, drawCheck1, drawCheck2, drawClock3, drawError3, alpha2, bigRadius, timeYOffset4, layoutHeight, chatMessageCell.statusDrawableProgress, false, drawSelectionBackground);
                    }
                }
                if (needRestore) {
                    canvas.restore();
                }
                TransitionParams transitionParams3 = chatMessageCell.transitionParams;
                transitionParams3.lastStatusDrawableParams = transitionParams3.createStatusDrawableParams();
                if (fromParent && drawClock3 && getParent() != null) {
                    ((View) getParent()).invalidate();
                }
            }
            canvas.restore();
        }
    }

    public void createStatusDrawableAnimator(int lastStatusDrawableParams, int currentStatus, final boolean fromParent) {
        boolean moveCheckTransition = false;
        boolean drawCheck1 = (currentStatus & 1) != 0;
        boolean drawCheck2 = (currentStatus & 2) != 0;
        boolean outDrawCheck1 = (lastStatusDrawableParams & 1) != 0;
        boolean outDrawCheck2 = (lastStatusDrawableParams & 2) != 0;
        boolean outDrawClock = (lastStatusDrawableParams & 4) != 0;
        if (!outDrawClock && outDrawCheck2 && drawCheck2 && !outDrawCheck1 && drawCheck1) {
            moveCheckTransition = true;
        }
        if (this.transitionParams.messageEntering && !moveCheckTransition) {
            return;
        }
        this.statusDrawableProgress = 0.0f;
        ValueAnimator ofFloat = ValueAnimator.ofFloat(0.0f, 1.0f);
        this.statusDrawableAnimator = ofFloat;
        if (moveCheckTransition) {
            ofFloat.setDuration(220L);
        } else {
            ofFloat.setDuration(150L);
        }
        this.statusDrawableAnimator.setInterpolator(CubicBezierInterpolator.DEFAULT);
        this.animateFromStatusDrawableParams = lastStatusDrawableParams;
        this.animateToStatusDrawableParams = currentStatus;
        this.statusDrawableAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() { // from class: org.telegram.ui.Cells.ChatMessageCell$$ExternalSyntheticLambda0
            @Override // android.animation.ValueAnimator.AnimatorUpdateListener
            public final void onAnimationUpdate(ValueAnimator valueAnimator) {
                ChatMessageCell.this.m1639x59af0ffd(fromParent, valueAnimator);
            }
        });
        this.statusDrawableAnimator.addListener(new AnimatorListenerAdapter() { // from class: org.telegram.ui.Cells.ChatMessageCell.6
            @Override // android.animation.AnimatorListenerAdapter, android.animation.Animator.AnimatorListener
            public void onAnimationEnd(Animator animation) {
                int currentStatus2 = ChatMessageCell.this.transitionParams.createStatusDrawableParams();
                if (ChatMessageCell.this.animateToStatusDrawableParams == currentStatus2) {
                    ChatMessageCell.this.statusDrawableAnimationInProgress = false;
                    ChatMessageCell.this.transitionParams.lastStatusDrawableParams = ChatMessageCell.this.animateToStatusDrawableParams;
                    return;
                }
                ChatMessageCell chatMessageCell = ChatMessageCell.this;
                chatMessageCell.createStatusDrawableAnimator(chatMessageCell.animateToStatusDrawableParams, currentStatus2, fromParent);
            }
        });
        this.statusDrawableAnimationInProgress = true;
        this.statusDrawableAnimator.start();
    }

    /* renamed from: lambda$createStatusDrawableAnimator$6$org-telegram-ui-Cells-ChatMessageCell */
    public /* synthetic */ void m1639x59af0ffd(boolean fromParent, ValueAnimator valueAnimator) {
        this.statusDrawableProgress = ((Float) valueAnimator.getAnimatedValue()).floatValue();
        invalidate();
        if (fromParent && getParent() != null) {
            ((View) getParent()).invalidate();
        }
    }

    private void drawClockOrErrorLayout(Canvas canvas, boolean drawTime, boolean drawError, float layoutHeight, float alpha, float timeYOffset, float timeX, float progress, boolean drawSelectionBackground) {
        float y;
        int clockColor;
        float timeY;
        int i = 0;
        boolean useScale = progress != 1.0f;
        float scale = (progress * 0.5f) + 0.5f;
        float alpha2 = alpha * progress;
        if (drawTime) {
            if (!this.currentMessageObject.isOutOwner()) {
                MsgClockDrawable clockDrawable = Theme.chat_msgClockDrawable;
                boolean shouldDrawTimeOnMedia = shouldDrawTimeOnMedia();
                String str = Theme.key_chat_mediaSentClock;
                if (shouldDrawTimeOnMedia) {
                    clockColor = getThemedColor(str);
                } else {
                    if (drawSelectionBackground) {
                        str = Theme.key_chat_outSentClockSelected;
                    }
                    clockColor = getThemedColor(str);
                }
                clockDrawable.setColor(clockColor);
                if (shouldDrawTimeOnMedia()) {
                    timeY = (this.photoImage.getImageY2() + this.additionalTimeOffsetY) - AndroidUtilities.dp(9.0f);
                } else {
                    timeY = (layoutHeight - AndroidUtilities.dp((this.pinnedBottom || this.pinnedTop) ? 9.5f : 8.5f)) + timeYOffset;
                }
                if (!this.currentMessageObject.scheduled) {
                    i = AndroidUtilities.dp(11.0f);
                }
                setDrawableBounds(clockDrawable, timeX + i, timeY - clockDrawable.getIntrinsicHeight());
                clockDrawable.setAlpha((int) (255.0f * alpha2));
                if (useScale) {
                    canvas.save();
                    canvas.scale(scale, scale, clockDrawable.getBounds().centerX(), clockDrawable.getBounds().centerY());
                }
                clockDrawable.draw(canvas);
                clockDrawable.setAlpha(255);
                invalidate();
                if (useScale) {
                    canvas.restore();
                }
            }
        } else if (drawError && !this.currentMessageObject.isOutOwner()) {
            if (!this.currentMessageObject.scheduled) {
                i = AndroidUtilities.dp(11.0f);
            }
            float x = timeX + i;
            float f = 21.5f;
            if (shouldDrawTimeOnMedia()) {
                y = (this.photoImage.getImageY2() + this.additionalTimeOffsetY) - AndroidUtilities.dp(21.5f);
            } else {
                if (!this.pinnedBottom && !this.pinnedTop) {
                    f = 20.5f;
                }
                y = (layoutHeight - AndroidUtilities.dp(f)) + timeYOffset;
            }
            this.rect.set(x, y, AndroidUtilities.dp(14.0f) + x, AndroidUtilities.dp(14.0f) + y);
            int oldAlpha = Theme.chat_msgErrorPaint.getAlpha();
            Theme.chat_msgErrorPaint.setAlpha((int) (alpha2 * 255.0f));
            if (useScale) {
                canvas.save();
                canvas.scale(scale, scale, this.rect.centerX(), this.rect.centerY());
            }
            canvas.drawRoundRect(this.rect, AndroidUtilities.dp(1.0f), AndroidUtilities.dp(1.0f), Theme.chat_msgErrorPaint);
            Theme.chat_msgErrorPaint.setAlpha(oldAlpha);
            Drawable errorDrawable = getThemedDrawable(Theme.key_drawable_msgError);
            setDrawableBounds(errorDrawable, AndroidUtilities.dp(6.0f) + x, AndroidUtilities.dp(2.0f) + y);
            errorDrawable.setAlpha((int) (255.0f * alpha2));
            errorDrawable.draw(canvas);
            errorDrawable.setAlpha(255);
            if (useScale) {
                canvas.restore();
            }
        }
    }

    private void drawViewsAndRepliesLayout(Canvas canvas, float layoutHeight, float alpha, float timeYOffset, float timeX, float progress, boolean drawSelectionBackground) {
        float timeY;
        float alpha2;
        float scale;
        float scale2;
        float pinnedX;
        Drawable pinnedDrawable;
        float viewsX;
        Drawable viewsDrawable;
        float y;
        float repliesX;
        Drawable repliesDrawable;
        boolean useScale = progress != 1.0f;
        float scale3 = (progress * 0.5f) + 0.5f;
        float alpha3 = alpha * progress;
        float offsetX = this.reactionsLayoutInBubble.isSmall ? this.reactionsLayoutInBubble.getCurrentWidth(1.0f) : 0.0f;
        int timeAlpha = Theme.chat_timePaint.getAlpha();
        if (shouldDrawTimeOnMedia()) {
            timeY = ((this.photoImage.getImageY2() + this.additionalTimeOffsetY) - AndroidUtilities.dp(7.3f)) - this.timeLayout.getHeight();
        } else {
            timeY = ((layoutHeight - AndroidUtilities.dp((this.pinnedBottom || this.pinnedTop) ? 7.5f : 6.5f)) - this.timeLayout.getHeight()) + timeYOffset;
        }
        if (this.repliesLayout != null || this.transitionParams.animateReplies) {
            float repliesX2 = (this.transitionParams.shouldAnimateTimeX ? this.timeX : timeX) + offsetX;
            boolean inAnimation = this.transitionParams.animateReplies && this.transitionParams.animateRepliesLayout == null && this.repliesLayout != null;
            boolean outAnimation = this.transitionParams.animateReplies && this.transitionParams.animateRepliesLayout != null && this.repliesLayout == null;
            boolean replaceAnimation = (!this.transitionParams.animateReplies || this.transitionParams.animateRepliesLayout == null || this.repliesLayout == null) ? false : true;
            if (this.transitionParams.shouldAnimateTimeX && !inAnimation) {
                if (!outAnimation) {
                    repliesX = (this.transitionParams.animateFromTimeXReplies * (1.0f - this.transitionParams.animateChangeProgress)) + (this.transitionParams.animateChangeProgress * repliesX2);
                } else {
                    repliesX = this.transitionParams.animateFromTimeXReplies;
                }
            } else {
                repliesX = repliesX2 + this.transitionParams.deltaRight;
            }
            MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
            if (groupedMessages != null && groupedMessages.transitionParams.backgroundChangeBounds) {
                repliesX += this.currentMessagesGroup.transitionParams.offsetRight;
            }
            if (this.transitionParams.animateBackgroundBoundsInner) {
                repliesX += this.animationOffsetX;
            }
            if (shouldDrawTimeOnMedia()) {
                repliesDrawable = this.currentMessageObject.shouldDrawWithoutBackground() ? getThemedDrawable(Theme.key_drawable_msgStickerReplies) : Theme.chat_msgMediaRepliesDrawable;
            } else if (this.currentMessageObject.isOutOwner()) {
                repliesDrawable = getThemedDrawable("drawableMsgOutReplies");
            } else {
                repliesDrawable = drawSelectionBackground ? Theme.chat_msgInRepliesSelectedDrawable : Theme.chat_msgInRepliesDrawable;
            }
            setDrawableBounds(repliesDrawable, repliesX, timeY);
            float repliesAlpha = alpha3;
            if (inAnimation) {
                repliesAlpha *= this.transitionParams.animateChangeProgress;
            } else if (outAnimation) {
                repliesAlpha *= 1.0f - this.transitionParams.animateChangeProgress;
            }
            repliesDrawable.setAlpha((int) (repliesAlpha * 255.0f));
            if (useScale) {
                canvas.save();
                float cx = (((repliesDrawable.getIntrinsicWidth() + AndroidUtilities.dp(3.0f)) + this.repliesTextWidth) / 2.0f) + repliesX;
                canvas.scale(scale3, scale3, cx, repliesDrawable.getBounds().centerY());
            }
            repliesDrawable.draw(canvas);
            repliesDrawable.setAlpha(255);
            if (this.transitionParams.animateReplies) {
                if (replaceAnimation) {
                    canvas.save();
                    TextPaint textPaint = Theme.chat_timePaint;
                    double d = timeAlpha;
                    alpha2 = alpha3;
                    scale = scale3;
                    double d2 = this.transitionParams.animateChangeProgress;
                    Double.isNaN(d2);
                    Double.isNaN(d);
                    textPaint.setAlpha((int) (d * (1.0d - d2)));
                    canvas.translate(repliesDrawable.getIntrinsicWidth() + repliesX + AndroidUtilities.dp(3.0f), timeY);
                    this.transitionParams.animateRepliesLayout.draw(canvas);
                    canvas.restore();
                } else {
                    alpha2 = alpha3;
                    scale = scale3;
                }
                Theme.chat_timePaint.setAlpha((int) (timeAlpha * repliesAlpha));
            } else {
                alpha2 = alpha3;
                scale = scale3;
            }
            canvas.save();
            canvas.translate(repliesDrawable.getIntrinsicWidth() + repliesX + AndroidUtilities.dp(3.0f), timeY);
            StaticLayout staticLayout = this.repliesLayout;
            if (staticLayout != null) {
                staticLayout.draw(canvas);
            } else if (this.transitionParams.animateRepliesLayout != null) {
                this.transitionParams.animateRepliesLayout.draw(canvas);
            }
            canvas.restore();
            if (this.repliesLayout != null) {
                offsetX += repliesDrawable.getIntrinsicWidth() + this.repliesTextWidth + AndroidUtilities.dp(10.0f);
            }
            if (useScale) {
                canvas.restore();
            }
            if (this.transitionParams.animateReplies) {
                Theme.chat_timePaint.setAlpha(timeAlpha);
            }
            this.transitionParams.lastTimeXReplies = repliesX;
        } else {
            alpha2 = alpha3;
            scale = scale3;
        }
        if (this.viewsLayout == null) {
            scale2 = scale;
        } else {
            float viewsX2 = (this.transitionParams.shouldAnimateTimeX ? this.timeX : timeX) + offsetX;
            if (this.transitionParams.shouldAnimateTimeX) {
                viewsX = (this.transitionParams.animateFromTimeXViews * (1.0f - this.transitionParams.animateChangeProgress)) + (this.transitionParams.animateChangeProgress * viewsX2);
            } else {
                viewsX = this.transitionParams.deltaRight + viewsX2;
            }
            MessageObject.GroupedMessages groupedMessages2 = this.currentMessagesGroup;
            if (groupedMessages2 != null && groupedMessages2.transitionParams.backgroundChangeBounds) {
                viewsX += this.currentMessagesGroup.transitionParams.offsetRight;
            }
            if (this.transitionParams.animateBackgroundBoundsInner) {
                viewsX += this.animationOffsetX;
            }
            if (shouldDrawTimeOnMedia()) {
                viewsDrawable = this.currentMessageObject.shouldDrawWithoutBackground() ? getThemedDrawable(Theme.key_drawable_msgStickerViews) : Theme.chat_msgMediaViewsDrawable;
            } else if (this.currentMessageObject.isOutOwner()) {
                viewsDrawable = getThemedDrawable(drawSelectionBackground ? Theme.key_drawable_msgOutViewsSelected : Theme.key_drawable_msgOutViews);
            } else {
                viewsDrawable = drawSelectionBackground ? Theme.chat_msgInViewsSelectedDrawable : Theme.chat_msgInViewsDrawable;
            }
            float f = 5.5f;
            if (shouldDrawTimeOnMedia()) {
                y = ((this.photoImage.getImageY2() + this.additionalTimeOffsetY) - AndroidUtilities.dp(5.5f)) - this.timeLayout.getHeight();
            } else {
                if (!this.pinnedBottom && !this.pinnedTop) {
                    f = 4.5f;
                }
                y = ((layoutHeight - AndroidUtilities.dp(f)) - this.timeLayout.getHeight()) + timeYOffset;
            }
            setDrawableBounds(viewsDrawable, viewsX, y);
            if (!useScale) {
                scale2 = scale;
            } else {
                canvas.save();
                float cx2 = (((viewsDrawable.getIntrinsicWidth() + AndroidUtilities.dp(3.0f)) + this.viewsTextWidth) / 2.0f) + viewsX;
                scale2 = scale;
                canvas.scale(scale2, scale2, cx2, viewsDrawable.getBounds().centerY());
            }
            viewsDrawable.setAlpha((int) (alpha2 * 255.0f));
            viewsDrawable.draw(canvas);
            viewsDrawable.setAlpha(255);
            if (this.transitionParams.animateViewsLayout != null) {
                canvas.save();
                TextPaint textPaint2 = Theme.chat_timePaint;
                double d3 = timeAlpha;
                double d4 = this.transitionParams.animateChangeProgress;
                Double.isNaN(d4);
                Double.isNaN(d3);
                textPaint2.setAlpha((int) (d3 * (1.0d - d4)));
                canvas.translate(viewsDrawable.getIntrinsicWidth() + viewsX + AndroidUtilities.dp(3.0f), timeY);
                this.transitionParams.animateViewsLayout.draw(canvas);
                canvas.restore();
                Theme.chat_timePaint.setAlpha((int) (timeAlpha * this.transitionParams.animateChangeProgress));
            }
            canvas.save();
            canvas.translate(viewsDrawable.getIntrinsicWidth() + viewsX + AndroidUtilities.dp(3.0f), timeY);
            this.viewsLayout.draw(canvas);
            canvas.restore();
            if (useScale) {
                canvas.restore();
            }
            offsetX += this.viewsTextWidth + Theme.chat_msgInViewsDrawable.getIntrinsicWidth() + AndroidUtilities.dp(10.0f);
            if (this.transitionParams.animateViewsLayout != null) {
                Theme.chat_timePaint.setAlpha(timeAlpha);
            }
            this.transitionParams.lastTimeXViews = viewsX;
        }
        if (this.isPinned || this.transitionParams.animatePinned) {
            float pinnedX2 = (this.transitionParams.shouldAnimateTimeX ? this.timeX : timeX) + offsetX;
            boolean inAnimation2 = this.transitionParams.animatePinned && this.isPinned;
            boolean outAnimation2 = this.transitionParams.animatePinned && !this.isPinned;
            if (this.transitionParams.shouldAnimateTimeX && !inAnimation2) {
                if (!outAnimation2) {
                    pinnedX = (this.transitionParams.animateFromTimeXPinned * (1.0f - this.transitionParams.animateChangeProgress)) + (this.transitionParams.animateChangeProgress * pinnedX2);
                } else {
                    pinnedX = this.transitionParams.animateFromTimeXPinned;
                }
            } else {
                pinnedX = pinnedX2 + this.transitionParams.deltaRight;
            }
            MessageObject.GroupedMessages groupedMessages3 = this.currentMessagesGroup;
            if (groupedMessages3 != null && groupedMessages3.transitionParams.backgroundChangeBounds) {
                pinnedX += this.currentMessagesGroup.transitionParams.offsetRight;
            }
            if (this.transitionParams.animateBackgroundBoundsInner) {
                pinnedX += this.animationOffsetX;
            }
            if (shouldDrawTimeOnMedia()) {
                pinnedDrawable = this.currentMessageObject.shouldDrawWithoutBackground() ? getThemedDrawable(Theme.key_drawable_msgStickerPinned) : Theme.chat_msgMediaPinnedDrawable;
            } else if (this.currentMessageObject.isOutOwner()) {
                pinnedDrawable = getThemedDrawable(drawSelectionBackground ? Theme.key_drawable_msgOutPinnedSelected : Theme.key_drawable_msgOutPinned);
            } else {
                pinnedDrawable = drawSelectionBackground ? Theme.chat_msgInPinnedSelectedDrawable : Theme.chat_msgInPinnedDrawable;
            }
            if (this.transitionParams.animatePinned) {
                if (this.isPinned) {
                    pinnedDrawable.setAlpha((int) (alpha2 * 255.0f * this.transitionParams.animateChangeProgress));
                    setDrawableBounds(pinnedDrawable, pinnedX, timeY);
                } else {
                    pinnedDrawable.setAlpha((int) (alpha2 * 255.0f * (1.0f - this.transitionParams.animateChangeProgress)));
                    setDrawableBounds(pinnedDrawable, pinnedX, timeY);
                }
            } else {
                pinnedDrawable.setAlpha((int) (alpha2 * 255.0f));
                setDrawableBounds(pinnedDrawable, pinnedX, timeY);
            }
            if (useScale) {
                canvas.save();
                float cx3 = (pinnedDrawable.getIntrinsicWidth() / 2.0f) + pinnedX;
                canvas.scale(scale2, scale2, cx3, pinnedDrawable.getBounds().centerY());
            }
            pinnedDrawable.draw(canvas);
            pinnedDrawable.setAlpha(255);
            if (useScale) {
                canvas.restore();
            }
            this.transitionParams.lastTimeXPinned = pinnedX;
        }
    }

    private void drawStatusDrawable(Canvas canvas, boolean drawCheck1, boolean drawCheck2, boolean drawClock, boolean drawError, float alpha, boolean bigRadius, float timeYOffset, float layoutHeight, float progress, boolean moveCheck, boolean drawSelectionBackground) {
        float alpha2;
        float y;
        int x;
        Drawable drawable;
        Drawable drawable2;
        int color;
        boolean useScale = progress != 1.0f && !moveCheck;
        float scale = (progress * 0.5f) + 0.5f;
        if (!useScale) {
            alpha2 = alpha;
        } else {
            alpha2 = alpha * progress;
        }
        float timeY = (this.photoImage.getImageY2() + this.additionalTimeOffsetY) - AndroidUtilities.dp(8.5f);
        if (drawClock) {
            MsgClockDrawable drawable3 = Theme.chat_msgClockDrawable;
            if (!shouldDrawTimeOnMedia()) {
                int color2 = getThemedColor(Theme.key_chat_outSentClock);
                setDrawableBounds(drawable3, (this.layoutWidth - AndroidUtilities.dp(18.5f)) - drawable3.getIntrinsicWidth(), ((layoutHeight - AndroidUtilities.dp(8.5f)) - drawable3.getIntrinsicHeight()) + timeYOffset);
                drawable3.setAlpha((int) (alpha2 * 255.0f));
                color = color2;
            } else {
                float f = 24.0f;
                if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                    color = getThemedColor(Theme.key_chat_serviceText);
                    int i = this.layoutWidth;
                    if (!bigRadius) {
                        f = 22.0f;
                    }
                    setDrawableBounds(drawable3, (i - AndroidUtilities.dp(f)) - drawable3.getIntrinsicWidth(), (timeY - drawable3.getIntrinsicHeight()) + timeYOffset);
                    drawable3.setAlpha((int) (this.timeAlpha * 255.0f * alpha2));
                } else {
                    color = getThemedColor(Theme.key_chat_mediaSentClock);
                    int i2 = this.layoutWidth;
                    if (!bigRadius) {
                        f = 22.0f;
                    }
                    setDrawableBounds(drawable3, (i2 - AndroidUtilities.dp(f)) - drawable3.getIntrinsicWidth(), (timeY - drawable3.getIntrinsicHeight()) + timeYOffset);
                    drawable3.setAlpha((int) (alpha2 * 255.0f));
                }
            }
            drawable3.setColor(color);
            if (useScale) {
                canvas.save();
                canvas.scale(scale, scale, drawable3.getBounds().centerX(), drawable3.getBounds().centerY());
            }
            drawable3.draw(canvas);
            drawable3.setAlpha(255);
            if (useScale) {
                canvas.restore();
            }
            invalidate();
        }
        float f2 = 23.5f;
        float f3 = 9.0f;
        if (drawCheck2) {
            if (shouldDrawTimeOnMedia()) {
                if (moveCheck) {
                    canvas.save();
                }
                float f4 = 28.3f;
                if (this.currentMessageObject.shouldDrawWithoutBackground()) {
                    drawable2 = getThemedDrawable(Theme.key_drawable_msgStickerCheck);
                    if (drawCheck1) {
                        if (moveCheck) {
                            canvas.translate(AndroidUtilities.dp(4.8f) * (1.0f - progress), 0.0f);
                        }
                        int i3 = this.layoutWidth;
                        if (!bigRadius) {
                            f4 = 26.3f;
                        }
                        setDrawableBounds(drawable2, (i3 - AndroidUtilities.dp(f4)) - drawable2.getIntrinsicWidth(), (timeY - drawable2.getIntrinsicHeight()) + timeYOffset);
                    } else {
                        setDrawableBounds(drawable2, (this.layoutWidth - AndroidUtilities.dp(bigRadius ? 23.5f : 21.5f)) - drawable2.getIntrinsicWidth(), (timeY - drawable2.getIntrinsicHeight()) + timeYOffset);
                    }
                    drawable2.setAlpha((int) (this.timeAlpha * 255.0f * alpha2));
                } else {
                    if (drawCheck1) {
                        if (moveCheck) {
                            canvas.translate(AndroidUtilities.dp(4.8f) * (1.0f - progress), 0.0f);
                        }
                        Drawable drawable4 = Theme.chat_msgMediaCheckDrawable;
                        int i4 = this.layoutWidth;
                        if (!bigRadius) {
                            f4 = 26.3f;
                        }
                        setDrawableBounds(drawable4, (i4 - AndroidUtilities.dp(f4)) - Theme.chat_msgMediaCheckDrawable.getIntrinsicWidth(), (timeY - Theme.chat_msgMediaCheckDrawable.getIntrinsicHeight()) + timeYOffset);
                    } else {
                        setDrawableBounds(Theme.chat_msgMediaCheckDrawable, (this.layoutWidth - AndroidUtilities.dp(bigRadius ? 23.5f : 21.5f)) - Theme.chat_msgMediaCheckDrawable.getIntrinsicWidth(), (timeY - Theme.chat_msgMediaCheckDrawable.getIntrinsicHeight()) + timeYOffset);
                    }
                    Theme.chat_msgMediaCheckDrawable.setAlpha((int) (this.timeAlpha * 255.0f * alpha2));
                    drawable2 = Theme.chat_msgMediaCheckDrawable;
                }
                if (useScale) {
                    canvas.save();
                    canvas.scale(scale, scale, drawable2.getBounds().centerX(), drawable2.getBounds().centerY());
                }
                drawable2.draw(canvas);
                if (useScale) {
                    canvas.restore();
                }
                if (moveCheck) {
                    canvas.restore();
                }
                drawable2.setAlpha(255);
            } else {
                if (moveCheck) {
                    canvas.save();
                }
                if (!drawCheck1) {
                    drawable = getThemedDrawable(drawSelectionBackground ? Theme.key_drawable_msgOutCheckSelected : Theme.key_drawable_msgOutCheck);
                    setDrawableBounds(drawable, (this.layoutWidth - AndroidUtilities.dp(18.5f)) - drawable.getIntrinsicWidth(), ((layoutHeight - AndroidUtilities.dp((this.pinnedBottom || this.pinnedTop) ? 9.0f : 8.0f)) - drawable.getIntrinsicHeight()) + timeYOffset);
                } else {
                    if (moveCheck) {
                        canvas.translate(AndroidUtilities.dp(4.0f) * (1.0f - progress), 0.0f);
                    }
                    drawable = getThemedDrawable(drawSelectionBackground ? Theme.key_drawable_msgOutCheckReadSelected : Theme.key_drawable_msgOutCheckRead);
                    setDrawableBounds(drawable, (this.layoutWidth - AndroidUtilities.dp(22.5f)) - drawable.getIntrinsicWidth(), ((layoutHeight - AndroidUtilities.dp((this.pinnedBottom || this.pinnedTop) ? 9.0f : 8.0f)) - drawable.getIntrinsicHeight()) + timeYOffset);
                }
                drawable.setAlpha((int) (alpha2 * 255.0f));
                if (useScale) {
                    canvas.save();
                    canvas.scale(scale, scale, drawable.getBounds().centerX(), drawable.getBounds().centerY());
                }
                drawable.draw(canvas);
                if (useScale) {
                    canvas.restore();
                }
                if (moveCheck) {
                    canvas.restore();
                }
                drawable.setAlpha(255);
            }
        }
        if (drawCheck1) {
            if (!shouldDrawTimeOnMedia()) {
                Drawable drawable5 = getThemedDrawable(drawSelectionBackground ? Theme.key_drawable_msgOutHalfCheckSelected : Theme.key_drawable_msgOutHalfCheck);
                float dp = (this.layoutWidth - AndroidUtilities.dp(18.0f)) - drawable5.getIntrinsicWidth();
                if (!this.pinnedBottom && !this.pinnedTop) {
                    f3 = 8.0f;
                }
                setDrawableBounds(drawable5, dp, ((layoutHeight - AndroidUtilities.dp(f3)) - drawable5.getIntrinsicHeight()) + timeYOffset);
                drawable5.setAlpha((int) (alpha2 * 255.0f));
                if (useScale || moveCheck) {
                    canvas.save();
                    canvas.scale(scale, scale, drawable5.getBounds().centerX(), drawable5.getBounds().centerY());
                }
                drawable5.draw(canvas);
                if (useScale || moveCheck) {
                    canvas.restore();
                }
                drawable5.setAlpha(255);
            } else {
                Drawable drawable6 = this.currentMessageObject.shouldDrawWithoutBackground() ? getThemedDrawable(Theme.key_drawable_msgStickerHalfCheck) : Theme.chat_msgMediaHalfCheckDrawable;
                int i5 = this.layoutWidth;
                if (!bigRadius) {
                    f2 = 21.5f;
                }
                setDrawableBounds(drawable6, (i5 - AndroidUtilities.dp(f2)) - drawable6.getIntrinsicWidth(), (timeY - drawable6.getIntrinsicHeight()) + timeYOffset);
                drawable6.setAlpha((int) (this.timeAlpha * 255.0f * alpha2));
                if (useScale || moveCheck) {
                    canvas.save();
                    canvas.scale(scale, scale, drawable6.getBounds().centerX(), drawable6.getBounds().centerY());
                }
                drawable6.draw(canvas);
                if (useScale || moveCheck) {
                    canvas.restore();
                }
                drawable6.setAlpha(255);
            }
        }
        if (drawError) {
            if (shouldDrawTimeOnMedia()) {
                x = this.layoutWidth - AndroidUtilities.dp(34.5f);
                y = (layoutHeight - AndroidUtilities.dp(26.5f)) + timeYOffset;
            } else {
                x = this.layoutWidth - AndroidUtilities.dp(32.0f);
                y = (layoutHeight - AndroidUtilities.dp((this.pinnedBottom || this.pinnedTop) ? 22.0f : 21.0f)) + timeYOffset;
            }
            this.rect.set(x, y, AndroidUtilities.dp(14.0f) + x, AndroidUtilities.dp(14.0f) + y);
            int oldAlpha = Theme.chat_msgErrorPaint.getAlpha();
            Theme.chat_msgErrorPaint.setAlpha((int) (oldAlpha * alpha2));
            canvas.drawRoundRect(this.rect, AndroidUtilities.dp(1.0f), AndroidUtilities.dp(1.0f), Theme.chat_msgErrorPaint);
            Theme.chat_msgErrorPaint.setAlpha(oldAlpha);
            setDrawableBounds(Theme.chat_msgErrorDrawable, AndroidUtilities.dp(6.0f) + x, AndroidUtilities.dp(2.0f) + y);
            Theme.chat_msgErrorDrawable.setAlpha((int) (255.0f * alpha2));
            if (useScale) {
                canvas.save();
                canvas.scale(scale, scale, Theme.chat_msgErrorDrawable.getBounds().centerX(), Theme.chat_msgErrorDrawable.getBounds().centerY());
            }
            Theme.chat_msgErrorDrawable.draw(canvas);
            Theme.chat_msgErrorDrawable.setAlpha(255);
            if (useScale) {
                canvas.restore();
            }
        }
    }

    /* JADX WARN: Code restructure failed: missing block: B:232:0x0703, code lost:
        if (r45.docTitleLayout.getLineLeft(0) != 0.0f) goto L234;
     */
    /* JADX WARN: Code restructure failed: missing block: B:351:0x0ac4, code lost:
        if (r1[0] == 3) goto L353;
     */
    /* JADX WARN: Code restructure failed: missing block: B:613:0x1268, code lost:
        if (r3 == 2) goto L616;
     */
    /* JADX WARN: Multi-variable type inference failed */
    /* JADX WARN: Removed duplicated region for block: B:252:0x07af  */
    /* JADX WARN: Removed duplicated region for block: B:260:0x07ef  */
    /* JADX WARN: Removed duplicated region for block: B:261:0x07fd  */
    /* JADX WARN: Removed duplicated region for block: B:264:0x0812  */
    /* JADX WARN: Removed duplicated region for block: B:759:0x154b  */
    /* JADX WARN: Removed duplicated region for block: B:763:0x1562  */
    /* JADX WARN: Removed duplicated region for block: B:771:0x1581  */
    /* JADX WARN: Removed duplicated region for block: B:775:0x1599  */
    /* JADX WARN: Removed duplicated region for block: B:797:0x15d7  */
    /* JADX WARN: Removed duplicated region for block: B:801:0x15e6  */
    /* JADX WARN: Removed duplicated region for block: B:947:0x194e  */
    /* JADX WARN: Removed duplicated region for block: B:954:0x196d  */
    /* JADX WARN: Removed duplicated region for block: B:957:0x19c3  */
    /* JADX WARN: Type inference failed for: r15v1, types: [org.telegram.ui.ActionBar.Theme$MessageDrawable, java.lang.String] */
    /* JADX WARN: Type inference failed for: r15v31 */
    /* JADX WARN: Type inference failed for: r15v4 */
    /* JADX WARN: Type inference failed for: r2v242, types: [boolean] */
    /*
        Code decompiled incorrectly, please refer to instructions dump.
    */
    public void drawOverlays(Canvas canvas) {
        long animationDt;
        Object obj;
        ?? r15;
        float y1;
        float x1;
        Object obj2;
        long animationDt2;
        int i;
        int i2;
        long animationDt3;
        int i3;
        float animatingToLoadingProgress;
        float f;
        boolean drawLoadingProgress;
        boolean drawDocTitleLayout;
        int imageW;
        int infoW;
        StaticLayout staticLayout;
        int i4;
        int i5;
        int i6;
        long animationDt4;
        Drawable menuDrawable;
        long dt;
        int color1;
        int color2;
        int x;
        int x2;
        float f2;
        int a;
        long animationDt5;
        int a2;
        PollButton button;
        int x3;
        Drawable drawable;
        String key;
        float f3;
        float f4;
        int x4;
        long time;
        int ty;
        int ax;
        int toAdd;
        int a3;
        float f5;
        float f6;
        int i7;
        int x5;
        Drawable icon;
        Drawable icon2;
        Drawable icon3;
        Drawable drawable2;
        float progress;
        StaticLayout infoLayout;
        StaticLayout docTitleLayout;
        String text;
        int i8;
        AnimatedFileDrawable animation;
        ChatMessageCellDelegate chatMessageCellDelegate;
        if (!this.drawFromPinchToZoom && (chatMessageCellDelegate = this.delegate) != null && chatMessageCellDelegate.getPinchToZoomHelper() != null && this.delegate.getPinchToZoomHelper().isInOverlayModeFor(this)) {
            return;
        }
        long newAnimationTime = SystemClock.elapsedRealtime();
        long animationDt6 = newAnimationTime - this.lastAnimationTime;
        if (animationDt6 <= 17) {
            animationDt = animationDt6;
        } else {
            animationDt = 17;
        }
        this.lastAnimationTime = newAnimationTime;
        if (this.currentMessageObject.hadAnimationNotReadyLoading && this.photoImage.getVisible() && !this.currentMessageObject.needDrawBluredPreview() && (((i8 = this.documentAttachType) == 7 || i8 == 4 || i8 == 2) && (animation = this.photoImage.getAnimation()) != null && animation.hasBitmap())) {
            this.currentMessageObject.hadAnimationNotReadyLoading = false;
            updateButtonState(false, true, false);
        }
        if (!this.hasGamePreview) {
            if (this.currentMessageObject.type == 3 || this.currentMessageObject.type == 1 || (i6 = this.documentAttachType) == 4) {
                animationDt2 = animationDt;
                i = 3;
            } else if (i6 == 2) {
                animationDt2 = animationDt;
                i = 3;
            } else if (this.currentMessageObject.type != 4) {
                if (this.currentMessageObject.type != 16) {
                    if (this.currentMessageObject.type == 17) {
                        long newTime = System.currentTimeMillis();
                        long dt2 = newTime - this.voteLastUpdateTime;
                        if (dt2 <= 17) {
                            dt = dt2;
                        } else {
                            dt = 17;
                        }
                        this.voteLastUpdateTime = newTime;
                        if (this.currentMessageObject.isOutOwner()) {
                            int color12 = getThemedColor(Theme.key_chat_messageTextOut);
                            color2 = getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outTimeSelectedText : Theme.key_chat_outTimeText);
                            color1 = color12;
                        } else {
                            int color13 = getThemedColor(Theme.key_chat_messageTextIn);
                            color2 = getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inTimeSelectedText : Theme.key_chat_inTimeText);
                            color1 = color13;
                        }
                        Theme.chat_audioTitlePaint.setColor(color1);
                        Theme.chat_audioPerformerPaint.setColor(color1);
                        Theme.chat_instantViewPaint.setColor(color1);
                        Theme.chat_timePaint.setColor(color2);
                        Theme.chat_livePaint.setColor(color2);
                        Theme.chat_locationAddressPaint.setColor(color2);
                        canvas.save();
                        if (this.transitionParams.animateForwardedLayout) {
                            float y = (this.namesOffset * this.transitionParams.animateChangeProgress) + (this.transitionParams.animateForwardedNamesOffset * (1.0f - this.transitionParams.animateChangeProgress));
                            if (this.currentMessageObject.needDrawForwarded()) {
                                y -= this.namesOffset;
                            }
                            canvas.translate(0.0f, y);
                        }
                        if (this.currentMessageObject.isOutOwner()) {
                            x = (this.layoutWidth - this.backgroundWidth) + AndroidUtilities.dp(11.0f);
                        } else if (this.isChat && !this.isThreadPost && this.currentMessageObject.needDrawAvatar()) {
                            x = AndroidUtilities.dp(68.0f);
                        } else {
                            x = AndroidUtilities.dp(20.0f);
                        }
                        if (this.titleLayout != null) {
                            canvas.save();
                            canvas.translate(getExtraTextX() + x, AndroidUtilities.dp(15.0f) + this.namesOffset);
                            this.titleLayout.draw(canvas);
                            canvas.restore();
                        }
                        StaticLayout staticLayout2 = this.titleLayout;
                        int y2 = this.namesOffset + (staticLayout2 != null ? staticLayout2.getHeight() : 0) + AndroidUtilities.dp(20.0f);
                        if (this.docTitleLayout != null) {
                            canvas.save();
                            canvas.translate(this.docTitleOffsetX + x + getExtraTextX(), y2);
                            this.docTitleLayout.draw(canvas);
                            canvas.restore();
                            TLRPC.TL_messageMediaPoll media = (TLRPC.TL_messageMediaPoll) this.currentMessageObject.messageOwner.media;
                            if (this.lastPoll.quiz) {
                                if (!this.pollVoted && !this.pollClosed) {
                                    this.pollHintX = -1;
                                    if (this.pollAvatarImages != null) {
                                    }
                                } else if (!TextUtils.isEmpty(media.results.solution)) {
                                    Drawable drawable3 = getThemedDrawable(this.currentMessageObject.isOutOwner() ? Theme.key_drawable_chat_pollHintDrawableOut : Theme.key_drawable_chat_pollHintDrawableIn);
                                    if (this.pollVoteInProgress) {
                                        drawable3.setAlpha((int) (this.pollAnimationProgress * 255.0f));
                                    } else {
                                        drawable3.setAlpha(255);
                                    }
                                    int i9 = this.docTitleOffsetX;
                                    if (i9 >= 0) {
                                        if (i9 == 0) {
                                        }
                                        this.pollHintX = getCurrentBackgroundLeft() + AndroidUtilities.dp(11.0f);
                                        this.pollHintY = y2 - AndroidUtilities.dp(6.0f);
                                        int cx = this.pollHintX + (drawable3.getIntrinsicWidth() / 2);
                                        int cy = this.pollHintY + (drawable3.getIntrinsicHeight() / 2);
                                        float scale = (this.hintButtonVisible || this.hintButtonProgress >= 1.0f) ? this.hintButtonProgress : AnimationProperties.overshootInterpolator.getInterpolation(this.hintButtonProgress);
                                        int w = (int) (drawable3.getIntrinsicWidth() * scale);
                                        int h = (int) (drawable3.getIntrinsicHeight() * scale);
                                        drawable3.setBounds(cx - (w / 2), cy - (h / 2), (w / 2) + cx, cy + (h / 2));
                                        drawable3.draw(canvas);
                                        if (this.pollAvatarImages != null && !this.isBot) {
                                            int lineLeft = (int) Math.ceil(this.docTitleLayout.getLineLeft(0));
                                            if (this.docTitleOffsetX == 0 || lineLeft != 0) {
                                                int toAdd2 = AndroidUtilities.dp(13.0f);
                                                toAdd = -toAdd2;
                                                i7 = this.docTitleOffsetX;
                                                if (i7 == 0) {
                                                    ax = ((i7 + x) - AndroidUtilities.dp(23.0f)) - getExtraTextX();
                                                } else {
                                                    int ax2 = x + lineLeft;
                                                    ax = (ax2 - AndroidUtilities.dp(23.0f)) - getExtraTextX();
                                                }
                                            } else {
                                                toAdd = AndroidUtilities.dp(13.0f);
                                                ax = ((int) Math.ceil(this.docTitleLayout.getLineWidth(0))) + x + AndroidUtilities.dp(7.0f) + getExtraTextX();
                                            }
                                            for (a3 = this.pollAvatarImages.length - 1; a3 >= 0; a3--) {
                                                if (this.pollAvatarImagesVisible[a3] && this.pollAvatarImages[a3].hasImageSet()) {
                                                    this.pollAvatarImages[a3].setImageX((toAdd * a3) + ax);
                                                    this.pollAvatarImages[a3].setImageY(y2 - AndroidUtilities.dp(1.0f));
                                                    ImageReceiver[] imageReceiverArr = this.pollAvatarImages;
                                                    if (a3 != imageReceiverArr.length - 1) {
                                                        canvas.drawCircle(imageReceiverArr[a3].getCenterX(), this.pollAvatarImages[a3].getCenterY(), AndroidUtilities.dp(9.0f), this.currentBackgroundDrawable.getPaint());
                                                    }
                                                    if (this.animatePollAvatars && this.animatePollAnswerAlpha) {
                                                        if (this.pollUnvoteInProgress) {
                                                            f5 = 1.0f;
                                                            f6 = (1.0f - this.pollAnimationProgress) / 0.3f;
                                                        } else {
                                                            f5 = 1.0f;
                                                            f6 = this.pollAnimationProgress;
                                                        }
                                                        this.pollAvatarImages[a3].setAlpha(Math.min(f6, f5));
                                                    }
                                                    this.pollAvatarImages[a3].draw(canvas);
                                                }
                                            }
                                        }
                                    }
                                    this.pollHintX = (this.currentBackgroundDrawable.getBounds().right - drawable3.getIntrinsicWidth()) - AndroidUtilities.dp(this.currentMessageObject.isOutOwner() ? 17.0f : 11.0f);
                                    this.pollHintY = y2 - AndroidUtilities.dp(6.0f);
                                    int cx2 = this.pollHintX + (drawable3.getIntrinsicWidth() / 2);
                                    int cy2 = this.pollHintY + (drawable3.getIntrinsicHeight() / 2);
                                    if (this.hintButtonVisible) {
                                    }
                                    int w2 = (int) (drawable3.getIntrinsicWidth() * scale);
                                    int h2 = (int) (drawable3.getIntrinsicHeight() * scale);
                                    drawable3.setBounds(cx2 - (w2 / 2), cy2 - (h2 / 2), (w2 / 2) + cx2, cy2 + (h2 / 2));
                                    drawable3.draw(canvas);
                                    if (this.pollAvatarImages != null) {
                                        int lineLeft2 = (int) Math.ceil(this.docTitleLayout.getLineLeft(0));
                                        if (this.docTitleOffsetX == 0) {
                                        }
                                        int toAdd22 = AndroidUtilities.dp(13.0f);
                                        toAdd = -toAdd22;
                                        i7 = this.docTitleOffsetX;
                                        if (i7 == 0) {
                                        }
                                        while (a3 >= 0) {
                                        }
                                    }
                                }
                            }
                            this.pollHintX = -1;
                            if (this.pollAvatarImages != null) {
                            }
                        }
                        if (((this.pollClosed || this.pollVoted) && !this.pollVoteInProgress) || !this.lastPoll.quiz || this.lastPoll.close_period == 0) {
                            x2 = x;
                        } else {
                            long currentTime = ConnectionsManager.getInstance(this.currentAccount).getCurrentTimeMillis();
                            long time2 = Math.max(0L, (this.lastPoll.close_date * 1000) - currentTime);
                            if (this.closeTimeText == null || this.lastPollCloseTime != time2) {
                                this.closeTimeText = AndroidUtilities.formatDurationNoHours((int) Math.ceil(((float) time2) / 1000.0f), false);
                                this.closeTimeWidth = (int) Math.ceil(Theme.chat_timePaint.measureText(this.closeTimeText));
                                this.lastPollCloseTime = time2;
                            }
                            if (time2 > 0 || this.pollClosed) {
                                x4 = x;
                            } else {
                                if (this.currentMessageObject.pollLastCheckTime + 1000 >= SystemClock.elapsedRealtime()) {
                                    x4 = x;
                                } else {
                                    x4 = x;
                                    this.currentMessageObject.pollLastCheckTime = 0L;
                                }
                                this.delegate.needReloadPolls();
                            }
                            int tx = (this.currentBackgroundDrawable.getBounds().right - this.closeTimeWidth) - AndroidUtilities.dp(this.currentMessageObject.isOutOwner() ? 40.0f : 34.0f);
                            if (time2 <= DefaultRenderersFactory.DEFAULT_ALLOWED_VIDEO_JOINING_TIME_MS) {
                                Theme.chat_timePaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outPollWrongAnswer : Theme.key_chat_inPollWrongAnswer));
                            }
                            if (this.animatePollAnswer) {
                                Theme.chat_timePaint.setAlpha((int) ((1.0f - this.pollAnimationProgress) * 255.0f));
                            }
                            int x6 = x4;
                            canvas.drawText(this.closeTimeText, tx, y2 + AndroidUtilities.dp(11.0f), Theme.chat_timePaint);
                            Theme.chat_pollTimerPaint.setColor(Theme.chat_timePaint.getColor());
                            int tx2 = tx + this.closeTimeWidth + AndroidUtilities.dp(13.0f);
                            int rad = AndroidUtilities.dp(5.1f);
                            int ty2 = y2 + AndroidUtilities.dp(6.0f);
                            if (time2 <= DefaultLoadErrorHandlingPolicy.DEFAULT_TRACK_BLACKLIST_MS) {
                                this.rect.set(tx2 - rad, ty2 - rad, tx2 + rad, ty2 + rad);
                                float radProgress = (((float) time2) / (Math.min(60, this.lastPoll.close_period) * 1000.0f)) * (-360.0f);
                                time = time2;
                                x2 = x6;
                                canvas.drawArc(this.rect, -90.0f, radProgress, false, Theme.chat_pollTimerPaint);
                                this.timerParticles.draw(canvas, Theme.chat_pollTimerPaint, this.rect, radProgress, this.pollVoteInProgress ? 1.0f - this.pollAnimationProgress : 1.0f);
                                ty = ty2;
                            } else {
                                time = time2;
                                x2 = x6;
                                ty = ty2;
                                canvas.drawCircle(tx2, ty, rad, Theme.chat_pollTimerPaint);
                            }
                            if (time <= DefaultLoadErrorHandlingPolicy.DEFAULT_TRACK_BLACKLIST_MS && this.timerTransitionProgress == 0.0f) {
                                invalidate();
                            }
                            Theme.chat_pollTimerPaint.setAlpha((int) (this.timerTransitionProgress * 255.0f));
                            canvas.drawLine(tx2 - (AndroidUtilities.dp(2.1f) * this.timerTransitionProgress), ty - AndroidUtilities.dp(7.5f), (AndroidUtilities.dp(2.1f) * this.timerTransitionProgress) + tx2, ty - AndroidUtilities.dp(7.5f), Theme.chat_pollTimerPaint);
                            canvas.drawLine(tx2, ty - (AndroidUtilities.dp(3.0f) * this.timerTransitionProgress), tx2, ty, Theme.chat_pollTimerPaint);
                            if (time <= DefaultLoadErrorHandlingPolicy.DEFAULT_TRACK_BLACKLIST_MS) {
                                float f7 = this.timerTransitionProgress - (((float) dt) / 180.0f);
                                this.timerTransitionProgress = f7;
                                if (f7 < 0.0f) {
                                    this.timerTransitionProgress = 0.0f;
                                }
                            }
                            invalidate();
                        }
                        if (Build.VERSION.SDK_INT >= 21 && this.selectorDrawable[0] != null) {
                            int[] iArr = this.selectorDrawableMaskType;
                            int i10 = iArr[0] != 1 ? 3 : 3;
                            if (iArr[0] == i10) {
                                canvas.save();
                                float f8 = this.hintButtonProgress;
                                canvas.scale(f8, f8, this.selectorDrawable[0].getBounds().centerX(), this.selectorDrawable[0].getBounds().centerY());
                            }
                            this.selectorDrawable[0].draw(canvas);
                            if (this.selectorDrawableMaskType[0] == i10) {
                                canvas.restore();
                            }
                        }
                        int N = this.pollButtons.size();
                        int lastVoteY = 0;
                        int a4 = 0;
                        while (a4 < N) {
                            PollButton button2 = this.pollButtons.get(a4);
                            int x7 = x2;
                            button2.x = x7;
                            canvas.save();
                            canvas.translate(AndroidUtilities.dp(35.0f) + x7, button2.y + this.namesOffset);
                            button2.title.draw(canvas);
                            if (this.animatePollAnswerAlpha) {
                                if (this.pollUnvoteInProgress) {
                                    f3 = 1.0f;
                                    f4 = 1.0f - this.pollAnimationProgress;
                                } else {
                                    f3 = 1.0f;
                                    f4 = this.pollAnimationProgress;
                                }
                                f2 = Math.min(f4 / 0.3f, f3) * 255.0f;
                            } else {
                                f2 = 255.0f;
                            }
                            int alpha = (int) f2;
                            if (this.pollVoted || this.pollClosed || this.animatePollAnswerAlpha) {
                                if (this.lastPoll.quiz && this.pollVoted && button2.chosen) {
                                    if (button2.correct) {
                                        key = this.currentMessageObject.isOutOwner() ? Theme.key_chat_outPollCorrectAnswer : Theme.key_chat_inPollCorrectAnswer;
                                    } else {
                                        key = this.currentMessageObject.isOutOwner() ? Theme.key_chat_outPollWrongAnswer : Theme.key_chat_inPollWrongAnswer;
                                    }
                                    if (!this.currentBackgroundDrawable.hasGradient() || Theme.hasThemeKey(key)) {
                                        Theme.chat_docBackPaint.setColor(getThemedColor(key));
                                    } else {
                                        Theme.chat_docBackPaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outAudioSeekbarFill : Theme.key_chat_inAudioSeekbarFill));
                                    }
                                } else {
                                    Theme.chat_docBackPaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outAudioSeekbarFill : Theme.key_chat_inAudioSeekbarFill));
                                }
                                if (this.animatePollAnswerAlpha) {
                                    Theme.chat_instantViewPaint.setAlpha((int) (alpha * (Theme.chat_instantViewPaint.getAlpha() / 255.0f)));
                                    Theme.chat_docBackPaint.setAlpha((int) (alpha * (Theme.chat_docBackPaint.getAlpha() / 255.0f)));
                                }
                                int currentPercent = (int) Math.ceil(button2.prevPercent + ((button2.percent - button2.prevPercent) * this.pollAnimationProgress));
                                String text2 = String.format("%d%%", Integer.valueOf(currentPercent));
                                a = a4;
                                int width = (int) Math.ceil(Theme.chat_instantViewPaint.measureText(text2));
                                canvas.drawText(text2, (-AndroidUtilities.dp(6.5f)) - width, AndroidUtilities.dp(14.0f), Theme.chat_instantViewPaint);
                                int width2 = this.backgroundWidth - AndroidUtilities.dp(76.0f);
                                float currentPercentProgress = button2.prevPercentProgress + ((button2.percentProgress - button2.prevPercentProgress) * this.pollAnimationProgress);
                                int width3 = button2.height;
                                this.rect.set(0.0f, button2.height + AndroidUtilities.dp(6.0f), width2 * currentPercentProgress, width3 + AndroidUtilities.dp(11.0f));
                                canvas.drawRoundRect(this.rect, AndroidUtilities.dp(2.0f), AndroidUtilities.dp(2.0f), Theme.chat_docBackPaint);
                                if (button2.chosen || button2.prevChosen || (this.lastPoll.quiz && button2.correct && (this.pollVoted || this.pollClosed))) {
                                    float cx3 = this.rect.left - AndroidUtilities.dp(13.5f);
                                    float cy3 = this.rect.centerY();
                                    canvas.drawCircle(cx3, cy3, AndroidUtilities.dp(7.0f), Theme.chat_docBackPaint);
                                    if (this.lastPoll.quiz && button2.chosen && !button2.correct) {
                                        drawable = Theme.chat_pollCrossDrawable[this.currentMessageObject.isOutOwner() ? 1 : 0];
                                    } else {
                                        drawable = Theme.chat_pollCheckDrawable[this.currentMessageObject.isOutOwner() ? 1 : 0];
                                    }
                                    drawable.setAlpha(alpha);
                                    setDrawableBounds(drawable, cx3 - (drawable.getIntrinsicWidth() / 2), cy3 - (drawable.getIntrinsicHeight() / 2));
                                    drawable.draw(canvas);
                                }
                            } else {
                                a = a4;
                            }
                            if ((this.pollVoted || this.pollClosed) && !this.animatePollAnswerAlpha) {
                                button = button2;
                                animationDt5 = animationDt;
                                a2 = a;
                                x3 = x7;
                            } else {
                                if (isDrawSelectionBackground()) {
                                    Theme.chat_replyLinePaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outVoiceSeekbarSelected : Theme.key_chat_inVoiceSeekbarSelected));
                                } else {
                                    Theme.chat_replyLinePaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outVoiceSeekbar : Theme.key_chat_inVoiceSeekbar));
                                }
                                if (this.animatePollAnswerAlpha) {
                                    Theme.chat_replyLinePaint.setAlpha((int) ((255 - alpha) * (Theme.chat_replyLinePaint.getAlpha() / 255.0f)));
                                }
                                animationDt5 = animationDt;
                                x3 = x7;
                                button = button2;
                                canvas.drawLine(-AndroidUtilities.dp(2.0f), button2.height + AndroidUtilities.dp(13.0f), this.backgroundWidth - AndroidUtilities.dp(58.0f), button2.height + AndroidUtilities.dp(13.0f), Theme.chat_replyLinePaint);
                                if (this.pollVoteInProgress) {
                                    a2 = a;
                                    if (a2 == this.pollVoteInProgressNum) {
                                        Theme.chat_instantViewRectPaint.setColor(getThemedColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outAudioSeekbarFill : Theme.key_chat_inAudioSeekbarFill));
                                        if (this.animatePollAnswerAlpha) {
                                            Theme.chat_instantViewRectPaint.setAlpha((int) ((255 - alpha) * (Theme.chat_instantViewRectPaint.getAlpha() / 255.0f)));
                                        }
                                        this.rect.set((-AndroidUtilities.dp(22.0f)) - AndroidUtilities.dp(8.5f), AndroidUtilities.dp(9.0f) - AndroidUtilities.dp(8.5f), (-AndroidUtilities.dp(23.0f)) + AndroidUtilities.dp(8.5f), AndroidUtilities.dp(9.0f) + AndroidUtilities.dp(8.5f));
                                        canvas.drawArc(this.rect, this.voteRadOffset, this.voteCurrentCircleLength, false, Theme.chat_instantViewRectPaint);
                                    }
                                } else {
                                    a2 = a;
                                }
                                if (this.currentMessageObject.isOutOwner()) {
                                    Theme.chat_instantViewRectPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outMenuSelected : Theme.key_chat_outMenu));
                                } else {
                                    Theme.chat_instantViewRectPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inMenuSelected : Theme.key_chat_inMenu));
                                }
                                if (this.animatePollAnswerAlpha) {
                                    Theme.chat_instantViewRectPaint.setAlpha((int) ((255 - alpha) * (Theme.chat_instantViewRectPaint.getAlpha() / 255.0f)));
                                }
                                canvas.drawCircle(-AndroidUtilities.dp(22.0f), AndroidUtilities.dp(9.0f), AndroidUtilities.dp(8.5f), Theme.chat_instantViewRectPaint);
                                if (this.lastPoll.multiple_choice) {
                                    int size = AndroidUtilities.dp(8.5f);
                                    String key2 = Theme.key_checkboxCheck;
                                    if (this.currentMessageObject.isOutOwner() && getThemedColor(key2) == -1) {
                                        key2 = Theme.key_chat_outBubble;
                                    }
                                    this.pollCheckBox[a2].setColor(null, this.currentMessageObject.isOutOwner() ? Theme.key_chat_outAudioSeekbarFill : Theme.key_chat_inAudioSeekbarFill, key2);
                                    this.pollCheckBox[a2].setBounds((-AndroidUtilities.dp(22.0f)) - (size / 2), AndroidUtilities.dp(9.0f) - (size / 2), size, size);
                                    this.pollCheckBox[a2].draw(canvas);
                                }
                            }
                            canvas.restore();
                            if (a2 == N - 1) {
                                lastVoteY = button.y + this.namesOffset + button.height;
                            }
                            a4 = a2 + 1;
                            x2 = x3;
                            animationDt = animationDt5;
                        }
                        animationDt4 = animationDt;
                        int x8 = x2;
                        if (this.drawInstantView) {
                            int textX = getCurrentBackgroundLeft() + AndroidUtilities.dp((this.currentMessageObject.isOutOwner() || this.mediaBackground || this.drawPinnedBottom) ? 2.0f : 8.0f);
                            int instantY = AndroidUtilities.dp(13.0f) + lastVoteY;
                            if (this.currentMessageObject.isOutOwner()) {
                                Theme.chat_instantViewPaint.setColor(getThemedColor(Theme.key_chat_outPreviewInstantText));
                            } else {
                                Theme.chat_instantViewPaint.setColor(getThemedColor(Theme.key_chat_inPreviewInstantText));
                            }
                            this.instantButtonRect.set(textX, instantY, this.instantWidth + textX, AndroidUtilities.dp(44.0f) + instantY);
                            Drawable[] drawableArr = this.selectorDrawable;
                            if (drawableArr[0] != null && this.selectorDrawableMaskType[0] == 2) {
                                drawableArr[0].setBounds(textX, instantY, this.instantWidth + textX, AndroidUtilities.dp(44.0f) + instantY);
                                this.selectorDrawable[0].draw(canvas);
                            }
                            if (this.instantViewLayout != null) {
                                canvas.save();
                                canvas.translate(this.instantTextX + textX, AndroidUtilities.dp(14.5f) + instantY);
                                this.instantViewLayout.draw(canvas);
                                canvas.restore();
                            }
                        } else if (this.infoLayout != null) {
                            if (this.lastPoll.public_voters || this.lastPoll.multiple_choice) {
                                lastVoteY += AndroidUtilities.dp(6.0f);
                            }
                            canvas.save();
                            canvas.translate(x8 + this.infoX, AndroidUtilities.dp(22.0f) + lastVoteY);
                            this.infoLayout.draw(canvas);
                            canvas.restore();
                        }
                        updatePollAnimations(dt);
                        canvas.restore();
                    } else {
                        animationDt4 = animationDt;
                        if (this.currentMessageObject.type == 12) {
                            if (this.currentMessageObject.isOutOwner()) {
                                Theme.chat_contactNamePaint.setColor(getThemedColor(Theme.key_chat_outContactNameText));
                                Theme.chat_contactPhonePaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outContactPhoneSelectedText : Theme.key_chat_outContactPhoneText));
                            } else {
                                Theme.chat_contactNamePaint.setColor(getThemedColor(Theme.key_chat_inContactNameText));
                                Theme.chat_contactPhonePaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inContactPhoneSelectedText : Theme.key_chat_inContactPhoneText));
                            }
                            if (this.titleLayout != null) {
                                canvas.save();
                                canvas.translate(this.photoImage.getImageX() + this.photoImage.getImageWidth() + AndroidUtilities.dp(9.0f), AndroidUtilities.dp(16.0f) + this.namesOffset);
                                this.titleLayout.draw(canvas);
                                canvas.restore();
                            }
                            if (this.docTitleLayout != null) {
                                canvas.save();
                                canvas.translate(this.photoImage.getImageX() + this.photoImage.getImageWidth() + AndroidUtilities.dp(9.0f), AndroidUtilities.dp(39.0f) + this.namesOffset);
                                this.docTitleLayout.draw(canvas);
                                canvas.restore();
                            }
                            if (this.currentMessageObject.isOutOwner()) {
                                menuDrawable = getThemedDrawable(isDrawSelectionBackground() ? Theme.key_drawable_msgOutMenuSelected : Theme.key_drawable_msgOutMenu);
                            } else {
                                menuDrawable = isDrawSelectionBackground() ? Theme.chat_msgInMenuSelectedDrawable : Theme.chat_msgInMenuDrawable;
                            }
                            int imageX = (int) ((this.photoImage.getImageX() + this.backgroundWidth) - AndroidUtilities.dp(48.0f));
                            this.otherX = imageX;
                            int imageY = (int) (this.photoImage.getImageY() - AndroidUtilities.dp(2.0f));
                            this.otherY = imageY;
                            setDrawableBounds(menuDrawable, imageX, imageY);
                            menuDrawable.draw(canvas);
                            if (this.drawInstantView) {
                                int textX2 = (int) (this.photoImage.getImageX() - AndroidUtilities.dp(2.0f));
                                int instantY2 = this.layoutHeight - AndroidUtilities.dp(66.0f);
                                if (!this.reactionsLayoutInBubble.isEmpty && !this.reactionsLayoutInBubble.isSmall) {
                                    instantY2 -= this.reactionsLayoutInBubble.totalHeight;
                                }
                                Paint backPaint = Theme.chat_instantViewRectPaint;
                                if (this.currentMessageObject.isOutOwner()) {
                                    Theme.chat_instantViewPaint.setColor(getThemedColor(Theme.key_chat_outPreviewInstantText));
                                    backPaint.setColor(getThemedColor(Theme.key_chat_outPreviewInstantText));
                                } else {
                                    Theme.chat_instantViewPaint.setColor(getThemedColor(Theme.key_chat_inPreviewInstantText));
                                    backPaint.setColor(getThemedColor(Theme.key_chat_inPreviewInstantText));
                                }
                                this.instantButtonRect.set(textX2, instantY2, this.instantWidth + textX2, AndroidUtilities.dp(36.0f) + instantY2);
                                if (Build.VERSION.SDK_INT >= 21) {
                                    this.selectorDrawableMaskType[0] = 0;
                                    this.selectorDrawable[0].setBounds(textX2, instantY2, this.instantWidth + textX2, AndroidUtilities.dp(36.0f) + instantY2);
                                    this.selectorDrawable[0].draw(canvas);
                                }
                                canvas.drawRoundRect(this.instantButtonRect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), backPaint);
                                if (this.instantViewLayout != null) {
                                    canvas.save();
                                    canvas.translate(this.instantTextX + textX2, AndroidUtilities.dp(10.5f) + instantY2);
                                    this.instantViewLayout.draw(canvas);
                                    canvas.restore();
                                }
                            }
                        }
                    }
                } else {
                    if (this.currentMessageObject.isOutOwner()) {
                        Theme.chat_audioTitlePaint.setColor(getThemedColor(Theme.key_chat_messageTextOut));
                        Theme.chat_contactPhonePaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outTimeSelectedText : Theme.key_chat_outTimeText));
                    } else {
                        Theme.chat_audioTitlePaint.setColor(getThemedColor(Theme.key_chat_messageTextIn));
                        Theme.chat_contactPhonePaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inTimeSelectedText : Theme.key_chat_inTimeText));
                    }
                    this.forceNotDrawTime = true;
                    if (this.currentMessageObject.isOutOwner()) {
                        x5 = (this.layoutWidth - this.backgroundWidth) + AndroidUtilities.dp(16.0f);
                    } else if (this.isChat && !this.isThreadPost && this.currentMessageObject.needDrawAvatar()) {
                        x5 = AndroidUtilities.dp(74.0f);
                    } else {
                        x5 = AndroidUtilities.dp(25.0f);
                    }
                    this.otherX = x5;
                    if (this.titleLayout != null) {
                        canvas.save();
                        canvas.translate(x5, AndroidUtilities.dp(12.0f) + this.namesOffset);
                        this.titleLayout.draw(canvas);
                        canvas.restore();
                    }
                    if (this.docTitleLayout != null) {
                        canvas.save();
                        canvas.translate(AndroidUtilities.dp(19.0f) + x5, AndroidUtilities.dp(37.0f) + this.namesOffset);
                        this.docTitleLayout.draw(canvas);
                        canvas.restore();
                    }
                    ?? isVideoCall = this.currentMessageObject.isVideoCall();
                    if (this.currentMessageObject.isOutOwner()) {
                        icon2 = Theme.chat_msgCallUpGreenDrawable;
                        if (!this.currentMessageObject.isVideoCall()) {
                            icon = getThemedDrawable(isDrawSelectionBackground() ? Theme.key_drawable_msgOutCallAudioSelected : Theme.key_drawable_msgOutCallAudio);
                        } else {
                            isDrawSelectionBackground();
                            icon = getThemedDrawable("drawableMsgOutCallVideo");
                        }
                    } else {
                        TLRPC.PhoneCallDiscardReason reason = this.currentMessageObject.messageOwner.action.reason;
                        if ((reason instanceof TLRPC.TL_phoneCallDiscardReasonMissed) || (reason instanceof TLRPC.TL_phoneCallDiscardReasonBusy)) {
                            icon3 = Theme.chat_msgCallDownRedDrawable;
                        } else {
                            icon3 = Theme.chat_msgCallDownGreenDrawable;
                        }
                        if (isDrawSelectionBackground()) {
                            drawable2 = Theme.chat_msgInCallSelectedDrawable[isVideoCall];
                        } else {
                            Drawable[] drawableArr2 = Theme.chat_msgInCallDrawable;
                            int idx = isVideoCall == true ? 1 : 0;
                            drawable2 = drawableArr2[idx];
                        }
                        icon2 = icon3;
                        icon = drawable2;
                    }
                    setDrawableBounds(icon2, x5 - AndroidUtilities.dp(1.0f), AndroidUtilities.dp(37.0f) + this.namesOffset);
                    icon2.draw(canvas);
                    if (Build.VERSION.SDK_INT >= 21) {
                        Drawable[] drawableArr3 = this.selectorDrawable;
                        if (drawableArr3[0] != null && this.selectorDrawableMaskType[0] == 4) {
                            drawableArr3[0].draw(canvas);
                        }
                    }
                    boolean z = this.pinnedBottom;
                    if (!z && !this.pinnedTop) {
                        this.otherY = AndroidUtilities.dp(18.5f);
                    } else if (z && this.pinnedTop) {
                        this.otherY = AndroidUtilities.dp(18.0f);
                    } else if (!z) {
                        this.otherY = AndroidUtilities.dp(17.0f);
                    } else {
                        this.otherY = AndroidUtilities.dp(19.0f);
                    }
                    setDrawableBounds(icon, AndroidUtilities.dp(isVideoCall == 0 ? 201.0f : 200.0f) + x5, this.otherY);
                    icon.draw(canvas);
                }
            } else if (this.docTitleLayout != null) {
                if (this.currentMessageObject.isOutOwner()) {
                    Theme.chat_locationTitlePaint.setColor(getThemedColor(Theme.key_chat_messageTextOut));
                    Theme.chat_locationAddressPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_outVenueInfoSelectedText : Theme.key_chat_outVenueInfoText));
                } else {
                    Theme.chat_locationTitlePaint.setColor(getThemedColor(Theme.key_chat_messageTextIn));
                    Theme.chat_locationAddressPaint.setColor(getThemedColor(isDrawSelectionBackground() ? Theme.key_chat_inVenueInfoSelectedText : Theme.key_chat_inVenueInfoText));
                }
                if (!(this.currentMessageObject.messageOwner.media instanceof TLRPC.TL_messageMediaGeoLive)) {
                    canvas.save();
                    canvas.translate(this.photoImage.getImageX() + AndroidUtilities.dp(6.0f), this.photoImage.getImageY2() + AndroidUtilities.dp(8.0f));
                    this.docTitleLayout.draw(canvas);
                    if (this.infoLayout != null) {
                        canvas.translate(0.0f, AndroidUtilities.dp(21.0f));
                        this.infoLayout.draw(canvas);
                    }
                    canvas.restore();
                } else {
                    int cy4 = (int) (this.photoImage.getImageY2() + AndroidUtilities.dp(30.0f));
                    if (!this.locationExpired || this.transitionParams.animateLocationIsExpired) {
                        this.forceNotDrawTime = true;
                        StaticLayout docTitleLayout2 = this.docTitleLayout;
                        StaticLayout infoLayout2 = this.infoLayout;
                        float alpha2 = 1.0f;
                        if (!this.transitionParams.animateLocationIsExpired) {
                            docTitleLayout = docTitleLayout2;
                            progress = 1.0f - (Math.abs(ConnectionsManager.getInstance(this.currentAccount).getCurrentTime() - this.currentMessageObject.messageOwner.date) / this.currentMessageObject.messageOwner.media.period);
                            text = LocaleController.formatLocationLeftTime(Math.abs(this.currentMessageObject.messageOwner.media.period - (ConnectionsManager.getInstance(this.currentAccount).getCurrentTime() - this.currentMessageObject.messageOwner.date)));
                            infoLayout = infoLayout2;
                        } else {
                            float progress2 = this.transitionParams.lastDrawLocationExpireProgress;
                            String text3 = this.transitionParams.lastDrawLocationExpireText;
                            StaticLayout docTitleLayout3 = this.transitionParams.lastDrawDocTitleLayout;
                            StaticLayout infoLayout3 = this.transitionParams.lastDrawInfoLayout;
                            alpha2 = 1.0f - this.transitionParams.animateChangeProgress;
                            docTitleLayout = docTitleLayout3;
                            progress = progress2;
                            text = text3;
                            infoLayout = infoLayout3;
                        }
                        this.rect.set(this.photoImage.getImageX2() - AndroidUtilities.dp(43.0f), cy4 - AndroidUtilities.dp(15.0f), this.photoImage.getImageX2() - AndroidUtilities.dp(13.0f), AndroidUtilities.dp(15.0f) + cy4);
                        if (this.currentMessageObject.isOutOwner()) {
                            Theme.chat_radialProgress2Paint.setColor(getThemedColor(Theme.key_chat_outInstant));
                            Theme.chat_livePaint.setColor(getThemedColor(Theme.key_chat_outInstant));
                        } else {
                            Theme.chat_radialProgress2Paint.setColor(getThemedColor(Theme.key_chat_inInstant));
                            Theme.chat_livePaint.setColor(getThemedColor(Theme.key_chat_inInstant));
                        }
                        int docTitleAlpha = Theme.chat_locationTitlePaint.getAlpha();
                        int infoAlpha = Theme.chat_locationAddressPaint.getAlpha();
                        int liveAplha = Theme.chat_livePaint.getAlpha();
                        if (alpha2 != 1.0f) {
                            Theme.chat_locationTitlePaint.setAlpha((int) (docTitleAlpha * alpha2));
                            Theme.chat_locationAddressPaint.setAlpha((int) (infoAlpha * alpha2));
                            Theme.chat_livePaint.setAlpha((int) (liveAplha * alpha2));
                            canvas.save();
                            canvas.translate(0.0f, (-AndroidUtilities.dp(50.0f)) * this.transitionParams.animateChangeProgress);
                        }
                        Theme.chat_radialProgress2Paint.setAlpha((int) (alpha2 * 50.0f));
                        canvas.drawCircle(this.rect.centerX(), this.rect.centerY(), AndroidUtilities.dp(15.0f), Theme.chat_radialProgress2Paint);
                        Theme.chat_radialProgress2Paint.setAlpha((int) (alpha2 * 255.0f));
                        String text4 = text;
                        canvas.drawArc(this.rect, -90.0f, progress * (-360.0f), false, Theme.chat_radialProgress2Paint);
                        float w3 = Theme.chat_livePaint.measureText(text4);
                        canvas.drawText(text4, this.rect.centerX() - (w3 / 2.0f), cy4 + AndroidUtilities.dp(4.0f), Theme.chat_livePaint);
                        if (docTitleLayout != null && infoLayout != null) {
                            canvas.save();
                            canvas.translate(this.photoImage.getImageX() + AndroidUtilities.dp(10.0f), this.photoImage.getImageY2() + AndroidUtilities.dp(10.0f));
                            docTitleLayout.draw(canvas);
                            canvas.translate(0.0f, AndroidUtilities.dp(23.0f));
                            infoLayout.draw(canvas);
                            canvas.restore();
                        }
                        if (alpha2 != 1.0f) {
                            Theme.chat_locationTitlePaint.setAlpha(docTitleAlpha);
                            Theme.chat_locationAddressPaint.setAlpha(infoAlpha);
                            Theme.chat_livePaint.setAlpha(liveAplha);
                            canvas.restore();
                        }
                        this.transitionParams.lastDrawLocationExpireProgress = progress;
                        this.transitionParams.lastDrawLocationExpireText = text4;
                        this.transitionParams.lastDrawDocTitleLayout = docTitleLayout;
                        this.transitionParams.lastDrawInfoLayout = infoLayout;
                    } else {
                        this.transitionParams.lastDrawLocationExpireText = null;
                        this.transitionParams.lastDrawDocTitleLayout = null;
                        this.transitionParams.lastDrawInfoLayout = null;
                    }
                    int cx4 = (int) ((this.photoImage.getImageX() + (this.photoImage.getImageWidth() / 2.0f)) - AndroidUtilities.dp(31.0f));
                    int cy5 = (int) ((this.photoImage.getImageY() + (this.photoImage.getImageHeight() / 2.0f)) - AndroidUtilities.dp(38.0f));
                    setDrawableBounds(Theme.chat_msgAvatarLiveLocationDrawable, cx4, cy5);
                    Theme.chat_msgAvatarLiveLocationDrawable.draw(canvas);
                    this.locationImageReceiver.setImageCoords(AndroidUtilities.dp(5.0f) + cx4, AndroidUtilities.dp(5.0f) + cy5, AndroidUtilities.dp(52.0f), AndroidUtilities.dp(52.0f));
                    this.locationImageReceiver.draw(canvas);
                }
            }
            if (this.photoImage.getVisible()) {
                if (!this.currentMessageObject.needDrawBluredPreview() && this.documentAttachType == 4) {
                    int oldAlpha = ((BitmapDrawable) Theme.chat_msgMediaMenuDrawable).getPaint().getAlpha();
                    if (this.drawMediaCheckBox) {
                        Theme.chat_msgMediaMenuDrawable.setAlpha((int) (oldAlpha * this.controlsAlpha * (1.0f - this.checkBoxAnimationProgress)));
                    } else {
                        Theme.chat_msgMediaMenuDrawable.setAlpha((int) (oldAlpha * this.controlsAlpha));
                    }
                    Drawable drawable4 = Theme.chat_msgMediaMenuDrawable;
                    int imageX2 = (int) ((this.photoImage.getImageX() + this.photoImage.getImageWidth()) - AndroidUtilities.dp(14.0f));
                    this.otherX = imageX2;
                    int imageY2 = (int) (this.photoImage.getImageY() + AndroidUtilities.dp(8.1f));
                    this.otherY = imageY2;
                    setDrawableBounds(drawable4, imageX2, imageY2);
                    Theme.chat_msgMediaMenuDrawable.draw(canvas);
                    Theme.chat_msgMediaMenuDrawable.setAlpha(oldAlpha);
                }
                boolean playing = MediaController.getInstance().isPlayingMessage(this.currentMessageObject);
                if (this.animatingNoSoundPlaying != playing) {
                    this.animatingNoSoundPlaying = playing;
                    this.animatingNoSound = playing ? 1 : 2;
                    this.animatingNoSoundProgress = playing ? 1.0f : 0.0f;
                }
                boolean fullWidth = true;
                MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
                if (groupedMessagePosition != null) {
                    fullWidth = (groupedMessagePosition.flags & 3) == 3;
                }
                int i11 = this.documentAttachType;
                int i12 = i11 != 4 ? 2 : 2;
                int i13 = this.buttonState;
                if (i13 == 1 || i13 == i12 || i13 == 0 || i13 == i || i13 == -1 || this.currentMessageObject.needDrawBluredPreview()) {
                    if (this.autoPlayingMedia) {
                        updatePlayingMessageProgress();
                    }
                    if ((this.infoLayout != null || this.loadingProgressLayout != null) && (!this.forceNotDrawTime || this.autoPlayingMedia || this.drawVideoImageButton || this.animatingLoadingProgressProgress != 0.0f || ((fullWidth && this.docTitleLayout != null) || (this.loadingProgressLayout != null && this.currentPosition != null && ((i5 = this.buttonState) == 1 || (i5 == i && this.miniButtonState == 1)))))) {
                        float alpha3 = 0.0f;
                        float loadingProgressAlpha = 1.0f;
                        if (!fullWidth) {
                            drawDocTitleLayout = true;
                            drawLoadingProgress = false;
                            loadingProgressAlpha = this.animatingLoadingProgressProgress;
                        } else {
                            boolean drawLoadingProgress2 = (this.buttonState == 1 || this.miniButtonState == 1 || this.animatingLoadingProgressProgress != 0.0f) && !this.currentMessageObject.isSecretMedia() && ((i4 = this.documentAttachType) == 4 || i4 == 2 || i4 == 1);
                            if (this.currentMessageObject.type == i || this.currentMessageObject.type == 8 || this.documentAttachType == 4) {
                                alpha3 = (!this.currentMessageObject.needDrawBluredPreview() || this.docTitleLayout != null) ? this.animatingDrawVideoImageButtonProgress : 0.0f;
                            }
                            boolean drawDocTitleLayout2 = alpha3 > 0.0f && this.docTitleLayout != null;
                            if (!drawDocTitleLayout2 && (drawLoadingProgress2 || this.infoLayout == null)) {
                                loadingProgressAlpha = this.animatingLoadingProgressProgress;
                                boolean z2 = drawLoadingProgress2;
                                drawLoadingProgress = drawDocTitleLayout2;
                                drawDocTitleLayout = z2;
                            } else {
                                boolean z3 = drawLoadingProgress2;
                                drawLoadingProgress = drawDocTitleLayout2;
                                drawDocTitleLayout = z3;
                            }
                        }
                        Theme.chat_infoPaint.setColor(getThemedColor(Theme.key_chat_mediaInfoText));
                        int x12 = (int) (this.photoImage.getImageX() + AndroidUtilities.dp(4.0f));
                        int y12 = (int) (this.photoImage.getImageY() + AndroidUtilities.dp(4.0f));
                        if (this.autoPlayingMedia && (!playing || this.animatingNoSound != 0)) {
                            imageW = (int) ((Theme.chat_msgNoSoundDrawable.getIntrinsicWidth() + AndroidUtilities.dp(4.0f)) * this.animatingNoSoundProgress);
                        } else {
                            imageW = 0;
                        }
                        if (drawDocTitleLayout && (staticLayout = this.loadingProgressLayout) != null) {
                            imageW = 0;
                            infoW = (int) staticLayout.getLineWidth(0);
                        } else {
                            infoW = this.infoWidth;
                        }
                        int w4 = (int) Math.ceil(AndroidUtilities.dp(8.0f) + infoW + imageW + ((((Math.max((this.infoWidth == infoW ? imageW : 0) + infoW, this.docTitleWidth) + (this.canStreamVideo ? AndroidUtilities.dp(32.0f) : 0)) - infoW) - imageW) * alpha3));
                        if (alpha3 != 0.0f && this.docTitleLayout == null) {
                            alpha3 = 0.0f;
                        }
                        canvas.save();
                        canvas.scale(loadingProgressAlpha, loadingProgressAlpha, x12, y12);
                        int oldAlpha2 = getThemedPaint(Theme.key_paint_chatTimeBackground).getAlpha();
                        getThemedPaint(Theme.key_paint_chatTimeBackground).setAlpha((int) (oldAlpha2 * this.controlsAlpha * loadingProgressAlpha));
                        if (drawLoadingProgress || ((drawDocTitleLayout && this.loadingProgressLayout != null) || (!drawDocTitleLayout && this.infoLayout != null))) {
                            int x13 = y12 + AndroidUtilities.dp((15.5f * alpha3) + 16.5f);
                            this.rect.set(x12, y12, x12 + w4, x13);
                            int[] rad2 = this.photoImage.getRoundRadius();
                            int r = Math.min(AndroidUtilities.dp(8.0f), Math.max(rad2[0], rad2[1]));
                            canvas.drawRoundRect(this.rect, r, r, getThemedPaint(Theme.key_paint_chatTimeBackground));
                        }
                        Theme.chat_infoPaint.setAlpha((int) (this.controlsAlpha * 255.0f * loadingProgressAlpha));
                        int imageX3 = (int) (this.photoImage.getImageX() + AndroidUtilities.dp((this.canStreamVideo ? 30.0f * alpha3 : 0.0f) + 8.0f));
                        this.noSoundCenterX = imageX3;
                        canvas.translate(imageX3, this.photoImage.getImageY() + AndroidUtilities.dp((0.2f * alpha3) + 5.5f));
                        StaticLayout staticLayout3 = this.infoLayout;
                        if (staticLayout3 != null && (!drawDocTitleLayout || drawLoadingProgress)) {
                            staticLayout3.draw(canvas);
                        }
                        if (imageW != 0 && (!drawDocTitleLayout || drawLoadingProgress)) {
                            canvas.save();
                            Drawable drawable5 = Theme.chat_msgNoSoundDrawable;
                            float f9 = this.animatingNoSoundProgress;
                            drawable5.setAlpha((int) (f9 * 255.0f * f9 * this.controlsAlpha));
                            int size2 = AndroidUtilities.dp(this.animatingNoSoundProgress * 14.0f);
                            int y3 = (AndroidUtilities.dp(14.0f) - size2) / 2;
                            int offset = this.infoWidth + AndroidUtilities.dp(4.0f);
                            canvas.translate(offset, 0.0f);
                            Theme.chat_msgNoSoundDrawable.setBounds(0, y3, size2, y3 + size2);
                            Theme.chat_msgNoSoundDrawable.draw(canvas);
                            this.noSoundCenterX += (size2 / 2) + offset;
                            canvas.restore();
                        }
                        if (drawDocTitleLayout && this.loadingProgressLayout != null) {
                            canvas.save();
                            if (drawLoadingProgress) {
                                Theme.chat_infoPaint.setAlpha((int) (this.controlsAlpha * 255.0f * alpha3));
                                canvas.translate(0.0f, AndroidUtilities.dp(14.3f * alpha3));
                            }
                            this.loadingProgressLayout.draw(canvas);
                            canvas.restore();
                        } else if (drawLoadingProgress) {
                            Theme.chat_infoPaint.setAlpha((int) (this.controlsAlpha * 255.0f * alpha3));
                            canvas.translate(0.0f, AndroidUtilities.dp(14.3f * alpha3));
                            this.docTitleLayout.draw(canvas);
                        }
                        canvas.restore();
                        Theme.chat_infoPaint.setAlpha(255);
                        getThemedPaint(Theme.key_paint_chatTimeBackground).setAlpha(oldAlpha2);
                    }
                    i2 = this.animatingDrawVideoImageButton;
                    if (i2 != 1) {
                        animationDt3 = animationDt2;
                        float f10 = this.animatingDrawVideoImageButtonProgress - (((float) animationDt3) / 160.0f);
                        this.animatingDrawVideoImageButtonProgress = f10;
                        if (f10 <= 0.0f) {
                            this.animatingDrawVideoImageButtonProgress = 0.0f;
                            this.animatingDrawVideoImageButton = 0;
                        }
                        invalidate();
                    } else {
                        animationDt3 = animationDt2;
                        if (i2 == 2) {
                            float f11 = this.animatingDrawVideoImageButtonProgress + (((float) animationDt3) / 160.0f);
                            this.animatingDrawVideoImageButtonProgress = f11;
                            if (f11 >= 1.0f) {
                                this.animatingDrawVideoImageButtonProgress = 1.0f;
                                this.animatingDrawVideoImageButton = 0;
                            }
                            invalidate();
                        }
                    }
                    i3 = this.animatingNoSound;
                    if (i3 != 1) {
                        float f12 = this.animatingNoSoundProgress - (((float) animationDt3) / 180.0f);
                        this.animatingNoSoundProgress = f12;
                        if (f12 <= 0.0f) {
                            this.animatingNoSoundProgress = 0.0f;
                            this.animatingNoSound = 0;
                        }
                        invalidate();
                    } else if (i3 == 2) {
                        float f13 = this.animatingNoSoundProgress + (((float) animationDt3) / 180.0f);
                        this.animatingNoSoundProgress = f13;
                        if (f13 >= 1.0f) {
                            this.animatingNoSoundProgress = 1.0f;
                            this.animatingNoSound = 0;
                        }
                        invalidate();
                    }
                    animatingToLoadingProgress = ((this.buttonState != 1 || this.miniButtonState == 1) && this.loadingProgressLayout != null) ? 1.0f : 0.0f;
                    if (animatingToLoadingProgress == 0.0f && this.infoLayout != null && fullWidth) {
                        this.animatingLoadingProgressProgress = 0.0f;
                    }
                    f = this.animatingLoadingProgressProgress;
                    if (f >= animatingToLoadingProgress) {
                        float f14 = f + (((float) animationDt3) / 160.0f);
                        this.animatingLoadingProgressProgress = f14;
                        if (f14 > animatingToLoadingProgress) {
                            this.animatingLoadingProgressProgress = animatingToLoadingProgress;
                        }
                        invalidate();
                    } else if (f != animatingToLoadingProgress) {
                        float f15 = f - (((float) animationDt3) / 160.0f);
                        this.animatingLoadingProgressProgress = f15;
                        if (f15 < animatingToLoadingProgress) {
                            this.animatingLoadingProgressProgress = animatingToLoadingProgress;
                        }
                        invalidate();
                    }
                }
                i2 = this.animatingDrawVideoImageButton;
                if (i2 != 1) {
                }
                i3 = this.animatingNoSound;
                if (i3 != 1) {
                }
                if (this.buttonState != 1) {
                }
                if (animatingToLoadingProgress == 0.0f) {
                    this.animatingLoadingProgressProgress = 0.0f;
                }
                f = this.animatingLoadingProgressProgress;
                if (f >= animatingToLoadingProgress) {
                }
            }
        }
        if (!this.drawImageButton || !this.photoImage.getVisible()) {
            obj = null;
        } else {
            float f16 = this.controlsAlpha;
            if (f16 != 1.0f) {
                this.radialProgress.setOverrideAlpha(f16);
            }
            if (this.photoImage.hasImageSet()) {
                obj = null;
                this.radialProgress.setBackgroundDrawable(null);
            } else {
                obj = null;
                this.radialProgress.setBackgroundDrawable(isDrawSelectionBackground() ? this.currentBackgroundSelectedDrawable : this.currentBackgroundDrawable);
            }
            if (!this.currentMessageObject.needDrawBluredPreview() || !MediaController.getInstance().isPlayingMessage(this.currentMessageObject)) {
                this.radialProgress.draw(canvas);
            }
        }
        if (this.buttonState != -1 || !this.currentMessageObject.needDrawBluredPreview() || MediaController.getInstance().isPlayingMessage(this.currentMessageObject) || !this.photoImage.getVisible() || this.currentMessageObject.messageOwner.destroyTime == 0) {
            r15 = obj;
        } else {
            if (!this.currentMessageObject.isOutOwner()) {
                long msTime = System.currentTimeMillis() + (ConnectionsManager.getInstance(this.currentAccount).getTimeDifference() * 1000);
                float progress3 = ((float) Math.max(0L, (this.currentMessageObject.messageOwner.destroyTime * 1000) - msTime)) / (this.currentMessageObject.messageOwner.ttl * 1000.0f);
                Theme.chat_deleteProgressPaint.setAlpha((int) (this.controlsAlpha * 255.0f));
                Object obj3 = obj;
                canvas.drawArc(this.deleteProgressRect, -90.0f, progress3 * (-360.0f), true, Theme.chat_deleteProgressPaint);
                obj2 = obj3;
                if (progress3 != 0.0f) {
                    int offset2 = AndroidUtilities.dp(2.0f);
                    invalidate(((int) this.deleteProgressRect.left) - offset2, ((int) this.deleteProgressRect.top) - offset2, ((int) this.deleteProgressRect.right) + (offset2 * 2), ((int) this.deleteProgressRect.bottom) + (offset2 * 2));
                    obj2 = obj3;
                }
            } else {
                obj2 = obj;
            }
            updateSecretTimeText(this.currentMessageObject);
            r15 = obj2;
        }
        if ((this.drawVideoImageButton || this.animatingDrawVideoImageButton != 0) && this.photoImage.getVisible()) {
            float f17 = this.controlsAlpha;
            if (f17 != 1.0f) {
                this.videoRadialProgress.setOverrideAlpha(f17);
            }
            this.videoRadialProgress.draw(canvas);
        }
        if (this.drawMediaCheckBox) {
            int i14 = this.documentAttachType;
            if (i14 != 5 && (i14 != 1 || this.drawPhotoImage)) {
                int size3 = AndroidUtilities.dp(21.0f);
                this.mediaCheckBox.setBackgroundType(0);
                this.mediaCheckBox.setBounds(((int) this.photoImage.getImageX2()) - AndroidUtilities.dp(25.0f), ((int) this.photoImage.getImageY()) + AndroidUtilities.dp(4.0f), size3, size3);
                this.mediaCheckBox.setColor(r15, r15, this.currentMessageObject.isOutOwner() ? Theme.key_chat_outBubbleSelected : Theme.key_chat_inBubbleSelected);
                this.mediaCheckBox.setBackgroundDrawable(r15);
                this.mediaCheckBox.draw(canvas);
            }
            int size4 = AndroidUtilities.dp(20.0f);
            this.mediaCheckBox.setBackgroundType(this.radialProgress.getMiniIcon() != 4 ? 12 : 13);
            this.mediaCheckBox.setBounds(this.buttonX + AndroidUtilities.dp(28.0f), this.buttonY + AndroidUtilities.dp(28.0f), size4, size4);
            this.mediaCheckBox.setColor(this.currentMessageObject.isOutOwner() ? Theme.key_chat_outTimeText : Theme.key_chat_inTimeText, this.currentMessageObject.isOutOwner() ? Theme.key_chat_outLoader : Theme.key_chat_inLoader, this.currentMessageObject.isOutOwner() ? Theme.key_chat_outBubble : Theme.key_chat_inBubble);
            this.mediaCheckBox.setBackgroundDrawable(isDrawSelectionBackground() ? this.currentBackgroundSelectedDrawable : this.currentBackgroundDrawable);
            this.mediaCheckBox.draw(canvas);
        }
        if (this.documentAttachType == 7) {
            boolean playing2 = MediaController.getInstance().isPlayingMessage(this.currentMessageObject);
            if (this.currentMessageObject.type == 5) {
                float offsetX = 0.0f;
                if (this.currentMessageObject.isOutOwner()) {
                    float offsetSize = (AndroidUtilities.roundPlayingMessageSize - AndroidUtilities.roundMessageSize) * 0.2f;
                    offsetX = this.isPlayingRound ? offsetSize : 0.0f;
                    if (this.transitionParams.animatePlayingRound) {
                        offsetX = (this.isPlayingRound ? this.transitionParams.animateChangeProgress : 1.0f - this.transitionParams.animateChangeProgress) * offsetSize;
                    }
                }
                float x14 = this.backgroundDrawableLeft + this.transitionParams.deltaLeft + AndroidUtilities.dp(8.0f) + this.roundPlayingDrawableProgress + offsetX;
                float y13 = this.layoutHeight - AndroidUtilities.dp(28 - (this.drawPinnedBottom ? 2 : 0));
                if (!this.reactionsLayoutInBubble.isEmpty) {
                    y13 -= this.reactionsLayoutInBubble.totalHeight;
                }
                this.transitionParams.lastDrawRoundVideoDotY = y13;
                if (this.transitionParams.animateRoundVideoDotY) {
                    y13 = (this.transitionParams.animateFromRoundVideoDotY * (1.0f - this.transitionParams.animateChangeProgress)) + (this.transitionParams.animateChangeProgress * y13);
                }
                this.rect.set(x14, y13, this.timeWidthAudio + x14 + AndroidUtilities.dp(22.0f), AndroidUtilities.dp(17.0f) + y13);
                int oldAlpha3 = getThemedPaint(Theme.key_paint_chatActionBackground).getAlpha();
                getThemedPaint(Theme.key_paint_chatActionBackground).setAlpha((int) (oldAlpha3 * this.timeAlpha));
                applyServiceShaderMatrix();
                canvas.drawRoundRect(this.rect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), getThemedPaint(Theme.key_paint_chatActionBackground));
                if (hasGradientService()) {
                    int oldAlpha22 = Theme.chat_actionBackgroundGradientDarkenPaint.getAlpha();
                    Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha((int) (oldAlpha22 * this.timeAlpha));
                    canvas.drawRoundRect(this.rect, AndroidUtilities.dp(6.0f), AndroidUtilities.dp(6.0f), Theme.chat_actionBackgroundGradientDarkenPaint);
                    Theme.chat_actionBackgroundGradientDarkenPaint.setAlpha(oldAlpha22);
                }
                getThemedPaint(Theme.key_paint_chatActionBackground).setAlpha(oldAlpha3);
                boolean showPlayingDrawable = playing2 || !this.currentMessageObject.isContentUnread();
                if (showPlayingDrawable) {
                    float f18 = this.roundPlayingDrawableProgress;
                    if (f18 != 1.0f) {
                        float f19 = f18 + 0.10666667f;
                        this.roundPlayingDrawableProgress = f19;
                        if (f19 > 1.0f) {
                            this.roundPlayingDrawableProgress = 1.0f;
                        } else {
                            invalidate();
                        }
                        if (showPlayingDrawable) {
                            if (playing2 && !MediaController.getInstance().isMessagePaused()) {
                                this.roundVideoPlayingDrawable.start();
                            } else {
                                this.roundVideoPlayingDrawable.stop();
                            }
                        }
                        if (this.roundPlayingDrawableProgress < 1.0f) {
                            float cx5 = this.timeWidthAudio + x14 + AndroidUtilities.dp(12.0f);
                            float cy6 = AndroidUtilities.dp(8.3f) + y13;
                            canvas.save();
                            float f20 = this.roundPlayingDrawableProgress;
                            canvas.scale(1.0f - f20, 1.0f - f20, cx5, cy6);
                            Theme.chat_docBackPaint.setColor(getThemedColor(Theme.key_chat_serviceText));
                            Theme.chat_docBackPaint.setAlpha((int) (this.timeAlpha * 255.0f * (1.0f - this.roundPlayingDrawableProgress)));
                            canvas.drawCircle(cx5, cy6, AndroidUtilities.dp(3.0f), Theme.chat_docBackPaint);
                            canvas.restore();
                        }
                        if (this.roundPlayingDrawableProgress > 0.0f) {
                            setDrawableBounds(this.roundVideoPlayingDrawable, this.timeWidthAudio + x14 + AndroidUtilities.dp(6.0f), AndroidUtilities.dp(2.3f) + y13);
                            canvas.save();
                            float f21 = this.roundPlayingDrawableProgress;
                            canvas.scale(f21, f21, this.roundVideoPlayingDrawable.getBounds().centerX(), this.roundVideoPlayingDrawable.getBounds().centerY());
                            this.roundVideoPlayingDrawable.setAlpha((int) (this.roundPlayingDrawableProgress * 255.0f));
                            this.roundVideoPlayingDrawable.draw(canvas);
                            canvas.restore();
                        }
                        x1 = x14 + AndroidUtilities.dp(4.0f);
                        y1 = y13 + AndroidUtilities.dp(1.7f);
                    }
                }
                if (!showPlayingDrawable) {
                    float f22 = this.roundPlayingDrawableProgress;
                    if (f22 != 0.0f) {
                        float f23 = f22 - 0.10666667f;
                        this.roundPlayingDrawableProgress = f23;
                        if (f23 < 0.0f) {
                            this.roundPlayingDrawableProgress = 0.0f;
                        } else {
                            invalidate();
                        }
                    }
                }
                if (showPlayingDrawable) {
                }
                if (this.roundPlayingDrawableProgress < 1.0f) {
                }
                if (this.roundPlayingDrawableProgress > 0.0f) {
                }
                x1 = x14 + AndroidUtilities.dp(4.0f);
                y1 = y13 + AndroidUtilities.dp(1.7f);
            } else {
                x1 = this.backgroundDrawableLeft + AndroidUtilities.dp((this.currentMessageObject.isOutOwner() || this.drawPinnedBottom) ? 12.0f : 18.0f);
                y1 = (this.layoutHeight - AndroidUtilities.dp(6.3f - (this.drawPinnedBottom ? 2 : 0))) - this.timeLayout.getHeight();
            }
            if (this.durationLayout != null) {
                Theme.chat_timePaint.setAlpha((int) (this.timeAlpha * 255.0f));
                canvas.save();
                canvas.translate(x1, y1);
                this.durationLayout.draw(canvas);
                canvas.restore();
                Theme.chat_timePaint.setAlpha(255);
            }
        }
    }

    @Override // org.telegram.messenger.DownloadController.FileDownloadProgressListener
    public int getObserverTag() {
        return this.TAG;
    }

    public MessageObject getMessageObject() {
        MessageObject messageObject = this.messageObjectToSet;
        return messageObject != null ? messageObject : this.currentMessageObject;
    }

    public TLRPC.Document getStreamingMedia() {
        int i = this.documentAttachType;
        if (i == 4 || i == 7 || i == 2) {
            return this.documentAttach;
        }
        return null;
    }

    public boolean drawPinnedBottom() {
        MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
        if (groupedMessages != null && groupedMessages.isDocuments) {
            MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
            if (groupedMessagePosition != null && (groupedMessagePosition.flags & 8) != 0) {
                return this.pinnedBottom;
            }
            return true;
        }
        return this.pinnedBottom;
    }

    public boolean drawPinnedTop() {
        MessageObject.GroupedMessages groupedMessages = this.currentMessagesGroup;
        if (groupedMessages != null && groupedMessages.isDocuments) {
            MessageObject.GroupedMessagePosition groupedMessagePosition = this.currentPosition;
            if (groupedMessagePosition != null && (groupedMessagePosition.flags & 4) != 0) {
                return this.pinnedTop;
            }
            return true;
        }
        return this.pinnedTop;
    }

    public boolean isPinnedBottom() {
        return this.pinnedBottom;
    }

    public boolean isPinnedTop() {
        return this.pinnedTop;
    }

    public MessageObject.GroupedMessages getCurrentMessagesGroup() {
        return this.currentMessagesGroup;
    }

    public MessageObject.GroupedMessagePosition getCurrentPosition() {
        return this.currentPosition;
    }

    public int getLayoutHeight() {
        return this.layoutHeight;
    }

    @Override // android.view.View
    public boolean performAccessibilityAction(int action, Bundle arguments) {
        ChatMessageCellDelegate chatMessageCellDelegate;
        ChatMessageCellDelegate chatMessageCellDelegate2 = this.delegate;
        if (chatMessageCellDelegate2 == null || !chatMessageCellDelegate2.onAccessibilityAction(action, arguments)) {
            if (action == 16) {
                int icon = getIconForCurrentState();
                if (icon == 4 || icon == 5) {
                    if (this.currentMessageObject.type == 16) {
                        this.delegate.didPressOther(this, this.otherX, this.otherY);
                    } else {
                        didClickedImage();
                    }
                } else {
                    didPressButton(true, false);
                }
                return true;
            }
            if (action == R.id.acc_action_small_button) {
                didPressMiniButton(true);
            } else if (action == R.id.acc_action_msg_options) {
                if (this.delegate != null) {
                    if (this.currentMessageObject.type == 16) {
                        this.delegate.didLongPress(this, 0.0f, 0.0f);
                    } else {
                        this.delegate.didPressOther(this, this.otherX, this.otherY);
                    }
                }
            } else if (action == R.id.acc_action_open_forwarded_origin && (chatMessageCellDelegate = this.delegate) != null) {
                TLRPC.Chat chat = this.currentForwardChannel;
                if (chat != null) {
                    chatMessageCellDelegate.didPressChannelAvatar(this, chat, this.currentMessageObject.messageOwner.fwd_from.channel_post, this.lastTouchX, this.lastTouchY);
                } else {
                    TLRPC.User user = this.currentForwardUser;
                    if (user != null) {
                        chatMessageCellDelegate.didPressUserAvatar(this, user, this.lastTouchX, this.lastTouchY);
                    } else if (this.currentForwardName != null) {
                        chatMessageCellDelegate.didPressHiddenForward(this);
                    }
                }
            }
            if ((!this.currentMessageObject.isVoice() && !this.currentMessageObject.isRoundVideo() && (!this.currentMessageObject.isMusic() || !MediaController.getInstance().isPlayingMessage(this.currentMessageObject))) || !this.seekBarAccessibilityDelegate.performAccessibilityActionInternal(action, arguments)) {
                return super.performAccessibilityAction(action, arguments);
            }
            return true;
        }
        return false;
    }

    public void setAnimationRunning(boolean animationRunning, boolean willRemoved) {
        this.animationRunning = animationRunning;
        if (animationRunning) {
            this.willRemoved = willRemoved;
        } else {
            this.willRemoved = false;
        }
        if (getParent() == null && this.attachedToWindow) {
            onDetachedFromWindow();
        }
    }

    @Override // android.view.View
    public boolean onHoverEvent(MotionEvent event) {
        int x = (int) event.getX();
        int y = (int) event.getY();
        if (event.getAction() == 9 || event.getAction() == 7) {
            for (int i = 0; i < this.accessibilityVirtualViewBounds.size(); i++) {
                Rect rect = this.accessibilityVirtualViewBounds.valueAt(i);
                if (rect.contains(x, y)) {
                    int id = this.accessibilityVirtualViewBounds.keyAt(i);
                    if (id != this.currentFocusedVirtualView) {
                        this.currentFocusedVirtualView = id;
                        sendAccessibilityEventForVirtualView(id, 32768);
                        return true;
                    }
                    return true;
                }
            }
        } else if (event.getAction() == 10) {
            this.currentFocusedVirtualView = 0;
        }
        return super.onHoverEvent(event);
    }

    @Override // android.view.View
    public void onInitializeAccessibilityNodeInfo(AccessibilityNodeInfo info) {
        super.onInitializeAccessibilityNodeInfo(info);
    }

    @Override // android.view.View
    public AccessibilityNodeProvider getAccessibilityNodeProvider() {
        return new MessageAccessibilityNodeProvider();
    }

    public void sendAccessibilityEventForVirtualView(int viewId, int eventType) {
        sendAccessibilityEventForVirtualView(viewId, eventType, null);
    }

    private void sendAccessibilityEventForVirtualView(int viewId, int eventType, String text) {
        AccessibilityManager am = (AccessibilityManager) getContext().getSystemService("accessibility");
        if (am.isTouchExplorationEnabled()) {
            AccessibilityEvent event = AccessibilityEvent.obtain(eventType);
            event.setPackageName(getContext().getPackageName());
            event.setSource(this, viewId);
            if (text != null) {
                event.getText().add(text);
            }
            if (getParent() != null) {
                getParent().requestSendAccessibilityEvent(this, event);
            }
        }
    }

    public static Point getMessageSize(int imageW, int imageH) {
        return getMessageSize(imageW, imageH, 0, 0);
    }

    private static Point getMessageSize(int imageW, int imageH, int photoWidth, int photoHeight) {
        if (photoHeight == 0 || photoWidth == 0) {
            if (AndroidUtilities.isTablet()) {
                photoWidth = (int) (AndroidUtilities.getMinTabletSide() * 0.7f);
            } else if (imageW >= imageH) {
                photoWidth = Math.min(AndroidUtilities.displaySize.x, AndroidUtilities.displaySize.y) - AndroidUtilities.dp(64.0f);
            } else {
                photoWidth = (int) (Math.min(AndroidUtilities.displaySize.x, AndroidUtilities.displaySize.y) * 0.7f);
            }
            photoHeight = photoWidth + AndroidUtilities.dp(100.0f);
            if (photoWidth > AndroidUtilities.getPhotoSize()) {
                photoWidth = AndroidUtilities.getPhotoSize();
            }
            if (photoHeight > AndroidUtilities.getPhotoSize()) {
                photoHeight = AndroidUtilities.getPhotoSize();
            }
        }
        float scale = imageW / photoWidth;
        int w = (int) (imageW / scale);
        int h = (int) (imageH / scale);
        if (w == 0) {
            w = AndroidUtilities.dp(150.0f);
        }
        if (h == 0) {
            h = AndroidUtilities.dp(150.0f);
        }
        if (h > photoHeight) {
            float scale2 = h;
            h = photoHeight;
            w = (int) (w / (scale2 / h));
        } else if (h < AndroidUtilities.dp(120.0f)) {
            h = AndroidUtilities.dp(120.0f);
            float hScale = imageH / h;
            if (imageW / hScale < photoWidth) {
                w = (int) (imageW / hScale);
            }
        }
        return new Point(w, h);
    }

    public StaticLayout getDescriptionlayout() {
        return this.descriptionLayout;
    }

    public void setSelectedBackgroundProgress(float value) {
        this.selectedBackgroundProgress = value;
        invalidate();
    }

    public int computeHeight(MessageObject object, MessageObject.GroupedMessages groupedMessages) {
        this.photoImage.setIgnoreImageSet(true);
        this.avatarImage.setIgnoreImageSet(true);
        this.replyImageReceiver.setIgnoreImageSet(true);
        this.locationImageReceiver.setIgnoreImageSet(true);
        if (groupedMessages != null && groupedMessages.messages.size() != 1) {
            int h = 0;
            for (int i = 0; i < groupedMessages.messages.size(); i++) {
                MessageObject o = groupedMessages.messages.get(i);
                MessageObject.GroupedMessagePosition position = groupedMessages.positions.get(o);
                if (position != null && (position.flags & 1) != 0) {
                    setMessageContent(o, groupedMessages, false, false);
                    h += this.totalHeight + this.keyboardHeight;
                }
            }
            return h;
        }
        setMessageContent(object, groupedMessages, false, false);
        this.photoImage.setIgnoreImageSet(false);
        this.avatarImage.setIgnoreImageSet(false);
        this.replyImageReceiver.setIgnoreImageSet(false);
        this.locationImageReceiver.setIgnoreImageSet(false);
        return this.totalHeight + this.keyboardHeight;
    }

    public void shakeView() {
        Keyframe kf0 = Keyframe.ofFloat(0.0f, 0.0f);
        Keyframe kf1 = Keyframe.ofFloat(0.2f, 3.0f);
        Keyframe kf2 = Keyframe.ofFloat(0.4f, -3.0f);
        Keyframe kf3 = Keyframe.ofFloat(0.6f, 3.0f);
        Keyframe kf4 = Keyframe.ofFloat(0.8f, -3.0f);
        Keyframe kf5 = Keyframe.ofFloat(1.0f, 0.0f);
        PropertyValuesHolder pvhRotation = PropertyValuesHolder.ofKeyframe(View.ROTATION, kf0, kf1, kf2, kf3, kf4, kf5);
        Keyframe kfs0 = Keyframe.ofFloat(0.0f, 1.0f);
        Keyframe kfs1 = Keyframe.ofFloat(0.5f, 0.97f);
        Keyframe kfs2 = Keyframe.ofFloat(1.0f, 1.0f);
        PropertyValuesHolder pvhScaleX = PropertyValuesHolder.ofKeyframe(View.SCALE_X, kfs0, kfs1, kfs2);
        PropertyValuesHolder pvhScaleY = PropertyValuesHolder.ofKeyframe(View.SCALE_Y, kfs0, kfs1, kfs2);
        AnimatorSet animatorSet = new AnimatorSet();
        this.shakeAnimation = animatorSet;
        animatorSet.playTogether(ObjectAnimator.ofPropertyValuesHolder(this, pvhRotation), ObjectAnimator.ofPropertyValuesHolder(this, pvhScaleX), ObjectAnimator.ofPropertyValuesHolder(this, pvhScaleY));
        this.shakeAnimation.setDuration(500L);
        this.shakeAnimation.start();
    }

    private void cancelShakeAnimation() {
        AnimatorSet animatorSet = this.shakeAnimation;
        if (animatorSet != null) {
            animatorSet.cancel();
            this.shakeAnimation = null;
            setScaleX(1.0f);
            setScaleY(1.0f);
            setRotation(0.0f);
        }
    }

    public void setSlidingOffset(float offsetX) {
        if (this.slidingOffsetX != offsetX) {
            this.slidingOffsetX = offsetX;
            updateTranslation();
        }
    }

    public void setAnimationOffsetX(float offsetX) {
        if (this.animationOffsetX != offsetX) {
            this.animationOffsetX = offsetX;
            updateTranslation();
        }
    }

    private void updateTranslation() {
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject == null) {
            return;
        }
        int checkBoxOffset = !messageObject.isOutOwner() ? this.checkBoxTranslation : 0;
        setTranslationX(this.slidingOffsetX + this.animationOffsetX + checkBoxOffset);
    }

    public float getNonAnimationTranslationX(boolean update) {
        boolean z;
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null && !messageObject.isOutOwner()) {
            if (update && ((z = this.checkBoxVisible) || this.checkBoxAnimationInProgress)) {
                Interpolator interpolator = z ? CubicBezierInterpolator.EASE_OUT : CubicBezierInterpolator.EASE_IN;
                this.checkBoxTranslation = (int) Math.ceil(interpolator.getInterpolation(this.checkBoxAnimationProgress) * AndroidUtilities.dp(35.0f));
            }
            return this.slidingOffsetX + this.checkBoxTranslation;
        }
        return this.slidingOffsetX;
    }

    public float getSlidingOffsetX() {
        return this.slidingOffsetX;
    }

    public boolean willRemovedAfterAnimation() {
        return this.willRemoved;
    }

    public float getAnimationOffsetX() {
        return this.animationOffsetX;
    }

    @Override // android.view.View
    public void setTranslationX(float translationX) {
        super.setTranslationX(translationX);
    }

    public SeekBar getSeekBar() {
        return this.seekBar;
    }

    public SeekBarWaveform getSeekBarWaveform() {
        return this.seekBarWaveform;
    }

    /* loaded from: classes4.dex */
    public class MessageAccessibilityNodeProvider extends AccessibilityNodeProvider {
        public static final int BOT_BUTTONS_START = 1000;
        public static final int COMMENT = 496;
        public static final int FORWARD = 494;
        public static final int INSTANT_VIEW = 499;
        public static final int LINK_CAPTION_IDS_START = 3000;
        public static final int LINK_IDS_START = 2000;
        public static final int POLL_BUTTONS_START = 500;
        public static final int POLL_HINT = 495;
        public static final int PROFILE = 5000;
        public static final int REPLY = 497;
        public static final int SHARE = 498;
        public static final int TRANSCRIBE = 493;
        private Path linkPath;
        private Rect rect;
        private RectF rectF;

        private MessageAccessibilityNodeProvider() {
            ChatMessageCell.this = r1;
            this.linkPath = new Path();
            this.rectF = new RectF();
            this.rect = new Rect();
        }

        /* loaded from: classes4.dex */
        private class ProfileSpan extends ClickableSpan {
            private TLRPC.User user;

            public ProfileSpan(TLRPC.User user) {
                MessageAccessibilityNodeProvider.this = r1;
                this.user = user;
            }

            @Override // android.text.style.ClickableSpan
            public void onClick(View view) {
                if (ChatMessageCell.this.delegate != null) {
                    ChatMessageCell.this.delegate.didPressUserAvatar(ChatMessageCell.this, this.user, 0.0f, 0.0f);
                }
            }
        }

        /* JADX WARN: Multi-variable type inference failed */
        /* JADX WARN: Type inference failed for: r13v0 */
        /* JADX WARN: Type inference failed for: r13v1, types: [boolean] */
        /* JADX WARN: Type inference failed for: r13v2 */
        @Override // android.view.accessibility.AccessibilityNodeProvider
        public AccessibilityNodeInfo createAccessibilityNodeInfo(int virtualViewId) {
            boolean z;
            String str;
            int i;
            String str2;
            int i2;
            int i3;
            AccessibilityNodeInfo.CollectionItemInfo itemInfo;
            TLRPC.TL_messagePeerReaction recentReaction;
            String str3;
            int i4;
            String title;
            int[] pos = {0, 0};
            ChatMessageCell.this.getLocationOnScreen(pos);
            int i5 = 10;
            ?? r13 = 1;
            if (virtualViewId == -1) {
                AccessibilityNodeInfo info = AccessibilityNodeInfo.obtain(ChatMessageCell.this);
                ChatMessageCell.this.onInitializeAccessibilityNodeInfo(info);
                if (ChatMessageCell.this.accessibilityText == null) {
                    SpannableStringBuilder sb = new SpannableStringBuilder();
                    if (ChatMessageCell.this.isChat && ChatMessageCell.this.currentUser != null && !ChatMessageCell.this.currentMessageObject.isOut()) {
                        sb.append(UserObject.getUserName(ChatMessageCell.this.currentUser));
                        sb.setSpan(new ProfileSpan(ChatMessageCell.this.currentUser), 0, sb.length(), 33);
                        sb.append('\n');
                    }
                    if (ChatMessageCell.this.drawForwardedName) {
                        int a = 0;
                        while (a < 2) {
                            if (ChatMessageCell.this.forwardedNameLayout[a] != null) {
                                sb.append(ChatMessageCell.this.forwardedNameLayout[a].getText());
                                sb.append(a == 0 ? " " : "\n");
                            }
                            a++;
                        }
                    }
                    if (!TextUtils.isEmpty(ChatMessageCell.this.currentMessageObject.messageText)) {
                        sb.append(ChatMessageCell.this.currentMessageObject.messageText);
                    }
                    if (ChatMessageCell.this.documentAttach != null && (ChatMessageCell.this.documentAttachType == 1 || ChatMessageCell.this.documentAttachType == 2 || ChatMessageCell.this.documentAttachType == 4)) {
                        if (ChatMessageCell.this.buttonState == 1 && ChatMessageCell.this.loadingProgressLayout != null) {
                            sb.append("\n");
                            boolean sending = ChatMessageCell.this.currentMessageObject.isSending();
                            String key = sending ? "AccDescrUploadProgress" : "AccDescrDownloadProgress";
                            int resId = sending ? R.string.AccDescrUploadProgress : R.string.AccDescrDownloadProgress;
                            sb.append(LocaleController.formatString(key, resId, AndroidUtilities.formatFileSize(ChatMessageCell.this.currentMessageObject.loadedFileSize), AndroidUtilities.formatFileSize(ChatMessageCell.this.lastLoadingSizeTotal)));
                        }
                    }
                    if (!ChatMessageCell.this.currentMessageObject.isMusic()) {
                        if (ChatMessageCell.this.currentMessageObject.isVoice() || ChatMessageCell.this.isRoundVideo) {
                            sb.append(", ");
                            sb.append(LocaleController.formatDuration(ChatMessageCell.this.currentMessageObject.getDuration()));
                            sb.append(", ");
                            if (ChatMessageCell.this.currentMessageObject.isContentUnread()) {
                                sb.append(LocaleController.getString("AccDescrMsgNotPlayed", R.string.AccDescrMsgNotPlayed));
                            } else {
                                sb.append(LocaleController.getString("AccDescrMsgPlayed", R.string.AccDescrMsgPlayed));
                            }
                        }
                    } else {
                        sb.append("\n");
                        sb.append(LocaleController.formatString("AccDescrMusicInfo", R.string.AccDescrMusicInfo, ChatMessageCell.this.currentMessageObject.getMusicAuthor(), ChatMessageCell.this.currentMessageObject.getMusicTitle()));
                        sb.append(", ");
                        sb.append(LocaleController.formatDuration(ChatMessageCell.this.currentMessageObject.getDuration()));
                    }
                    if (ChatMessageCell.this.lastPoll != null) {
                        sb.append(", ");
                        sb.append(ChatMessageCell.this.lastPoll.question);
                        sb.append(", ");
                        if (!ChatMessageCell.this.pollClosed) {
                            if (ChatMessageCell.this.lastPoll.quiz) {
                                if (ChatMessageCell.this.lastPoll.public_voters) {
                                    title = LocaleController.getString("QuizPoll", R.string.QuizPoll);
                                } else {
                                    title = LocaleController.getString("AnonymousQuizPoll", R.string.AnonymousQuizPoll);
                                }
                            } else if (ChatMessageCell.this.lastPoll.public_voters) {
                                title = LocaleController.getString("PublicPoll", R.string.PublicPoll);
                            } else {
                                title = LocaleController.getString("AnonymousPoll", R.string.AnonymousPoll);
                            }
                        } else {
                            title = LocaleController.getString("FinalResults", R.string.FinalResults);
                        }
                        sb.append((CharSequence) title);
                    }
                    if (!ChatMessageCell.this.currentMessageObject.isVoiceTranscriptionOpen()) {
                        if (ChatMessageCell.this.currentMessageObject.messageOwner.media != null && !TextUtils.isEmpty(ChatMessageCell.this.currentMessageObject.caption)) {
                            sb.append("\n");
                            sb.append(ChatMessageCell.this.currentMessageObject.caption);
                        }
                    } else {
                        sb.append("\n");
                        sb.append(ChatMessageCell.this.currentMessageObject.getVoiceTranscription());
                    }
                    if (ChatMessageCell.this.documentAttach != null) {
                        if (ChatMessageCell.this.documentAttachType == 4) {
                            sb.append(", ");
                            sb.append(LocaleController.formatDuration(ChatMessageCell.this.currentMessageObject.getDuration()));
                        }
                        if (ChatMessageCell.this.buttonState == 0 || ChatMessageCell.this.documentAttachType == 1) {
                            sb.append(", ");
                            sb.append(AndroidUtilities.formatFileSize(ChatMessageCell.this.documentAttach.size));
                        }
                    }
                    if (ChatMessageCell.this.currentMessageObject.isOut()) {
                        if (!ChatMessageCell.this.currentMessageObject.isSent()) {
                            if (!ChatMessageCell.this.currentMessageObject.isSending()) {
                                if (ChatMessageCell.this.currentMessageObject.isSendError()) {
                                    sb.append("\n");
                                    sb.append(LocaleController.getString("AccDescrMsgSendingError", R.string.AccDescrMsgSendingError));
                                }
                            } else {
                                sb.append("\n");
                                sb.append(LocaleController.getString("AccDescrMsgSending", R.string.AccDescrMsgSending));
                                float sendingProgress = ChatMessageCell.this.radialProgress.getProgress();
                                if (sendingProgress > 0.0f) {
                                    sb.append(", ").append(Integer.toString(Math.round(100.0f * sendingProgress))).append("%");
                                }
                            }
                        } else {
                            sb.append("\n");
                            if (ChatMessageCell.this.currentMessageObject.scheduled) {
                                sb.append(LocaleController.formatString("AccDescrScheduledDate", R.string.AccDescrScheduledDate, ChatMessageCell.this.currentTimeString));
                            } else {
                                sb.append(LocaleController.formatString("AccDescrSentDate", R.string.AccDescrSentDate, LocaleController.getString("TodayAt", R.string.TodayAt) + " " + ChatMessageCell.this.currentTimeString));
                                sb.append(", ");
                                if (ChatMessageCell.this.currentMessageObject.isUnread()) {
                                    i4 = R.string.AccDescrMsgUnread;
                                    str3 = "AccDescrMsgUnread";
                                } else {
                                    i4 = R.string.AccDescrMsgRead;
                                    str3 = "AccDescrMsgRead";
                                }
                                sb.append(LocaleController.getString(str3, i4));
                            }
                        }
                    } else {
                        sb.append("\n");
                        sb.append(LocaleController.formatString("AccDescrReceivedDate", R.string.AccDescrReceivedDate, LocaleController.getString("TodayAt", R.string.TodayAt) + " " + ChatMessageCell.this.currentTimeString));
                    }
                    if (ChatMessageCell.this.getRepliesCount() > 0 && !ChatMessageCell.this.hasCommentLayout()) {
                        sb.append("\n");
                        sb.append(LocaleController.formatPluralString("AccDescrNumberOfReplies", ChatMessageCell.this.getRepliesCount(), new Object[0]));
                    }
                    if (ChatMessageCell.this.currentMessageObject.messageOwner.reactions != null && ChatMessageCell.this.currentMessageObject.messageOwner.reactions.results != null) {
                        if (ChatMessageCell.this.currentMessageObject.messageOwner.reactions.results.size() == 1) {
                            TLRPC.TL_reactionCount reaction = ChatMessageCell.this.currentMessageObject.messageOwner.reactions.results.get(0);
                            if (reaction.count == 1) {
                                sb.append("\n");
                                boolean isMe = false;
                                String userName = "";
                                if (ChatMessageCell.this.currentMessageObject.messageOwner.reactions.recent_reactions != null && ChatMessageCell.this.currentMessageObject.messageOwner.reactions.recent_reactions.size() == 1 && (recentReaction = ChatMessageCell.this.currentMessageObject.messageOwner.reactions.recent_reactions.get(0)) != null) {
                                    TLRPC.User user = MessagesController.getInstance(ChatMessageCell.this.currentAccount).getUser(Long.valueOf(MessageObject.getPeerId(recentReaction.peer_id)));
                                    isMe = UserObject.isUserSelf(user);
                                    if (user != null) {
                                        userName = UserObject.getFirstName(user);
                                    }
                                }
                                if (isMe) {
                                    sb.append(LocaleController.formatString("AccDescrYouReactedWith", R.string.AccDescrYouReactedWith, reaction.reaction));
                                } else {
                                    sb.append(LocaleController.formatString("AccDescrReactedWith", R.string.AccDescrReactedWith, userName, reaction.reaction));
                                }
                            } else if (reaction.count > 1) {
                                sb.append("\n");
                                sb.append(LocaleController.formatPluralString("AccDescrNumberOfPeopleReactions", reaction.count, reaction.reaction));
                            }
                        } else {
                            sb.append(LocaleController.getString("Reactions", R.string.Reactions)).append(": ");
                            int count = ChatMessageCell.this.currentMessageObject.messageOwner.reactions.results.size();
                            for (int i6 = 0; i6 < count; i6++) {
                                TLRPC.TL_reactionCount reactionCount = ChatMessageCell.this.currentMessageObject.messageOwner.reactions.results.get(i6);
                                if (reactionCount != null) {
                                    sb.append(reactionCount.reaction).append(" ").append(reactionCount.count + "");
                                    if (i6 + 1 < count) {
                                        sb.append(", ");
                                    }
                                }
                            }
                            sb.append("\n");
                        }
                    }
                    if ((ChatMessageCell.this.currentMessageObject.messageOwner.flags & 1024) != 0) {
                        sb.append("\n");
                        sb.append(LocaleController.formatPluralString("AccDescrNumberOfViews", ChatMessageCell.this.currentMessageObject.messageOwner.views, new Object[0]));
                    }
                    sb.append("\n");
                    CharacterStyle[] links = (CharacterStyle[]) sb.getSpans(0, sb.length(), ClickableSpan.class);
                    for (final CharacterStyle link : links) {
                        int start = sb.getSpanStart(link);
                        int end = sb.getSpanEnd(link);
                        sb.removeSpan(link);
                        ClickableSpan underlineSpan = new ClickableSpan() { // from class: org.telegram.ui.Cells.ChatMessageCell.MessageAccessibilityNodeProvider.1
                            @Override // android.text.style.ClickableSpan
                            public void onClick(View view) {
                                CharacterStyle characterStyle = link;
                                if (!(characterStyle instanceof ProfileSpan)) {
                                    if (ChatMessageCell.this.delegate != null) {
                                        ChatMessageCell.this.delegate.didPressUrl(ChatMessageCell.this, link, false);
                                        return;
                                    }
                                    return;
                                }
                                ((ProfileSpan) characterStyle).onClick(view);
                            }
                        };
                        sb.setSpan(underlineSpan, start, end, 33);
                    }
                    ChatMessageCell.this.accessibilityText = sb;
                }
                if (Build.VERSION.SDK_INT < 24) {
                    info.setContentDescription(ChatMessageCell.this.accessibilityText.toString());
                } else {
                    info.setText(ChatMessageCell.this.accessibilityText);
                }
                info.setEnabled(true);
                if (Build.VERSION.SDK_INT >= 19 && (itemInfo = info.getCollectionItemInfo()) != null) {
                    info.setCollectionItemInfo(AccessibilityNodeInfo.CollectionItemInfo.obtain(itemInfo.getRowIndex(), 1, 0, 1, false));
                }
                if (Build.VERSION.SDK_INT >= 21) {
                    info.addAction(new AccessibilityNodeInfo.AccessibilityAction(R.id.acc_action_msg_options, LocaleController.getString("AccActionMessageOptions", R.string.AccActionMessageOptions)));
                    int icon = ChatMessageCell.this.getIconForCurrentState();
                    CharSequence actionLabel = null;
                    switch (icon) {
                        case 0:
                            actionLabel = LocaleController.getString("AccActionPlay", R.string.AccActionPlay);
                            i3 = 16;
                            break;
                        case 1:
                            actionLabel = LocaleController.getString("AccActionPause", R.string.AccActionPause);
                            i3 = 16;
                            break;
                        case 2:
                            actionLabel = LocaleController.getString("AccActionDownload", R.string.AccActionDownload);
                            i3 = 16;
                            break;
                        case 3:
                            actionLabel = LocaleController.getString("AccActionCancelDownload", R.string.AccActionCancelDownload);
                            i3 = 16;
                            break;
                        case 4:
                        default:
                            i3 = 16;
                            if (ChatMessageCell.this.currentMessageObject.type == 16) {
                                actionLabel = LocaleController.getString("CallAgain", R.string.CallAgain);
                                break;
                            }
                            break;
                        case 5:
                            actionLabel = LocaleController.getString("AccActionOpenFile", R.string.AccActionOpenFile);
                            i3 = 16;
                            break;
                    }
                    info.addAction(new AccessibilityNodeInfo.AccessibilityAction(i3, actionLabel));
                    info.addAction(new AccessibilityNodeInfo.AccessibilityAction(32, LocaleController.getString("AccActionEnterSelectionMode", R.string.AccActionEnterSelectionMode)));
                    int smallIcon = ChatMessageCell.this.getMiniIconForCurrentState();
                    if (smallIcon == 2) {
                        info.addAction(new AccessibilityNodeInfo.AccessibilityAction(R.id.acc_action_small_button, LocaleController.getString("AccActionDownload", R.string.AccActionDownload)));
                    }
                } else {
                    info.addAction(16);
                    info.addAction(32);
                }
                if ((ChatMessageCell.this.currentMessageObject.isVoice() || ChatMessageCell.this.currentMessageObject.isRoundVideo() || ChatMessageCell.this.currentMessageObject.isMusic()) && MediaController.getInstance().isPlayingMessage(ChatMessageCell.this.currentMessageObject)) {
                    ChatMessageCell.this.seekBarAccessibilityDelegate.onInitializeAccessibilityNodeInfoInternal(info);
                }
                if (ChatMessageCell.this.useTranscribeButton && ChatMessageCell.this.transcribeButton != null) {
                    info.addChild(ChatMessageCell.this, TRANSCRIBE);
                }
                if (Build.VERSION.SDK_INT < 24) {
                    if (ChatMessageCell.this.isChat && ChatMessageCell.this.currentUser != null && !ChatMessageCell.this.currentMessageObject.isOut()) {
                        info.addChild(ChatMessageCell.this, 5000);
                    }
                    if (ChatMessageCell.this.currentMessageObject.messageText instanceof Spannable) {
                        Spannable buffer = (Spannable) ChatMessageCell.this.currentMessageObject.messageText;
                        CharacterStyle[] links2 = (CharacterStyle[]) buffer.getSpans(0, buffer.length(), ClickableSpan.class);
                        int i7 = 0;
                        for (CharacterStyle characterStyle : links2) {
                            info.addChild(ChatMessageCell.this, i7 + 2000);
                            i7++;
                        }
                    }
                    if ((ChatMessageCell.this.currentMessageObject.caption instanceof Spannable) && ChatMessageCell.this.captionLayout != null) {
                        Spannable buffer2 = (Spannable) ChatMessageCell.this.currentMessageObject.caption;
                        CharacterStyle[] links3 = (CharacterStyle[]) buffer2.getSpans(0, buffer2.length(), ClickableSpan.class);
                        int i8 = 0;
                        for (CharacterStyle characterStyle2 : links3) {
                            info.addChild(ChatMessageCell.this, i8 + 3000);
                            i8++;
                        }
                    }
                }
                int i9 = 0;
                Iterator it = ChatMessageCell.this.botButtons.iterator();
                while (it.hasNext()) {
                    BotButton botButton = (BotButton) it.next();
                    info.addChild(ChatMessageCell.this, i9 + 1000);
                    i9++;
                }
                if (ChatMessageCell.this.hintButtonVisible && ChatMessageCell.this.pollHintX != -1 && ChatMessageCell.this.currentMessageObject.isPoll()) {
                    info.addChild(ChatMessageCell.this, POLL_HINT);
                }
                int i10 = 0;
                Iterator it2 = ChatMessageCell.this.pollButtons.iterator();
                while (it2.hasNext()) {
                    PollButton pollButton = (PollButton) it2.next();
                    info.addChild(ChatMessageCell.this, i10 + 500);
                    i10++;
                }
                if (ChatMessageCell.this.drawInstantView && !ChatMessageCell.this.instantButtonRect.isEmpty()) {
                    info.addChild(ChatMessageCell.this, INSTANT_VIEW);
                }
                if (ChatMessageCell.this.commentLayout != null) {
                    info.addChild(ChatMessageCell.this, COMMENT);
                }
                if (ChatMessageCell.this.drawSideButton == 1) {
                    info.addChild(ChatMessageCell.this, SHARE);
                }
                if (ChatMessageCell.this.replyNameLayout != null) {
                    info.addChild(ChatMessageCell.this, REPLY);
                }
                if (ChatMessageCell.this.forwardedNameLayout[0] != null && ChatMessageCell.this.forwardedNameLayout[1] != null) {
                    if (Build.VERSION.SDK_INT >= 21) {
                        info.addAction(new AccessibilityNodeInfo.AccessibilityAction(R.id.acc_action_open_forwarded_origin, LocaleController.getString("AccActionOpenForwardedOrigin", R.string.AccActionOpenForwardedOrigin)));
                    } else {
                        info.addChild(ChatMessageCell.this, FORWARD);
                    }
                }
                if (ChatMessageCell.this.drawSelectionBackground || ChatMessageCell.this.getBackground() != null) {
                    info.setSelected(true);
                }
                return info;
            }
            AccessibilityNodeInfo info2 = AccessibilityNodeInfo.obtain();
            info2.setSource(ChatMessageCell.this, virtualViewId);
            info2.setParent(ChatMessageCell.this);
            info2.setPackageName(ChatMessageCell.this.getContext().getPackageName());
            if (virtualViewId == 5000) {
                if (ChatMessageCell.this.currentUser == null) {
                    return null;
                }
                String content = UserObject.getUserName(ChatMessageCell.this.currentUser);
                info2.setText(content);
                Rect rect = this.rect;
                int i11 = (int) ChatMessageCell.this.nameX;
                int i12 = (int) ChatMessageCell.this.nameY;
                int i13 = (int) (ChatMessageCell.this.nameX + ChatMessageCell.this.nameWidth);
                float f = ChatMessageCell.this.nameY;
                if (ChatMessageCell.this.nameLayout != null) {
                    i5 = ChatMessageCell.this.nameLayout.getHeight();
                }
                rect.set(i11, i12, i13, (int) (f + i5));
                info2.setBoundsInParent(this.rect);
                if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null) {
                    ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                }
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                info2.setClassName("android.widget.TextView");
                info2.setEnabled(true);
                info2.setClickable(true);
                info2.setLongClickable(true);
                info2.addAction(16);
                info2.addAction(32);
                z = true;
            } else if (virtualViewId >= 3000) {
                if (!(ChatMessageCell.this.currentMessageObject.caption instanceof Spannable) || ChatMessageCell.this.captionLayout == null) {
                    return null;
                }
                Spannable buffer3 = (Spannable) ChatMessageCell.this.currentMessageObject.caption;
                ClickableSpan link2 = getLinkById(virtualViewId, true);
                if (link2 == null) {
                    return null;
                }
                int[] linkPos = ChatMessageCell.this.getRealSpanStartAndEnd(buffer3, link2);
                String content2 = buffer3.subSequence(linkPos[0], linkPos[1]).toString();
                info2.setText(content2);
                ChatMessageCell.this.captionLayout.getText().length();
                ChatMessageCell.this.captionLayout.getSelectionPath(linkPos[0], linkPos[1], this.linkPath);
                this.linkPath.computeBounds(this.rectF, true);
                this.rect.set((int) this.rectF.left, (int) this.rectF.top, (int) this.rectF.right, (int) this.rectF.bottom);
                this.rect.offset((int) ChatMessageCell.this.captionX, (int) ChatMessageCell.this.captionY);
                info2.setBoundsInParent(this.rect);
                if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null) {
                    ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                }
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                info2.setClassName("android.widget.TextView");
                info2.setEnabled(true);
                info2.setClickable(true);
                info2.setLongClickable(true);
                info2.addAction(16);
                info2.addAction(32);
                z = true;
            } else if (virtualViewId >= 2000) {
                if (!(ChatMessageCell.this.currentMessageObject.messageText instanceof Spannable)) {
                    return null;
                }
                Spannable buffer4 = (Spannable) ChatMessageCell.this.currentMessageObject.messageText;
                ClickableSpan link3 = getLinkById(virtualViewId, false);
                if (link3 == null) {
                    return null;
                }
                int[] linkPos2 = ChatMessageCell.this.getRealSpanStartAndEnd(buffer4, link3);
                String content3 = buffer4.subSequence(linkPos2[0], linkPos2[1]).toString();
                info2.setText(content3);
                Iterator<MessageObject.TextLayoutBlock> it3 = ChatMessageCell.this.currentMessageObject.textLayoutBlocks.iterator();
                while (true) {
                    if (!it3.hasNext()) {
                        break;
                    }
                    MessageObject.TextLayoutBlock block = it3.next();
                    int length = block.textLayout.getText().length();
                    if (block.charactersOffset <= linkPos2[0]) {
                        int i14 = block.charactersOffset + length;
                        char c = r13 == true ? 1 : 0;
                        char c2 = r13 == true ? 1 : 0;
                        if (i14 >= linkPos2[c]) {
                            block.textLayout.getSelectionPath(linkPos2[0] - block.charactersOffset, linkPos2[r13] - block.charactersOffset, this.linkPath);
                            this.linkPath.computeBounds(this.rectF, r13);
                            this.rect.set((int) this.rectF.left, (int) this.rectF.top, (int) this.rectF.right, (int) this.rectF.bottom);
                            this.rect.offset(0, (int) block.textYOffset);
                            this.rect.offset(ChatMessageCell.this.textX, ChatMessageCell.this.textY);
                            info2.setBoundsInParent(this.rect);
                            if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null) {
                                ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                            }
                            this.rect.offset(pos[0], pos[1]);
                            info2.setBoundsInScreen(this.rect);
                        }
                    }
                    r13 = 1;
                }
                info2.setClassName("android.widget.TextView");
                info2.setEnabled(true);
                info2.setClickable(true);
                info2.setLongClickable(true);
                info2.addAction(16);
                info2.addAction(32);
                z = true;
            } else if (virtualViewId >= 1000) {
                int buttonIndex = virtualViewId - 1000;
                if (buttonIndex >= ChatMessageCell.this.botButtons.size()) {
                    return null;
                }
                BotButton button = (BotButton) ChatMessageCell.this.botButtons.get(buttonIndex);
                info2.setText(button.title.getText());
                info2.setClassName("android.widget.Button");
                info2.setEnabled(true);
                info2.setClickable(true);
                info2.addAction(16);
                this.rect.set(button.x, button.y, button.x + button.width, button.y + button.height);
                int addX = ChatMessageCell.this.currentMessageObject.isOutOwner() ? (ChatMessageCell.this.getMeasuredWidth() - ChatMessageCell.this.widthForButtons) - AndroidUtilities.dp(10.0f) : ChatMessageCell.this.backgroundDrawableLeft + AndroidUtilities.dp(ChatMessageCell.this.mediaBackground ? 1.0f : 7.0f);
                this.rect.offset(addX, ChatMessageCell.this.layoutHeight);
                info2.setBoundsInParent(this.rect);
                if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null) {
                    ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                }
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                z = true;
            } else if (virtualViewId >= 500) {
                int buttonIndex2 = virtualViewId - 500;
                if (buttonIndex2 >= ChatMessageCell.this.pollButtons.size()) {
                    return null;
                }
                PollButton button2 = (PollButton) ChatMessageCell.this.pollButtons.get(buttonIndex2);
                StringBuilder sb2 = new StringBuilder(button2.title.getText());
                if (ChatMessageCell.this.pollVoted) {
                    info2.setSelected(button2.chosen);
                    sb2.append(", ");
                    sb2.append(button2.percent);
                    sb2.append("%");
                    if (ChatMessageCell.this.lastPoll != null && ChatMessageCell.this.lastPoll.quiz && (button2.chosen || button2.correct)) {
                        sb2.append(", ");
                        if (button2.correct) {
                            i2 = R.string.AccDescrQuizCorrectAnswer;
                            str2 = "AccDescrQuizCorrectAnswer";
                        } else {
                            i2 = R.string.AccDescrQuizIncorrectAnswer;
                            str2 = "AccDescrQuizIncorrectAnswer";
                        }
                        sb2.append(LocaleController.getString(str2, i2));
                    }
                } else {
                    info2.setClassName("android.widget.Button");
                }
                info2.setText(sb2);
                info2.setEnabled(true);
                info2.addAction(16);
                int y = button2.y + ChatMessageCell.this.namesOffset;
                int w = ChatMessageCell.this.backgroundWidth - AndroidUtilities.dp(76.0f);
                this.rect.set(button2.x, y, button2.x + w, button2.height + y);
                info2.setBoundsInParent(this.rect);
                if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null) {
                    ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                }
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                info2.setClickable(true);
                z = true;
            } else if (virtualViewId == 495) {
                info2.setClassName("android.widget.Button");
                info2.setEnabled(true);
                info2.setText(LocaleController.getString("AccDescrQuizExplanation", R.string.AccDescrQuizExplanation));
                info2.addAction(16);
                this.rect.set(ChatMessageCell.this.pollHintX - AndroidUtilities.dp(8.0f), ChatMessageCell.this.pollHintY - AndroidUtilities.dp(8.0f), ChatMessageCell.this.pollHintX + AndroidUtilities.dp(32.0f), ChatMessageCell.this.pollHintY + AndroidUtilities.dp(32.0f));
                info2.setBoundsInParent(this.rect);
                if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null || !((Rect) ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId)).equals(this.rect)) {
                    ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                }
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                info2.setClickable(true);
                z = true;
            } else if (virtualViewId == 499) {
                info2.setClassName("android.widget.Button");
                info2.setEnabled(true);
                if (ChatMessageCell.this.instantViewLayout != null) {
                    info2.setText(ChatMessageCell.this.instantViewLayout.getText());
                }
                info2.addAction(16);
                ChatMessageCell.this.instantButtonRect.round(this.rect);
                info2.setBoundsInParent(this.rect);
                if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null || !((Rect) ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId)).equals(this.rect)) {
                    ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                }
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                info2.setClickable(true);
                z = true;
            } else if (virtualViewId == 498) {
                info2.setClassName("android.widget.ImageButton");
                info2.setEnabled(true);
                ChatMessageCell chatMessageCell = ChatMessageCell.this;
                if (chatMessageCell.isOpenChatByShare(chatMessageCell.currentMessageObject)) {
                    info2.setContentDescription(LocaleController.getString("AccDescrOpenChat", R.string.AccDescrOpenChat));
                } else {
                    info2.setContentDescription(LocaleController.getString("ShareFile", R.string.ShareFile));
                }
                info2.addAction(16);
                this.rect.set((int) ChatMessageCell.this.sideStartX, (int) ChatMessageCell.this.sideStartY, ((int) ChatMessageCell.this.sideStartX) + AndroidUtilities.dp(40.0f), ((int) ChatMessageCell.this.sideStartY) + AndroidUtilities.dp(32.0f));
                info2.setBoundsInParent(this.rect);
                if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null || !((Rect) ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId)).equals(this.rect)) {
                    ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                }
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                info2.setClickable(true);
                z = true;
            } else if (virtualViewId == 497) {
                info2.setEnabled(true);
                StringBuilder sb3 = new StringBuilder();
                sb3.append(LocaleController.getString("Reply", R.string.Reply));
                sb3.append(", ");
                if (ChatMessageCell.this.replyNameLayout != null) {
                    sb3.append(ChatMessageCell.this.replyNameLayout.getText());
                    sb3.append(", ");
                }
                if (ChatMessageCell.this.replyTextLayout != null) {
                    sb3.append(ChatMessageCell.this.replyTextLayout.getText());
                }
                info2.setContentDescription(sb3.toString());
                info2.addAction(16);
                this.rect.set(ChatMessageCell.this.replyStartX, ChatMessageCell.this.replyStartY, ChatMessageCell.this.replyStartX + Math.max(ChatMessageCell.this.replyNameWidth, ChatMessageCell.this.replyTextWidth), ChatMessageCell.this.replyStartY + AndroidUtilities.dp(35.0f));
                info2.setBoundsInParent(this.rect);
                if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null || !((Rect) ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId)).equals(this.rect)) {
                    ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                }
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                info2.setClickable(true);
                z = true;
            } else if (virtualViewId == 494) {
                info2.setEnabled(true);
                StringBuilder sb4 = new StringBuilder();
                if (ChatMessageCell.this.forwardedNameLayout[0] != null && ChatMessageCell.this.forwardedNameLayout[1] != null) {
                    int a2 = 0;
                    while (a2 < 2) {
                        sb4.append(ChatMessageCell.this.forwardedNameLayout[a2].getText());
                        sb4.append(a2 == 0 ? " " : "\n");
                        a2++;
                    }
                }
                info2.setContentDescription(sb4.toString());
                info2.addAction(16);
                int x = (int) Math.min(ChatMessageCell.this.forwardNameX - ChatMessageCell.this.forwardNameOffsetX[0], ChatMessageCell.this.forwardNameX - ChatMessageCell.this.forwardNameOffsetX[1]);
                this.rect.set(x, ChatMessageCell.this.forwardNameY, ChatMessageCell.this.forwardedNameWidth + x, ChatMessageCell.this.forwardNameY + AndroidUtilities.dp(32.0f));
                info2.setBoundsInParent(this.rect);
                if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null || !((Rect) ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId)).equals(this.rect)) {
                    ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                }
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                info2.setClickable(true);
                z = true;
            } else if (virtualViewId == 496) {
                info2.setClassName("android.widget.Button");
                info2.setEnabled(true);
                int commentCount = ChatMessageCell.this.getRepliesCount();
                String comment = null;
                if (ChatMessageCell.this.currentMessageObject != null && !ChatMessageCell.this.currentMessageObject.shouldDrawWithoutBackground() && !ChatMessageCell.this.currentMessageObject.isAnimatedEmoji()) {
                    comment = ChatMessageCell.this.isRepliesChat ? LocaleController.getString("ViewInChat", R.string.ViewInChat) : commentCount == 0 ? LocaleController.getString("LeaveAComment", R.string.LeaveAComment) : LocaleController.formatPluralString("CommentsCount", commentCount, new Object[0]);
                } else if (!ChatMessageCell.this.isRepliesChat && commentCount > 0) {
                    comment = LocaleController.formatShortNumber(commentCount, null);
                }
                if (comment != null) {
                    info2.setText(comment);
                }
                info2.addAction(16);
                this.rect.set(ChatMessageCell.this.commentButtonRect);
                info2.setBoundsInParent(this.rect);
                if (ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId) == null || !((Rect) ChatMessageCell.this.accessibilityVirtualViewBounds.get(virtualViewId)).equals(this.rect)) {
                    ChatMessageCell.this.accessibilityVirtualViewBounds.put(virtualViewId, new Rect(this.rect));
                }
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                info2.setClickable(true);
                z = true;
            } else if (virtualViewId != 493) {
                z = true;
            } else {
                info2.setClassName("android.widget.Button");
                info2.setEnabled(true);
                if (ChatMessageCell.this.currentMessageObject.isVoiceTranscriptionOpen()) {
                    i = R.string.AccActionCloseTranscription;
                    str = "AccActionCloseTranscription";
                } else {
                    i = R.string.AccActionOpenTranscription;
                    str = "AccActionOpenTranscription";
                }
                info2.setText(LocaleController.getString(str, i));
                info2.addAction(16);
                this.rect.set((int) ChatMessageCell.this.transcribeX, (int) ChatMessageCell.this.transcribeY, (int) (ChatMessageCell.this.transcribeX + AndroidUtilities.dp(30.0f)), (int) (ChatMessageCell.this.transcribeY + AndroidUtilities.dp(30.0f)));
                info2.setBoundsInParent(this.rect);
                z = true;
                this.rect.offset(pos[0], pos[1]);
                info2.setBoundsInScreen(this.rect);
                info2.setClickable(true);
            }
            info2.setFocusable(z);
            info2.setVisibleToUser(z);
            return info2;
        }

        @Override // android.view.accessibility.AccessibilityNodeProvider
        public boolean performAction(int virtualViewId, int action, Bundle arguments) {
            if (virtualViewId == -1) {
                ChatMessageCell.this.performAccessibilityAction(action, arguments);
            } else if (action == 64) {
                ChatMessageCell.this.sendAccessibilityEventForVirtualView(virtualViewId, 32768);
            } else {
                boolean z = false;
                if (action == 16) {
                    if (virtualViewId == 5000) {
                        if (ChatMessageCell.this.delegate != null) {
                            ChatMessageCellDelegate chatMessageCellDelegate = ChatMessageCell.this.delegate;
                            ChatMessageCell chatMessageCell = ChatMessageCell.this;
                            chatMessageCellDelegate.didPressUserAvatar(chatMessageCell, chatMessageCell.currentUser, 0.0f, 0.0f);
                        }
                    } else if (virtualViewId >= 3000) {
                        ClickableSpan link = getLinkById(virtualViewId, true);
                        if (link != null) {
                            ChatMessageCell.this.delegate.didPressUrl(ChatMessageCell.this, link, false);
                            ChatMessageCell.this.sendAccessibilityEventForVirtualView(virtualViewId, 1);
                        }
                    } else if (virtualViewId >= 2000) {
                        ClickableSpan link2 = getLinkById(virtualViewId, false);
                        if (link2 != null) {
                            ChatMessageCell.this.delegate.didPressUrl(ChatMessageCell.this, link2, false);
                            ChatMessageCell.this.sendAccessibilityEventForVirtualView(virtualViewId, 1);
                        }
                    } else if (virtualViewId >= 1000) {
                        int buttonIndex = virtualViewId - 1000;
                        if (buttonIndex >= ChatMessageCell.this.botButtons.size()) {
                            return false;
                        }
                        BotButton button = (BotButton) ChatMessageCell.this.botButtons.get(buttonIndex);
                        if (ChatMessageCell.this.delegate != null && button.button != null) {
                            ChatMessageCell.this.delegate.didPressBotButton(ChatMessageCell.this, button.button);
                        }
                        ChatMessageCell.this.sendAccessibilityEventForVirtualView(virtualViewId, 1);
                    } else if (virtualViewId >= 500) {
                        int buttonIndex2 = virtualViewId - 500;
                        if (buttonIndex2 >= ChatMessageCell.this.pollButtons.size()) {
                            return false;
                        }
                        PollButton button2 = (PollButton) ChatMessageCell.this.pollButtons.get(buttonIndex2);
                        if (ChatMessageCell.this.delegate != null) {
                            ArrayList<TLRPC.TL_pollAnswer> answers = new ArrayList<>();
                            answers.add(button2.answer);
                            ChatMessageCell.this.delegate.didPressVoteButtons(ChatMessageCell.this, answers, -1, 0, 0);
                        }
                        ChatMessageCell.this.sendAccessibilityEventForVirtualView(virtualViewId, 1);
                    } else if (virtualViewId == 495) {
                        if (ChatMessageCell.this.delegate != null) {
                            ChatMessageCell.this.delegate.didPressHint(ChatMessageCell.this, 0);
                        }
                    } else if (virtualViewId == 499) {
                        if (ChatMessageCell.this.delegate != null) {
                            ChatMessageCellDelegate chatMessageCellDelegate2 = ChatMessageCell.this.delegate;
                            ChatMessageCell chatMessageCell2 = ChatMessageCell.this;
                            chatMessageCellDelegate2.didPressInstantButton(chatMessageCell2, chatMessageCell2.drawInstantViewType);
                        }
                    } else if (virtualViewId == 498) {
                        if (ChatMessageCell.this.delegate != null) {
                            ChatMessageCell.this.delegate.didPressSideButton(ChatMessageCell.this);
                        }
                    } else if (virtualViewId == 497) {
                        if (ChatMessageCell.this.delegate != null && ((!ChatMessageCell.this.isThreadChat || ChatMessageCell.this.currentMessageObject.getReplyTopMsgId() != 0) && ChatMessageCell.this.currentMessageObject.hasValidReplyMessageObject())) {
                            ChatMessageCellDelegate chatMessageCellDelegate3 = ChatMessageCell.this.delegate;
                            ChatMessageCell chatMessageCell3 = ChatMessageCell.this;
                            chatMessageCellDelegate3.didPressReplyMessage(chatMessageCell3, chatMessageCell3.currentMessageObject.getReplyMsgId());
                        }
                    } else if (virtualViewId == 494) {
                        if (ChatMessageCell.this.delegate != null) {
                            if (ChatMessageCell.this.currentForwardChannel != null) {
                                ChatMessageCellDelegate chatMessageCellDelegate4 = ChatMessageCell.this.delegate;
                                ChatMessageCell chatMessageCell4 = ChatMessageCell.this;
                                chatMessageCellDelegate4.didPressChannelAvatar(chatMessageCell4, chatMessageCell4.currentForwardChannel, ChatMessageCell.this.currentMessageObject.messageOwner.fwd_from.channel_post, ChatMessageCell.this.lastTouchX, ChatMessageCell.this.lastTouchY);
                            } else if (ChatMessageCell.this.currentForwardUser != null) {
                                ChatMessageCellDelegate chatMessageCellDelegate5 = ChatMessageCell.this.delegate;
                                ChatMessageCell chatMessageCell5 = ChatMessageCell.this;
                                chatMessageCellDelegate5.didPressUserAvatar(chatMessageCell5, chatMessageCell5.currentForwardUser, ChatMessageCell.this.lastTouchX, ChatMessageCell.this.lastTouchY);
                            } else if (ChatMessageCell.this.currentForwardName != null) {
                                ChatMessageCell.this.delegate.didPressHiddenForward(ChatMessageCell.this);
                            }
                        }
                    } else if (virtualViewId == 496) {
                        if (ChatMessageCell.this.delegate != null) {
                            if (ChatMessageCell.this.isRepliesChat) {
                                ChatMessageCell.this.delegate.didPressSideButton(ChatMessageCell.this);
                            } else {
                                ChatMessageCell.this.delegate.didPressCommentButton(ChatMessageCell.this);
                            }
                        }
                    } else if (virtualViewId == 493 && ChatMessageCell.this.transcribeButton != null) {
                        ChatMessageCell.this.transcribeButton.onTap();
                    }
                } else if (action == 32) {
                    if (virtualViewId >= 3000) {
                        z = true;
                    }
                    ClickableSpan link3 = getLinkById(virtualViewId, z);
                    if (link3 != null) {
                        ChatMessageCell.this.delegate.didPressUrl(ChatMessageCell.this, link3, true);
                        ChatMessageCell.this.sendAccessibilityEventForVirtualView(virtualViewId, 2);
                    }
                }
            }
            return true;
        }

        private ClickableSpan getLinkById(int id, boolean caption) {
            if (id == 5000) {
                return null;
            }
            if (caption) {
                int id2 = id - 3000;
                if ((ChatMessageCell.this.currentMessageObject.caption instanceof Spannable) && id2 >= 0) {
                    Spannable buffer = (Spannable) ChatMessageCell.this.currentMessageObject.caption;
                    ClickableSpan[] links = (ClickableSpan[]) buffer.getSpans(0, buffer.length(), ClickableSpan.class);
                    if (links.length <= id2) {
                        return null;
                    }
                    return links[id2];
                }
                return null;
            }
            int id3 = id - 2000;
            if ((ChatMessageCell.this.currentMessageObject.messageText instanceof Spannable) && id3 >= 0) {
                Spannable buffer2 = (Spannable) ChatMessageCell.this.currentMessageObject.messageText;
                ClickableSpan[] links2 = (ClickableSpan[]) buffer2.getSpans(0, buffer2.length(), ClickableSpan.class);
                if (links2.length <= id3) {
                    return null;
                }
                return links2[id3];
            }
            return null;
        }
    }

    public void setImageCoords(float x, float y, float w, float h) {
        this.photoImage.setImageCoords(x, y, w, h);
        int i = this.documentAttachType;
        if (i == 4 || i == 2) {
            this.videoButtonX = (int) (this.photoImage.getImageX() + AndroidUtilities.dp(8.0f));
            int imageY = (int) (this.photoImage.getImageY() + AndroidUtilities.dp(8.0f));
            this.videoButtonY = imageY;
            RadialProgress2 radialProgress2 = this.videoRadialProgress;
            int i2 = this.videoButtonX;
            radialProgress2.setProgressRect(i2, imageY, AndroidUtilities.dp(24.0f) + i2, this.videoButtonY + AndroidUtilities.dp(24.0f));
            this.buttonX = (int) (((this.photoImage.getImageWidth() - AndroidUtilities.dp(48.0f)) / 2.0f) + x);
            int imageY2 = (int) (this.photoImage.getImageY() + ((this.photoImage.getImageHeight() - AndroidUtilities.dp(48.0f)) / 2.0f));
            this.buttonY = imageY2;
            RadialProgress2 radialProgress22 = this.radialProgress;
            int i3 = this.buttonX;
            radialProgress22.setProgressRect(i3, imageY2, AndroidUtilities.dp(48.0f) + i3, this.buttonY + AndroidUtilities.dp(48.0f));
        }
    }

    @Override // android.view.View
    public float getAlpha() {
        if (this.ALPHA_PROPERTY_WORKAROUND) {
            return this.alphaInternal;
        }
        return super.getAlpha();
    }

    @Override // android.view.View
    public void setAlpha(float alpha) {
        boolean z = true;
        boolean z2 = alpha == 1.0f;
        if (getAlpha() != 1.0f) {
            z = false;
        }
        if (z2 != z) {
            invalidate();
        }
        if (this.ALPHA_PROPERTY_WORKAROUND) {
            this.alphaInternal = alpha;
            invalidate();
            return;
        }
        super.setAlpha(alpha);
    }

    public int getCurrentBackgroundLeft() {
        int left = this.currentBackgroundDrawable.getBounds().left;
        if (!this.currentMessageObject.isOutOwner() && this.transitionParams.changePinnedBottomProgress != 1.0f && !this.mediaBackground && !this.drawPinnedBottom) {
            return left - AndroidUtilities.dp(6.0f);
        }
        return left;
    }

    public TransitionParams getTransitionParams() {
        return this.transitionParams;
    }

    public int getTopMediaOffset() {
        MessageObject messageObject = this.currentMessageObject;
        if (messageObject != null && messageObject.type == 14) {
            return this.mediaOffsetY + this.namesOffset;
        }
        return 0;
    }

    public int getTextX() {
        return this.textX;
    }

    public int getTextY() {
        return this.textY;
    }

    public boolean isPlayingRound() {
        return this.isRoundVideo && this.isPlayingRound;
    }

    public int getParentWidth() {
        int i;
        MessageObject object = this.currentMessageObject;
        if (object == null) {
            object = this.messageObjectToSet;
        }
        if (object != null && object.preview && (i = this.parentWidth) > 0) {
            return i;
        }
        return AndroidUtilities.displaySize.x;
    }

    /* loaded from: classes4.dex */
    public class TransitionParams {
        public boolean animateBackgroundBoundsInner;
        public boolean animateBackgroundWidth;
        boolean animateBotButtonsChanged;
        private boolean animateButton;
        public boolean animateChange;
        private int animateCommentArrowX;
        private boolean animateCommentDrawUnread;
        private int animateCommentUnreadX;
        private float animateCommentX;
        private boolean animateComments;
        private StaticLayout animateCommentsLayout;
        private boolean animateDrawCommentNumber;
        public boolean animateDrawingTimeAlpha;
        private boolean animateEditedEnter;
        private StaticLayout animateEditedLayout;
        private int animateEditedWidthDiff;
        int animateForwardNameWidth;
        float animateForwardNameX;
        public boolean animateForwardedLayout;
        public int animateForwardedNamesOffset;
        private float animateFromButtonX;
        private float animateFromButtonY;
        public int animateFromRepliesTextWidth;
        public float animateFromReplyY;
        public float animateFromRoundVideoDotY;
        public float animateFromTextY;
        public int animateFromTimeX;
        public float animateFromTimeXPinned;
        private float animateFromTimeXReplies;
        private float animateFromTimeXViews;
        public boolean animateLocationIsExpired;
        boolean animateMessageText;
        private float animateNameX;
        private StaticLayout animateOutCaptionLayout;
        private ArrayList<MessageObject.TextLayoutBlock> animateOutTextBlocks;
        private boolean animatePinned;
        public boolean animatePlayingRound;
        public boolean animateRadius;
        boolean animateReplaceCaptionLayout;
        private boolean animateReplies;
        private StaticLayout animateRepliesLayout;
        public boolean animateReplyY;
        public boolean animateRoundVideoDotY;
        private boolean animateShouldDrawMenuDrawable;
        private boolean animateShouldDrawTimeOnMedia;
        private boolean animateSign;
        public boolean animateText;
        private StaticLayout animateTimeLayout;
        private int animateTimeWidth;
        public float animateToImageH;
        public float animateToImageW;
        public float animateToImageX;
        public float animateToImageY;
        public int[] animateToRadius;
        private int animateTotalCommentWidth;
        private StaticLayout animateViewsLayout;
        public float captionFromX;
        public float captionFromY;
        public float deltaBottom;
        public float deltaLeft;
        public float deltaRight;
        public float deltaTop;
        public boolean drawPinnedBottomBackground;
        public boolean ignoreAlpha;
        public boolean imageChangeBoundsTransition;
        public int lastBackgroundLeft;
        public int lastBackgroundRight;
        private float lastButtonX;
        private float lastButtonY;
        private int lastCommentArrowX;
        private boolean lastCommentDrawUnread;
        private StaticLayout lastCommentLayout;
        private int lastCommentUnreadX;
        private float lastCommentX;
        private int lastCommentsCount;
        private boolean lastDrawCommentNumber;
        public StaticLayout lastDrawDocTitleLayout;
        public StaticLayout lastDrawInfoLayout;
        public float lastDrawLocationExpireProgress;
        public String lastDrawLocationExpireText;
        public float lastDrawReplyY;
        public float lastDrawRoundVideoDotY;
        public boolean lastDrawTime;
        private StaticLayout lastDrawingCaptionLayout;
        public float lastDrawingCaptionX;
        public float lastDrawingCaptionY;
        private boolean lastDrawingEdited;
        public float lastDrawingImageH;
        public float lastDrawingImageW;
        public float lastDrawingImageX;
        public float lastDrawingImageY;
        private ArrayList<MessageObject.TextLayoutBlock> lastDrawingTextBlocks;
        public float lastDrawingTextX;
        public float lastDrawingTextY;
        public boolean lastDrawnForwardedName;
        int lastForwardNameWidth;
        float lastForwardNameX;
        public int lastForwardedNamesOffset;
        private boolean lastIsPinned;
        private boolean lastIsPlayingRound;
        public boolean lastLocatinIsExpired;
        private int lastRepliesCount;
        private StaticLayout lastRepliesLayout;
        private boolean lastShouldDrawMenuDrawable;
        private boolean lastShouldDrawTimeOnMedia;
        private String lastSignMessage;
        private StaticLayout lastTimeLayout;
        private int lastTimeWidth;
        public int lastTimeX;
        public float lastTimeXPinned;
        private float lastTimeXReplies;
        private float lastTimeXViews;
        public int lastTopOffset;
        private int lastTotalCommentWidth;
        private int lastViewsCount;
        private StaticLayout lastViewsLayout;
        public boolean messageEntering;
        private boolean moveCaption;
        public boolean shouldAnimateTimeX;
        public float toDeltaLeft;
        public float toDeltaRight;
        public boolean transformGroupToSingleMessage;
        public boolean updatePhotoImageX;
        public boolean wasDraw;
        public int[] imageRoundRadius = new int[4];
        public float captionEnterProgress = 1.0f;
        public float changePinnedBottomProgress = 1.0f;
        public Rect lastDrawingBackgroundRect = new Rect();
        public float animateChangeProgress = 1.0f;
        private ArrayList<BotButton> lastDrawBotButtons = new ArrayList<>();
        private ArrayList<BotButton> transitionBotButtons = new ArrayList<>();
        public int lastStatusDrawableParams = -1;
        public StaticLayout[] lastDrawnForwardedNameLayout = new StaticLayout[2];
        public StaticLayout[] animatingForwardedNameLayout = new StaticLayout[2];

        public TransitionParams() {
            ChatMessageCell.this = this$0;
        }

        public void recordDrawingState() {
            this.wasDraw = true;
            this.lastDrawingImageX = ChatMessageCell.this.photoImage.getImageX();
            this.lastDrawingImageY = ChatMessageCell.this.photoImage.getImageY();
            this.lastDrawingImageW = ChatMessageCell.this.photoImage.getImageWidth();
            this.lastDrawingImageH = ChatMessageCell.this.photoImage.getImageHeight();
            int[] r = ChatMessageCell.this.photoImage.getRoundRadius();
            System.arraycopy(r, 0, this.imageRoundRadius, 0, 4);
            if (ChatMessageCell.this.currentBackgroundDrawable != null) {
                this.lastDrawingBackgroundRect.set(ChatMessageCell.this.currentBackgroundDrawable.getBounds());
            }
            this.lastDrawingTextBlocks = ChatMessageCell.this.currentMessageObject.textLayoutBlocks;
            this.lastDrawingEdited = ChatMessageCell.this.edited;
            this.lastDrawingCaptionX = ChatMessageCell.this.captionX;
            this.lastDrawingCaptionY = ChatMessageCell.this.captionY;
            this.lastDrawingCaptionLayout = ChatMessageCell.this.captionLayout;
            this.lastDrawBotButtons.clear();
            if (!ChatMessageCell.this.botButtons.isEmpty()) {
                this.lastDrawBotButtons.addAll(ChatMessageCell.this.botButtons);
            }
            if (ChatMessageCell.this.commentLayout != null) {
                this.lastCommentsCount = ChatMessageCell.this.getRepliesCount();
                this.lastTotalCommentWidth = ChatMessageCell.this.totalCommentWidth;
                this.lastCommentLayout = ChatMessageCell.this.commentLayout;
                this.lastCommentArrowX = ChatMessageCell.this.commentArrowX;
                this.lastCommentUnreadX = ChatMessageCell.this.commentUnreadX;
                this.lastCommentDrawUnread = ChatMessageCell.this.commentDrawUnread;
                this.lastCommentX = ChatMessageCell.this.commentX;
                this.lastDrawCommentNumber = ChatMessageCell.this.drawCommentNumber;
            }
            this.lastRepliesCount = ChatMessageCell.this.getRepliesCount();
            this.lastViewsCount = ChatMessageCell.this.getMessageObject().messageOwner.views;
            this.lastRepliesLayout = ChatMessageCell.this.repliesLayout;
            this.lastViewsLayout = ChatMessageCell.this.viewsLayout;
            this.lastIsPinned = ChatMessageCell.this.isPinned;
            this.lastSignMessage = ChatMessageCell.this.lastPostAuthor;
            this.lastButtonX = ChatMessageCell.this.buttonX;
            this.lastButtonY = ChatMessageCell.this.buttonY;
            this.lastDrawTime = !ChatMessageCell.this.forceNotDrawTime;
            this.lastTimeX = ChatMessageCell.this.timeX;
            this.lastTimeLayout = ChatMessageCell.this.timeLayout;
            this.lastTimeWidth = ChatMessageCell.this.timeWidth;
            this.lastShouldDrawTimeOnMedia = ChatMessageCell.this.shouldDrawTimeOnMedia();
            this.lastTopOffset = ChatMessageCell.this.getTopMediaOffset();
            this.lastShouldDrawMenuDrawable = ChatMessageCell.this.shouldDrawMenuDrawable();
            this.lastLocatinIsExpired = ChatMessageCell.this.locationExpired;
            this.lastIsPlayingRound = ChatMessageCell.this.isPlayingRound;
            this.lastDrawingTextY = ChatMessageCell.this.textY;
            this.lastDrawingTextX = ChatMessageCell.this.textX;
            this.lastDrawnForwardedNameLayout[0] = ChatMessageCell.this.forwardedNameLayout[0];
            this.lastDrawnForwardedNameLayout[1] = ChatMessageCell.this.forwardedNameLayout[1];
            this.lastDrawnForwardedName = ChatMessageCell.this.currentMessageObject.needDrawForwarded();
            this.lastForwardNameX = ChatMessageCell.this.forwardNameX;
            this.lastForwardedNamesOffset = ChatMessageCell.this.namesOffset;
            this.lastForwardNameWidth = ChatMessageCell.this.forwardedNameWidth;
            this.lastBackgroundLeft = ChatMessageCell.this.getCurrentBackgroundLeft();
            this.lastBackgroundRight = ChatMessageCell.this.currentBackgroundDrawable.getBounds().right;
            ChatMessageCell.this.reactionsLayoutInBubble.recordDrawingState();
            if (ChatMessageCell.this.replyNameLayout != null) {
                this.lastDrawReplyY = ChatMessageCell.this.replyStartY;
            } else {
                this.lastDrawReplyY = 0.0f;
            }
        }

        public void recordDrawingStatePreview() {
            this.lastDrawnForwardedNameLayout[0] = ChatMessageCell.this.forwardedNameLayout[0];
            this.lastDrawnForwardedNameLayout[1] = ChatMessageCell.this.forwardedNameLayout[1];
            this.lastDrawnForwardedName = ChatMessageCell.this.currentMessageObject.needDrawForwarded();
            this.lastForwardNameX = ChatMessageCell.this.forwardNameX;
            this.lastForwardedNamesOffset = ChatMessageCell.this.namesOffset;
            this.lastForwardNameWidth = ChatMessageCell.this.forwardedNameWidth;
        }

        /* JADX WARN: Code restructure failed: missing block: B:148:0x03a7, code lost:
            if (java.lang.Math.abs(org.telegram.ui.Cells.ChatMessageCell.this.timeX - r18.lastTimeX) > 1) goto L150;
         */
        /*
            Code decompiled incorrectly, please refer to instructions dump.
        */
        public boolean animateChange() {
            boolean z;
            String editedStr;
            String text;
            int i;
            int i2 = 0;
            if (!this.wasDraw) {
                return false;
            }
            boolean changed = false;
            this.animateMessageText = false;
            if (ChatMessageCell.this.currentMessageObject.textLayoutBlocks != this.lastDrawingTextBlocks) {
                boolean sameText = true;
                if (ChatMessageCell.this.currentMessageObject.textLayoutBlocks != null && this.lastDrawingTextBlocks != null && ChatMessageCell.this.currentMessageObject.textLayoutBlocks.size() == this.lastDrawingTextBlocks.size()) {
                    for (int i3 = 0; i3 < this.lastDrawingTextBlocks.size(); i3++) {
                        String newText = ChatMessageCell.this.currentMessageObject.textLayoutBlocks.get(i3).textLayout == null ? null : ChatMessageCell.this.currentMessageObject.textLayoutBlocks.get(i3).textLayout.getText().toString();
                        String oldText = this.lastDrawingTextBlocks.get(i3).textLayout == null ? null : this.lastDrawingTextBlocks.get(i3).textLayout.getText().toString();
                        if ((newText == null && oldText != null) || ((newText != null && oldText == null) || !newText.equals(oldText))) {
                            sameText = false;
                            break;
                        }
                    }
                } else {
                    sameText = false;
                }
                if (!sameText) {
                    this.animateMessageText = true;
                    this.animateOutTextBlocks = this.lastDrawingTextBlocks;
                    changed = true;
                }
            }
            if (ChatMessageCell.this.edited && !this.lastDrawingEdited && ChatMessageCell.this.timeLayout != null && (i = (text = ChatMessageCell.this.timeLayout.getText().toString()).indexOf((editedStr = LocaleController.getString("EditedMessage", R.string.EditedMessage)))) >= 0) {
                if (i == 0) {
                    this.animateEditedLayout = new StaticLayout(editedStr, Theme.chat_timePaint, ChatMessageCell.this.timeTextWidth + AndroidUtilities.dp(100.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                    SpannableStringBuilder spannableStringBuilder = new SpannableStringBuilder();
                    spannableStringBuilder.append((CharSequence) editedStr);
                    spannableStringBuilder.append((CharSequence) text.substring(editedStr.length()));
                    spannableStringBuilder.setSpan(new EmptyStubSpan(), 0, editedStr.length(), 0);
                    this.animateTimeLayout = new StaticLayout(spannableStringBuilder, Theme.chat_timePaint, ChatMessageCell.this.timeTextWidth + AndroidUtilities.dp(100.0f), Layout.Alignment.ALIGN_NORMAL, 1.0f, 0.0f, false);
                    this.animateEditedWidthDiff = ChatMessageCell.this.timeWidth - this.lastTimeWidth;
                } else {
                    this.animateEditedWidthDiff = 0;
                    this.animateEditedLayout = null;
                    this.animateTimeLayout = this.lastTimeLayout;
                }
                this.animateEditedEnter = true;
                this.animateTimeWidth = this.lastTimeWidth;
                this.animateFromTimeX = this.lastTimeX;
                this.shouldAnimateTimeX = true;
                changed = true;
            }
            StaticLayout staticLayout = ChatMessageCell.this.captionLayout;
            StaticLayout staticLayout2 = this.lastDrawingCaptionLayout;
            if (staticLayout == staticLayout2) {
                if (ChatMessageCell.this.captionLayout != null && this.lastDrawingCaptionLayout != null) {
                    ChatMessageCell.this.updateCaptionLayout();
                    if (this.lastDrawingCaptionX != ChatMessageCell.this.captionX || this.lastDrawingCaptionY != ChatMessageCell.this.captionY) {
                        this.moveCaption = true;
                        this.captionFromX = this.lastDrawingCaptionX;
                        this.captionFromY = this.lastDrawingCaptionY;
                        changed = true;
                    }
                }
            } else {
                String oldCaption = staticLayout2 == null ? null : staticLayout2.getText().toString();
                String currentCaption = ChatMessageCell.this.captionLayout == null ? null : ChatMessageCell.this.captionLayout.getText().toString();
                if ((currentCaption == null) != (oldCaption == null) || (oldCaption != null && !oldCaption.equals(currentCaption))) {
                    this.animateReplaceCaptionLayout = true;
                    this.animateOutCaptionLayout = this.lastDrawingCaptionLayout;
                    changed = true;
                } else {
                    ChatMessageCell.this.updateCaptionLayout();
                    if (this.lastDrawingCaptionX != ChatMessageCell.this.captionX || this.lastDrawingCaptionY != ChatMessageCell.this.captionY) {
                        this.moveCaption = true;
                        this.captionFromX = this.lastDrawingCaptionX;
                        this.captionFromY = this.lastDrawingCaptionY;
                        changed = true;
                    }
                }
            }
            if (!this.lastDrawBotButtons.isEmpty() || !ChatMessageCell.this.botButtons.isEmpty()) {
                if (this.lastDrawBotButtons.size() != ChatMessageCell.this.botButtons.size()) {
                    this.animateBotButtonsChanged = true;
                }
                if (!this.animateBotButtonsChanged) {
                    for (int i4 = 0; i4 < ChatMessageCell.this.botButtons.size(); i4++) {
                        BotButton button1 = (BotButton) ChatMessageCell.this.botButtons.get(i4);
                        BotButton button2 = this.lastDrawBotButtons.get(i4);
                        if (button1.x != button2.x || button1.width != button2.width) {
                            this.animateBotButtonsChanged = true;
                            break;
                        }
                    }
                }
                if (this.animateBotButtonsChanged) {
                    this.transitionBotButtons.addAll(this.lastDrawBotButtons);
                }
            }
            if ((ChatMessageCell.this.documentAttachType == 3 || ChatMessageCell.this.documentAttachType == 1) && (ChatMessageCell.this.buttonX != this.lastButtonX || ChatMessageCell.this.buttonY != this.lastButtonY)) {
                this.animateFromButtonX = this.lastButtonX;
                this.animateFromButtonY = this.lastButtonY;
                this.animateButton = true;
                changed = true;
            }
            boolean timeDrawablesIsChanged = false;
            if (this.lastIsPinned != ChatMessageCell.this.isPinned) {
                this.animatePinned = true;
                changed = true;
                timeDrawablesIsChanged = true;
            }
            if ((this.lastRepliesLayout != null || ChatMessageCell.this.repliesLayout != null) && this.lastRepliesCount != ChatMessageCell.this.getRepliesCount()) {
                this.animateRepliesLayout = this.lastRepliesLayout;
                this.animateReplies = true;
                changed = true;
                timeDrawablesIsChanged = true;
            }
            if (this.lastViewsLayout != null && this.lastViewsCount != ChatMessageCell.this.getMessageObject().messageOwner.views) {
                this.animateViewsLayout = this.lastViewsLayout;
                changed = true;
                timeDrawablesIsChanged = true;
            }
            if (ChatMessageCell.this.commentLayout != null && this.lastCommentsCount != ChatMessageCell.this.getRepliesCount()) {
                StaticLayout staticLayout3 = this.lastCommentLayout;
                if (staticLayout3 == null || TextUtils.equals(staticLayout3.getText(), ChatMessageCell.this.commentLayout.getText())) {
                    this.animateCommentsLayout = null;
                } else {
                    this.animateCommentsLayout = this.lastCommentLayout;
                }
                this.animateTotalCommentWidth = this.lastTotalCommentWidth;
                this.animateCommentX = this.lastCommentX;
                this.animateCommentArrowX = this.lastCommentArrowX;
                this.animateCommentUnreadX = this.lastCommentUnreadX;
                this.animateCommentDrawUnread = this.lastCommentDrawUnread;
                this.animateDrawCommentNumber = this.lastDrawCommentNumber;
                this.animateComments = true;
                changed = true;
            }
            if (!TextUtils.equals(this.lastSignMessage, ChatMessageCell.this.lastPostAuthor)) {
                this.animateSign = true;
                this.animateNameX = ChatMessageCell.this.nameX;
                changed = true;
            }
            if (this.lastDrawTime == ChatMessageCell.this.forceNotDrawTime) {
                this.animateDrawingTimeAlpha = true;
                this.animateViewsLayout = null;
                changed = true;
            } else if (this.lastShouldDrawTimeOnMedia != ChatMessageCell.this.shouldDrawTimeOnMedia()) {
                this.animateEditedEnter = false;
                this.animateShouldDrawTimeOnMedia = true;
                this.animateFromTimeX = this.lastTimeX;
                this.animateTimeLayout = this.lastTimeLayout;
                this.animateTimeWidth = this.lastTimeWidth;
                changed = true;
            } else {
                boolean z2 = !timeDrawablesIsChanged ? true : true;
                this.shouldAnimateTimeX = z2;
                this.animateTimeWidth = this.lastTimeWidth;
                this.animateFromTimeX = this.lastTimeX;
                this.animateFromTimeXViews = this.lastTimeXViews;
                this.animateFromTimeXReplies = this.lastTimeXReplies;
                this.animateFromTimeXPinned = this.lastTimeXPinned;
            }
            if (this.lastShouldDrawMenuDrawable == ChatMessageCell.this.shouldDrawMenuDrawable()) {
                z = true;
            } else {
                z = true;
                this.animateShouldDrawMenuDrawable = true;
            }
            if (this.lastLocatinIsExpired != ChatMessageCell.this.locationExpired) {
                this.animateLocationIsExpired = z;
            }
            if (this.lastIsPlayingRound != ChatMessageCell.this.isPlayingRound) {
                this.animatePlayingRound = z;
                changed = true;
            }
            if (this.lastDrawingTextY != ChatMessageCell.this.textY) {
                this.animateText = true;
                this.animateFromTextY = this.lastDrawingTextY;
                changed = true;
            }
            if (ChatMessageCell.this.currentMessageObject != null && this.lastDrawnForwardedName != ChatMessageCell.this.currentMessageObject.needDrawForwarded()) {
                this.animateForwardedLayout = true;
                StaticLayout[] staticLayoutArr = this.animatingForwardedNameLayout;
                StaticLayout[] staticLayoutArr2 = this.lastDrawnForwardedNameLayout;
                staticLayoutArr[0] = staticLayoutArr2[0];
                staticLayoutArr[1] = staticLayoutArr2[1];
                this.animateForwardNameX = this.lastForwardNameX;
                this.animateForwardedNamesOffset = this.lastForwardedNamesOffset;
                this.animateForwardNameWidth = this.lastForwardNameWidth;
                changed = true;
            }
            ChatMessageCell.this.updateReactionLayoutPosition();
            if (ChatMessageCell.this.reactionsLayoutInBubble.animateChange()) {
                changed = true;
            }
            if (ChatMessageCell.this.currentMessageObject.isRoundVideo()) {
                int i5 = ChatMessageCell.this.layoutHeight;
                if (ChatMessageCell.this.drawPinnedBottom) {
                    i2 = 2;
                }
                float y1 = i5 - AndroidUtilities.dp(28 - i2);
                if (!ChatMessageCell.this.reactionsLayoutInBubble.isEmpty) {
                    y1 -= ChatMessageCell.this.reactionsLayoutInBubble.totalHeight;
                }
                float f = this.lastDrawRoundVideoDotY;
                if (y1 != f) {
                    this.animateRoundVideoDotY = true;
                    this.animateFromRoundVideoDotY = f;
                    changed = true;
                }
            }
            if (ChatMessageCell.this.replyNameLayout != null) {
                float f2 = this.lastDrawReplyY;
                if (ChatMessageCell.this.replyStartX != f2 && f2 != 0.0f) {
                    this.animateReplyY = true;
                    this.animateFromReplyY = f2;
                    return true;
                }
                return changed;
            }
            return changed;
        }

        public void onDetach() {
            this.wasDraw = false;
        }

        public void resetAnimation() {
            this.animateChange = false;
            this.animatePinned = false;
            this.animateBackgroundBoundsInner = false;
            this.animateBackgroundWidth = false;
            this.deltaLeft = 0.0f;
            this.deltaRight = 0.0f;
            this.deltaBottom = 0.0f;
            this.deltaTop = 0.0f;
            this.toDeltaLeft = 0.0f;
            this.toDeltaRight = 0.0f;
            if (this.imageChangeBoundsTransition && this.animateToImageW != 0.0f && this.animateToImageH != 0.0f) {
                ChatMessageCell.this.photoImage.setImageCoords(this.animateToImageX, this.animateToImageY, this.animateToImageW, this.animateToImageH);
            }
            if (this.animateRadius) {
                ChatMessageCell.this.photoImage.setRoundRadius(this.animateToRadius);
            }
            this.animateToImageX = 0.0f;
            this.animateToImageY = 0.0f;
            this.animateToImageW = 0.0f;
            this.animateToImageH = 0.0f;
            this.imageChangeBoundsTransition = false;
            this.changePinnedBottomProgress = 1.0f;
            this.captionEnterProgress = 1.0f;
            this.animateRadius = false;
            this.animateChangeProgress = 1.0f;
            this.animateMessageText = false;
            this.animateOutTextBlocks = null;
            this.animateEditedLayout = null;
            this.animateTimeLayout = null;
            this.animateEditedEnter = false;
            this.animateReplaceCaptionLayout = false;
            this.transformGroupToSingleMessage = false;
            this.animateOutCaptionLayout = null;
            this.moveCaption = false;
            this.animateDrawingTimeAlpha = false;
            this.transitionBotButtons.clear();
            this.animateButton = false;
            this.animateReplies = false;
            this.animateRepliesLayout = null;
            this.animateComments = false;
            this.animateCommentsLayout = null;
            this.animateViewsLayout = null;
            this.animateShouldDrawTimeOnMedia = false;
            this.animateShouldDrawMenuDrawable = false;
            this.shouldAnimateTimeX = false;
            this.animateSign = false;
            this.animateDrawingTimeAlpha = false;
            this.animateLocationIsExpired = false;
            this.animatePlayingRound = false;
            this.animateText = false;
            this.animateForwardedLayout = false;
            StaticLayout[] staticLayoutArr = this.animatingForwardedNameLayout;
            staticLayoutArr[0] = null;
            staticLayoutArr[1] = null;
            this.animateRoundVideoDotY = false;
            this.animateReplyY = false;
            ChatMessageCell.this.reactionsLayoutInBubble.resetAnimation();
        }

        public boolean supportChangeAnimation() {
            return true;
        }

        public int createStatusDrawableParams() {
            int i = 8;
            int i2 = 4;
            if (!ChatMessageCell.this.currentMessageObject.isOutOwner()) {
                boolean drawClock = ChatMessageCell.this.currentMessageObject.isSending() || ChatMessageCell.this.currentMessageObject.isEditing();
                boolean drawError = ChatMessageCell.this.currentMessageObject.isSendError();
                if (!drawClock) {
                    i2 = 0;
                }
                if (!drawError) {
                    i = 0;
                }
                return i | i2;
            }
            int i3 = 0;
            boolean drawCheck2 = false;
            boolean drawClock2 = false;
            boolean drawError2 = false;
            if (!ChatMessageCell.this.currentMessageObject.isSending() && !ChatMessageCell.this.currentMessageObject.isEditing()) {
                if (!ChatMessageCell.this.currentMessageObject.isSendError()) {
                    if (ChatMessageCell.this.currentMessageObject.isSent()) {
                        if (!ChatMessageCell.this.currentMessageObject.scheduled && !ChatMessageCell.this.currentMessageObject.isUnread()) {
                            i3 = 1;
                        } else {
                            i3 = 0;
                        }
                        drawCheck2 = true;
                        drawClock2 = false;
                        drawError2 = false;
                    }
                } else {
                    drawCheck2 = false;
                    drawClock2 = false;
                    drawError2 = true;
                }
            } else {
                drawCheck2 = false;
                drawClock2 = true;
                drawError2 = false;
            }
            int i4 = (drawCheck2 ? 2 : 0) | i3;
            if (!drawClock2) {
                i2 = 0;
            }
            int i5 = i2 | i4;
            if (!drawError2) {
                i = 0;
            }
            return i | i5;
        }
    }

    private int getThemedColor(String key) {
        Theme.ResourcesProvider resourcesProvider = this.resourcesProvider;
        Integer color = resourcesProvider != null ? resourcesProvider.getColor(key) : null;
        return color != null ? color.intValue() : Theme.getColor(key);
    }

    private Drawable getThemedDrawable(String key) {
        Theme.ResourcesProvider resourcesProvider = this.resourcesProvider;
        Drawable drawable = resourcesProvider != null ? resourcesProvider.getDrawable(key) : null;
        return drawable != null ? drawable : Theme.getThemeDrawable(key);
    }

    private Paint getThemedPaint(String paintKey) {
        Theme.ResourcesProvider resourcesProvider = this.resourcesProvider;
        Paint paint = resourcesProvider != null ? resourcesProvider.getPaint(paintKey) : null;
        return paint != null ? paint : Theme.getThemePaint(paintKey);
    }

    private boolean hasGradientService() {
        Theme.ResourcesProvider resourcesProvider = this.resourcesProvider;
        return resourcesProvider != null ? resourcesProvider.hasGradientService() : Theme.hasGradientService();
    }
}
